"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[172],{32:function(e,t,n){n.a(e,async function(e,r){try{n.r(t),n.d(t,{default:function(){return ToolBoxV2}});var o=n(8896),a=n(2052),l=n(2322);n(7157);var s=n(2105),i=n(4821),c=n.n(i),u=n(1791),d=n(1798),f=n(9634),p=n(95),h=n(1648),m=n(7644),x=n(1430).Buffer,b=e([a]);a=(b.then?(await b)():b)[0];let y={uuid:(0,f.Z)(),name:"weather-api",description:"Get the weather data for a given location.",schema:c()('\n        z.object({\n            location: z.string().nonempty()\n                    .describe("The location: district, state to get weather data for."),\n        })\n    '),action:c()('\n        async function ({ location }) {\n            const URL = `https://farmerchat.farmstack.co/vistaar/api/weather/get_weather_forecast/?location=${location}&source=TOMORROW_NOW`;\n        \n            try {\n                const response = await fetch(URL);\n                if (!response.ok) {\n                    throw new Error("Failed to fetch weather data.");\n                }\n                const text_data = await response.text();\n                return text_data;\n            } catch (error) {\n                throw new Error("Failed to fetch weather data.");\n            }\n        } \n    ')},g={uuid:(0,f.Z)(),name:"doc-qa-tool",description:"Get answers to crop-related queries.",schema:c()('\n        z.object({\n            query: z.string().nonempty().describe("The question related to a crop."),\n            crop: z.enum(["coffee", "dairy", "wheat"]).describe("The crop to which query is related."),\n        })\n    '),action:c()("\n        async function ({ query, crop }) {\n            const url = \"https://farmerchat.farmstack.co/dev/telegram_app/doc_qa/\";\n\n            const payload = {\n                query,\n                crop: crop.charAt(0).toUpperCase() + crop.slice(1),\n            };\n            const headers = {\n                'Content-Type': 'application/json'\n            };\n\n            try {\n                const response = await fetch(url, {\n                    method: 'POST',\n                    headers,\n                    body: JSON.stringify(payload),\n                });\n                if (!response.ok) {\n                    throw new Error(\"Failed to get answers.\");\n                }\n                const data = await response.json();\n                return data.response || '';\n            } catch (error) {\n                throw new Error(\"Failed to get answers.\");\n            }\n        }\n    ")},w={uuid:(0,f.Z)(),name:"video-search-tool",description:"Get the crop-related video link.",schema:c()('\n        z.object({\n            query: z.string().nonempty().max(255).describe("The question related to a crop."),\n            crop: z.enum(["coffee", "dairy", "wheat"]).describe("The crop to which query is related."),\n        })\n    '),action:c()("\n        async function ({ query, crop }) {\n            const url = \"https://farmerchat.farmstack.co/dev/telegram_app/video_search/\";\n\n            const payload = {\n                query,\n                crop: crop.charAt(0).toUpperCase() + crop.slice(1) // Capitalize the crop name\n            };\n            const headers = {\n                'Content-Type': 'application/json'\n            };\n\n            try {\n                const response = await fetch(url, {\n                    method: 'POST',\n                    headers,\n                    body: JSON.stringify(payload),\n                });\n                if (!response.ok) {\n                    throw new Error(\"Failed to get video link.\");\n                }\n                const data = await response.json();\n                return data.video_link || '';\n            } catch (error) {\n                throw new Error(\"Failed to get video link.\");\n            }\n        }\n    ")};function ToolBoxV2(){let[e,t]=(0,d.useState)(null),[n,r]=(0,d.useState)(null),[i,c]=(0,s._)(u.RM,"");(0,d.useEffect)(()=>{async function loadTools(){let e=await (0,p.Pb)(),t=[];for(let[n,r]of e){let e=await (0,p.Pr)(n);t.push(e)}return t}Promise.resolve().then(()=>loadTools()).then(e=>t(e)).catch(e=>console.error(e))},[]);let{token:f,username:b}=(0,h.yH)();function handleEdit(e){r(e)}async function handleDelete(n){let o=e.filter(e=>e.uuid!==n.uuid);await (0,p._h)(n.uuid),r(null),t(o)}async function handleToolSave(n){console.log("Saving tool: ",n);let o=e.map(e=>e.uuid===n.uuid?n:e);await (0,p.yk)(n),r(null),t(o)}async function handleAddTool(){if(!e)return;let n=createNewToolTpl(),o=[...e,n];t(o),r(n)}async function handleExport(e){let t=JSON.stringify(e,null,2),n=new Blob([t],{type:"application/json"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download="".concat(e.uuid,".json"),o.click()}async function exportToGithub(e){if(!b||!i)return;let t=JSON.stringify(e,null,2),{owner:n,repo:r,branch:o}=(0,h.v7)(i),a=new m.v({auth:f}),l="tools/".concat(e.uuid,".json"),s="at-ui: update tool: ".concat(e.name),c=x.from(t).toString("base64"),u=await a.repos.getContent({owner:n,repo:r,path:l,ref:o}).then(e=>e.data.sha).catch(()=>null);await a.repos.createOrUpdateFileContents({owner:n,repo:r,branch:o,path:l,message:s,content:c,sha:u})}async function handleExportToGH(e){try{await exportToGithub(e),l.Am.success("Tool exported to GitHub: ".concat(e.name))}catch(e){console.error(e),l.Am.error("Failed to export tool to GitHub: ".concat(e))}}let y=(0,o.jsx)("p",{children:"No tools"});return(e&&e.length>0&&(y=(0,o.jsxs)(o.Fragment,{children:[(0,o.jsx)("ol",{className:"w-full list-inside list-decimal",children:e.map(e=>(0,o.jsxs)("li",{children:[(0,o.jsx)("span",{className:"text-xl",children:e.name}),(0,o.jsx)("h3",{children:e.description}),(0,o.jsx)("button",{type:"button",className:"mt-4 text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:()=>handleEdit(e),children:"Edit"}),(0,o.jsx)("button",{type:"button",className:"mt-4 text-white bg-green-700 hover:bg-green-800 focus:outline-none focus:ring-4 focus:ring-green-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:bg-green-600 dark:hover:bg-green-700 dark:focus:ring-green-800",onClick:()=>handleExport(e),children:"Export"}),(0,o.jsx)("button",{type:"button",className:"mt-4 text-white bg-green-700 hover:bg-red-800 focus:outline-none focus:ring-4 focus:ring-red-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",onClick:()=>handleExportToGH(e),children:"Sync to GH"}),(0,o.jsx)("button",{type:"button",className:"mt-4 text-white bg-red-700 hover:bg-red-800 focus:outline-none focus:ring-4 focus:ring-red-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:bg-red-600 dark:hover:bg-red-700 dark:focus:ring-red-800",onClick:()=>handleDelete(e),children:"Delete"})]},e.uuid))}),(0,o.jsx)("button",{type:"button",className:"mt-4 text-white bg-blue-700 hover:bg-blue-800 focus:outline-none focus:ring-4 focus:ring-blue-300 font-medium rounded-full text-sm px-5 py-2.5 text-center me-2 mb-2 dark:bg-blue-600 dark:hover:bg-blue-700 dark:focus:ring-blue-800",onClick:()=>handleAddTool(),children:"Add Tool"})]})),n)?(0,o.jsx)(a.Z,{info:n,onSave:handleToolSave,onDelete:handleDelete}):(0,o.jsxs)("div",{className:"p-4 md:p-8 rounded bg-[#25252d] w-full max-h-[100vh] overflow-auto",children:[(0,o.jsx)("h1",{className:"text-3xl md:text-4xl mb-4",children:"Tools and toolkitss Configuration"}),y,(0,o.jsx)(l.Ix,{})]})}function createNewToolTpl(){return{uuid:(0,f.Z)(),name:"new-tool",description:"New tool description",parameters:{},action:c()("\n                async function ({ }) {\n                    // Define the action here\n                }\n            ")}}JSON.stringify([y,g,w]),r()}catch(e){r(e)}})},2052:function(e,t,n){n.a(e,async function(e,r){try{n.d(t,{Z:function(){return Tool}});var o=n(8896),a=n(2809),l=n(7932),s=n(1798),i=n(2322),c=e([a]);function Tool(e){let{info:t,onSave:n,onDelete:r}=e,c=t.uuid,[u,d]=(0,s.useState)(null),f=(0,s.useRef)(null),p=(0,s.useRef)(null),h=(0,s.useRef)(null),m=(0,s.useRef)(null),x=(0,s.useRef)(null);function handleDelete(){r&&r(t)}async function ensureUpload(){let e=new l.W;return d(e),(0,i.Am)("Please upload a file to test the action.",{theme:"dark",autoClose:!1}),await e.promise()}function createToolFromForm(){var e,t,n,r;let o=null===(e=f.current)||void 0===e?void 0:e.value;if(!o)return i.Am.error("Name is required."),null;let l=null===(t=p.current)||void 0===t?void 0:t.value;if(!l)return i.Am.error("Description is required."),null;let s=null===(n=h.current)||void 0===n?void 0:n.value;if(!s)return i.Am.error("Parameters are required: use {} if none."),null;let u=null===(r=m.current)||void 0===r?void 0:r.value;if(!u)return i.Am.error("Action is required."),null;let d={uuid:c,name:o,description:l,parameters:JSON.parse(s),action:u},x=(0,a.y)(d,{ensureUpload});return{tool:x,info:d}}async function handleTest(){var e;let t=createToolFromForm();if(!t)return;let{tool:n}=t,r=null===(e=x.current)||void 0===e?void 0:e.value;try{if(r){let e=await n.run(JSON.parse(r));"string"!=typeof e&&(e=JSON.stringify(e,null,2)),console.log("Action result: ",e),i.Am.success("Action result: ".concat(e))}return}catch(e){console.error("Error while creating tool info"),console.error(e),i.Am.error("Error while creating tool info: ".concat(e));return}}async function handleSave(){let e=await createToolFromForm();if(!e)return;let{info:t}=e;n&&n(t)}async function handleFileSelect(e){let t=e.target.files;if(!t)return;let n=t[0];u&&u.put(n)}return(0,o.jsxs)("div",{className:"p-4 md:p-8 rounded bg-[#35252d] w-full",children:[(0,o.jsx)("h1",{className:"text-3xl md:text-4xl mb-4",children:"Tool"}),(0,o.jsx)("form",{onSubmit:e=>e.preventDefault(),children:(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{className:"flex flex-row p-1 items-baseline",children:[(0,o.jsx)("label",{children:"Name:"}),(0,o.jsx)("input",{className:"m-4",type:"text",defaultValue:t.name,ref:f,name:"name"}),(0,o.jsx)("label",{children:"Description:"}),(0,o.jsx)("input",{className:"m-4 flex-grow",type:"text",defaultValue:t.description,name:"description",ref:p})]}),(0,o.jsxs)("li",{className:"flex flex-row p-1 w-full",children:[(0,o.jsx)("div",{className:"p-1 flex-grow",children:(0,o.jsxs)("label",{children:["Parameters JSON Schema:",(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{className:"m-4 w-full monospace",rows:15,defaultValue:JSON.stringify(t.parameters,null,2),name:"parameters",ref:h})]})}),(0,o.jsx)("div",{className:"p-1 flex-grow",children:(0,o.jsxs)("label",{children:["Action:",(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{className:"m-4 w-full monospace",rows:15,defaultValue:t.action,name:"action",ref:m})]})}),(0,o.jsx)("div",{className:"p-1 flex-grow",children:(0,o.jsxs)("label",{children:["Action:",(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{className:"m-4 w-full monospace",rows:15,placeholder:"Enter test input as JSON here.",name:"testInput",ref:x})]})})]}),(0,o.jsxs)("li",{className:"flex flex-row p-1 w-full",children:[(0,o.jsx)("button",{type:"submit",className:"shrink-0 px-8 py-4 bg-sky-600 rounded w-28",onClick:e=>handleSave(),children:"Save"})," ",(0,o.jsx)("button",{type:"submit",className:"shrink-0 px-8 py-4 bg-sky-600 rounded w-28",onClick:e=>handleTest(),children:"Test"})," ",(0,o.jsx)("button",{type:"submit",className:"shrink-0 px-8 py-4 bg-sky-600 rounded w-28",onClick:e=>handleDelete(),children:"Delete"}),(0,o.jsxs)("label",{htmlFor:"file-input",className:"mx-2 px-8 py-4 bg-sky-600 rounded cursor-pointer",children:["\uD83D\uDDBC",(0,o.jsx)("input",{disabled:!u,type:"file",className:"hidden",id:"file-input",onChange:handleFileSelect})]})]})]})}),(0,o.jsx)(i.Ix,{})]})}a=(c.then?(await c)():c)[0],r()}catch(e){r(e)}})},9634:function(e,t,n){let r;n.d(t,{Z:function(){return esm_browser_v4}});let o="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var a={randomUUID:o};let l=new Uint8Array(16);function rng(){if(!r&&!(r="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return r(l)}let s=[];for(let e=0;e<256;++e)s.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return s[e[t+0]]+s[e[t+1]]+s[e[t+2]]+s[e[t+3]]+"-"+s[e[t+4]]+s[e[t+5]]+"-"+s[e[t+6]]+s[e[t+7]]+"-"+s[e[t+8]]+s[e[t+9]]+"-"+s[e[t+10]]+s[e[t+11]]+s[e[t+12]]+s[e[t+13]]+s[e[t+14]]+s[e[t+15]]}var esm_browser_v4=function(e,t,n){if(a.randomUUID&&!t&&!e)return a.randomUUID();e=e||{};let r=e.random||(e.rng||rng)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t){n=n||0;for(let e=0;e<16;++e)t[n+e]=r[e];return t}return unsafeStringify(r)}}}]);