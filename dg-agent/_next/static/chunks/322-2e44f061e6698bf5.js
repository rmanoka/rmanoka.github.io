(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[322],{9919:function(a,i,s){"use strict";a=s.nmd(a);let wrapAnsi256=(a=0)=>i=>`\u001B[${38+a};5;${i}m`,wrapAnsi16m=(a=0)=>(i,s,o)=>`\u001B[${38+a};2;${i};${s};${o}m`;Object.defineProperty(a,"exports",{enumerable:!0,get:function(){let a=new Map,i={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[s,o]of(i.color.gray=i.color.blackBright,i.bgColor.bgGray=i.bgColor.bgBlackBright,i.color.grey=i.color.blackBright,i.bgColor.bgGrey=i.bgColor.bgBlackBright,Object.entries(i))){for(let[s,c]of Object.entries(o))i[s]={open:`\u001B[${c[0]}m`,close:`\u001B[${c[1]}m`},o[s]=i[s],a.set(c[0],c[1]);Object.defineProperty(i,s,{value:o,enumerable:!1})}return Object.defineProperty(i,"codes",{value:a,enumerable:!1}),i.color.close="\x1b[39m",i.bgColor.close="\x1b[49m",i.color.ansi256=wrapAnsi256(),i.color.ansi16m=wrapAnsi16m(),i.bgColor.ansi256=wrapAnsi256(10),i.bgColor.ansi16m=wrapAnsi16m(10),Object.defineProperties(i,{rgbToAnsi256:{value:(a,i,s)=>a===i&&i===s?a<8?16:a>248?231:Math.round((a-8)/247*24)+232:16+36*Math.round(a/255*5)+6*Math.round(i/255*5)+Math.round(s/255*5),enumerable:!1},hexToRgb:{value:a=>{let i=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(a.toString(16));if(!i)return[0,0,0];let{colorString:s}=i.groups;3===s.length&&(s=s.split("").map(a=>a+a).join(""));let o=Number.parseInt(s,16);return[o>>16&255,o>>8&255,255&o]},enumerable:!1},hexToAnsi256:{value:a=>i.rgbToAnsi256(...i.hexToRgb(a)),enumerable:!1}}),i}})},1226:function(a,i){"use strict";i.byteLength=byteLength,i.toByteArray=toByteArray,i.fromByteArray=fromByteArray;for(var s=[],o=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=0,A=w.length;P<A;++P)s[P]=w[P],o[w.charCodeAt(P)]=P;function getLens(a){var i=a.length;if(i%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=a.indexOf("=");-1===s&&(s=i);var o=s===i?0:4-s%4;return[s,o]}function byteLength(a){var i=getLens(a),s=i[0],o=i[1];return(s+o)*3/4-o}function _byteLength(a,i,s){return(i+s)*3/4-s}function toByteArray(a){var i,s,w=getLens(a),P=w[0],A=w[1],x=new c(_byteLength(a,P,A)),k=0,R=A>0?P-4:P;for(s=0;s<R;s+=4)i=o[a.charCodeAt(s)]<<18|o[a.charCodeAt(s+1)]<<12|o[a.charCodeAt(s+2)]<<6|o[a.charCodeAt(s+3)],x[k++]=i>>16&255,x[k++]=i>>8&255,x[k++]=255&i;return 2===A&&(i=o[a.charCodeAt(s)]<<2|o[a.charCodeAt(s+1)]>>4,x[k++]=255&i),1===A&&(i=o[a.charCodeAt(s)]<<10|o[a.charCodeAt(s+1)]<<4|o[a.charCodeAt(s+2)]>>2,x[k++]=i>>8&255,x[k++]=255&i),x}function tripletToBase64(a){return s[a>>18&63]+s[a>>12&63]+s[a>>6&63]+s[63&a]}function encodeChunk(a,i,s){for(var o=[],c=i;c<s;c+=3)o.push(tripletToBase64((a[c]<<16&16711680)+(a[c+1]<<8&65280)+(255&a[c+2])));return o.join("")}function fromByteArray(a){for(var i,o=a.length,c=o%3,w=[],P=0,A=o-c;P<A;P+=16383)w.push(encodeChunk(a,P,P+16383>A?A:P+16383));return 1===c?w.push(s[(i=a[o-1])>>2]+s[i<<4&63]+"=="):2===c&&w.push(s[(i=(a[o-2]<<8)+a[o-1])>>10]+s[i>>4&63]+s[i<<2&63]+"="),w.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},2455:function(a){"use strict";let i=/[\p{Lu}]/u,s=/[\p{Ll}]/u,o=/^[\p{Lu}](?![\p{Lu}])/gu,c=/([\p{Alpha}\p{N}_]|$)/u,w=/[_.\- ]+/,P=RegExp("^"+w.source),A=RegExp(w.source+c.source,"gu"),x=RegExp("\\d+"+c.source,"gu"),preserveCamelCase=(a,o,c)=>{let w=!1,P=!1,A=!1;for(let x=0;x<a.length;x++){let k=a[x];w&&i.test(k)?(a=a.slice(0,x)+"-"+a.slice(x),w=!1,A=P,P=!0,x++):P&&A&&s.test(k)?(a=a.slice(0,x-1)+"-"+a.slice(x-1),A=P,P=!1,w=!0):(w=o(k)===k&&c(k)!==k,A=P,P=c(k)===k&&o(k)!==k)}return a},preserveConsecutiveUppercase=(a,i)=>(o.lastIndex=0,a.replace(o,a=>i(a))),postProcess=(a,i)=>(A.lastIndex=0,x.lastIndex=0,a.replace(A,(a,s)=>i(s)).replace(x,a=>i(a))),camelCase=(a,i)=>{if(!("string"==typeof a||Array.isArray(a)))throw TypeError("Expected the input to be `string | string[]`");if(i={pascalCase:!1,preserveConsecutiveUppercase:!1,...i},0===(a=Array.isArray(a)?a.map(a=>a.trim()).filter(a=>a.length).join("-"):a.trim()).length)return"";let s=!1===i.locale?a=>a.toLowerCase():a=>a.toLocaleLowerCase(i.locale),o=!1===i.locale?a=>a.toUpperCase():a=>a.toLocaleUpperCase(i.locale);if(1===a.length)return i.pascalCase?o(a):s(a);let c=a!==s(a);return c&&(a=preserveCamelCase(a,s,o)),a=a.replace(P,""),a=i.preserveConsecutiveUppercase?preserveConsecutiveUppercase(a,s):s(a),i.pascalCase&&(a=o(a.charAt(0))+a.slice(1)),postProcess(a,o)};a.exports=camelCase,a.exports.default=camelCase},4521:function(a){"use strict";a.exports=function(a,i){if("string"!=typeof a)throw TypeError("Expected a string");return i=void 0===i?"_":i,a.replace(/([a-z\d])([A-Z])/g,"$1"+i+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+i+"$2").toLowerCase()}},4821:function(a){a.exports=function(a){for(var i=[],s=1;s<arguments.length;s++)i[s-1]=arguments[s];var o=[],c="string"==typeof a?[a]:a.slice();c[c.length-1]=c[c.length-1].replace(/\r?\n([\t ]*)$/,"");for(var w=0;w<c.length;w++){var P=void 0;(P=c[w].match(/\n[\t ]+/g))&&o.push.apply(o,P)}if(o.length)for(var A=RegExp("\n[	 ]{"+Math.min.apply(Math,o.map(function(a){return a.length-1}))+"}","g"),w=0;w<c.length;w++)c[w]=c[w].replace(A,"\n");c[0]=c[0].replace(/^\r?\n/,"");for(var x=c[0],w=0;w<i.length;w++)x+=i[w]+c[w+1];return x}},7913:function(a){"use strict";var i=Object.prototype.hasOwnProperty,s="~";function Events(){}function EE(a,i,s){this.fn=a,this.context=i,this.once=s||!1}function addListener(a,i,o,c,w){if("function"!=typeof o)throw TypeError("The listener must be a function");var P=new EE(o,c||a,w),A=s?s+i:i;return a._events[A]?a._events[A].fn?a._events[A]=[a._events[A],P]:a._events[A].push(P):(a._events[A]=P,a._eventsCount++),a}function clearEvent(a,i){0==--a._eventsCount?a._events=new Events:delete a._events[i]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(s=!1)),EventEmitter.prototype.eventNames=function(){var a,o,c=[];if(0===this._eventsCount)return c;for(o in a=this._events)i.call(a,o)&&c.push(s?o.slice(1):o);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(a)):c},EventEmitter.prototype.listeners=function(a){var i=s?s+a:a,o=this._events[i];if(!o)return[];if(o.fn)return[o.fn];for(var c=0,w=o.length,P=Array(w);c<w;c++)P[c]=o[c].fn;return P},EventEmitter.prototype.listenerCount=function(a){var i=s?s+a:a,o=this._events[i];return o?o.fn?1:o.length:0},EventEmitter.prototype.emit=function(a,i,o,c,w,P){var A=s?s+a:a;if(!this._events[A])return!1;var x,k,R=this._events[A],j=arguments.length;if(R.fn){switch(R.once&&this.removeListener(a,R.fn,void 0,!0),j){case 1:return R.fn.call(R.context),!0;case 2:return R.fn.call(R.context,i),!0;case 3:return R.fn.call(R.context,i,o),!0;case 4:return R.fn.call(R.context,i,o,c),!0;case 5:return R.fn.call(R.context,i,o,c,w),!0;case 6:return R.fn.call(R.context,i,o,c,w,P),!0}for(k=1,x=Array(j-1);k<j;k++)x[k-1]=arguments[k];R.fn.apply(R.context,x)}else{var $,B=R.length;for(k=0;k<B;k++)switch(R[k].once&&this.removeListener(a,R[k].fn,void 0,!0),j){case 1:R[k].fn.call(R[k].context);break;case 2:R[k].fn.call(R[k].context,i);break;case 3:R[k].fn.call(R[k].context,i,o);break;case 4:R[k].fn.call(R[k].context,i,o,c);break;default:if(!x)for($=1,x=Array(j-1);$<j;$++)x[$-1]=arguments[$];R[k].fn.apply(R[k].context,x)}}return!0},EventEmitter.prototype.on=function(a,i,s){return addListener(this,a,i,s,!1)},EventEmitter.prototype.once=function(a,i,s){return addListener(this,a,i,s,!0)},EventEmitter.prototype.removeListener=function(a,i,o,c){var w=s?s+a:a;if(!this._events[w])return this;if(!i)return clearEvent(this,w),this;var P=this._events[w];if(P.fn)P.fn!==i||c&&!P.once||o&&P.context!==o||clearEvent(this,w);else{for(var A=0,x=[],k=P.length;A<k;A++)(P[A].fn!==i||c&&!P[A].once||o&&P[A].context!==o)&&x.push(P[A]);x.length?this._events[w]=1===x.length?x[0]:x:clearEvent(this,w)}return this},EventEmitter.prototype.removeAllListeners=function(a){var i;return a?(i=s?s+a:a,this._events[i]&&clearEvent(this,i)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=s,EventEmitter.EventEmitter=EventEmitter,a.exports=EventEmitter},5465:function(a,i){var s=/~/,o=/~[01]/g;function escapeReplacer(a){switch(a){case"~1":return"/";case"~0":return"~"}throw Error("Invalid tilde escape: "+a)}function untilde(a){return s.test(a)?a.replace(o,escapeReplacer):a}function setter(a,i,s){for(var o,c,w=1,P=i.length;w<P;){if("constructor"===i[w]||"prototype"===i[w]||"__proto__"===i[w])return a;if(o=untilde(i[w++]),c=P>w,void 0===a[o]&&(Array.isArray(a)&&"-"===o&&(o=a.length),c&&(""!==i[w]&&i[w]<1/0||"-"===i[w]?a[o]=[]:a[o]={})),!c)break;a=a[o]}var A=a[o];return void 0===s?delete a[o]:a[o]=s,A}function compilePointer(a){if("string"==typeof a){if(""===(a=a.split("/"))[0])return a}else if(Array.isArray(a)){for(let i of a)if("string"!=typeof i&&"number"!=typeof i)throw Error("Invalid JSON pointer. Must be of type string or number.");return a}throw Error("Invalid JSON pointer.")}},5656:function(a,i,s){"use strict";var o,c;a.exports=(null==(o=s.g.process)?void 0:o.env)&&"object"==typeof(null==(c=s.g.process)?void 0:c.env)?s.g.process:s(1197)},8756:function(a,i){"use strict";function getHostname(a,i){let s;if((null==i?void 0:i.host)&&!Array.isArray(i.host))s=i.host.toString().split(":",1)[0];else{if(!a.hostname)return;s=a.hostname}return s.toLowerCase()}Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"getHostname",{enumerable:!0,get:function(){return getHostname}})},1553:function(a,i){"use strict";function detectDomainLocale(a,i,s){if(a)for(let w of(s&&(s=s.toLowerCase()),a)){var o,c;let a=null==(o=w.domain)?void 0:o.split(":",1)[0].toLowerCase();if(i===a||s===w.defaultLocale.toLowerCase()||(null==(c=w.locales)?void 0:c.some(a=>a.toLowerCase()===s)))return w}}Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"detectDomainLocale",{enumerable:!0,get:function(){return detectDomainLocale}})},5976:function(a,i){"use strict";function normalizeLocalePath(a,i){let s;let o=a.split("/");return(i||[]).some(i=>!!o[1]&&o[1].toLowerCase()===i.toLowerCase()&&(s=i,o.splice(1,1),a=o.join("/")||"/",!0)),{pathname:a,detectedLocale:s}}Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"normalizeLocalePath",{enumerable:!0,get:function(){return normalizeLocalePath}})},2584:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"addLocale",{enumerable:!0,get:function(){return addLocale}});let o=s(7195),c=s(1014);function addLocale(a,i,s,w){if(!i||i===s)return a;let P=a.toLowerCase();return!w&&((0,c.pathHasPrefix)(P,"/api")||(0,c.pathHasPrefix)(P,"/"+i.toLowerCase()))?a:(0,o.addPathPrefix)(a,"/"+i)}},1083:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"addPathSuffix",{enumerable:!0,get:function(){return addPathSuffix}});let o=s(7174);function addPathSuffix(a,i){if(!a.startsWith("/")||!i)return a;let{pathname:s,query:c,hash:w}=(0,o.parsePath)(a);return""+s+i+c+w}},8307:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"formatNextPathnameInfo",{enumerable:!0,get:function(){return formatNextPathnameInfo}});let o=s(8952),c=s(7195),w=s(1083),P=s(2584);function formatNextPathnameInfo(a){let i=(0,P.addLocale)(a.pathname,a.locale,a.buildId?void 0:a.defaultLocale,a.ignorePrefix);return(a.buildId||!a.trailingSlash)&&(i=(0,o.removeTrailingSlash)(i)),a.buildId&&(i=(0,w.addPathSuffix)((0,c.addPathPrefix)(i,"/_next/data/"+a.buildId),"/"===a.pathname?"index.json":".json")),i=(0,c.addPathPrefix)(i,a.basePath),!a.buildId&&a.trailingSlash?i.endsWith("/")?i:(0,w.addPathSuffix)(i,"/"):(0,o.removeTrailingSlash)(i)}},7831:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"getNextPathnameInfo",{enumerable:!0,get:function(){return getNextPathnameInfo}});let o=s(5976),c=s(293),w=s(1014);function getNextPathnameInfo(a,i){var s,P;let{basePath:A,i18n:x,trailingSlash:k}=null!=(s=i.nextConfig)?s:{},R={pathname:a,trailingSlash:"/"!==a?a.endsWith("/"):k};A&&(0,w.pathHasPrefix)(R.pathname,A)&&(R.pathname=(0,c.removePathPrefix)(R.pathname,A),R.basePath=A);let j=R.pathname;if(R.pathname.startsWith("/_next/data/")&&R.pathname.endsWith(".json")){let a=R.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),s=a[0];R.buildId=s,j="index"!==a[1]?"/"+a.slice(1).join("/"):"/",!0===i.parseData&&(R.pathname=j)}if(x){let a=i.i18nProvider?i.i18nProvider.analyze(R.pathname):(0,o.normalizeLocalePath)(R.pathname,x.locales);R.locale=a.detectedLocale,R.pathname=null!=(P=a.pathname)?P:R.pathname,!a.detectedLocale&&R.buildId&&(a=i.i18nProvider?i.i18nProvider.analyze(j):(0,o.normalizeLocalePath)(j,x.locales)).detectedLocale&&(R.locale=a.detectedLocale)}return R}},293:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"removePathPrefix",{enumerable:!0,get:function(){return removePathPrefix}});let o=s(1014);function removePathPrefix(a,i){if(!(0,o.pathHasPrefix)(a,i))return a;let s=a.slice(i.length);return s.startsWith("/")?s:"/"+s}},7157:function(){},8476:function(a){"use strict";var i=Object.defineProperty,s=Object.getOwnPropertyDescriptor,o=Object.getOwnPropertyNames,c=Object.prototype.hasOwnProperty,w={};function stringifyCookie(a){var i;let s=["path"in a&&a.path&&`Path=${a.path}`,"expires"in a&&(a.expires||0===a.expires)&&`Expires=${("number"==typeof a.expires?new Date(a.expires):a.expires).toUTCString()}`,"maxAge"in a&&"number"==typeof a.maxAge&&`Max-Age=${a.maxAge}`,"domain"in a&&a.domain&&`Domain=${a.domain}`,"secure"in a&&a.secure&&"Secure","httpOnly"in a&&a.httpOnly&&"HttpOnly","sameSite"in a&&a.sameSite&&`SameSite=${a.sameSite}`,"priority"in a&&a.priority&&`Priority=${a.priority}`].filter(Boolean);return`${a.name}=${encodeURIComponent(null!=(i=a.value)?i:"")}; ${s.join("; ")}`}function parseCookie(a){let i=new Map;for(let s of a.split(/; */)){if(!s)continue;let a=s.indexOf("=");if(-1===a){i.set(s,"true");continue}let[o,c]=[s.slice(0,a),s.slice(a+1)];try{i.set(o,decodeURIComponent(null!=c?c:"true"))}catch{}}return i}function parseSetCookie(a){if(!a)return;let[[i,s],...o]=parseCookie(a),{domain:c,expires:w,httponly:P,maxage:A,path:x,samesite:k,secure:R,priority:j}=Object.fromEntries(o.map(([a,i])=>[a.toLowerCase(),i])),$={name:i,value:decodeURIComponent(s),domain:c,...w&&{expires:new Date(w)},...P&&{httpOnly:!0},..."string"==typeof A&&{maxAge:Number(A)},path:x,...k&&{sameSite:parseSameSite(k)},...R&&{secure:!0},...j&&{priority:parsePriority(j)}};return compact($)}function compact(a){let i={};for(let s in a)a[s]&&(i[s]=a[s]);return i}((a,s)=>{for(var o in s)i(a,o,{get:s[o],enumerable:!0})})(w,{RequestCookies:()=>x,ResponseCookies:()=>k,parseCookie:()=>parseCookie,parseSetCookie:()=>parseSetCookie,stringifyCookie:()=>stringifyCookie}),a.exports=((a,w,P,A)=>{if(w&&"object"==typeof w||"function"==typeof w)for(let P of o(w))c.call(a,P)||void 0===P||i(a,P,{get:()=>w[P],enumerable:!(A=s(w,P))||A.enumerable});return a})(i({},"__esModule",{value:!0}),w);var P=["strict","lax","none"];function parseSameSite(a){return a=a.toLowerCase(),P.includes(a)?a:void 0}var A=["low","medium","high"];function parsePriority(a){return a=a.toLowerCase(),A.includes(a)?a:void 0}function splitCookiesString(a){if(!a)return[];var i,s,o,c,w,P=[],A=0;function skipWhitespace(){for(;A<a.length&&/\s/.test(a.charAt(A));)A+=1;return A<a.length}function notSpecialChar(){return"="!==(s=a.charAt(A))&&";"!==s&&","!==s}for(;A<a.length;){for(i=A,w=!1;skipWhitespace();)if(","===(s=a.charAt(A))){for(o=A,A+=1,skipWhitespace(),c=A;A<a.length&&notSpecialChar();)A+=1;A<a.length&&"="===a.charAt(A)?(w=!0,A=c,P.push(a.substring(i,o)),i=A):A=o+1}else A+=1;(!w||A>=a.length)&&P.push(a.substring(i,a.length))}return P}var x=class{constructor(a){this._parsed=new Map,this._headers=a;let i=a.get("cookie");if(i){let a=parseCookie(i);for(let[i,s]of a)this._parsed.set(i,{name:i,value:s})}}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...a){let i="string"==typeof a[0]?a[0]:a[0].name;return this._parsed.get(i)}getAll(...a){var i;let s=Array.from(this._parsed);if(!a.length)return s.map(([a,i])=>i);let o="string"==typeof a[0]?a[0]:null==(i=a[0])?void 0:i.name;return s.filter(([a])=>a===o).map(([a,i])=>i)}has(a){return this._parsed.has(a)}set(...a){let[i,s]=1===a.length?[a[0].name,a[0].value]:a,o=this._parsed;return o.set(i,{name:i,value:s}),this._headers.set("cookie",Array.from(o).map(([a,i])=>stringifyCookie(i)).join("; ")),this}delete(a){let i=this._parsed,s=Array.isArray(a)?a.map(a=>i.delete(a)):i.delete(a);return this._headers.set("cookie",Array.from(i).map(([a,i])=>stringifyCookie(i)).join("; ")),s}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(a=>`${a.name}=${encodeURIComponent(a.value)}`).join("; ")}},k=class{constructor(a){var i,s,o;this._parsed=new Map,this._headers=a;let c=null!=(o=null!=(s=null==(i=a.getSetCookie)?void 0:i.call(a))?s:a.get("set-cookie"))?o:[],w=Array.isArray(c)?c:splitCookiesString(c);for(let a of w){let i=parseSetCookie(a);i&&this._parsed.set(i.name,i)}}get(...a){let i="string"==typeof a[0]?a[0]:a[0].name;return this._parsed.get(i)}getAll(...a){var i;let s=Array.from(this._parsed.values());if(!a.length)return s;let o="string"==typeof a[0]?a[0]:null==(i=a[0])?void 0:i.name;return s.filter(a=>a.name===o)}has(a){return this._parsed.has(a)}set(...a){let[i,s,o]=1===a.length?[a[0].name,a[0].value,a[0]]:a,c=this._parsed;return c.set(i,normalizeCookie({name:i,value:s,...o})),replace(c,this._headers),this}delete(...a){let[i,s,o]="string"==typeof a[0]?[a[0]]:[a[0].name,a[0].path,a[0].domain];return this.set({name:i,path:s,domain:o,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(stringifyCookie).join("; ")}};function replace(a,i){for(let[,s]of(i.delete("set-cookie"),a)){let a=stringifyCookie(s);i.append("set-cookie",a)}}function normalizeCookie(a={name:"",value:""}){return"number"==typeof a.expires&&(a.expires=new Date(a.expires)),a.maxAge&&(a.expires=new Date(Date.now()+1e3*a.maxAge)),(null===a.path||void 0===a.path)&&(a.path="/"),a}},1430:function(a){!function(){var i={675:function(a,i){"use strict";i.byteLength=byteLength,i.toByteArray=toByteArray,i.fromByteArray=fromByteArray;for(var s=[],o=[],c="undefined"!=typeof Uint8Array?Uint8Array:Array,w="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=0,A=w.length;P<A;++P)s[P]=w[P],o[w.charCodeAt(P)]=P;function getLens(a){var i=a.length;if(i%4>0)throw Error("Invalid string. Length must be a multiple of 4");var s=a.indexOf("=");-1===s&&(s=i);var o=s===i?0:4-s%4;return[s,o]}function byteLength(a){var i=getLens(a),s=i[0],o=i[1];return(s+o)*3/4-o}function _byteLength(a,i,s){return(i+s)*3/4-s}function toByteArray(a){var i,s,w=getLens(a),P=w[0],A=w[1],x=new c(_byteLength(a,P,A)),k=0,R=A>0?P-4:P;for(s=0;s<R;s+=4)i=o[a.charCodeAt(s)]<<18|o[a.charCodeAt(s+1)]<<12|o[a.charCodeAt(s+2)]<<6|o[a.charCodeAt(s+3)],x[k++]=i>>16&255,x[k++]=i>>8&255,x[k++]=255&i;return 2===A&&(i=o[a.charCodeAt(s)]<<2|o[a.charCodeAt(s+1)]>>4,x[k++]=255&i),1===A&&(i=o[a.charCodeAt(s)]<<10|o[a.charCodeAt(s+1)]<<4|o[a.charCodeAt(s+2)]>>2,x[k++]=i>>8&255,x[k++]=255&i),x}function tripletToBase64(a){return s[a>>18&63]+s[a>>12&63]+s[a>>6&63]+s[63&a]}function encodeChunk(a,i,s){for(var o=[],c=i;c<s;c+=3)o.push(tripletToBase64((a[c]<<16&16711680)+(a[c+1]<<8&65280)+(255&a[c+2])));return o.join("")}function fromByteArray(a){for(var i,o=a.length,c=o%3,w=[],P=0,A=o-c;P<A;P+=16383)w.push(encodeChunk(a,P,P+16383>A?A:P+16383));return 1===c?w.push(s[(i=a[o-1])>>2]+s[i<<4&63]+"=="):2===c&&w.push(s[(i=(a[o-2]<<8)+a[o-1])>>10]+s[i>>4&63]+s[i<<2&63]+"="),w.join("")}o["-".charCodeAt(0)]=62,o["_".charCodeAt(0)]=63},72:function(a,i,s){"use strict";/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var o=s(675),c=s(783),w="function"==typeof Symbol&&"function"==typeof Symbol.for?Symbol.for("nodejs.util.inspect.custom"):null;function typedArraySupport(){try{var a=new Uint8Array(1),i={foo:function(){return 42}};return Object.setPrototypeOf(i,Uint8Array.prototype),Object.setPrototypeOf(a,i),42===a.foo()}catch(a){return!1}}function createBuffer(a){if(a>2147483647)throw RangeError('The value "'+a+'" is invalid for option "size"');var i=new Uint8Array(a);return Object.setPrototypeOf(i,Buffer.prototype),i}function Buffer(a,i,s){if("number"==typeof a){if("string"==typeof i)throw TypeError('The "string" argument must be of type string. Received type number');return allocUnsafe(a)}return from(a,i,s)}function from(a,i,s){if("string"==typeof a)return fromString(a,i);if(ArrayBuffer.isView(a))return fromArrayLike(a);if(null==a)throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a);if(isInstance(a,ArrayBuffer)||a&&isInstance(a.buffer,ArrayBuffer)||"undefined"!=typeof SharedArrayBuffer&&(isInstance(a,SharedArrayBuffer)||a&&isInstance(a.buffer,SharedArrayBuffer)))return fromArrayBuffer(a,i,s);if("number"==typeof a)throw TypeError('The "value" argument must not be of type number. Received type number');var o=a.valueOf&&a.valueOf();if(null!=o&&o!==a)return Buffer.from(o,i,s);var c=fromObject(a);if(c)return c;if("undefined"!=typeof Symbol&&null!=Symbol.toPrimitive&&"function"==typeof a[Symbol.toPrimitive])return Buffer.from(a[Symbol.toPrimitive]("string"),i,s);throw TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof a)}function assertSize(a){if("number"!=typeof a)throw TypeError('"size" argument must be of type number');if(a<0)throw RangeError('The value "'+a+'" is invalid for option "size"')}function alloc(a,i,s){return(assertSize(a),a<=0)?createBuffer(a):void 0!==i?"string"==typeof s?createBuffer(a).fill(i,s):createBuffer(a).fill(i):createBuffer(a)}function allocUnsafe(a){return assertSize(a),createBuffer(a<0?0:0|checked(a))}function fromString(a,i){if(("string"!=typeof i||""===i)&&(i="utf8"),!Buffer.isEncoding(i))throw TypeError("Unknown encoding: "+i);var s=0|byteLength(a,i),o=createBuffer(s),c=o.write(a,i);return c!==s&&(o=o.slice(0,c)),o}function fromArrayLike(a){for(var i=a.length<0?0:0|checked(a.length),s=createBuffer(i),o=0;o<i;o+=1)s[o]=255&a[o];return s}function fromArrayBuffer(a,i,s){var o;if(i<0||a.byteLength<i)throw RangeError('"offset" is outside of buffer bounds');if(a.byteLength<i+(s||0))throw RangeError('"length" is outside of buffer bounds');return Object.setPrototypeOf(o=void 0===i&&void 0===s?new Uint8Array(a):void 0===s?new Uint8Array(a,i):new Uint8Array(a,i,s),Buffer.prototype),o}function fromObject(a){if(Buffer.isBuffer(a)){var i,s=0|checked(a.length),o=createBuffer(s);return 0===o.length||a.copy(o,0,0,s),o}return void 0!==a.length?"number"!=typeof a.length||(i=a.length)!=i?createBuffer(0):fromArrayLike(a):"Buffer"===a.type&&Array.isArray(a.data)?fromArrayLike(a.data):void 0}function checked(a){if(a>=2147483647)throw RangeError("Attempt to allocate Buffer larger than maximum size: 0x7fffffff bytes");return 0|a}function SlowBuffer(a){return+a!=a&&(a=0),Buffer.alloc(+a)}function byteLength(a,i){if(Buffer.isBuffer(a))return a.length;if(ArrayBuffer.isView(a)||isInstance(a,ArrayBuffer))return a.byteLength;if("string"!=typeof a)throw TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof a);var s=a.length,o=arguments.length>2&&!0===arguments[2];if(!o&&0===s)return 0;for(var c=!1;;)switch(i){case"ascii":case"latin1":case"binary":return s;case"utf8":case"utf-8":return utf8ToBytes(a).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*s;case"hex":return s>>>1;case"base64":return base64ToBytes(a).length;default:if(c)return o?-1:utf8ToBytes(a).length;i=(""+i).toLowerCase(),c=!0}}function slowToString(a,i,s){var o=!1;if((void 0===i||i<0)&&(i=0),i>this.length||((void 0===s||s>this.length)&&(s=this.length),s<=0||(s>>>=0)<=(i>>>=0)))return"";for(a||(a="utf8");;)switch(a){case"hex":return hexSlice(this,i,s);case"utf8":case"utf-8":return utf8Slice(this,i,s);case"ascii":return asciiSlice(this,i,s);case"latin1":case"binary":return latin1Slice(this,i,s);case"base64":return base64Slice(this,i,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return utf16leSlice(this,i,s);default:if(o)throw TypeError("Unknown encoding: "+a);a=(a+"").toLowerCase(),o=!0}}function swap(a,i,s){var o=a[i];a[i]=a[s],a[s]=o}function bidirectionalIndexOf(a,i,s,o,c){var w;if(0===a.length)return -1;if("string"==typeof s?(o=s,s=0):s>2147483647?s=2147483647:s<-2147483648&&(s=-2147483648),(w=s=+s)!=w&&(s=c?0:a.length-1),s<0&&(s=a.length+s),s>=a.length){if(c)return -1;s=a.length-1}else if(s<0){if(!c)return -1;s=0}if("string"==typeof i&&(i=Buffer.from(i,o)),Buffer.isBuffer(i))return 0===i.length?-1:arrayIndexOf(a,i,s,o,c);if("number"==typeof i)return(i&=255,"function"==typeof Uint8Array.prototype.indexOf)?c?Uint8Array.prototype.indexOf.call(a,i,s):Uint8Array.prototype.lastIndexOf.call(a,i,s):arrayIndexOf(a,[i],s,o,c);throw TypeError("val must be string, number or Buffer")}function arrayIndexOf(a,i,s,o,c){var w,P=1,A=a.length,x=i.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(a.length<2||i.length<2)return -1;P=2,A/=2,x/=2,s/=2}function read(a,i){return 1===P?a[i]:a.readUInt16BE(i*P)}if(c){var k=-1;for(w=s;w<A;w++)if(read(a,w)===read(i,-1===k?0:w-k)){if(-1===k&&(k=w),w-k+1===x)return k*P}else -1!==k&&(w-=w-k),k=-1}else for(s+x>A&&(s=A-x),w=s;w>=0;w--){for(var R=!0,j=0;j<x;j++)if(read(a,w+j)!==read(i,j)){R=!1;break}if(R)return w}return -1}function hexWrite(a,i,s,o){s=Number(s)||0;var c=a.length-s;o?(o=Number(o))>c&&(o=c):o=c;var w=i.length;o>w/2&&(o=w/2);for(var P=0;P<o;++P){var A=parseInt(i.substr(2*P,2),16);if(A!=A)break;a[s+P]=A}return P}function utf8Write(a,i,s,o){return blitBuffer(utf8ToBytes(i,a.length-s),a,s,o)}function latin1Write(a,i,s,o){return blitBuffer(asciiToBytes(i),a,s,o)}function base64Write(a,i,s,o){return blitBuffer(base64ToBytes(i),a,s,o)}function ucs2Write(a,i,s,o){return blitBuffer(utf16leToBytes(i,a.length-s),a,s,o)}function base64Slice(a,i,s){return 0===i&&s===a.length?o.fromByteArray(a):o.fromByteArray(a.slice(i,s))}function utf8Slice(a,i,s){s=Math.min(a.length,s);for(var o=[],c=i;c<s;){var w,P,A,x,k=a[c],R=null,j=k>239?4:k>223?3:k>191?2:1;if(c+j<=s)switch(j){case 1:k<128&&(R=k);break;case 2:(192&(w=a[c+1]))==128&&(x=(31&k)<<6|63&w)>127&&(R=x);break;case 3:w=a[c+1],P=a[c+2],(192&w)==128&&(192&P)==128&&(x=(15&k)<<12|(63&w)<<6|63&P)>2047&&(x<55296||x>57343)&&(R=x);break;case 4:w=a[c+1],P=a[c+2],A=a[c+3],(192&w)==128&&(192&P)==128&&(192&A)==128&&(x=(15&k)<<18|(63&w)<<12|(63&P)<<6|63&A)>65535&&x<1114112&&(R=x)}null===R?(R=65533,j=1):R>65535&&(R-=65536,o.push(R>>>10&1023|55296),R=56320|1023&R),o.push(R),c+=j}return decodeCodePointsArray(o)}function decodeCodePointsArray(a){var i=a.length;if(i<=4096)return String.fromCharCode.apply(String,a);for(var s="",o=0;o<i;)s+=String.fromCharCode.apply(String,a.slice(o,o+=4096));return s}function asciiSlice(a,i,s){var o="";s=Math.min(a.length,s);for(var c=i;c<s;++c)o+=String.fromCharCode(127&a[c]);return o}function latin1Slice(a,i,s){var o="";s=Math.min(a.length,s);for(var c=i;c<s;++c)o+=String.fromCharCode(a[c]);return o}function hexSlice(a,i,s){var o=a.length;(!i||i<0)&&(i=0),(!s||s<0||s>o)&&(s=o);for(var c="",w=i;w<s;++w)c+=A[a[w]];return c}function utf16leSlice(a,i,s){for(var o=a.slice(i,s),c="",w=0;w<o.length;w+=2)c+=String.fromCharCode(o[w]+256*o[w+1]);return c}function checkOffset(a,i,s){if(a%1!=0||a<0)throw RangeError("offset is not uint");if(a+i>s)throw RangeError("Trying to access beyond buffer length")}function checkInt(a,i,s,o,c,w){if(!Buffer.isBuffer(a))throw TypeError('"buffer" argument must be a Buffer instance');if(i>c||i<w)throw RangeError('"value" argument is out of bounds');if(s+o>a.length)throw RangeError("Index out of range")}function checkIEEE754(a,i,s,o,c,w){if(s+o>a.length||s<0)throw RangeError("Index out of range")}function writeFloat(a,i,s,o,w){return i=+i,s>>>=0,w||checkIEEE754(a,i,s,4,34028234663852886e22,-34028234663852886e22),c.write(a,i,s,o,23,4),s+4}function writeDouble(a,i,s,o,w){return i=+i,s>>>=0,w||checkIEEE754(a,i,s,8,17976931348623157e292,-17976931348623157e292),c.write(a,i,s,o,52,8),s+8}i.Buffer=Buffer,i.SlowBuffer=SlowBuffer,i.INSPECT_MAX_BYTES=50,i.kMaxLength=2147483647,Buffer.TYPED_ARRAY_SUPPORT=typedArraySupport(),Buffer.TYPED_ARRAY_SUPPORT||"undefined"==typeof console||"function"!=typeof console.error||console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support."),Object.defineProperty(Buffer.prototype,"parent",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.buffer}}),Object.defineProperty(Buffer.prototype,"offset",{enumerable:!0,get:function(){if(Buffer.isBuffer(this))return this.byteOffset}}),Buffer.poolSize=8192,Buffer.from=function(a,i,s){return from(a,i,s)},Object.setPrototypeOf(Buffer.prototype,Uint8Array.prototype),Object.setPrototypeOf(Buffer,Uint8Array),Buffer.alloc=function(a,i,s){return alloc(a,i,s)},Buffer.allocUnsafe=function(a){return allocUnsafe(a)},Buffer.allocUnsafeSlow=function(a){return allocUnsafe(a)},Buffer.isBuffer=function(a){return null!=a&&!0===a._isBuffer&&a!==Buffer.prototype},Buffer.compare=function(a,i){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),isInstance(i,Uint8Array)&&(i=Buffer.from(i,i.offset,i.byteLength)),!Buffer.isBuffer(a)||!Buffer.isBuffer(i))throw TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(a===i)return 0;for(var s=a.length,o=i.length,c=0,w=Math.min(s,o);c<w;++c)if(a[c]!==i[c]){s=a[c],o=i[c];break}return s<o?-1:o<s?1:0},Buffer.isEncoding=function(a){switch(String(a).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},Buffer.concat=function(a,i){if(!Array.isArray(a))throw TypeError('"list" argument must be an Array of Buffers');if(0===a.length)return Buffer.alloc(0);if(void 0===i)for(s=0,i=0;s<a.length;++s)i+=a[s].length;var s,o=Buffer.allocUnsafe(i),c=0;for(s=0;s<a.length;++s){var w=a[s];if(isInstance(w,Uint8Array)&&(w=Buffer.from(w)),!Buffer.isBuffer(w))throw TypeError('"list" argument must be an Array of Buffers');w.copy(o,c),c+=w.length}return o},Buffer.byteLength=byteLength,Buffer.prototype._isBuffer=!0,Buffer.prototype.swap16=function(){var a=this.length;if(a%2!=0)throw RangeError("Buffer size must be a multiple of 16-bits");for(var i=0;i<a;i+=2)swap(this,i,i+1);return this},Buffer.prototype.swap32=function(){var a=this.length;if(a%4!=0)throw RangeError("Buffer size must be a multiple of 32-bits");for(var i=0;i<a;i+=4)swap(this,i,i+3),swap(this,i+1,i+2);return this},Buffer.prototype.swap64=function(){var a=this.length;if(a%8!=0)throw RangeError("Buffer size must be a multiple of 64-bits");for(var i=0;i<a;i+=8)swap(this,i,i+7),swap(this,i+1,i+6),swap(this,i+2,i+5),swap(this,i+3,i+4);return this},Buffer.prototype.toString=function(){var a=this.length;return 0===a?"":0==arguments.length?utf8Slice(this,0,a):slowToString.apply(this,arguments)},Buffer.prototype.toLocaleString=Buffer.prototype.toString,Buffer.prototype.equals=function(a){if(!Buffer.isBuffer(a))throw TypeError("Argument must be a Buffer");return this===a||0===Buffer.compare(this,a)},Buffer.prototype.inspect=function(){var a="",s=i.INSPECT_MAX_BYTES;return a=this.toString("hex",0,s).replace(/(.{2})/g,"$1 ").trim(),this.length>s&&(a+=" ... "),"<Buffer "+a+">"},w&&(Buffer.prototype[w]=Buffer.prototype.inspect),Buffer.prototype.compare=function(a,i,s,o,c){if(isInstance(a,Uint8Array)&&(a=Buffer.from(a,a.offset,a.byteLength)),!Buffer.isBuffer(a))throw TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof a);if(void 0===i&&(i=0),void 0===s&&(s=a?a.length:0),void 0===o&&(o=0),void 0===c&&(c=this.length),i<0||s>a.length||o<0||c>this.length)throw RangeError("out of range index");if(o>=c&&i>=s)return 0;if(o>=c)return -1;if(i>=s)return 1;if(i>>>=0,s>>>=0,o>>>=0,c>>>=0,this===a)return 0;for(var w=c-o,P=s-i,A=Math.min(w,P),x=this.slice(o,c),k=a.slice(i,s),R=0;R<A;++R)if(x[R]!==k[R]){w=x[R],P=k[R];break}return w<P?-1:P<w?1:0},Buffer.prototype.includes=function(a,i,s){return -1!==this.indexOf(a,i,s)},Buffer.prototype.indexOf=function(a,i,s){return bidirectionalIndexOf(this,a,i,s,!0)},Buffer.prototype.lastIndexOf=function(a,i,s){return bidirectionalIndexOf(this,a,i,s,!1)},Buffer.prototype.write=function(a,i,s,o){if(void 0===i)o="utf8",s=this.length,i=0;else if(void 0===s&&"string"==typeof i)o=i,s=this.length,i=0;else if(isFinite(i))i>>>=0,isFinite(s)?(s>>>=0,void 0===o&&(o="utf8")):(o=s,s=void 0);else throw Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");var c,w,P=this.length-i;if((void 0===s||s>P)&&(s=P),a.length>0&&(s<0||i<0)||i>this.length)throw RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var A=!1;;)switch(o){case"hex":return hexWrite(this,a,i,s);case"utf8":case"utf-8":return utf8Write(this,a,i,s);case"ascii":return c=i,w=s,blitBuffer(asciiToBytes(a),this,c,w);case"latin1":case"binary":return latin1Write(this,a,i,s);case"base64":return base64Write(this,a,i,s);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return ucs2Write(this,a,i,s);default:if(A)throw TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),A=!0}},Buffer.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}},Buffer.prototype.slice=function(a,i){var s=this.length;a=~~a,i=void 0===i?s:~~i,a<0?(a+=s)<0&&(a=0):a>s&&(a=s),i<0?(i+=s)<0&&(i=0):i>s&&(i=s),i<a&&(i=a);var o=this.subarray(a,i);return Object.setPrototypeOf(o,Buffer.prototype),o},Buffer.prototype.readUIntLE=function(a,i,s){a>>>=0,i>>>=0,s||checkOffset(a,i,this.length);for(var o=this[a],c=1,w=0;++w<i&&(c*=256);)o+=this[a+w]*c;return o},Buffer.prototype.readUIntBE=function(a,i,s){a>>>=0,i>>>=0,s||checkOffset(a,i,this.length);for(var o=this[a+--i],c=1;i>0&&(c*=256);)o+=this[a+--i]*c;return o},Buffer.prototype.readUInt8=function(a,i){return a>>>=0,i||checkOffset(a,1,this.length),this[a]},Buffer.prototype.readUInt16LE=function(a,i){return a>>>=0,i||checkOffset(a,2,this.length),this[a]|this[a+1]<<8},Buffer.prototype.readUInt16BE=function(a,i){return a>>>=0,i||checkOffset(a,2,this.length),this[a]<<8|this[a+1]},Buffer.prototype.readUInt32LE=function(a,i){return a>>>=0,i||checkOffset(a,4,this.length),(this[a]|this[a+1]<<8|this[a+2]<<16)+16777216*this[a+3]},Buffer.prototype.readUInt32BE=function(a,i){return a>>>=0,i||checkOffset(a,4,this.length),16777216*this[a]+(this[a+1]<<16|this[a+2]<<8|this[a+3])},Buffer.prototype.readIntLE=function(a,i,s){a>>>=0,i>>>=0,s||checkOffset(a,i,this.length);for(var o=this[a],c=1,w=0;++w<i&&(c*=256);)o+=this[a+w]*c;return o>=(c*=128)&&(o-=Math.pow(2,8*i)),o},Buffer.prototype.readIntBE=function(a,i,s){a>>>=0,i>>>=0,s||checkOffset(a,i,this.length);for(var o=i,c=1,w=this[a+--o];o>0&&(c*=256);)w+=this[a+--o]*c;return w>=(c*=128)&&(w-=Math.pow(2,8*i)),w},Buffer.prototype.readInt8=function(a,i){return(a>>>=0,i||checkOffset(a,1,this.length),128&this[a])?-((255-this[a]+1)*1):this[a]},Buffer.prototype.readInt16LE=function(a,i){a>>>=0,i||checkOffset(a,2,this.length);var s=this[a]|this[a+1]<<8;return 32768&s?4294901760|s:s},Buffer.prototype.readInt16BE=function(a,i){a>>>=0,i||checkOffset(a,2,this.length);var s=this[a+1]|this[a]<<8;return 32768&s?4294901760|s:s},Buffer.prototype.readInt32LE=function(a,i){return a>>>=0,i||checkOffset(a,4,this.length),this[a]|this[a+1]<<8|this[a+2]<<16|this[a+3]<<24},Buffer.prototype.readInt32BE=function(a,i){return a>>>=0,i||checkOffset(a,4,this.length),this[a]<<24|this[a+1]<<16|this[a+2]<<8|this[a+3]},Buffer.prototype.readFloatLE=function(a,i){return a>>>=0,i||checkOffset(a,4,this.length),c.read(this,a,!0,23,4)},Buffer.prototype.readFloatBE=function(a,i){return a>>>=0,i||checkOffset(a,4,this.length),c.read(this,a,!1,23,4)},Buffer.prototype.readDoubleLE=function(a,i){return a>>>=0,i||checkOffset(a,8,this.length),c.read(this,a,!0,52,8)},Buffer.prototype.readDoubleBE=function(a,i){return a>>>=0,i||checkOffset(a,8,this.length),c.read(this,a,!1,52,8)},Buffer.prototype.writeUIntLE=function(a,i,s,o){if(a=+a,i>>>=0,s>>>=0,!o){var c=Math.pow(2,8*s)-1;checkInt(this,a,i,s,c,0)}var w=1,P=0;for(this[i]=255&a;++P<s&&(w*=256);)this[i+P]=a/w&255;return i+s},Buffer.prototype.writeUIntBE=function(a,i,s,o){if(a=+a,i>>>=0,s>>>=0,!o){var c=Math.pow(2,8*s)-1;checkInt(this,a,i,s,c,0)}var w=s-1,P=1;for(this[i+w]=255&a;--w>=0&&(P*=256);)this[i+w]=a/P&255;return i+s},Buffer.prototype.writeUInt8=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,1,255,0),this[i]=255&a,i+1},Buffer.prototype.writeUInt16LE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,2,65535,0),this[i]=255&a,this[i+1]=a>>>8,i+2},Buffer.prototype.writeUInt16BE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,2,65535,0),this[i]=a>>>8,this[i+1]=255&a,i+2},Buffer.prototype.writeUInt32LE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,4,4294967295,0),this[i+3]=a>>>24,this[i+2]=a>>>16,this[i+1]=a>>>8,this[i]=255&a,i+4},Buffer.prototype.writeUInt32BE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,4,4294967295,0),this[i]=a>>>24,this[i+1]=a>>>16,this[i+2]=a>>>8,this[i+3]=255&a,i+4},Buffer.prototype.writeIntLE=function(a,i,s,o){if(a=+a,i>>>=0,!o){var c=Math.pow(2,8*s-1);checkInt(this,a,i,s,c-1,-c)}var w=0,P=1,A=0;for(this[i]=255&a;++w<s&&(P*=256);)a<0&&0===A&&0!==this[i+w-1]&&(A=1),this[i+w]=(a/P>>0)-A&255;return i+s},Buffer.prototype.writeIntBE=function(a,i,s,o){if(a=+a,i>>>=0,!o){var c=Math.pow(2,8*s-1);checkInt(this,a,i,s,c-1,-c)}var w=s-1,P=1,A=0;for(this[i+w]=255&a;--w>=0&&(P*=256);)a<0&&0===A&&0!==this[i+w+1]&&(A=1),this[i+w]=(a/P>>0)-A&255;return i+s},Buffer.prototype.writeInt8=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,1,127,-128),a<0&&(a=255+a+1),this[i]=255&a,i+1},Buffer.prototype.writeInt16LE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,2,32767,-32768),this[i]=255&a,this[i+1]=a>>>8,i+2},Buffer.prototype.writeInt16BE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,2,32767,-32768),this[i]=a>>>8,this[i+1]=255&a,i+2},Buffer.prototype.writeInt32LE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,4,2147483647,-2147483648),this[i]=255&a,this[i+1]=a>>>8,this[i+2]=a>>>16,this[i+3]=a>>>24,i+4},Buffer.prototype.writeInt32BE=function(a,i,s){return a=+a,i>>>=0,s||checkInt(this,a,i,4,2147483647,-2147483648),a<0&&(a=4294967295+a+1),this[i]=a>>>24,this[i+1]=a>>>16,this[i+2]=a>>>8,this[i+3]=255&a,i+4},Buffer.prototype.writeFloatLE=function(a,i,s){return writeFloat(this,a,i,!0,s)},Buffer.prototype.writeFloatBE=function(a,i,s){return writeFloat(this,a,i,!1,s)},Buffer.prototype.writeDoubleLE=function(a,i,s){return writeDouble(this,a,i,!0,s)},Buffer.prototype.writeDoubleBE=function(a,i,s){return writeDouble(this,a,i,!1,s)},Buffer.prototype.copy=function(a,i,s,o){if(!Buffer.isBuffer(a))throw TypeError("argument should be a Buffer");if(s||(s=0),o||0===o||(o=this.length),i>=a.length&&(i=a.length),i||(i=0),o>0&&o<s&&(o=s),o===s||0===a.length||0===this.length)return 0;if(i<0)throw RangeError("targetStart out of bounds");if(s<0||s>=this.length)throw RangeError("Index out of range");if(o<0)throw RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),a.length-i<o-s&&(o=a.length-i+s);var c=o-s;if(this===a&&"function"==typeof Uint8Array.prototype.copyWithin)this.copyWithin(i,s,o);else if(this===a&&s<i&&i<o)for(var w=c-1;w>=0;--w)a[w+i]=this[w+s];else Uint8Array.prototype.set.call(a,this.subarray(s,o),i);return c},Buffer.prototype.fill=function(a,i,s,o){if("string"==typeof a){if("string"==typeof i?(o=i,i=0,s=this.length):"string"==typeof s&&(o=s,s=this.length),void 0!==o&&"string"!=typeof o)throw TypeError("encoding must be a string");if("string"==typeof o&&!Buffer.isEncoding(o))throw TypeError("Unknown encoding: "+o);if(1===a.length){var c,w=a.charCodeAt(0);("utf8"===o&&w<128||"latin1"===o)&&(a=w)}}else"number"==typeof a?a&=255:"boolean"==typeof a&&(a=Number(a));if(i<0||this.length<i||this.length<s)throw RangeError("Out of range index");if(s<=i)return this;if(i>>>=0,s=void 0===s?this.length:s>>>0,a||(a=0),"number"==typeof a)for(c=i;c<s;++c)this[c]=a;else{var P=Buffer.isBuffer(a)?a:Buffer.from(a,o),A=P.length;if(0===A)throw TypeError('The value "'+a+'" is invalid for argument "value"');for(c=0;c<s-i;++c)this[c+i]=P[c%A]}return this};var P=/[^+/0-9A-Za-z-_]/g;function base64clean(a){if((a=(a=a.split("=")[0]).trim().replace(P,"")).length<2)return"";for(;a.length%4!=0;)a+="=";return a}function utf8ToBytes(a,i){i=i||1/0;for(var s,o=a.length,c=null,w=[],P=0;P<o;++P){if((s=a.charCodeAt(P))>55295&&s<57344){if(!c){if(s>56319||P+1===o){(i-=3)>-1&&w.push(239,191,189);continue}c=s;continue}if(s<56320){(i-=3)>-1&&w.push(239,191,189),c=s;continue}s=(c-55296<<10|s-56320)+65536}else c&&(i-=3)>-1&&w.push(239,191,189);if(c=null,s<128){if((i-=1)<0)break;w.push(s)}else if(s<2048){if((i-=2)<0)break;w.push(s>>6|192,63&s|128)}else if(s<65536){if((i-=3)<0)break;w.push(s>>12|224,s>>6&63|128,63&s|128)}else if(s<1114112){if((i-=4)<0)break;w.push(s>>18|240,s>>12&63|128,s>>6&63|128,63&s|128)}else throw Error("Invalid code point")}return w}function asciiToBytes(a){for(var i=[],s=0;s<a.length;++s)i.push(255&a.charCodeAt(s));return i}function utf16leToBytes(a,i){for(var s,o,c=[],w=0;w<a.length&&!((i-=2)<0);++w)o=(s=a.charCodeAt(w))>>8,c.push(s%256),c.push(o);return c}function base64ToBytes(a){return o.toByteArray(base64clean(a))}function blitBuffer(a,i,s,o){for(var c=0;c<o&&!(c+s>=i.length)&&!(c>=a.length);++c)i[c+s]=a[c];return c}function isInstance(a,i){return a instanceof i||null!=a&&null!=a.constructor&&null!=a.constructor.name&&a.constructor.name===i.name}var A=function(){for(var a="0123456789abcdef",i=Array(256),s=0;s<16;++s)for(var o=16*s,c=0;c<16;++c)i[o+c]=a[s]+a[c];return i}()},783:function(a,i){/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */i.read=function(a,i,s,o,c){var w,P,A=8*c-o-1,x=(1<<A)-1,k=x>>1,R=-7,j=s?c-1:0,$=s?-1:1,B=a[i+j];for(j+=$,w=B&(1<<-R)-1,B>>=-R,R+=A;R>0;w=256*w+a[i+j],j+=$,R-=8);for(P=w&(1<<-R)-1,w>>=-R,R+=o;R>0;P=256*P+a[i+j],j+=$,R-=8);if(0===w)w=1-k;else{if(w===x)return P?NaN:(B?-1:1)*(1/0);P+=Math.pow(2,o),w-=k}return(B?-1:1)*P*Math.pow(2,w-o)},i.write=function(a,i,s,o,c,w){var P,A,x,k=8*w-c-1,R=(1<<k)-1,j=R>>1,$=23===c?5960464477539062e-23:0,B=o?0:w-1,D=o?1:-1,Z=i<0||0===i&&1/i<0?1:0;for(isNaN(i=Math.abs(i))||i===1/0?(A=isNaN(i)?1:0,P=R):(P=Math.floor(Math.log(i)/Math.LN2),i*(x=Math.pow(2,-P))<1&&(P--,x*=2),P+j>=1?i+=$/x:i+=$*Math.pow(2,1-j),i*x>=2&&(P++,x/=2),P+j>=R?(A=0,P=R):P+j>=1?(A=(i*x-1)*Math.pow(2,c),P+=j):(A=i*Math.pow(2,j-1)*Math.pow(2,c),P=0));c>=8;a[s+B]=255&A,B+=D,A/=256,c-=8);for(P=P<<c|A,k+=c;k>0;a[s+B]=255&P,B+=D,P/=256,k-=8);a[s+B-D]|=128*Z}}},s={};function __nccwpck_require__(a){var o=s[a];if(void 0!==o)return o.exports;var c=s[a]={exports:{}},w=!0;try{i[a](c,c.exports,__nccwpck_require__),w=!1}finally{w&&delete s[a]}return c.exports}__nccwpck_require__.ab="//";var o=__nccwpck_require__(72);a.exports=o}()},1197:function(a){!function(){var i={229:function(a){var i,s,o,c=a.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function runTimeout(a){if(i===setTimeout)return setTimeout(a,0);if((i===defaultSetTimout||!i)&&setTimeout)return i=setTimeout,setTimeout(a,0);try{return i(a,0)}catch(s){try{return i.call(null,a,0)}catch(s){return i.call(this,a,0)}}}function runClearTimeout(a){if(s===clearTimeout)return clearTimeout(a);if((s===defaultClearTimeout||!s)&&clearTimeout)return s=clearTimeout,clearTimeout(a);try{return s(a)}catch(i){try{return s.call(null,a)}catch(i){return s.call(this,a)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(a){i=defaultSetTimout}try{s="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(a){s=defaultClearTimeout}}();var w=[],P=!1,A=-1;function cleanUpNextTick(){P&&o&&(P=!1,o.length?w=o.concat(w):A=-1,w.length&&drainQueue())}function drainQueue(){if(!P){var a=runTimeout(cleanUpNextTick);P=!0;for(var i=w.length;i;){for(o=w,w=[];++A<i;)o&&o[A].run();A=-1,i=w.length}o=null,P=!1,runClearTimeout(a)}}function Item(a,i){this.fun=a,this.array=i}function noop(){}c.nextTick=function(a){var i=Array(arguments.length-1);if(arguments.length>1)for(var s=1;s<arguments.length;s++)i[s-1]=arguments[s];w.push(new Item(a,i)),1!==w.length||P||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},c.title="browser",c.browser=!0,c.env={},c.argv=[],c.version="",c.versions={},c.on=noop,c.addListener=noop,c.once=noop,c.off=noop,c.removeListener=noop,c.removeAllListeners=noop,c.emit=noop,c.prependListener=noop,c.prependOnceListener=noop,c.listeners=function(a){return[]},c.binding=function(a){throw Error("process.binding is not supported")},c.cwd=function(){return"/"},c.chdir=function(a){throw Error("process.chdir is not supported")},c.umask=function(){return 0}}},s={};function __nccwpck_require__(a){var o=s[a];if(void 0!==o)return o.exports;var c=s[a]={exports:{}},w=!0;try{i[a](c,c.exports,__nccwpck_require__),w=!1}finally{w&&delete s[a]}return c.exports}__nccwpck_require__.ab="//";var o=__nccwpck_require__(229);a.exports=o}()},6938:function(a,i,s){"use strict";Object.defineProperty(i,"Z",{enumerable:!0,get:function(){return o.NextResponse}});let o=s(6783)},2700:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"NextURL",{enumerable:!0,get:function(){return NextURL}});let o=s(1553),c=s(8307),w=s(8756),P=s(7831),A=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function parseURL(a,i){return new URL(String(a).replace(A,"localhost"),i&&String(i).replace(A,"localhost"))}let x=Symbol("NextURLInternal");let NextURL=class NextURL{constructor(a,i,s){let o,c;"object"==typeof i&&"pathname"in i||"string"==typeof i?(o=i,c=s||{}):c=s||i||{},this[x]={url:parseURL(a,o??c.base),options:c,basePath:""},this.analyze()}analyze(){var a,i,s,c,A;let k=(0,P.getNextPathnameInfo)(this[x].url.pathname,{nextConfig:this[x].options.nextConfig,parseData:!0,i18nProvider:this[x].options.i18nProvider}),R=(0,w.getHostname)(this[x].url,this[x].options.headers);this[x].domainLocale=this[x].options.i18nProvider?this[x].options.i18nProvider.detectDomainLocale(R):(0,o.detectDomainLocale)(null==(i=this[x].options.nextConfig)?void 0:null==(a=i.i18n)?void 0:a.domains,R);let j=(null==(s=this[x].domainLocale)?void 0:s.defaultLocale)||(null==(A=this[x].options.nextConfig)?void 0:null==(c=A.i18n)?void 0:c.defaultLocale);this[x].url.pathname=k.pathname,this[x].defaultLocale=j,this[x].basePath=k.basePath??"",this[x].buildId=k.buildId,this[x].locale=k.locale??j,this[x].trailingSlash=k.trailingSlash}formatPathname(){return(0,c.formatNextPathnameInfo)({basePath:this[x].basePath,buildId:this[x].buildId,defaultLocale:this[x].options.forceLocale?void 0:this[x].defaultLocale,locale:this[x].locale,pathname:this[x].url.pathname,trailingSlash:this[x].trailingSlash})}formatSearch(){return this[x].url.search}get buildId(){return this[x].buildId}set buildId(a){this[x].buildId=a}get locale(){return this[x].locale??""}set locale(a){var i,s;if(!this[x].locale||!(null==(s=this[x].options.nextConfig)?void 0:null==(i=s.i18n)?void 0:i.locales.includes(a)))throw TypeError(`The NextURL configuration includes no locale "${a}"`);this[x].locale=a}get defaultLocale(){return this[x].defaultLocale}get domainLocale(){return this[x].domainLocale}get searchParams(){return this[x].url.searchParams}get host(){return this[x].url.host}set host(a){this[x].url.host=a}get hostname(){return this[x].url.hostname}set hostname(a){this[x].url.hostname=a}get port(){return this[x].url.port}set port(a){this[x].url.port=a}get protocol(){return this[x].url.protocol}set protocol(a){this[x].url.protocol=a}get href(){let a=this.formatPathname(),i=this.formatSearch();return`${this.protocol}//${this.host}${a}${i}${this.hash}`}set href(a){this[x].url=parseURL(a),this.analyze()}get origin(){return this[x].url.origin}get pathname(){return this[x].url.pathname}set pathname(a){this[x].url.pathname=a}get hash(){return this[x].url.hash}set hash(a){this[x].url.hash=a}get search(){return this[x].url.search}set search(a){this[x].url.search=a}get password(){return this[x].url.password}set password(a){this[x].url.password=a}get username(){return this[x].url.username}set username(a){this[x].url.username=a}get basePath(){return this[x].basePath}set basePath(a){this[x].basePath=a.startsWith("/")?a:`/${a}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new NextURL(String(this),this[x].options)}}},7799:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),function(a,i){for(var s in i)Object.defineProperty(a,s,{enumerable:!0,get:i[s]})}(i,{RequestCookies:function(){return o.RequestCookies},ResponseCookies:function(){return o.ResponseCookies}});let o=s(8476)},6783:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0}),Object.defineProperty(i,"NextResponse",{enumerable:!0,get:function(){return NextResponse}});let o=s(2700),c=s(1387),w=s(7799),P=Symbol("internal response"),A=new Set([301,302,303,307,308]);function handleMiddlewareField(a,i){var s;if(null==a?void 0:null==(s=a.request)?void 0:s.headers){if(!(a.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let s=[];for(let[o,c]of a.request.headers)i.set("x-middleware-request-"+o,c),s.push(o);i.set("x-middleware-override-headers",s.join(","))}}let NextResponse=class NextResponse extends Response{constructor(a,i={}){super(a,i),this[P]={cookies:new w.ResponseCookies(this.headers),url:i.url?new o.NextURL(i.url,{headers:(0,c.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:i.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[P].cookies}static json(a,i){let s=Response.json(a,i);return new NextResponse(s.body,s)}static redirect(a,i){let s="number"==typeof i?i:(null==i?void 0:i.status)??307;if(!A.has(s))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let o="object"==typeof i?i:{},w=new Headers(null==o?void 0:o.headers);return w.set("Location",(0,c.validateURL)(a)),new NextResponse(null,{...o,headers:w,status:s})}static rewrite(a,i){let s=new Headers(null==i?void 0:i.headers);return s.set("x-middleware-rewrite",(0,c.validateURL)(a)),handleMiddlewareField(i,s),new NextResponse(null,{...i,headers:s})}static next(a){let i=new Headers(null==a?void 0:a.headers);return i.set("x-middleware-next","1"),handleMiddlewareField(a,i),new NextResponse(null,{...a,headers:i})}}},1387:function(a,i){"use strict";function fromNodeOutgoingHttpHeaders(a){let i=new Headers;for(let[s,o]of Object.entries(a)){let a=Array.isArray(o)?o:[o];for(let o of a)void 0!==o&&("number"==typeof o&&(o=o.toString()),i.append(s,o))}return i}function splitCookiesString(a){var i,s,o,c,w,P=[],A=0;function skipWhitespace(){for(;A<a.length&&/\s/.test(a.charAt(A));)A+=1;return A<a.length}function notSpecialChar(){return"="!==(s=a.charAt(A))&&";"!==s&&","!==s}for(;A<a.length;){for(i=A,w=!1;skipWhitespace();)if(","===(s=a.charAt(A))){for(o=A,A+=1,skipWhitespace(),c=A;A<a.length&&notSpecialChar();)A+=1;A<a.length&&"="===a.charAt(A)?(w=!0,A=c,P.push(a.substring(i,o)),i=A):A=o+1}else A+=1;(!w||A>=a.length)&&P.push(a.substring(i,a.length))}return P}function toNodeOutgoingHttpHeaders(a){let i={},s=[];if(a)for(let[o,c]of a.entries())"set-cookie"===o.toLowerCase()?(s.push(...splitCookiesString(c)),i[o]=1===s.length?s[0]:s):i[o]=c;return i}function validateURL(a){try{return String(new URL(String(a)))}catch(i){throw Error(`URL is malformed "${String(a)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:i})}}Object.defineProperty(i,"__esModule",{value:!0}),function(a,i){for(var s in i)Object.defineProperty(a,s,{enumerable:!0,get:i[s]})}(i,{fromNodeOutgoingHttpHeaders:function(){return fromNodeOutgoingHttpHeaders},splitCookiesString:function(){return splitCookiesString},toNodeOutgoingHttpHeaders:function(){return toNodeOutgoingHttpHeaders},validateURL:function(){return validateURL}})},9014:function(a){"use strict";a.exports=(a,i)=>(i=i||(()=>{}),a.then(a=>new Promise(a=>{a(i())}).then(()=>a),a=>new Promise(a=>{a(i())}).then(()=>{throw a})))},4825:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});let o=s(7913),c=s(6586),w=s(5517),empty=()=>{},P=new c.TimeoutError;let PQueue=class PQueue extends o{constructor(a){var i,s,o,c;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=empty,this._resolveIdle=empty,!("number"==typeof(a=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:w.default},a)).intervalCap&&a.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(s=null===(i=a.intervalCap)||void 0===i?void 0:i.toString())&&void 0!==s?s:""}\` (${typeof a.intervalCap})`);if(void 0===a.interval||!(Number.isFinite(a.interval)&&a.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(c=null===(o=a.interval)||void 0===o?void 0:o.toString())&&void 0!==c?c:""}\` (${typeof a.interval})`);this._carryoverConcurrencyCount=a.carryoverConcurrencyCount,this._isIntervalIgnored=a.intervalCap===1/0||0===a.interval,this._intervalCap=a.intervalCap,this._interval=a.interval,this._queue=new a.queueClass,this._queueClass=a.queueClass,this.concurrency=a.concurrency,this._timeout=a.timeout,this._throwOnTimeout=!0===a.throwOnTimeout,this._isPaused=!1===a.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=empty,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=empty,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let a=Date.now();if(void 0===this._intervalId){let i=this._intervalEnd-a;if(!(i<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},i)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let a=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let i=this._queue.dequeue();return!!i&&(this.emit("active"),i(),a&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(a){if(!("number"==typeof a&&a>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${a}\` (${typeof a})`);this._concurrency=a,this._processQueue()}async add(a,i={}){return new Promise((s,o)=>{let run=async()=>{this._pendingCount++,this._intervalCount++;try{let w=void 0===this._timeout&&void 0===i.timeout?a():c.default(Promise.resolve(a()),void 0===i.timeout?this._timeout:i.timeout,()=>{(void 0===i.throwOnTimeout?this._throwOnTimeout:i.throwOnTimeout)&&o(P)});s(await w)}catch(a){o(a)}this._next()};this._queue.enqueue(run,i),this._tryToStartAnother(),this.emit("add")})}async addAll(a,i){return Promise.all(a.map(async a=>this.add(a,i)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(a=>{let i=this._resolveEmpty;this._resolveEmpty=()=>{i(),a()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(a=>{let i=this._resolveIdle;this._resolveIdle=()=>{i(),a()}})}get size(){return this._queue.size}sizeBy(a){return this._queue.filter(a).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(a){this._timeout=a}};i.default=PQueue},2736:function(a,i){"use strict";function lowerBound(a,i,s){let o=0,c=a.length;for(;c>0;){let w=c/2|0,P=o+w;0>=s(a[P],i)?(o=++P,c-=w+1):c=w}return o}Object.defineProperty(i,"__esModule",{value:!0}),i.default=lowerBound},5517:function(a,i,s){"use strict";Object.defineProperty(i,"__esModule",{value:!0});let o=s(2736);let PriorityQueue=class PriorityQueue{constructor(){this._queue=[]}enqueue(a,i){i=Object.assign({priority:0},i);let s={priority:i.priority,run:a};if(this.size&&this._queue[this.size-1].priority>=i.priority){this._queue.push(s);return}let c=o.default(this._queue,s,(a,i)=>i.priority-a.priority);this._queue.splice(c,0,s)}dequeue(){let a=this._queue.shift();return null==a?void 0:a.run}filter(a){return this._queue.filter(i=>i.priority===a.priority).map(a=>a.run)}get size(){return this._queue.length}};i.default=PriorityQueue},1018:function(a,i,s){"use strict";let o=s(9182),c=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];let AbortError=class AbortError extends Error{constructor(a){super(),a instanceof Error?(this.originalError=a,{message:a}=a):(this.originalError=Error(a),this.originalError.stack=this.stack),this.name="AbortError",this.message=a}};let decorateErrorWithCounts=(a,i,s)=>{let o=s.retries-(i-1);return a.attemptNumber=i,a.retriesLeft=o,a},isNetworkError=a=>c.includes(a),pRetry=(a,i)=>new Promise((s,c)=>{i={onFailedAttempt:()=>{},retries:10,...i};let w=o.operation(i);w.attempt(async o=>{try{s(await a(o))}catch(a){if(!(a instanceof Error)){c(TypeError(`Non-error was thrown: "${a}". You should only throw errors.`));return}if(a instanceof AbortError)w.stop(),c(a.originalError);else if(a instanceof TypeError&&!isNetworkError(a.message))w.stop(),c(a);else{decorateErrorWithCounts(a,o,i);try{await i.onFailedAttempt(a)}catch(a){c(a);return}w.retry(a)||c(w.mainError())}}})});a.exports=pRetry,a.exports.default=pRetry,a.exports.AbortError=AbortError},6586:function(a,i,s){"use strict";let o=s(9014);let TimeoutError=class TimeoutError extends Error{constructor(a){super(a),this.name="TimeoutError"}};let pTimeout=(a,i,s)=>new Promise((c,w)=>{if("number"!=typeof i||i<0)throw TypeError("Expected `milliseconds` to be a positive number");if(i===1/0){c(a);return}let P=setTimeout(()=>{if("function"==typeof s){try{c(s())}catch(a){w(a)}return}let o="string"==typeof s?s:`Promise timed out after ${i} milliseconds`,P=s instanceof Error?s:new TimeoutError(o);"function"==typeof a.cancel&&a.cancel(),w(P)},i);o(a.then(c,w),()=>{clearTimeout(P)})});a.exports=pTimeout,a.exports.default=pTimeout,a.exports.TimeoutError=TimeoutError},9182:function(a,i,s){a.exports=s(7530)},7530:function(a,i,s){var o=s(9283);i.operation=function(a){return new o(i.timeouts(a),{forever:a&&(a.forever||a.retries===1/0),unref:a&&a.unref,maxRetryTime:a&&a.maxRetryTime})},i.timeouts=function(a){if(a instanceof Array)return[].concat(a);var i={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var s in a)i[s]=a[s];if(i.minTimeout>i.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var o=[],c=0;c<i.retries;c++)o.push(this.createTimeout(c,i));return a&&a.forever&&!o.length&&o.push(this.createTimeout(c,i)),o.sort(function(a,i){return a-i}),o},i.createTimeout=function(a,i){return Math.min(Math.round((i.randomize?Math.random()+1:1)*Math.max(i.minTimeout,1)*Math.pow(i.factor,a)),i.maxTimeout)},i.wrap=function(a,s,o){if(s instanceof Array&&(o=s,s=null),!o)for(var c in o=[],a)"function"==typeof a[c]&&o.push(c);for(var w=0;w<o.length;w++){var P=o[w],A=a[P];a[P]=(function(o){var c=i.operation(s),w=Array.prototype.slice.call(arguments,1),P=w.pop();w.push(function(a){c.retry(a)||(a&&(arguments[0]=c.mainError()),P.apply(this,arguments))}),c.attempt(function(){o.apply(a,w)})}).bind(a,A),a[P].options=s}}},9283:function(a){function RetryOperation(a,i){"boolean"==typeof i&&(i={forever:i}),this._originalTimeouts=JSON.parse(JSON.stringify(a)),this._timeouts=a,this._options=i||{},this._maxRetryTime=i&&i.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}a.exports=RetryOperation,RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(a){if(this._timeout&&clearTimeout(this._timeout),!a)return!1;var i=new Date().getTime();if(a&&i-this._operationStart>=this._maxRetryTime)return this._errors.push(a),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(a);var s=this._timeouts.shift();if(void 0===s){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),s=this._cachedTimeouts.slice(-1)}var o=this;return this._timer=setTimeout(function(){o._attempts++,o._operationTimeoutCb&&(o._timeout=setTimeout(function(){o._operationTimeoutCb(o._attempts)},o._operationTimeout),o._options.unref&&o._timeout.unref()),o._fn(o._attempts)},s),this._options.unref&&this._timer.unref(),!0},RetryOperation.prototype.attempt=function(a,i){this._fn=a,i&&(i.timeout&&(this._operationTimeout=i.timeout),i.cb&&(this._operationTimeoutCb=i.cb));var s=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){s._operationTimeoutCb()},s._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(a){console.log("Using RetryOperation.try() is deprecated"),this.attempt(a)},RetryOperation.prototype.start=function(a){console.log("Using RetryOperation.start() is deprecated"),this.attempt(a)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var a={},i=null,s=0,o=0;o<this._errors.length;o++){var c=this._errors[o],w=c.message,P=(a[w]||0)+1;a[w]=P,P>=s&&(i=c,s=P)}return i}},8315:function(a,i,s){"use strict";/**
 * @license React
 * use-sync-external-store-shim.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var o=s(1798);function h(a,i){return a===i&&(0!==a||1/a==1/i)||a!=a&&i!=i}var c="function"==typeof Object.is?Object.is:h,w=o.useState,P=o.useEffect,A=o.useLayoutEffect,x=o.useDebugValue;function q(a,i){var s=i(),o=w({inst:{value:s,getSnapshot:i}}),c=o[0].inst,k=o[1];return A(function(){c.value=s,c.getSnapshot=i,r(c)&&k({inst:c})},[a,s,i]),P(function(){return r(c)&&k({inst:c}),a(function(){r(c)&&k({inst:c})})},[a]),x(s),s}function r(a){var i=a.getSnapshot;a=a.value;try{var s=i();return!c(a,s)}catch(a){return!0}}function t(a,i){return i()}var k="undefined"==typeof window||void 0===window.document||void 0===window.document.createElement?t:q;i.useSyncExternalStore=void 0!==o.useSyncExternalStore?o.useSyncExternalStore:k},5647:function(a,i,s){"use strict";a.exports=s(8315)},9634:function(a,i,s){"use strict";let o;s.d(i,{Z:function(){return esm_browser_v4}});let c="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var w={randomUUID:c};let P=new Uint8Array(16);function rng(){if(!o&&!(o="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return o(P)}let A=[];for(let a=0;a<256;++a)A.push((a+256).toString(16).slice(1));function unsafeStringify(a,i=0){return A[a[i+0]]+A[a[i+1]]+A[a[i+2]]+A[a[i+3]]+"-"+A[a[i+4]]+A[a[i+5]]+"-"+A[a[i+6]]+A[a[i+7]]+"-"+A[a[i+8]]+A[a[i+9]]+"-"+A[a[i+10]]+A[a[i+11]]+A[a[i+12]]+A[a[i+13]]+A[a[i+14]]+A[a[i+15]]}var esm_browser_v4=function(a,i,s){if(w.randomUUID&&!i&&!a)return w.randomUUID();a=a||{};let o=a.random||(a.rng||rng)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,i){s=s||0;for(let a=0;a<16;++a)i[s+a]=o[a];return i}return unsafeStringify(o)}},325:function(a,i,s){"use strict";s.d(i,{Z:function(){return esm_browser_validate}});var o=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,esm_browser_validate=function(a){return"string"==typeof a&&o.test(a)}},1974:function(a,i,s){"use strict";s.d(i,{QH:function(){return o.QH},Ye:function(){return o.Ye}});var o=s(7018)},2713:function(a,i,s){"use strict";s.d(i,{E:function(){return BaseCallbackHandler}});var o=s(9634),c=s(8498),w=s(298);let BaseCallbackHandlerMethodsClass=class BaseCallbackHandlerMethodsClass{};let BaseCallbackHandler=class BaseCallbackHandler extends BaseCallbackHandlerMethodsClass{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,c.j)(this.constructor)]}constructor(a){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==(0,w.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=a||{},a&&(this.ignoreLLM=a.ignoreLLM??this.ignoreLLM,this.ignoreChain=a.ignoreChain??this.ignoreChain,this.ignoreAgent=a.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=a.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=a._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return c.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return c.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(a){let Handler=class Handler extends BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:o.Z()}),Object.assign(this,a)}};return new Handler}}},7018:function(a,i,s){"use strict";let o,c,w,P;s.d(i,{Ye:function(){return CallbackManager},xz:function(){return ensureHandler},QH:function(){return parseCallbackConfigArg}});var A=s(9634),x=s(2713),k=s(9919),R=s(1448);function wrap(a,i){return`${a.open}${i}${a.close}`}function tryJsonStringify(a,i){try{return JSON.stringify(a,null,2)}catch(a){return i}}function elapsed(a){if(!a.end_time)return"";let i=a.end_time-a.start_time;return i<1e3?`${i}ms`:`${(i/1e3).toFixed(2)}s`}let{color:j}=k;let ConsoleCallbackHandler=class ConsoleCallbackHandler extends R.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(a){return Promise.resolve()}getParents(a){let i=[],s=a;for(;s.parent_run_id;){let a=this.runMap.get(s.parent_run_id);if(a)i.push(a),s=a;else break}return i}getBreadcrumbs(a){let i=this.getParents(a).reverse(),s=[...i,a].map((a,i,s)=>{let o=`${a.execution_order}:${a.run_type}:${a.name}`;return i===s.length-1?wrap(k.bold,o):o}).join(" > ");return wrap(j.grey,s)}onChainStart(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.green,"[chain/start]")} [${i}] Entering Chain run with input: ${tryJsonStringify(a.inputs,"[inputs]")}`)}onChainEnd(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.cyan,"[chain/end]")} [${i}] [${elapsed(a)}] Exiting Chain run with output: ${tryJsonStringify(a.outputs,"[outputs]")}`)}onChainError(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.red,"[chain/error]")} [${i}] [${elapsed(a)}] Chain run errored with error: ${tryJsonStringify(a.error,"[error]")}`)}onLLMStart(a){let i=this.getBreadcrumbs(a),s="prompts"in a.inputs?{prompts:a.inputs.prompts.map(a=>a.trim())}:a.inputs;console.log(`${wrap(j.green,"[llm/start]")} [${i}] Entering LLM run with input: ${tryJsonStringify(s,"[inputs]")}`)}onLLMEnd(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.cyan,"[llm/end]")} [${i}] [${elapsed(a)}] Exiting LLM run with output: ${tryJsonStringify(a.outputs,"[response]")}`)}onLLMError(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.red,"[llm/error]")} [${i}] [${elapsed(a)}] LLM run errored with error: ${tryJsonStringify(a.error,"[error]")}`)}onToolStart(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.green,"[tool/start]")} [${i}] Entering Tool run with input: "${a.inputs.input?.trim()}"`)}onToolEnd(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.cyan,"[tool/end]")} [${i}] [${elapsed(a)}] Exiting Tool run with output: "${a.outputs?.output?.trim()}"`)}onToolError(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.red,"[tool/error]")} [${i}] [${elapsed(a)}] Tool run errored with error: ${tryJsonStringify(a.error,"[error]")}`)}onRetrieverStart(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.green,"[retriever/start]")} [${i}] Entering Retriever run with input: ${tryJsonStringify(a.inputs,"[inputs]")}`)}onRetrieverEnd(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.cyan,"[retriever/end]")} [${i}] [${elapsed(a)}] Exiting Retriever run with output: ${tryJsonStringify(a.outputs,"[outputs]")}`)}onRetrieverError(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.red,"[retriever/error]")} [${i}] [${elapsed(a)}] Retriever run errored with error: ${tryJsonStringify(a.error,"[error]")}`)}onAgentAction(a){let i=this.getBreadcrumbs(a);console.log(`${wrap(j.blue,"[agent/action]")} [${i}] Agent selected action: ${tryJsonStringify(a.actions[a.actions.length-1],"[action]")}`)}};var $=s(325),B=s(1018),D=s(4825);let Z=[400,401,403,404,405,406,407,408],U=[409];let AsyncCaller=class AsyncCaller{constructor(a){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=a.maxConcurrency??1/0,this.maxRetries=a.maxRetries??6;let i=D.default;this.queue=new i({concurrency:this.maxConcurrency}),this.onFailedResponseHook=a?.onFailedResponseHook}call(a,...i){let s=this.onFailedResponseHook;return this.queue.add(()=>B(()=>a(...i).catch(a=>{if(a instanceof Error)throw a;throw Error(a)}),{async onFailedAttempt(a){if(a.message.startsWith("Cancel")||a.message.startsWith("TimeoutError")||a.message.startsWith("AbortError")||a?.code==="ECONNABORTED")throw a;let i=a?.response,o=i?.status;if(o){if(Z.includes(+o))throw a;if(U.includes(+o))return;s&&await s(i)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(a,i,...s){return a.signal?Promise.race([this.call(i,...s),new Promise((i,s)=>{a.signal?.addEventListener("abort",()=>{s(Error("AbortError"))})})]):this.call(i,...s)}fetch(...a){return this.call(()=>fetch(...a).then(a=>a.ok?a:Promise.reject(a)))}};function isLangChainMessage(a){return"function"==typeof a?._getType}function convertLangChainMessageToExample(a){let i={type:a._getType(),data:{content:a.content}};return a?.additional_kwargs&&Object.keys(a.additional_kwargs).length>0&&(i.data.additional_kwargs={...a.additional_kwargs}),i}var z=s(5656);let isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),isDeno=()=>"undefined"!=typeof Deno,isNode=()=>void 0!==z&&void 0!==z.versions&&void 0!==z.versions.node&&!isDeno(),getEnv=()=>o||(o=isBrowser()?"browser":isNode()?"node":isWebWorker()?"webworker":isJsDom()?"jsdom":isDeno()?"deno":"other");async function env_getRuntimeEnvironment(){if(void 0===c){let a=getEnv(),i=getShas();c={library:"langsmith",runtime:a,sdk:"langsmith-js",sdk_version:V,...i}}return c}function getLangChainEnvVarsMetadata(){let a=getEnvironmentVariables()||{},i={},s=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[o,c]of Object.entries(a))!o.startsWith("LANGCHAIN_")||"string"!=typeof c||s.includes(o)||o.toLowerCase().includes("key")||o.toLowerCase().includes("secret")||o.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===o?i.revision_id=c:i[o]=c);return i}function getEnvironmentVariables(){try{if(void 0!==z&&z.env)return Object.entries(z.env).reduce((a,[i,s])=>(a[i]=String(s),a),{});return}catch(a){return}}function env_getEnvironmentVariable(a){try{return void 0!==z?z.env?.[a]:void 0}catch(a){return}}function getShas(){if(void 0!==w)return w;let a={};for(let i of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let s=env_getEnvironmentVariable(i);void 0!==s&&(a[i]=s)}return w=a,a}async function mergeRuntimeEnvIntoRunCreates(a){let i=await env_getRuntimeEnvironment(),s=getLangChainEnvVarsMetadata();return a.map(a=>{let o=a.extra??{},c=o.metadata;return a.extra={...o,runtime:{...i,...o?.runtime},metadata:{...s,...s.revision_id||a.revision_id?{revision_id:a.revision_id??s.revision_id}:{},...c}},a})}let getTracingSamplingRate=()=>{let a=env_getEnvironmentVariable("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===a)return;let i=parseFloat(a);if(i<0||i>1)throw Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${i}`);return i},isLocalhost=a=>{let i=a.replace("http://","").replace("https://",""),s=i.split("/")[0].split(":")[0];return"localhost"===s||"127.0.0.1"===s||"::1"===s},raiseForStatus=async(a,i)=>{let s=await a.text();if(!a.ok)throw Error(`Failed to ${i}: ${a.status} ${a.statusText} ${s}`)};async function toArray(a){let i=[];for await(let s of a)i.push(s);return i}function trimQuotes(a){if(void 0!==a)return a.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function assertUuid(a){if(!$.Z(a))throw Error(`Invalid UUID: ${a}`)}let handle429=async a=>{if(a?.status===429){let i=1e3*parseInt(a.headers.get("retry-after")??"30",10);if(i>0)return await new Promise(a=>setTimeout(a,i)),!0}return!1};let Queue=class Queue{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(a){return new Promise(i=>{this.items.push([a,i])})}pop(a){if(a<1)throw Error("Number of items to pop off may not be less than 1.");let i=[];for(;i.length<a&&this.items.length;){let a=this.items.shift();if(a)i.push(a);else break}return[i.map(a=>a[0]),()=>i.forEach(a=>a[1]())]}};let client_Client=class client_Client{constructor(a={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Queue}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=client_Client.getDefaultClientConfig();this.tracingSampleRate=getTracingSamplingRate(),this.apiUrl=trimQuotes(a.apiUrl??i.apiUrl)??"",this.apiKey=trimQuotes(a.apiKey??i.apiKey),this.webUrl=trimQuotes(a.webUrl??i.webUrl),this.timeout_ms=a.timeout_ms??12e3,this.caller=new AsyncCaller(a.callerOptions??{}),this.batchIngestCaller=new AsyncCaller({...a.callerOptions??{},onFailedResponseHook:handle429}),this.hideInputs=a.hideInputs??i.hideInputs,this.hideOutputs=a.hideOutputs??i.hideOutputs,this.autoBatchTracing=a.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=a.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=a.fetchOptions||{}}static getDefaultClientConfig(){let a=env_getEnvironmentVariable("LANGCHAIN_API_KEY"),i=env_getEnvironmentVariable("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",s="true"===env_getEnvironmentVariable("LANGCHAIN_HIDE_INPUTS"),o="true"===env_getEnvironmentVariable("LANGCHAIN_HIDE_OUTPUTS");return{apiUrl:i,apiKey:a,webUrl:void 0,hideInputs:s,hideOutputs:o}}getHostUrl(){return this.webUrl?this.webUrl:isLocalhost(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let a={"User-Agent":`langsmith-js/${V}`};return this.apiKey&&(a["x-api-key"]=`${this.apiKey}`),a}processInputs(a){return!1===this.hideInputs?a:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(a):a}processOutputs(a){return!1===this.hideOutputs?a:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(a):a}prepareRunCreateOrUpdateInputs(a){let i={...a};return void 0!==i.inputs&&(i.inputs=this.processInputs(i.inputs)),void 0!==i.outputs&&(i.outputs=this.processOutputs(i.outputs)),i}async _getResponse(a,i){let s=i?.toString()??"",o=`${this.apiUrl}${a}?${s}`,c=await this.caller.call(fetch,o,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok)throw Error(`Failed to fetch ${a}: ${c.status} ${c.statusText}`);return c}async _get(a,i){let s=await this._getResponse(a,i);return s.json()}async *_getPaginated(a,i=new URLSearchParams){let s=Number(i.get("offset"))||0,o=Number(i.get("limit"))||100;for(;;){i.set("offset",String(s)),i.set("limit",String(o));let c=`${this.apiUrl}${a}?${i}`,w=await this.caller.call(fetch,c,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!w.ok)throw Error(`Failed to fetch ${a}: ${w.status} ${w.statusText}`);let P=await w.json();if(0===P.length||(yield P,P.length<o))break;s+=P.length}}async *_getCursorPaginatedList(a,i=null,s="POST",o="runs"){let c=i?{...i}:{};for(;;){let i=await this.caller.call(fetch,`${this.apiUrl}${a}`,{method:s,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(c)}),w=await i.json();if(!w||!w[o])break;yield w[o];let P=w.cursors;if(!P||!P.next)break;c.cursor=P.next}}_filterForSampling(a,i=!1){if(void 0===this.tracingSampleRate)return a;if(i){let i=[];for(let s of a)this.sampledPostUuids.has(s.id)&&(i.push(s),this.sampledPostUuids.delete(s.id));return i}{let i=[];for(let s of a)Math.random()<this.tracingSampleRate&&(i.push(s),this.sampledPostUuids.add(s.id));return i}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){let[a,i]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!a.length){i();return}try{await this.batchIngestRuns({runCreates:a.filter(a=>"create"===a.action).map(a=>a.item),runUpdates:a.filter(a=>"update"===a.action).map(a=>a.item)})}finally{i()}}}async processRunOperation(a,i){let s=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;let o=this.autoBatchQueue.push(a);return(i||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},s?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),o}async _getServerInfo(){let a=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!a.ok)throw await a.text(),Error("Failed to retrieve server info.");return a.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(a){return!1}return!0}async createRun(a){if(!this._filterForSampling([a]).length)return;let i={...this.headers,"Content-Type":"application/json"},s=a.project_name;delete a.project_name;let o=this.prepareRunCreateOrUpdateInputs({session_name:s,...a,start_time:a.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==o.trace_id&&void 0!==o.dotted_order){this.processRunOperation({action:"create",item:o}).catch(console.error);return}let c=await mergeRuntimeEnvIntoRunCreates([o]),w=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:i,body:JSON.stringify(c[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(w,"create run")}async batchIngestRuns({runCreates:a,runUpdates:i}){if(void 0===a&&void 0===i)return;let s=a?.map(a=>this.prepareRunCreateOrUpdateInputs(a))??[],o=i?.map(a=>this.prepareRunCreateOrUpdateInputs(a))??[];if(s.length>0&&o.length>0){let a=s.reduce((a,i)=>(i.id&&(a[i.id]=i),a),{}),i=[];for(let s of o)void 0!==s.id&&a[s.id]?a[s.id]={...a[s.id],...s}:i.push(s);s=Object.values(a),o=i}let c={post:this._filterForSampling(s),patch:this._filterForSampling(o,!0)};if(!c.post.length&&!c.patch.length)return;if(s=await mergeRuntimeEnvIntoRunCreates(s),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){for(let a of(this.autoBatchTracing=!1,c.post))await this.createRun(a);for(let a of c.patch)void 0!==a.id&&await this.updateRun(a.id,a);return}let w=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,P={post:[],patch:[]},A=0;for(let a of["post","patch"]){let i=c[a].reverse(),s=i.pop();for(;void 0!==s;){let o=JSON.stringify(s);A>0&&A+o.length>w&&(await this._postBatchIngestRuns(JSON.stringify(P)),A=0,P.post=[],P.patch=[]),A+=o.length,P[a].push(s),s=i.pop()}}(P.post.length>0||P.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(P))}async _postBatchIngestRuns(a){let i={...this.headers,"Content-Type":"application/json",Accept:"application/json"},s=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:i,body:a,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(s,"batch create run")}async updateRun(a,i){assertUuid(a),i.inputs&&(i.inputs=this.processInputs(i.inputs)),i.outputs&&(i.outputs=this.processOutputs(i.outputs));let s={...i,id:a};if(!this._filterForSampling([s],!0).length)return;if(this.autoBatchTracing&&void 0!==s.trace_id&&void 0!==s.dotted_order){void 0!==i.end_time&&void 0===s.parent_run_id?await this.processRunOperation({action:"update",item:s},!0):this.processRunOperation({action:"update",item:s}).catch(console.error);return}let o={...this.headers,"Content-Type":"application/json"},c=await this.caller.call(fetch,`${this.apiUrl}/runs/${a}`,{method:"PATCH",headers:o,body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(c,"update run")}async readRun(a,{loadChildRuns:i}={loadChildRuns:!1}){assertUuid(a);let s=await this._get(`/runs/${a}`);return i&&s.child_run_ids&&(s=await this._loadChildRuns(s)),s}async getRunUrl({runId:a,run:i,projectOpts:s}){if(void 0!==i){let a;if(i.session_id)a=i.session_id;else if(s?.projectName)a=(await this.readProject({projectName:s?.projectName})).id;else if(s?.projectId)a=s?.projectId;else{let i=await this.readProject({projectName:env_getEnvironmentVariable("LANGCHAIN_PROJECT")||"default"});a=i.id}let o=await this._getTenantId();return`${this.getHostUrl()}/o/${o}/projects/p/${a}/r/${i.id}?poll=true`}if(void 0!==a){let i=await this.readRun(a);if(!i.app_path)throw Error(`Run ${a} has no app_path`);let s=this.getHostUrl();return`${s}${i.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(a){let i=await toArray(this.listRuns({id:a.child_run_ids})),s={},o={};for(let a of(i.sort((a,i)=>(a?.dotted_order??"").localeCompare(i?.dotted_order??"")),i)){if(null===a.parent_run_id||void 0===a.parent_run_id)throw Error(`Child run ${a.id} has no parent`);a.parent_run_id in s||(s[a.parent_run_id]=[]),s[a.parent_run_id].push(a),o[a.id]=a}for(let i in a.child_runs=s[a.id]||[],s)i!==a.id&&(o[i].child_runs=s[i]);return a}async *listRuns(a){let{projectId:i,projectName:s,parentRunId:o,traceId:c,referenceExampleId:w,startTime:P,executionOrder:A,isRoot:x,runType:k,error:R,id:j,query:$,filter:B,traceFilter:D,treeFilter:Z,limit:U,select:z}=a,V=[];if(i&&(V=Array.isArray(i)?i:[i]),s){let a=Array.isArray(s)?s:[s],i=await Promise.all(a.map(a=>this.readProject({projectName:a}).then(a=>a.id)));V.push(...i)}let G={session:V.length?V:null,run_type:k,reference_example:w,query:$,filter:B,trace_filter:D,tree_filter:Z,execution_order:A,parent_run:o,start_time:P?P.toISOString():null,error:R,id:j,limit:U,trace:c,select:z||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:x};for await(let a of this._getCursorPaginatedList("/runs/query",G))yield*a}async shareRun(a,{shareId:i}={}){let s={run_id:a,share_token:i||A.Z()};assertUuid(a);let o=await this.caller.call(fetch,`${this.apiUrl}/runs/${a}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),c=await o.json();if(null===c||!("share_token"in c))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${c.share_token}/r`}async unshareRun(a){assertUuid(a);let i=await this.caller.call(fetch,`${this.apiUrl}/runs/${a}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(i,"unshare run")}async readRunSharedLink(a){assertUuid(a);let i=await this.caller.call(fetch,`${this.apiUrl}/runs/${a}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await i.json();if(null!==s&&"share_token"in s)return`${this.getHostUrl()}/public/${s.share_token}/r`}async listSharedRuns(a,{runIds:i}={}){let s=new URLSearchParams({share_token:a});if(void 0!==i)for(let a of i)s.append("id",a);assertUuid(a);let o=await this.caller.call(fetch,`${this.apiUrl}/public/${a}/runs${s}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),c=await o.json();return c}async readDatasetSharedSchema(a,i){if(!a&&!i)throw Error("Either datasetId or datasetName must be given");if(!a){let s=await this.readDataset({datasetName:i});a=s.id}assertUuid(a);let s=await this.caller.call(fetch,`${this.apiUrl}/datasets/${a}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),o=await s.json();return o.url=`${this.getHostUrl()}/public/${o.share_token}/d`,o}async shareDataset(a,i){if(!a&&!i)throw Error("Either datasetId or datasetName must be given");if(!a){let s=await this.readDataset({datasetName:i});a=s.id}let s={dataset_id:a};assertUuid(a);let o=await this.caller.call(fetch,`${this.apiUrl}/datasets/${a}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(s),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),c=await o.json();return c.url=`${this.getHostUrl()}/public/${c.share_token}/d`,c}async unshareDataset(a){assertUuid(a);let i=await this.caller.call(fetch,`${this.apiUrl}/datasets/${a}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(i,"unshare dataset")}async readSharedDataset(a){assertUuid(a);let i=await this.caller.call(fetch,`${this.apiUrl}/public/${a}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await i.json();return s}async createProject({projectName:a,description:i=null,metadata:s=null,upsert:o=!1,projectExtra:c=null,referenceDatasetId:w=null}){let P=`${this.apiUrl}/sessions${o?"?upsert=true":""}`,A=c||{};s&&(A.metadata=s);let x={name:a,extra:A,description:i};null!==w&&(x.reference_dataset_id=w);let k=await this.caller.call(fetch,P,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(x),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),R=await k.json();if(!k.ok)throw Error(`Failed to create session ${a}: ${k.status} ${k.statusText}`);return R}async updateProject(a,{name:i=null,description:s=null,metadata:o=null,projectExtra:c=null,endTime:w=null}){let P=`${this.apiUrl}/sessions/${a}`,A=c;o&&(A={...A||{},metadata:o});let x={name:i,extra:A,description:s,end_time:w?new Date(w).toISOString():null},k=await this.caller.call(fetch,P,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(x),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),R=await k.json();if(!k.ok)throw Error(`Failed to update project ${a}: ${k.status} ${k.statusText}`);return R}async hasProject({projectId:a,projectName:i}){let s="/sessions",o=new URLSearchParams;if(void 0!==a&&void 0!==i)throw Error("Must provide either projectName or projectId, not both");if(void 0!==a)assertUuid(a),s+=`/${a}`;else if(void 0!==i)o.append("name",i);else throw Error("Must provide projectName or projectId");let c=await this.caller.call(fetch,`${this.apiUrl}${s}?${o}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let a=await c.json();if(!c.ok)return!1;if(Array.isArray(a))return a.length>0;return!0}catch(a){return!1}}async readProject({projectId:a,projectName:i,includeStats:s}){let o,c="/sessions",w=new URLSearchParams;if(void 0!==a&&void 0!==i)throw Error("Must provide either projectName or projectId, not both");if(void 0!==a)assertUuid(a),c+=`/${a}`;else if(void 0!==i)w.append("name",i);else throw Error("Must provide projectName or projectId");void 0!==s&&w.append("include_stats",s.toString());let P=await this._get(c,w);if(Array.isArray(P)){if(0===P.length)throw Error(`Project[id=${a}, name=${i}] not found`);o=P[0]}else o=P;return o}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let a=new URLSearchParams({limit:"1"});for await(let i of this._getPaginated("/sessions",a))return this._tenantId=i[0].tenant_id,i[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:a,name:i,nameContains:s,referenceDatasetId:o,referenceDatasetName:c,referenceFree:w}={}){let P=new URLSearchParams;if(void 0!==a)for(let i of a)P.append("id",i);if(void 0!==i&&P.append("name",i),void 0!==s&&P.append("name_contains",s),void 0!==o)P.append("reference_dataset",o);else if(void 0!==c){let a=await this.readDataset({datasetName:c});P.append("reference_dataset",a.id)}for await(let a of(void 0!==w&&P.append("reference_free",w.toString()),this._getPaginated("/sessions",P)))yield*a}async deleteProject({projectId:a,projectName:i}){let s;if(void 0===a&&void 0===i)throw Error("Must provide projectName or projectId");if(void 0!==a&&void 0!==i)throw Error("Must provide either projectName or projectId, not both");assertUuid(s=void 0===a?(await this.readProject({projectName:i})).id:a);let o=await this.caller.call(fetch,`${this.apiUrl}/sessions/${s}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(o,`delete session ${s} (${i})`)}async uploadCsv({csvFile:a,fileName:i,inputKeys:s,outputKeys:o,description:c,dataType:w,name:P}){let A=`${this.apiUrl}/datasets/upload`,x=new FormData;x.append("file",a,i),s.forEach(a=>{x.append("input_keys",a)}),o.forEach(a=>{x.append("output_keys",a)}),c&&x.append("description",c),w&&x.append("data_type",w),P&&x.append("name",P);let k=await this.caller.call(fetch,A,{method:"POST",headers:this.headers,body:x,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!k.ok){let a=await k.json();if(a.detail&&a.detail.includes("already exists"))throw Error(`Dataset ${i} already exists`);throw Error(`Failed to upload CSV: ${k.status} ${k.statusText}`)}let R=await k.json();return R}async createDataset(a,{description:i,dataType:s}={}){let o={name:a,description:i};s&&(o.data_type=s);let c=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(o),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok){let i=await c.json();if(i.detail&&i.detail.includes("already exists"))throw Error(`Dataset ${a} already exists`);throw Error(`Failed to create dataset ${c.status} ${c.statusText}`)}let w=await c.json();return w}async readDataset({datasetId:a,datasetName:i}){let s,o="/datasets",c=new URLSearchParams({limit:"1"});if(void 0!==a&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==a)assertUuid(a),o+=`/${a}`;else if(void 0!==i)c.append("name",i);else throw Error("Must provide datasetName or datasetId");let w=await this._get(o,c);if(Array.isArray(w)){if(0===w.length)throw Error(`Dataset[id=${a}, name=${i}] not found`);s=w[0]}else s=w;return s}async diffDatasetVersions({datasetId:a,datasetName:i,fromVersion:s,toVersion:o}){let c=a;if(void 0===c&&void 0===i)throw Error("Must provide either datasetName or datasetId");if(void 0!==c&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===c){let a=await this.readDataset({datasetName:i});c=a.id}let w=new URLSearchParams({from_version:"string"==typeof s?s:s.toISOString(),to_version:"string"==typeof o?o:o.toISOString()}),P=await this._get(`/datasets/${c}/versions/diff`,w);return P}async readDatasetOpenaiFinetuning({datasetId:a,datasetName:i}){if(void 0!==a);else if(void 0!==i)a=(await this.readDataset({datasetName:i})).id;else throw Error("Must provide datasetName or datasetId");let s=await this._getResponse(`/datasets/${a}/openai_ft`),o=await s.text(),c=o.trim().split("\n").map(a=>JSON.parse(a));return c}async *listDatasets({limit:a=100,offset:i=0,datasetIds:s,datasetName:o,datasetNameContains:c}={}){let w=new URLSearchParams({limit:a.toString(),offset:i.toString()});if(void 0!==s)for(let a of s)w.append("id",a);for await(let a of(void 0!==o&&w.append("name",o),void 0!==c&&w.append("name_contains",c),this._getPaginated("/datasets",w)))yield*a}async deleteDataset({datasetId:a,datasetName:i}){let s="/datasets",o=a;if(void 0!==a&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==i){let a=await this.readDataset({datasetName:i});o=a.id}if(void 0!==o)assertUuid(o),s+=`/${o}`;else throw Error("Must provide datasetName or datasetId");let c=await this.caller.call(fetch,this.apiUrl+s,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!c.ok)throw Error(`Failed to delete ${s}: ${c.status} ${c.statusText}`);await c.json()}async createExample(a,i,{datasetId:s,datasetName:o,createdAt:c,exampleId:w,metadata:P}){let A=s;if(void 0===A&&void 0===o)throw Error("Must provide either datasetName or datasetId");if(void 0!==A&&void 0!==o)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===A){let a=await this.readDataset({datasetName:o});A=a.id}let x=c||new Date,k={dataset_id:A,inputs:a,outputs:i,created_at:x?.toISOString(),id:w,metadata:P},R=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(k),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!R.ok)throw Error(`Failed to create example: ${R.status} ${R.statusText}`);let j=await R.json();return j}async createExamples(a){let{inputs:i,outputs:s,metadata:o,sourceRunIds:c,exampleIds:w,datasetId:P,datasetName:A}=a,x=P;if(void 0===x&&void 0===A)throw Error("Must provide either datasetName or datasetId");if(void 0!==x&&void 0!==A)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===x){let a=await this.readDataset({datasetName:A});x=a.id}let k=i.map((a,i)=>({dataset_id:x,inputs:a,outputs:s?s[i]:void 0,metadata:o?o[i]:void 0,id:w?w[i]:void 0,source_run_id:c?c[i]:void 0})),R=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(k),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!R.ok)throw Error(`Failed to create examples: ${R.status} ${R.statusText}`);let j=await R.json();return j}async createLLMExample(a,i,s){return this.createExample({input:a},{output:i},s)}async createChatExample(a,i,s){let o=a.map(a=>isLangChainMessage(a)?convertLangChainMessageToExample(a):a),c=isLangChainMessage(i)?convertLangChainMessageToExample(i):i;return this.createExample({input:o},{output:c},s)}async readExample(a){assertUuid(a);let i=`/examples/${a}`;return await this._get(i)}async *listExamples({datasetId:a,datasetName:i,exampleIds:s,asOf:o,inlineS3Urls:c}={}){let w;if(void 0!==a&&void 0!==i)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==a)w=a;else if(void 0!==i){let a=await this.readDataset({datasetName:i});w=a.id}else throw Error("Must provide a datasetName or datasetId");let P=new URLSearchParams({dataset:w}),A=o?"string"==typeof o?o:o?.toISOString():void 0;if(A&&P.append("as_of",A),P.append("inline_s3_urls",(c??!0).toString()),void 0!==s)for(let a of s)P.append("id",a);for await(let a of this._getPaginated("/examples",P))yield*a}async deleteExample(a){assertUuid(a);let i=`/examples/${a}`,s=await this.caller.call(fetch,this.apiUrl+i,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw Error(`Failed to delete ${i}: ${s.status} ${s.statusText}`);await s.json()}async updateExample(a,i){assertUuid(a);let s=await this.caller.call(fetch,`${this.apiUrl}/examples/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw Error(`Failed to update example ${a}: ${s.status} ${s.statusText}`);let o=await s.json();return o}async evaluateRun(a,i,{sourceInfo:s,loadChildRuns:o,referenceExample:c}={loadChildRuns:!1}){let w;if("string"==typeof a)w=await this.readRun(a,{loadChildRuns:o});else if("object"==typeof a&&"id"in a)w=a;else throw Error(`Invalid run type: ${typeof a}`);null!==w.reference_example_id&&void 0!==w.reference_example_id&&(c=await this.readExample(w.reference_example_id));let P=await i.evaluateRun(w,c),A=s??{};P.evaluatorInfo&&(A={...A,...P.evaluatorInfo});let x=P.targetRunId??w.id;return await this.createFeedback(x,P.key,{score:P?.score,value:P?.value,comment:P?.comment,correction:P?.correction,sourceInfo:A,feedbackSourceType:"model",sourceRunId:P?.sourceRunId})}async createFeedback(a,i,{score:s,value:o,correction:c,comment:w,sourceInfo:P,feedbackSourceType:x="api",sourceRunId:k,feedbackId:R,feedbackConfig:j}){let $={type:x??"api",metadata:P??{}};void 0===k||$?.metadata===void 0||$.metadata.__run||($.metadata.__run={run_id:k}),$?.metadata!==void 0&&$.metadata.__run?.run_id!==void 0&&assertUuid($.metadata.__run.run_id);let B={id:R??A.Z(),run_id:a,key:i,score:s,value:o,correction:c,comment:w,feedback_source:$,feedbackConfig:j},D=`${this.apiUrl}/feedback`,Z=await this.caller.call(fetch,D,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(B),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await raiseForStatus(Z,"create feedback"),B}async updateFeedback(a,{score:i,value:s,correction:o,comment:c}){let w={};null!=i&&(w.score=i),null!=s&&(w.value=s),null!=o&&(w.correction=o),null!=c&&(w.comment=c),assertUuid(a);let P=await this.caller.call(fetch,`${this.apiUrl}/feedback/${a}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(w),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(P,"update feedback")}async readFeedback(a){assertUuid(a);let i=`/feedback/${a}`,s=await this._get(i);return s}async deleteFeedback(a){assertUuid(a);let i=`/feedback/${a}`,s=await this.caller.call(fetch,this.apiUrl+i,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!s.ok)throw Error(`Failed to delete ${i}: ${s.status} ${s.statusText}`);await s.json()}async *listFeedback({runIds:a,feedbackKeys:i,feedbackSourceTypes:s}={}){let o=new URLSearchParams;if(a&&o.append("run",a.join(",")),i)for(let a of i)o.append("key",a);if(s)for(let a of s)o.append("source",a);for await(let a of this._getPaginated("/feedback",o))yield*a}async createPresignedFeedbackToken(a,i,{expiration:s,feedbackConfig:o}={}){let c={run_id:a,feedback_key:i,feedback_config:o};s?"string"==typeof s?c.expires_at=s:(s?.hours||s?.minutes||s?.days)&&(c.expires_in=s):c.expires_in={hours:3};let w=await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(c),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),P=await w.json();return P}async *listPresignedFeedbackTokens(a){assertUuid(a);let i=new URLSearchParams({run_id:a});for await(let a of this._getPaginated("/feedback/tokens",i))yield*a}};let V="0.1.20";var G=s(298);let tracer_langchain_LangChainTracer=class tracer_langchain_LangChainTracer extends R.Z{constructor(a={}){super(a),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:i,projectName:s,client:o}=a;this.projectName=s??(0,G.lS)("LANGCHAIN_PROJECT")??(0,G.lS)("LANGCHAIN_SESSION"),this.exampleId=i,this.client=o??new client_Client({})}async _convertToCreate(a,i){return{...a,extra:{...a.extra,runtime:await (0,G.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:a.parent_run_id?void 0:i}}async persistRun(a){}async onRunCreate(a){let i=await this._convertToCreate(a,this.exampleId);await this.client.createRun(i)}async onRunUpdate(a){let i={end_time:a.end_time,error:a.error,outputs:a.outputs,events:a.events,inputs:a.inputs,trace_id:a.trace_id,dotted_order:a.dotted_order,parent_run_id:a.parent_run_id};await this.client.updateRun(a.id,i)}getRun(a){return this.runMap.get(a)}};var W=s(3478);async function getTracingV2CallbackHandler(){return new tracer_langchain_LangChainTracer}function createQueue(){let a=D.default;return new a({autoStart:!0,concurrency:1})}async function consumeCallback(a,i){!0===i?await a():(void 0===P&&(P=createQueue()),P.add(a))}function parseCallbackConfigArg(a){return a?Array.isArray(a)||"name"in a?{callbacks:a}:a:{}}let BaseCallbackManager=class BaseCallbackManager{setHandler(a){return this.setHandlers([a])}};let BaseRunManager=class BaseRunManager{constructor(a,i,s,o,c,w,P,A){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:c}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:w}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:P}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:A})}async handleText(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{try{await i.handleText?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleText: ${a}`)}},i.awaitHandlers)))}};let CallbackManagerForRetrieverRun=class CallbackManagerForRetrieverRun extends BaseRunManager{getChild(a){let i=new CallbackManager(this.runId);return i.setHandlers(this.inheritableHandlers),i.addTags(this.inheritableTags),i.addMetadata(this.inheritableMetadata),a&&i.addTags([a],!1),i}async handleRetrieverEnd(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreRetriever)try{await i.handleRetrieverEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleRetriever`)}},i.awaitHandlers)))}async handleRetrieverError(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreRetriever)try{await i.handleRetrieverError?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleRetrieverError: ${a}`)}},i.awaitHandlers)))}};let CallbackManagerForLLMRun=class CallbackManagerForLLMRun extends BaseRunManager{async handleLLMNewToken(a,i,s,o,c,w){await Promise.all(this.handlers.map(s=>consumeCallback(async()=>{if(!s.ignoreLLM)try{await s.handleLLMNewToken?.(a,i??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,w)}catch(a){console.error(`Error in handler ${s.constructor.name}, handleLLMNewToken: ${a}`)}},s.awaitHandlers)))}async handleLLMError(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreLLM)try{await i.handleLLMError?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleLLMError: ${a}`)}},i.awaitHandlers)))}async handleLLMEnd(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreLLM)try{await i.handleLLMEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleLLMEnd: ${a}`)}},i.awaitHandlers)))}};let CallbackManagerForChainRun=class CallbackManagerForChainRun extends BaseRunManager{getChild(a){let i=new CallbackManager(this.runId);return i.setHandlers(this.inheritableHandlers),i.addTags(this.inheritableTags),i.addMetadata(this.inheritableMetadata),a&&i.addTags([a],!1),i}async handleChainError(a,i,s,o,c){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreChain)try{await i.handleChainError?.(a,this.runId,this._parentRunId,this.tags,c)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleChainError: ${a}`)}},i.awaitHandlers)))}async handleChainEnd(a,i,s,o,c){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreChain)try{await i.handleChainEnd?.(a,this.runId,this._parentRunId,this.tags,c)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleChainEnd: ${a}`)}},i.awaitHandlers)))}async handleAgentAction(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreAgent)try{await i.handleAgentAction?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleAgentAction: ${a}`)}},i.awaitHandlers)))}async handleAgentEnd(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreAgent)try{await i.handleAgentEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleAgentEnd: ${a}`)}},i.awaitHandlers)))}};let CallbackManagerForToolRun=class CallbackManagerForToolRun extends BaseRunManager{getChild(a){let i=new CallbackManager(this.runId);return i.setHandlers(this.inheritableHandlers),i.addTags(this.inheritableTags),i.addMetadata(this.inheritableMetadata),a&&i.addTags([a],!1),i}async handleToolError(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreAgent)try{await i.handleToolError?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleToolError: ${a}`)}},i.awaitHandlers)))}async handleToolEnd(a){await Promise.all(this.handlers.map(i=>consumeCallback(async()=>{if(!i.ignoreAgent)try{await i.handleToolEnd?.(a,this.runId,this._parentRunId,this.tags)}catch(a){console.error(`Error in handler ${i.constructor.name}, handleToolEnd: ${a}`)}},i.awaitHandlers)))}};let CallbackManager=class CallbackManager extends BaseCallbackManager{constructor(a,i){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=i?.handlers??this.handlers,this.inheritableHandlers=i?.inheritableHandlers??this.inheritableHandlers,this.tags=i?.tags??this.tags,this.inheritableTags=i?.inheritableTags??this.inheritableTags,this.metadata=i?.metadata??this.metadata,this.inheritableMetadata=i?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=a}getParentRunId(){return this._parentRunId}async handleLLMStart(a,i,s,o,c,w,P,x){return Promise.all(i.map(async(i,o)=>{let w=0===o&&s?s:(0,A.Z)();return await Promise.all(this.handlers.map(s=>consumeCallback(async()=>{if(!s.ignoreLLM)try{await s.handleLLMStart?.(a,[i],w,this._parentRunId,c,this.tags,this.metadata,x)}catch(a){console.error(`Error in handler ${s.constructor.name}, handleLLMStart: ${a}`)}},s.awaitHandlers))),new CallbackManagerForLLMRun(w,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(a,i,s,o,c,w,P,x){return Promise.all(i.map(async(i,o)=>{let w=0===o&&s?s:(0,A.Z)();return await Promise.all(this.handlers.map(s=>consumeCallback(async()=>{if(!s.ignoreLLM)try{if(s.handleChatModelStart)await s.handleChatModelStart?.(a,[i],w,this._parentRunId,c,this.tags,this.metadata,x);else if(s.handleLLMStart){let o=(0,W.zs)(i);await s.handleLLMStart?.(a,[o],w,this._parentRunId,c,this.tags,this.metadata,x)}}catch(a){console.error(`Error in handler ${s.constructor.name}, handleLLMStart: ${a}`)}},s.awaitHandlers))),new CallbackManagerForLLMRun(w,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(a,i,s=(0,A.Z)(),o,c,w,P){return await Promise.all(this.handlers.map(c=>consumeCallback(async()=>{if(!c.ignoreChain)try{await c.handleChainStart?.(a,i,s,this._parentRunId,this.tags,this.metadata,o,P)}catch(a){console.error(`Error in handler ${c.constructor.name}, handleChainStart: ${a}`)}},c.awaitHandlers))),new CallbackManagerForChainRun(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(a,i,s=(0,A.Z)(),o,c,w,P){return await Promise.all(this.handlers.map(o=>consumeCallback(async()=>{if(!o.ignoreAgent)try{await o.handleToolStart?.(a,i,s,this._parentRunId,this.tags,this.metadata,P)}catch(a){console.error(`Error in handler ${o.constructor.name}, handleToolStart: ${a}`)}},o.awaitHandlers))),new CallbackManagerForToolRun(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(a,i,s=(0,A.Z)(),o,c,w,P){return await Promise.all(this.handlers.map(o=>consumeCallback(async()=>{if(!o.ignoreRetriever)try{await o.handleRetrieverStart?.(a,i,s,this._parentRunId,this.tags,this.metadata,P)}catch(a){console.error(`Error in handler ${o.constructor.name}, handleRetrieverStart: ${a}`)}},o.awaitHandlers))),new CallbackManagerForRetrieverRun(s,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(a,i=!0){this.handlers.push(a),i&&this.inheritableHandlers.push(a)}removeHandler(a){this.handlers=this.handlers.filter(i=>i!==a),this.inheritableHandlers=this.inheritableHandlers.filter(i=>i!==a)}setHandlers(a,i=!0){for(let s of(this.handlers=[],this.inheritableHandlers=[],a))this.addHandler(s,i)}addTags(a,i=!0){this.removeTags(a),this.tags.push(...a),i&&this.inheritableTags.push(...a)}removeTags(a){this.tags=this.tags.filter(i=>!a.includes(i)),this.inheritableTags=this.inheritableTags.filter(i=>!a.includes(i))}addMetadata(a,i=!0){this.metadata={...this.metadata,...a},i&&(this.inheritableMetadata={...this.inheritableMetadata,...a})}removeMetadata(a){for(let i of Object.keys(a))delete this.metadata[i],delete this.inheritableMetadata[i]}copy(a=[],i=!0){let s=new CallbackManager(this._parentRunId);for(let a of this.handlers){let i=this.inheritableHandlers.includes(a);s.addHandler(a,i)}for(let a of this.tags){let i=this.inheritableTags.includes(a);s.addTags([a],i)}for(let a of Object.keys(this.metadata)){let i=Object.keys(this.inheritableMetadata).includes(a);s.addMetadata({[a]:this.metadata[a]},i)}for(let o of a)s.handlers.filter(a=>"console_callback_handler"===a.name).some(a=>a.name===o.name)||s.addHandler(o,i);return s}static fromHandlers(a){let Handler=class Handler extends x.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,A.Z)()}),Object.assign(this,a)}};let i=new this;return i.addHandler(new Handler),i}static async configure(a,i,s,o,c,w,P){let A;(a||i)&&(Array.isArray(a)||!a?(A=new CallbackManager).setHandlers(a?.map(ensureHandler)??[],!0):A=a,A=A.copy(Array.isArray(i)?i.map(ensureHandler):i?.handlers,!1));let x="true"===(0,G.lS)("LANGCHAIN_VERBOSE")||P?.verbose,k="true"===(0,G.lS)("LANGCHAIN_TRACING_V2"),R=k||((0,G.lS)("LANGCHAIN_TRACING")??!1);if(x||R){if(A||(A=new CallbackManager),x&&!A.handlers.some(a=>a.name===ConsoleCallbackHandler.prototype.name)){let a=new ConsoleCallbackHandler;A.addHandler(a,!0)}R&&!A.handlers.some(a=>"langchain_tracer"===a.name)&&k&&A.addHandler(await getTracingV2CallbackHandler(),!0)}return(s||o)&&A&&(A.addTags(s??[]),A.addTags(o??[],!1)),(c||w)&&A&&(A.addMetadata(c??{}),A.addMetadata(w??{},!1)),A}};function ensureHandler(a){return"name"in a?a:x.E.fromMethods(a)}},7610:function(a,i,s){"use strict";s.d(i,{BD:function(){return BaseLangChain},qV:function(){return BaseLanguageModel}});/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var o,c,w,P="object"==typeof window?window:{},A="0123456789abcdef".split(""),x=[-2147483648,8388608,32768,128],k=[24,16,8,0],R=[];function Sha1(a){a?(R[0]=R[16]=R[1]=R[2]=R[3]=R[4]=R[5]=R[6]=R[7]=R[8]=R[9]=R[10]=R[11]=R[12]=R[13]=R[14]=R[15]=0,this.blocks=R):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(a){if(!this.finalized){var i="string"!=typeof a;i&&a.constructor===P.ArrayBuffer&&(a=new Uint8Array(a));for(var s,o,c=0,w=a.length||0,A=this.blocks;c<w;){if(this.hashed&&(this.hashed=!1,A[0]=this.block,A[16]=A[1]=A[2]=A[3]=A[4]=A[5]=A[6]=A[7]=A[8]=A[9]=A[10]=A[11]=A[12]=A[13]=A[14]=A[15]=0),i)for(o=this.start;c<w&&o<64;++c)A[o>>2]|=a[c]<<k[3&o++];else for(o=this.start;c<w&&o<64;++c)(s=a.charCodeAt(c))<128?A[o>>2]|=s<<k[3&o++]:(s<2048?A[o>>2]|=(192|s>>6)<<k[3&o++]:(s<55296||s>=57344?A[o>>2]|=(224|s>>12)<<k[3&o++]:(s=65536+((1023&s)<<10|1023&a.charCodeAt(++c)),A[o>>2]|=(240|s>>18)<<k[3&o++],A[o>>2]|=(128|s>>12&63)<<k[3&o++]),A[o>>2]|=(128|s>>6&63)<<k[3&o++]),A[o>>2]|=(128|63&s)<<k[3&o++]);this.lastByteIndex=o,this.bytes+=o-this.start,o>=64?(this.block=A[16],this.start=o-64,this.hash(),this.hashed=!0):this.start=o}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var a=this.blocks,i=this.lastByteIndex;a[16]=this.block,a[i>>2]|=x[3&i],this.block=a[16],i>=56&&(this.hashed||this.hash(),a[0]=this.block,a[16]=a[1]=a[2]=a[3]=a[4]=a[5]=a[6]=a[7]=a[8]=a[9]=a[10]=a[11]=a[12]=a[13]=a[14]=a[15]=0),a[14]=this.hBytes<<3|this.bytes>>>29,a[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var a,i,s,o=this.h0,c=this.h1,w=this.h2,P=this.h3,A=this.h4,x=this.blocks;for(i=16;i<80;++i)s=x[i-3]^x[i-8]^x[i-14]^x[i-16],x[i]=s<<1|s>>>31;for(i=0;i<20;i+=5)a=c&w|~c&P,A=(s=o<<5|o>>>27)+a+A+1518500249+x[i]<<0,a=o&(c=c<<30|c>>>2)|~o&w,P=(s=A<<5|A>>>27)+a+P+1518500249+x[i+1]<<0,a=A&(o=o<<30|o>>>2)|~A&c,w=(s=P<<5|P>>>27)+a+w+1518500249+x[i+2]<<0,a=P&(A=A<<30|A>>>2)|~P&o,c=(s=w<<5|w>>>27)+a+c+1518500249+x[i+3]<<0,a=w&(P=P<<30|P>>>2)|~w&A,o=(s=c<<5|c>>>27)+a+o+1518500249+x[i+4]<<0,w=w<<30|w>>>2;for(;i<40;i+=5)a=c^w^P,A=(s=o<<5|o>>>27)+a+A+1859775393+x[i]<<0,a=o^(c=c<<30|c>>>2)^w,P=(s=A<<5|A>>>27)+a+P+1859775393+x[i+1]<<0,a=A^(o=o<<30|o>>>2)^c,w=(s=P<<5|P>>>27)+a+w+1859775393+x[i+2]<<0,a=P^(A=A<<30|A>>>2)^o,c=(s=w<<5|w>>>27)+a+c+1859775393+x[i+3]<<0,a=w^(P=P<<30|P>>>2)^A,o=(s=c<<5|c>>>27)+a+o+1859775393+x[i+4]<<0,w=w<<30|w>>>2;for(;i<60;i+=5)a=c&w|c&P|w&P,A=(s=o<<5|o>>>27)+a+A-1894007588+x[i]<<0,a=o&(c=c<<30|c>>>2)|o&w|c&w,P=(s=A<<5|A>>>27)+a+P-1894007588+x[i+1]<<0,a=A&(o=o<<30|o>>>2)|A&c|o&c,w=(s=P<<5|P>>>27)+a+w-1894007588+x[i+2]<<0,a=P&(A=A<<30|A>>>2)|P&o|A&o,c=(s=w<<5|w>>>27)+a+c-1894007588+x[i+3]<<0,a=w&(P=P<<30|P>>>2)|w&A|P&A,o=(s=c<<5|c>>>27)+a+o-1894007588+x[i+4]<<0,w=w<<30|w>>>2;for(;i<80;i+=5)a=c^w^P,A=(s=o<<5|o>>>27)+a+A-899497514+x[i]<<0,a=o^(c=c<<30|c>>>2)^w,P=(s=A<<5|A>>>27)+a+P-899497514+x[i+1]<<0,a=A^(o=o<<30|o>>>2)^c,w=(s=P<<5|P>>>27)+a+w-899497514+x[i+2]<<0,a=P^(A=A<<30|A>>>2)^o,c=(s=w<<5|w>>>27)+a+c-899497514+x[i+3]<<0,a=w^(P=P<<30|P>>>2)^A,o=(s=c<<5|c>>>27)+a+o-899497514+x[i+4]<<0,w=w<<30|w>>>2;this.h0=this.h0+o<<0,this.h1=this.h1+c<<0,this.h2=this.h2+w<<0,this.h3=this.h3+P<<0,this.h4=this.h4+A<<0},Sha1.prototype.hex=function(){this.finalize();var a=this.h0,i=this.h1,s=this.h2,o=this.h3,c=this.h4;return A[a>>28&15]+A[a>>24&15]+A[a>>20&15]+A[a>>16&15]+A[a>>12&15]+A[a>>8&15]+A[a>>4&15]+A[15&a]+A[i>>28&15]+A[i>>24&15]+A[i>>20&15]+A[i>>16&15]+A[i>>12&15]+A[i>>8&15]+A[i>>4&15]+A[15&i]+A[s>>28&15]+A[s>>24&15]+A[s>>20&15]+A[s>>16&15]+A[s>>12&15]+A[s>>8&15]+A[s>>4&15]+A[15&s]+A[o>>28&15]+A[o>>24&15]+A[o>>20&15]+A[o>>16&15]+A[o>>12&15]+A[o>>8&15]+A[o>>4&15]+A[15&o]+A[c>>28&15]+A[c>>24&15]+A[c>>20&15]+A[c>>16&15]+A[c>>12&15]+A[c>>8&15]+A[c>>4&15]+A[15&c]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var a=this.h0,i=this.h1,s=this.h2,o=this.h3,c=this.h4;return[a>>24&255,a>>16&255,a>>8&255,255&a,i>>24&255,i>>16&255,i>>8&255,255&i,s>>24&255,s>>16&255,s>>8&255,255&s,o>>24&255,o>>16&255,o>>8&255,255&o,c>>24&255,c>>16&255,c>>8&255,255&c]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var a=new ArrayBuffer(20),i=new DataView(a);return i.setUint32(0,this.h0),i.setUint32(4,this.h1),i.setUint32(8,this.h2),i.setUint32(12,this.h3),i.setUint32(16,this.h4),a};let insecureHash=a=>new Sha1(!0).update(a).hex();var j=s(3478);let getCacheKey=(...a)=>insecureHash(a.join("_"));let BaseCache=class BaseCache{};let $=new Map;let InMemoryCache=class InMemoryCache extends BaseCache{constructor(a){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=a??new Map}lookup(a,i){return Promise.resolve(this.cache.get(getCacheKey(a,i))??null)}async update(a,i,s){this.cache.set(getCacheKey(a,i),s)}static global(){return new InMemoryCache($)}};var B=s(4697),D=s(3830),Z=s(1226),U=Object.defineProperty;function bytePairMerge(a,i){let s=Array.from({length:a.length},(a,i)=>({start:i,end:i+1}));for(;s.length>1;){let o=null;for(let c=0;c<s.length-1;c++){let w=a.slice(s[c].start,s[c+1].end),P=i.get(w.join(","));null!=P&&(null==o||P<o[0])&&(o=[P,c])}if(null!=o){let a=o[1];s[a]={start:s[a].start,end:s[a+1].end},s.splice(a+1,1)}else break}return s}function bytePairEncode(a,i){return 1===a.length?[i.get(a.join(","))]:bytePairMerge(a,i).map(s=>i.get(a.slice(s.start,s.end).join(","))).filter(a=>null!=a)}function escapeRegex(a){return a.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var z=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(a,i){this.patStr=a.pat_str;let s=a.bpe_ranks.split("\n").filter(Boolean).reduce((a,i)=>{let[s,o,...c]=i.split(" "),w=Number.parseInt(o,10);return c.forEach((i,s)=>a[i]=w+s),a},{});for(let[a,i]of Object.entries(s)){let s=Z.toByteArray(a);this.rankMap.set(s.join(","),i),this.textMap.set(i,s)}this.specialTokens={...a.special_tokens,...i},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((a,[i,s])=>(a[s]=this.textEncoder.encode(i),a),{})}encode(a,i=[],s="all"){let o=RegExp(this.patStr,"ug"),c=z.specialTokenRegex(Object.keys(this.specialTokens)),w=[],P=new Set("all"===i?Object.keys(this.specialTokens):i),A=new Set("all"===s?Object.keys(this.specialTokens).filter(a=>!P.has(a)):s);if(A.size>0){let i=z.specialTokenRegex([...A]),s=a.match(i);if(null!=s)throw Error(`The text contains a special token that is not allowed: ${s[0]}`)}let x=0;for(;;){let i=null,s=x;for(;c.lastIndex=s,!(null==(i=c.exec(a))||P.has(i[0]));)s=i.index+1;let A=i?.index??a.length;for(let i of a.substring(x,A).matchAll(o)){let a=this.textEncoder.encode(i[0]),s=this.rankMap.get(a.join(","));if(null!=s){w.push(s);continue}w.push(...bytePairEncode(a,this.rankMap))}if(null==i)break;let k=this.specialTokens[i[0]];w.push(k),x=i.index+i[0].length}return w}decode(a){let i=[],s=0;for(let o=0;o<a.length;++o){let c=a[o],w=this.textMap.get(c)??this.inverseSpecialTokens[c];null!=w&&(i.push(w),s+=w.length)}let o=new Uint8Array(s),c=0;for(let a of i)o.set(a,c),c+=a.length;return this.textDecoder.decode(o)}};function getEncodingNameForModel(a){switch(a){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw Error("Unknown model")}}o="symbol"!=typeof(w="specialTokenRegex")?w+"":w,c=a=>RegExp(a.map(a=>escapeRegex(a)).join("|"),"g"),o in z?U(z,o,{enumerable:!0,configurable:!0,writable:!0,value:c}):z[o]=c;let V={},G=new D.L({});async function getEncoding(a){return a in V||(V[a]=G.fetch(`https://tiktoken.pages.dev/js/${a}.json`).then(a=>a.json()).then(a=>new z(a)).catch(i=>{throw delete V[a],i})),await V[a]}async function tiktoken_encodingForModel(a){return getEncoding(getEncodingNameForModel(a))}var W=s(8477);let getModelNameForTiktoken=a=>a.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":a.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":a.startsWith("gpt-4-32k")?"gpt-4-32k":a.startsWith("gpt-4-")?"gpt-4":a,getVerbosity=()=>!1;let BaseLangChain=class BaseLangChain extends W.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(a){super(a),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=a.verbose??getVerbosity(),this.callbacks=a.callbacks,this.tags=a.tags??[],this.metadata=a.metadata??{}}};let BaseLanguageModel=class BaseLanguageModel extends BaseLangChain{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:a,callbackManager:i,...s}){super({callbacks:a??i,...s}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof s.cache?this.cache=s.cache:s.cache?this.cache=InMemoryCache.global():this.cache=void 0,this.caller=new D.L(s??{})}async getNumTokens(a){if("string"!=typeof a)return 0;let i=Math.ceil(a.length/4);if(!this._encoding)try{this._encoding=await tiktoken_encodingForModel("modelName"in this?getModelNameForTiktoken(this.modelName):"gpt2")}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}if(this._encoding)try{i=this._encoding.encode(a).length}catch(a){console.warn("Failed to calculate number of tokens, falling back to approximate count",a)}return i}static _convertInputToPromptValue(a){return"string"==typeof a?new B.nw(a):Array.isArray(a)?new B.GU(a.map(j.E1)):a}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(a){let i={...this._identifyingParams(),...a,_type:this._llmType(),_model:this._modelType()},s=Object.entries(i).filter(([a,i])=>void 0!==i),o=s.map(([a,i])=>`${a}:${JSON.stringify(i)}`).sort().join(",");return o}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(a){throw Error("Use .toJSON() instead")}}},8498:function(a,i,s){"use strict";s.d(i,{i:function(){return Serializable},j:function(){return get_lc_unique_name}});var o=s(4521);function keyToJson(a,i){return i?.[a]||o(a)}function mapKeys(a,i,s){let o={};for(let c in a)Object.hasOwn(a,c)&&(o[i(c,s)]=a[c]);return o}function shallowCopy(a){return Array.isArray(a)?[...a]:{...a}}function replaceSecrets(a,i){let s=shallowCopy(a);for(let[a,o]of Object.entries(i)){let[i,...c]=a.split(".").reverse(),w=s;for(let a of c.reverse()){if(void 0===w[a])break;w[a]=shallowCopy(w[a]),w=w[a]}void 0!==w[i]&&(w[i]={lc:1,type:"secret",id:[o]})}return s}function get_lc_unique_name(a){let i=Object.getPrototypeOf(a),s="function"==typeof a.lc_name&&("function"!=typeof i.lc_name||a.lc_name()!==i.lc_name());return s?a.lc_name():a.name}s(2455);let Serializable=class Serializable{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,get_lc_unique_name(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(a,...i){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=a||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof Serializable||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let a={},i={},s=Object.keys(this.lc_kwargs).reduce((a,i)=>(a[i]=i in this?this[i]:this.lc_kwargs[i],a),{});for(let o=Object.getPrototypeOf(this);o;o=Object.getPrototypeOf(o))Object.assign(a,Reflect.get(o,"lc_aliases",this)),Object.assign(i,Reflect.get(o,"lc_secrets",this)),Object.assign(s,Reflect.get(o,"lc_attributes",this));return Object.keys(i).forEach(a=>{let i=this,o=s,[c,...w]=a.split(".").reverse();for(let a of w.reverse()){if(!(a in i)||void 0===i[a])return;a in o&&void 0!==o[a]||("object"==typeof i[a]&&null!=i[a]?o[a]={}:Array.isArray(i[a])&&(o[a]=[])),i=i[a],o=o[a]}c in i&&void 0!==i[c]&&(o[c]=o[c]||i[c])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:mapKeys(Object.keys(i).length?replaceSecrets(s,i):s,keyToJson,a)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},7708:function(a,i,s){"use strict";s.d(i,{GC:function(){return AIMessageChunk},Z0:function(){return isAIMessage},gY:function(){return AIMessage}});var o=s(2991),c=s(1808),w=s(9033);let AIMessage=class AIMessage extends c.ku{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(a,i){let s;if("string"==typeof a)s={content:a,tool_calls:[],invalid_tool_calls:[],additional_kwargs:i??{}};else{s=a;let i=s.additional_kwargs?.tool_calls,o=s.tool_calls;null!=i&&i.length>0&&(void 0===o||0===o.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `yarn add @langchain/anthropic`, yarn add @langchain/openai`, etc.");try{if(null!=i&&void 0===o){let[a,o]=(0,w.jC)(i);s.tool_calls=a??[],s.invalid_tool_calls=o??[]}else s.tool_calls=s.tool_calls??[],s.invalid_tool_calls=s.invalid_tool_calls??[]}catch(a){s.tool_calls=[],s.invalid_tool_calls=[]}}super(s),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),"string"!=typeof s&&(this.tool_calls=s.tool_calls??this.tool_calls,this.invalid_tool_calls=s.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}};function isAIMessage(a){return"ai"===a._getType()}let AIMessageChunk=class AIMessageChunk extends c.$k{constructor(a){let i;if("string"==typeof a)i={content:a,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===a.tool_call_chunks)i={...a,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{let s=[],c=[];for(let i of a.tool_call_chunks){let a={};try{if(a=(0,o.g)(i.args??"{}")??{},"object"!=typeof a||Array.isArray(a))throw Error("Malformed tool call chunk args.");s.push({name:i.name??"",args:a,id:i.id})}catch(a){c.push({name:i.name,args:i.args,id:i.id,error:"Malformed args."})}}i={...a,tool_calls:s,invalid_tool_calls:c}}super(i),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=i?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=i?.tool_calls??this.tool_calls,this.invalid_tool_calls=i?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(a){let i={content:(0,c.Wf)(this.content,a.content),additional_kwargs:(0,c.wv)(this.additional_kwargs,a.additional_kwargs),response_metadata:(0,c.wv)(this.response_metadata,a.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==a.tool_call_chunks){let s=(0,c.eL)(this.tool_call_chunks,a.tool_call_chunks);void 0!==s&&s.length>0&&(i.tool_call_chunks=s)}return new AIMessageChunk(i)}}},1808:function(a,i,s){"use strict";s.d(i,{$k:function(){return BaseMessageChunk},QW:function(){return isBaseMessage},Wf:function(){return mergeContent},a2:function(){return isBaseMessageChunk},eL:function(){return _mergeLists},ku:function(){return BaseMessage},wv:function(){return _mergeDicts}});var o=s(8498);function mergeContent(a,i){return"string"==typeof a?"string"==typeof i?a+i:[{type:"text",text:a},...i]:Array.isArray(i)?[...a,...i]:[...a,{type:"text",text:i}]}let BaseMessage=class BaseMessage extends o.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(a,i){"string"==typeof a&&(a={content:a,additional_kwargs:i,response_metadata:{}}),a.additional_kwargs||(a.additional_kwargs={}),a.response_metadata||(a.response_metadata={}),super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=a.name,this.content=a.content,this.additional_kwargs=a.additional_kwargs,this.response_metadata=a.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}};function _mergeDicts(a,i){let s={...a};for(let[a,o]of Object.entries(i))if(null==s[a])s[a]=o;else if(null==o)continue;else if(typeof s[a]!=typeof o||Array.isArray(s[a])!==Array.isArray(o))throw Error(`field[${a}] already exists in the message chunk, but with a different type.`);else if("string"==typeof s[a])s[a]=s[a]+o;else if(Array.isArray(s[a])||"object"!=typeof s[a]){if(Array.isArray(s[a]))s[a]=_mergeLists(s[a],o);else{if(s[a]===o)continue;console.warn(`field[${a}] already exists in this message chunk and value has unsupported type.`)}}else s[a]=_mergeDicts(s[a],o);return s}function _mergeLists(a,i){if(void 0!==a||void 0!==i){if(void 0===a||void 0===i)return a||i;{let s=[...a];for(let a of i)if("object"==typeof a&&"index"in a&&"number"==typeof a.index){let i=s.findIndex(i=>i.index===a.index);-1!==i?s[i]=_mergeDicts(s[i],a):s.push(a)}else s.push(a);return s}}}let BaseMessageChunk=class BaseMessageChunk extends BaseMessage{};function isBaseMessage(a){return"function"==typeof a?._getType}function isBaseMessageChunk(a){return isBaseMessage(a)&&"function"==typeof a.concat}},4630:function(a,i,s){"use strict";s.d(i,{H:function(){return ChatMessageChunk},J:function(){return ChatMessage}});var o=s(1808);let ChatMessage=class ChatMessage extends o.ku{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return ChatMessage}constructor(a,i){"string"==typeof a&&(a={content:a,role:i}),super(a),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=a.role}_getType(){return"generic"}static isInstance(a){return"generic"===a._getType()}};let ChatMessageChunk=class ChatMessageChunk extends o.$k{static lc_name(){return"ChatMessageChunk"}constructor(a,i){"string"==typeof a&&(a={content:a,role:i}),super(a),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=a.role}_getType(){return"generic"}concat(a){return new ChatMessageChunk({content:(0,o.Wf)(this.content,a.content),additional_kwargs:(0,o.wv)(this.additional_kwargs,a.additional_kwargs),response_metadata:(0,o.wv)(this.response_metadata,a.response_metadata),role:this.role})}}},1434:function(a,i,s){"use strict";s.d(i,{C:function(){return FunctionMessageChunk},T:function(){return FunctionMessage}});var o=s(1808);let FunctionMessage=class FunctionMessage extends o.ku{static lc_name(){return"FunctionMessage"}constructor(a,i){"string"==typeof a&&(a={content:a,name:i}),super(a)}_getType(){return"function"}};let FunctionMessageChunk=class FunctionMessageChunk extends o.$k{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(a){return new FunctionMessageChunk({content:(0,o.Wf)(this.content,a.content),additional_kwargs:(0,o.wv)(this.additional_kwargs,a.additional_kwargs),response_metadata:(0,o.wv)(this.response_metadata,a.response_metadata),name:this.name??""})}}},8470:function(a,i,s){"use strict";s.d(i,{r:function(){return HumanMessageChunk},x:function(){return HumanMessage}});var o=s(1808);let HumanMessage=class HumanMessage extends o.ku{static lc_name(){return"HumanMessage"}_getType(){return"human"}};let HumanMessageChunk=class HumanMessageChunk extends o.$k{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(a){return new HumanMessageChunk({content:(0,o.Wf)(this.content,a.content),additional_kwargs:(0,o.wv)(this.additional_kwargs,a.additional_kwargs),response_metadata:(0,o.wv)(this.response_metadata,a.response_metadata)})}}},3478:function(a,i,s){"use strict";s.d(i,{Cr:function(){return P.C},E1:function(){return k.E1},GC:function(){return o.GC},HD:function(){return w.H},J:function(){return w.J},QW:function(){return c.QW},TN:function(){return P.T},Xz:function(){return R.Xz},Z0:function(){return o.Z0},gY:function(){return o.gY},jN:function(){return x.j},ku:function(){return c.ku},ro:function(){return A.r},xk:function(){return A.x},xq:function(){return x.x},zs:function(){return k.zs}});var o=s(7708),c=s(1808),w=s(4630),P=s(1434),A=s(8470),x=s(2723),k=s(2334),R=s(9033)},2723:function(a,i,s){"use strict";s.d(i,{j:function(){return SystemMessage},x:function(){return SystemMessageChunk}});var o=s(1808);let SystemMessage=class SystemMessage extends o.ku{static lc_name(){return"SystemMessage"}_getType(){return"system"}};let SystemMessageChunk=class SystemMessageChunk extends o.$k{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(a){return new SystemMessageChunk({content:(0,o.Wf)(this.content,a.content),additional_kwargs:(0,o.wv)(this.additional_kwargs,a.additional_kwargs),response_metadata:(0,o.wv)(this.response_metadata,a.response_metadata)})}}},9033:function(a,i,s){"use strict";s.d(i,{Xz:function(){return ToolMessageChunk},jC:function(){return defaultToolCallParser}});var o=s(1808);let ToolMessageChunk=class ToolMessageChunk extends o.$k{constructor(a){super(a),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=a.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(a){return new ToolMessageChunk({content:(0,o.Wf)(this.content,a.content),additional_kwargs:(0,o.wv)(this.additional_kwargs,a.additional_kwargs),response_metadata:(0,o.wv)(this.response_metadata,a.response_metadata),tool_call_id:this.tool_call_id})}};function defaultToolCallParser(a){let i=[],s=[];for(let o of a)if(o.function){let a=o.function.name;try{let s=JSON.parse(o.function.arguments),c={name:a||"",args:s||{},id:o.id};i.push(c)}catch(i){s.push({name:a,args:o.function.arguments,id:o.id,error:"Malformed args."})}}return[i,s]}},2334:function(a,i,s){"use strict";s.d(i,{E1:function(){return coerceMessageLikeToMessage},Oy:function(){return convertToChunk},zs:function(){return getBufferString}});var o=s(1808),c=s(8470),w=s(7708),P=s(2723),A=s(4630),x=s(1434);function coerceMessageLikeToMessage(a){if("string"==typeof a)return new c.x(a);if((0,o.QW)(a))return a;let[i,s]=a;if("human"===i||"user"===i)return new c.x({content:s});if("ai"===i||"assistant"===i)return new w.gY({content:s});if("system"===i)return new P.j({content:s});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function getBufferString(a,i="Human",s="AI"){let o=[];for(let c of a){let a;if("human"===c._getType())a=i;else if("ai"===c._getType())a=s;else if("system"===c._getType())a="System";else if("function"===c._getType())a="Function";else if("tool"===c._getType())a="Tool";else if("generic"===c._getType())a=c.role;else throw Error(`Got unsupported message type: ${c._getType()}`);let w=c.name?`${c.name}, `:"";o.push(`${a}: ${w}${c.content}`)}return o.join("\n")}function convertToChunk(a){let i=a._getType();if("human"===i)return new c.r({...a});if("ai"===i)return new w.GC({...a});if("system"===i)return new P.x({...a});if("function"===i)return new x.C({...a});if(A.J.isInstance(a))return new A.H({...a});throw Error("Unknown message type.")}s(9033)},9073:function(a,i,s){"use strict";s.d(i,{bI:function(){return BaseOutputParser},dS:function(){return OutputParserException},tw:function(){return BaseLLMOutputParser}});var o=s(986);let BaseLLMOutputParser=class BaseLLMOutputParser extends o.eq{parseResultWithPrompt(a,i,s){return this.parseResult(a,s)}_baseMessageToString(a){return"string"==typeof a.content?a.content:this._baseMessageContentToString(a.content)}_baseMessageContentToString(a){return JSON.stringify(a)}async invoke(a,i){return"string"==typeof a?this._callWithConfig(async(a,i)=>this.parseResult([{text:a}],i?.callbacks),a,{...i,runType:"parser"}):this._callWithConfig(async(a,i)=>this.parseResult([{message:a,text:this._baseMessageToString(a)}],i?.callbacks),a,{...i,runType:"parser"})}};let BaseOutputParser=class BaseOutputParser extends BaseLLMOutputParser{parseResult(a,i){return this.parse(a[0].text,i)}async parseWithPrompt(a,i,s){return this.parse(a,s)}_type(){throw Error("_type not implemented")}};let OutputParserException=class OutputParserException extends Error{constructor(a,i,s,o=!1){if(super(a),Object.defineProperty(this,"llmOutput",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"observation",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sendToLLM",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmOutput=i,this.observation=s,this.sendToLLM=o,o&&(void 0===s||void 0===i))throw Error("Arguments 'observation' & 'llmOutput' are required if 'sendToLlm' is true")}}},4559:function(a,i,s){"use strict";s.d(i,{Qh:function(){return JsonOutputParser},gP:function(){return w.g}});var o=s(242),c=s(7578),w=s(2991);let JsonOutputParser=class JsonOutputParser extends o.g{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","output_parsers"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"JsonOutputParser"}_diff(a,i){return i?a?(0,c.q)(a,i):[{op:"replace",path:"",value:i}]:void 0}async parsePartialResult(a){return(0,w.M)(a[0].text)}async parse(a){return(0,w.M)(a,JSON.parse)}getFormatInstructions(){return""}}},242:function(a,i,s){"use strict";s.d(i,{g:function(){return BaseCumulativeTransformOutputParser}});var o=s(9073),c=s(1808),w=s(2334),P=s(8398);function deep_compare_strict_deepCompareStrict(a,i){let s=typeof a;if(s!==typeof i)return!1;if(Array.isArray(a)){if(!Array.isArray(i))return!1;let s=a.length;if(s!==i.length)return!1;for(let o=0;o<s;o++)if(!deep_compare_strict_deepCompareStrict(a[o],i[o]))return!1;return!0}if("object"===s){if(!a||!i)return a===i;let s=Object.keys(a),o=Object.keys(i),c=s.length;if(c!==o.length)return!1;for(let o of s)if(!deep_compare_strict_deepCompareStrict(a[o],i[o]))return!1;return!0}return a===i}new URL("undefined"!=typeof self&&self.location&&"null"!==self.location.origin?self.location.origin+self.location.pathname+location.search:"https://github.com/cfworker");let A=/^(\d\d\d\d)-(\d\d)-(\d\d)$/,x=[0,31,28,31,30,31,30,31,31,30,31,30,31],k=/^(\d\d):(\d\d):(\d\d)(\.\d+)?(z|[+-]\d\d(?::?\d\d)?)?$/i;function bind(a){return a.test.bind(a)}let R={date,time:time.bind(void 0,!1),"date-time":date_time,duration:a=>a.length>1&&a.length<80&&(/^P\d+([.,]\d+)?W$/.test(a)||/^P[\dYMDTHS]*(\d[.,]\d+)?[YMDHS]$/.test(a)&&/^P([.,\d]+Y)?([.,\d]+M)?([.,\d]+D)?(T([.,\d]+H)?([.,\d]+M)?([.,\d]+S)?)?$/.test(a)),uri,"uri-reference":bind(/^(?:[a-z][a-z0-9+\-.]*:)?(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'"()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'"()*+,;=:@]|%[0-9a-f]{2})*)*)?(?:\?(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'"()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i),"uri-template":bind(/^(?:(?:[^\x00-\x20"'<>%\\^`{|}]|%[0-9a-f]{2})|\{[+#./;?&=,!@|]?(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?(?:,(?:[a-z0-9_]|%[0-9a-f]{2})+(?::[1-9][0-9]{0,3}|\*)?)*\})*$/i),url:bind(/^(?:(?:https?|ftp):\/\/)(?:\S+(?::\S*)?@)?(?:(?!10(?:\.\d{1,3}){3})(?!127(?:\.\d{1,3}){3})(?!169\.254(?:\.\d{1,3}){2})(?!192\.168(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)(?:\.(?:[a-z\u{00a1}-\u{ffff}0-9]+-?)*[a-z\u{00a1}-\u{ffff}0-9]+)*(?:\.(?:[a-z\u{00a1}-\u{ffff}]{2,})))(?::\d{2,5})?(?:\/[^\s]*)?$/iu),email:a=>{if('"'===a[0])return!1;let[i,s,...o]=a.split("@");return!(!i||!s||0!==o.length||i.length>64||s.length>253||"."===i[0]||i.endsWith(".")||i.includes(".."))&&!!/^[a-z0-9.-]+$/i.test(s)&&!!/^[a-z0-9.!#$%&'*+/=?^_`{|}~-]+$/i.test(i)&&s.split(".").every(a=>/^[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?$/i.test(a))},hostname:bind(/^(?=.{1,253}\.?$)[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?(?:\.[a-z0-9](?:[-0-9a-z]{0,61}[0-9a-z])?)*\.?$/i),ipv4:bind(/^(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)$/),ipv6:bind(/^((([0-9a-f]{1,4}:){7}([0-9a-f]{1,4}|:))|(([0-9a-f]{1,4}:){6}(:[0-9a-f]{1,4}|((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){5}(((:[0-9a-f]{1,4}){1,2})|:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3})|:))|(([0-9a-f]{1,4}:){4}(((:[0-9a-f]{1,4}){1,3})|((:[0-9a-f]{1,4})?:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){3}(((:[0-9a-f]{1,4}){1,4})|((:[0-9a-f]{1,4}){0,2}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){2}(((:[0-9a-f]{1,4}){1,5})|((:[0-9a-f]{1,4}){0,3}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(([0-9a-f]{1,4}:){1}(((:[0-9a-f]{1,4}){1,6})|((:[0-9a-f]{1,4}){0,4}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:))|(:(((:[0-9a-f]{1,4}){1,7})|((:[0-9a-f]{1,4}){0,5}:((25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)(\.(25[0-5]|2[0-4]\d|1\d\d|[1-9]?\d)){3}))|:)))$/i),regex:regex,uuid:bind(/^(?:urn:uuid:)?[0-9a-f]{8}-(?:[0-9a-f]{4}-){3}[0-9a-f]{12}$/i),"json-pointer":bind(/^(?:\/(?:[^~/]|~0|~1)*)*$/),"json-pointer-uri-fragment":bind(/^#(?:\/(?:[a-z0-9_\-.!$&'()*+,;:=@]|%[0-9a-f]{2}|~0|~1)*)*$/i),"relative-json-pointer":bind(/^(?:0|[1-9][0-9]*)(?:#|(?:\/(?:[^~/]|~0|~1)*)*)$/)};function isLeapYear(a){return a%4==0&&(a%100!=0||a%400==0)}function date(a){let i=a.match(A);if(!i)return!1;let s=+i[1],o=+i[2],c=+i[3];return o>=1&&o<=12&&c>=1&&c<=(2==o&&isLeapYear(s)?29:x[o])}function time(a,i){let s=i.match(k);if(!s)return!1;let o=+s[1],c=+s[2],w=+s[3],P=!!s[5];return(o<=23&&c<=59&&w<=59||23==o&&59==c&&60==w)&&(!a||P)}({...R,date:bind(/^\d\d\d\d-[0-1]\d-[0-3]\d$/),time:bind(/^(?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)?$/i),"date-time":bind(/^\d\d\d\d-[0-1]\d-[0-3]\d[t\s](?:[0-2]\d:[0-5]\d:[0-5]\d|23:59:60)(?:\.\d+)?(?:z|[+-]\d\d(?::?\d\d)?)$/i),"uri-reference":bind(/^(?:(?:[a-z][a-z0-9+-.]*:)?\/?\/)?(?:[^\\\s#][^\s#]*)?(?:#[^\\\s]*)?$/i)});let j=/t|\s/i;function date_time(a){let i=a.split(j);return 2==i.length&&date(i[0])&&time(!0,i[1])}let $=/\/|:/,B=/^(?:[a-z][a-z0-9+\-.]*:)(?:\/?\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:]|%[0-9a-f]{2})*@)?(?:\[(?:(?:(?:(?:[0-9a-f]{1,4}:){6}|::(?:[0-9a-f]{1,4}:){5}|(?:[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){4}|(?:(?:[0-9a-f]{1,4}:){0,1}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){3}|(?:(?:[0-9a-f]{1,4}:){0,2}[0-9a-f]{1,4})?::(?:[0-9a-f]{1,4}:){2}|(?:(?:[0-9a-f]{1,4}:){0,3}[0-9a-f]{1,4})?::[0-9a-f]{1,4}:|(?:(?:[0-9a-f]{1,4}:){0,4}[0-9a-f]{1,4})?::)(?:[0-9a-f]{1,4}:[0-9a-f]{1,4}|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?))|(?:(?:[0-9a-f]{1,4}:){0,5}[0-9a-f]{1,4})?::[0-9a-f]{1,4}|(?:(?:[0-9a-f]{1,4}:){0,6}[0-9a-f]{1,4})?::)|[Vv][0-9a-f]+\.[a-z0-9\-._~!$&'()*+,;=:]+)\]|(?:(?:25[0-5]|2[0-4]\d|[01]?\d\d?)\.){3}(?:25[0-5]|2[0-4]\d|[01]?\d\d?)|(?:[a-z0-9\-._~!$&'()*+,;=]|%[0-9a-f]{2})*)(?::\d*)?(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*|\/(?:(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)?|(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})+(?:\/(?:[a-z0-9\-._~!$&'()*+,;=:@]|%[0-9a-f]{2})*)*)(?:\?(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?(?:#(?:[a-z0-9\-._~!$&'()*+,;=:@/?]|%[0-9a-f]{2})*)?$/i;function uri(a){return $.test(a)&&B.test(a)}let D=/[^\\]\\Z/;function regex(a){if(D.test(a))return!1;try{return new RegExp(a),!0}catch(a){return!1}}let BaseTransformOutputParser=class BaseTransformOutputParser extends o.bI{async *_transform(a){for await(let i of a)"string"==typeof i?yield this.parseResult([{text:i}]):yield this.parseResult([{message:i,text:this._baseMessageToString(i)}])}async *transform(a,i){yield*this._transformStreamWithConfig(a,this._transform.bind(this),{...i,runType:"parser"})}};let BaseCumulativeTransformOutputParser=class BaseCumulativeTransformOutputParser extends BaseTransformOutputParser{constructor(a){super(a),Object.defineProperty(this,"diff",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.diff=a?.diff??this.diff}async *_transform(a){let i,s;for await(let o of a){let a;if("string"!=typeof o&&"string"!=typeof o.content)throw Error("Cannot handle non-string output.");if((0,c.a2)(o)){if("string"!=typeof o.content)throw Error("Cannot handle non-string message output.");a=new P.Ls({message:o,text:o.content})}else if((0,c.QW)(o)){if("string"!=typeof o.content)throw Error("Cannot handle non-string message output.");a=new P.Ls({message:(0,w.Oy)(o),text:o.content})}else a=new P.b6({text:o});s=void 0===s?a:s.concat(a);let A=await this.parsePartialResult([s]);null==A||deep_compare_strict_deepCompareStrict(A,i)||(this.diff?yield this._diff(i,A):yield A,i=A)}}}},8398:function(a,i,s){"use strict";s.d(i,{Ls:function(){return ChatGenerationChunk},WH:function(){return o},b6:function(){return GenerationChunk}});let o="__run";let GenerationChunk=class GenerationChunk{constructor(a){Object.defineProperty(this,"text",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"generationInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.text=a.text,this.generationInfo=a.generationInfo}concat(a){return new GenerationChunk({text:this.text+a.text,generationInfo:{...this.generationInfo,...a.generationInfo}})}};let ChatGenerationChunk=class ChatGenerationChunk extends GenerationChunk{constructor(a){super(a),Object.defineProperty(this,"message",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.message=a.message}concat(a){return new ChatGenerationChunk({text:this.text+a.text,generationInfo:{...this.generationInfo,...a.generationInfo},message:this.message.concat(a.message)})}}},4697:function(a,i,s){"use strict";s.d(i,{GU:function(){return ChatPromptValue},Nn:function(){return ImagePromptValue},nw:function(){return StringPromptValue}});var o=s(8498),c=s(3478);let BasePromptValue=class BasePromptValue extends o.i{};let StringPromptValue=class StringPromptValue extends BasePromptValue{static lc_name(){return"StringPromptValue"}constructor(a){super({value:a}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=a}toString(){return this.value}toChatMessages(){return[new c.xk(this.value)]}};let ChatPromptValue=class ChatPromptValue extends BasePromptValue{static lc_name(){return"ChatPromptValue"}constructor(a){Array.isArray(a)&&(a={messages:a}),super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=a.messages}toString(){return(0,c.zs)(this.messages)}toChatMessages(){return this.messages}};let ImagePromptValue=class ImagePromptValue extends BasePromptValue{static lc_name(){return"ImagePromptValue"}constructor(a){"imageUrl"in a||(a={imageUrl:a}),super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=a.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new c.xk({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},4256:function(a,i,s){"use strict";s.d(i,{d:function(){return BasePromptTemplate}});var o=s(8477);let BasePromptTemplate=class BasePromptTemplate extends o.eq{get lc_attributes(){return{partialVariables:void 0}}constructor(a){super(a),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts",this._getPromptType()]}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"partialVariables",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{inputVariables:i}=a;if(i.includes("stop"))throw Error("Cannot have an input variable named 'stop', as it is used internally, please rename.");Object.assign(this,a)}async mergePartialAndUserVariables(a){let i=this.partialVariables??{},s={};for(let[a,o]of Object.entries(i))"string"==typeof o?s[a]=o:s[a]=await o();let o={...s,...a};return o}async invoke(a,i){return this._callWithConfig(a=>this.formatPromptValue(a),a,{...i,runType:"prompt"})}serialize(){throw Error("Use .toJSON() instead")}static async deserialize(a){switch(a._type){case"prompt":{let{PromptTemplate:i}=await Promise.resolve().then(s.bind(s,4094));return i.deserialize(a)}case void 0:{let{PromptTemplate:i}=await Promise.resolve().then(s.bind(s,4094));return i.deserialize({...a,_type:"prompt"})}case"few_shot":{let{FewShotPromptTemplate:i}=await Promise.resolve().then(s.bind(s,1520));return i.deserialize(a)}default:throw Error(`Invalid prompt type in config: ${a._type}`)}}}},4359:function(a,i,s){"use strict";s.d(i,{ax:function(){return MessagesPlaceholder},gc:function(){return AIMessagePromptTemplate},kq:function(){return HumanMessagePromptTemplate},ks:function(){return ChatPromptTemplate},ov:function(){return SystemMessagePromptTemplate}});var o=s(3478),c=s(4697),w=s(8477),P=s(2566),A=s(4256),x=s(4094),k=s(6531),R=s(6184);let BaseMessagePromptTemplate=class BaseMessagePromptTemplate extends w.eq{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}async invoke(a,i){return this._callWithConfig(a=>this.formatMessages(a),a,{...i,runType:"prompt"})}};let MessagesPlaceholder=class MessagesPlaceholder extends BaseMessagePromptTemplate{static lc_name(){return"MessagesPlaceholder"}constructor(a){"string"==typeof a&&(a={variableName:a}),super(a),Object.defineProperty(this,"variableName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"optional",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.variableName=a.variableName,this.optional=a.optional??!1}get inputVariables(){return[this.variableName]}validateInputOrThrow(a,i){if(this.optional&&!a)return!1;if(!a){let a=Error(`Error: Field "${i}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: undefined`);throw a.name="InputFormatError",a}if(!(Array.isArray(a)?a.every(a=>(0,o.QW)(a)):(0,o.QW)(a))){let s="string"==typeof a?a:JSON.stringify(a,null,2),o=Error(`Error: Field "${i}" in prompt uses a MessagesPlaceholder, which expects an array of BaseMessages as an input value. Received: ${s}`);throw o.name="InputFormatError",o}return!0}async formatMessages(a){return this.validateInputOrThrow(a[this.variableName],this.variableName),a[this.variableName]??[]}};let BaseMessageStringPromptTemplate=class BaseMessageStringPromptTemplate extends BaseMessagePromptTemplate{constructor(a){"prompt"in a||(a={prompt:a}),super(a),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=a.prompt}get inputVariables(){return this.prompt.inputVariables}async formatMessages(a){return[await this.format(a)]}};let BaseChatPromptTemplate=class BaseChatPromptTemplate extends A.d{constructor(a){super(a)}async format(a){return(await this.formatPromptValue(a)).toString()}async formatPromptValue(a){let i=await this.formatMessages(a);return new c.GU(i)}};let ChatMessagePromptTemplate=class ChatMessagePromptTemplate extends BaseMessageStringPromptTemplate{static lc_name(){return"ChatMessagePromptTemplate"}constructor(a,i){"prompt"in a||(a={prompt:a,role:i}),super(a),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=a.role}async format(a){return new o.J(await this.prompt.format(a),this.role)}static fromTemplate(a,i,s){return new this(x.PromptTemplate.fromTemplate(a,{templateFormat:s?.templateFormat}),i)}};let _StringImageMessagePromptTemplate=class _StringImageMessagePromptTemplate extends BaseMessagePromptTemplate{static _messageClass(){throw Error("Can not invoke _messageClass from inside _StringImageMessagePromptTemplate")}constructor(a,i){if("prompt"in a||(a={prompt:a}),super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","chat"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"inputVariables",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"additionalOptions",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"messageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"chatMessageClass",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=a.prompt,Array.isArray(this.prompt)){let a=[];this.prompt.forEach(i=>{"inputVariables"in i&&(a=a.concat(i.inputVariables))}),this.inputVariables=a}else this.inputVariables=this.prompt.inputVariables;this.additionalOptions=i??this.additionalOptions}createMessage(a){let i=this.constructor;if(i._messageClass()){let s=i._messageClass();return new s({content:a})}if(i.chatMessageClass){let s=i.chatMessageClass();return new s({content:a,role:this.getRoleFromMessageClass(s.lc_name())})}throw Error("No message class defined")}getRoleFromMessageClass(a){switch(a){case"HumanMessage":return"human";case"AIMessage":return"ai";case"SystemMessage":return"system";case"ChatMessage":return"chat";default:throw Error("Invalid message class name")}}static fromTemplate(a,i){if("string"==typeof a)return new this(x.PromptTemplate.fromTemplate(a,i));let s=[];for(let i of a)if("string"==typeof i||"object"==typeof i&&"text"in i){let a="";"string"==typeof i?a=i:"string"==typeof i.text&&(a=i.text??""),s.push(x.PromptTemplate.fromTemplate(a))}else if("object"==typeof i&&"image_url"in i){let a,o=i.image_url??"",c=[];if("string"==typeof o){let i=(0,R._O)(o),s=i.flatMap(a=>"variable"===a.type?[a.name]:[]);if((s?.length??0)>0){if(s.length>1)throw Error(`Only one format variable allowed per image template.
Got: ${s}
From: ${o}`);c=[s[0]]}else c=[];o={url:o},a=new k.r({template:o,inputVariables:c})}else if("object"==typeof o){if("url"in o){let a=(0,R._O)(o.url);c=a.flatMap(a=>"variable"===a.type?[a.name]:[])}else c=[];a=new k.r({template:o,inputVariables:c})}else throw Error("Invalid image template");s.push(a)}return new this({prompt:s,additionalOptions:i})}async format(a){if(this.prompt instanceof P.A){let i=await this.prompt.format(a);return this.createMessage(i)}{let i=[];for(let s of this.prompt){let o={};if(!("inputVariables"in s))throw Error(`Prompt ${s} does not have inputVariables defined.`);for(let i of s.inputVariables)o||(o={[i]:a[i]}),o={...o,[i]:a[i]};if(s instanceof P.A){let a=await s.format(o);i.push({type:"text",text:a})}else if(s instanceof k.r){let a=await s.format(o);i.push({type:"image_url",image_url:a})}}return this.createMessage(i)}}async formatMessages(a){return[await this.format(a)]}};let HumanMessagePromptTemplate=class HumanMessagePromptTemplate extends _StringImageMessagePromptTemplate{static _messageClass(){return o.xk}static lc_name(){return"HumanMessagePromptTemplate"}};let AIMessagePromptTemplate=class AIMessagePromptTemplate extends _StringImageMessagePromptTemplate{static _messageClass(){return o.gY}static lc_name(){return"AIMessagePromptTemplate"}};let SystemMessagePromptTemplate=class SystemMessagePromptTemplate extends _StringImageMessagePromptTemplate{static _messageClass(){return o.jN}static lc_name(){return"SystemMessagePromptTemplate"}};function _isBaseMessagePromptTemplate(a){return"function"==typeof a.formatMessages}function _coerceMessagePromptTemplateLike(a,i){let s;if(_isBaseMessagePromptTemplate(a)||(0,o.QW)(a))return a;if(Array.isArray(a)&&"placeholder"===a[0]){let i=a[1];if("string"!=typeof i||"{"!==i[0]||"}"!==i[i.length-1])throw Error(`Invalid placeholder template: "${a[1]}". Expected a variable name surrounded by curly braces.`);let s=i.slice(1,-1);return new MessagesPlaceholder({variableName:s,optional:!0})}let c=(0,o.E1)(a);if(s="string"==typeof c.content?c.content:c.content.map(a=>"text"in a?{text:a.text}:"image_url"in a?{image_url:a.image_url}:a),"human"===c._getType())return HumanMessagePromptTemplate.fromTemplate(s,i);if("ai"===c._getType())return AIMessagePromptTemplate.fromTemplate(s,i);if("system"===c._getType())return SystemMessagePromptTemplate.fromTemplate(s,i);if(o.J.isInstance(c))return ChatMessagePromptTemplate.fromTemplate(c.content,c.role,i);throw Error(`Could not coerce message prompt template from input. Received message type: "${c._getType()}".`)}function isMessagesPlaceholder(a){return"MessagesPlaceholder"===a.constructor.lc_name()}let ChatPromptTemplate=class ChatPromptTemplate extends BaseChatPromptTemplate{static lc_name(){return"ChatPromptTemplate"}get lc_aliases(){return{promptMessages:"messages"}}constructor(a){if(super(a),Object.defineProperty(this,"promptMessages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),"mustache"===a.templateFormat&&void 0===a.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,a),this.validateTemplate){let a=new Set;for(let i of this.promptMessages)if(!(i instanceof o.ku))for(let s of i.inputVariables)a.add(s);let i=this.inputVariables,s=new Set(this.partialVariables?i.concat(Object.keys(this.partialVariables)):i),c=new Set([...s].filter(i=>!a.has(i)));if(c.size>0)throw Error(`Input variables \`${[...c]}\` are not used in any of the prompt messages.`);let w=new Set([...a].filter(a=>!s.has(a)));if(w.size>0)throw Error(`Input variables \`${[...w]}\` are used in prompt messages but not in the prompt template.`)}}_getPromptType(){return"chat"}async _parseImagePrompts(a,i){if("string"==typeof a.content)return a;let s=await Promise.all(a.content.map(async a=>{if("image_url"!==a.type)return a;let s="";s="string"==typeof a.image_url?a.image_url:a.image_url.url;let o=x.PromptTemplate.fromTemplate(s),c=await o.format(i);return"string"!=typeof a.image_url&&"url"in a.image_url?a.image_url.url=c:a.image_url=c,a}));return a.content=s,a}async formatMessages(a){let i=await this.mergePartialAndUserVariables(a),s=[];for(let a of this.promptMessages)if(a instanceof o.ku)s.push(await this._parseImagePrompts(a,i));else{let o=a.inputVariables.reduce((s,o)=>{if(!(o in i)&&!(isMessagesPlaceholder(a)&&a.optional))throw Error(`Missing value for input variable \`${o.toString()}\``);return s[o]=i[o],s},{}),c=await a.formatMessages(o);s=s.concat(c)}return s}async partial(a){let i=this.inputVariables.filter(i=>!(i in a)),s={...this.partialVariables??{},...a},o={...this,inputVariables:i,partialVariables:s};return new ChatPromptTemplate(o)}static fromTemplate(a,i){let s=x.PromptTemplate.fromTemplate(a,i),o=new HumanMessagePromptTemplate({prompt:s});return this.fromMessages([o])}static fromMessages(a,i){let s=a.reduce((a,s)=>a.concat(s instanceof ChatPromptTemplate?s.promptMessages:[_coerceMessagePromptTemplateLike(s,i)]),[]),c=a.reduce((a,i)=>i instanceof ChatPromptTemplate?Object.assign(a,i.partialVariables):a,Object.create(null)),w=new Set;for(let a of s)if(!(a instanceof o.ku))for(let i of a.inputVariables)i in c||w.add(i);return new this({...i,inputVariables:[...w],promptMessages:s,partialVariables:c,templateFormat:i?.templateFormat})}static fromPromptMessages(a){return this.fromMessages(a)}}},1520:function(a,i,s){"use strict";s.d(i,{FewShotPromptTemplate:function(){return FewShotPromptTemplate}});var o=s(2566),c=s(6184),w=s(4094);s(4359);let FewShotPromptTemplate=class FewShotPromptTemplate extends o.A{constructor(a){if(super(a),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"examples",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleSelector",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"examplePrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"suffix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"exampleSeparator",{enumerable:!0,configurable:!0,writable:!0,value:"\n\n"}),Object.defineProperty(this,"prefix",{enumerable:!0,configurable:!0,writable:!0,value:""}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.assign(this,a),void 0!==this.examples&&void 0!==this.exampleSelector)throw Error("Only one of 'examples' and 'example_selector' should be provided");if(void 0===this.examples&&void 0===this.exampleSelector)throw Error("One of 'examples' and 'example_selector' should be provided");if(this.validateTemplate){let a=this.inputVariables;this.partialVariables&&(a=a.concat(Object.keys(this.partialVariables))),(0,c.af)(this.prefix+this.suffix,this.templateFormat,a)}}_getPromptType(){return"few_shot"}static lc_name(){return"FewShotPromptTemplate"}async getExamples(a){if(void 0!==this.examples)return this.examples;if(void 0!==this.exampleSelector)return this.exampleSelector.selectExamples(a);throw Error("One of 'examples' and 'example_selector' should be provided")}async partial(a){let i=this.inputVariables.filter(i=>!(i in a)),s={...this.partialVariables??{},...a},o={...this,inputVariables:i,partialVariables:s};return new FewShotPromptTemplate(o)}async format(a){let i=await this.mergePartialAndUserVariables(a),s=await this.getExamples(i),o=await Promise.all(s.map(a=>this.examplePrompt.format(a))),w=[this.prefix,...o,this.suffix].join(this.exampleSeparator);return(0,c.SM)(w,this.templateFormat,i)}serialize(){if(this.exampleSelector||!this.examples)throw Error("Serializing an example selector is not currently supported");if(void 0!==this.outputParser)throw Error("Serializing an output parser is not currently supported");return{_type:this._getPromptType(),input_variables:this.inputVariables,example_prompt:this.examplePrompt.serialize(),example_separator:this.exampleSeparator,suffix:this.suffix,prefix:this.prefix,template_format:this.templateFormat,examples:this.examples}}static async deserialize(a){let i;let{example_prompt:s}=a;if(!s)throw Error("Missing example prompt");let o=await w.PromptTemplate.deserialize(s);if(Array.isArray(a.examples))i=a.examples;else throw Error("Invalid examples format. Only list or string are supported.");return new FewShotPromptTemplate({inputVariables:a.input_variables,examplePrompt:o,examples:i,exampleSeparator:a.example_separator,prefix:a.prefix,suffix:a.suffix,templateFormat:a.template_format})}}},6531:function(a,i,s){"use strict";s.d(i,{r:function(){return ImagePromptTemplate}});var o=s(4697),c=s(4256),w=s(6184);let ImagePromptTemplate=class ImagePromptTemplate extends c.d{static lc_name(){return"ImagePromptTemplate"}constructor(a){if(super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompts","image"]}),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.template=a.template,this.templateFormat=a.templateFormat??this.templateFormat,this.validateTemplate=a.validateTemplate??this.validateTemplate,this.validateTemplate){let a=this.inputVariables;this.partialVariables&&(a=a.concat(Object.keys(this.partialVariables))),(0,w.af)([{type:"image_url",image_url:this.template}],this.templateFormat,a)}}_getPromptType(){return"prompt"}async partial(a){let i=this.inputVariables.filter(i=>!(i in a)),s={...this.partialVariables??{},...a},o={...this,inputVariables:i,partialVariables:s};return new ImagePromptTemplate(o)}async format(a){let i={};for(let[s,o]of Object.entries(this.template))"string"==typeof o?i[s]=o.replace(/{([^{}]*)}/g,(i,s)=>{let o=a[s];return"string"==typeof o||"number"==typeof o?String(o):i}):i[s]=o;let s=a.url||i.url,o=a.detail||i.detail;if(!s)throw Error("Must provide either an image URL.");if("string"!=typeof s)throw Error("url must be a string.");let c={url:s};return o&&(c.detail=o),c}async formatPromptValue(a){let i=await this.format(a);return new o.Nn(i)}}},4094:function(a,i,s){"use strict";s.d(i,{PromptTemplate:function(){return PromptTemplate}});var o=s(2566),c=s(6184);let PromptTemplate=class PromptTemplate extends o.A{static lc_name(){return"PromptTemplate"}constructor(a){if(super(a),Object.defineProperty(this,"template",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"templateFormat",{enumerable:!0,configurable:!0,writable:!0,value:"f-string"}),Object.defineProperty(this,"validateTemplate",{enumerable:!0,configurable:!0,writable:!0,value:!0}),"mustache"===a.templateFormat&&void 0===a.validateTemplate&&(this.validateTemplate=!1),Object.assign(this,a),this.validateTemplate){if("mustache"===this.templateFormat)throw Error("Mustache templates cannot be validated.");let a=this.inputVariables;this.partialVariables&&(a=a.concat(Object.keys(this.partialVariables))),(0,c.af)(this.template,this.templateFormat,a)}}_getPromptType(){return"prompt"}async format(a){let i=await this.mergePartialAndUserVariables(a);return(0,c.SM)(this.template,this.templateFormat,i)}static fromExamples(a,i,s,o="\n\n",c=""){let w=[c,...a,i].join(o);return new PromptTemplate({inputVariables:s,template:w})}static fromTemplate(a,i){let{templateFormat:s="f-string",...o}=i??{},w=new Set;return(0,c.$M)(a,s).forEach(a=>{"variable"===a.type&&w.add(a.name)}),new PromptTemplate({inputVariables:[...w],templateFormat:s,template:a,...o})}async partial(a){let i=this.inputVariables.filter(i=>!(i in a)),s={...this.partialVariables??{},...a},o={...this,inputVariables:i,partialVariables:s};return new PromptTemplate(o)}serialize(){if(void 0!==this.outputParser)throw Error("Cannot serialize a prompt template with an output parser");return{_type:this._getPromptType(),input_variables:this.inputVariables,template:this.template,template_format:this.templateFormat}}static async deserialize(a){if(!a.template)throw Error("Prompt template must have a template");let i=new PromptTemplate({inputVariables:a.input_variables,template:a.template,templateFormat:a.template_format});return i}}},2566:function(a,i,s){"use strict";s.d(i,{A:function(){return BaseStringPromptTemplate}});var o=s(4697),c=s(4256);let BaseStringPromptTemplate=class BaseStringPromptTemplate extends c.d{async formatPromptValue(a){let i=await this.format(a);return new o.nw(i)}}},6184:function(a,i,s){"use strict";s.d(i,{af:function(){return checkValidTemplate},_O:function(){return parseFString},$M:function(){return template_parseTemplate},SM:function(){return renderTemplate}});/*!
 * mustache.js - Logic-less {{mustache}} templates with JavaScript
 * http://github.com/janl/mustache.js
 */var o=Object.prototype.toString,c=Array.isArray||function(a){return"[object Array]"===o.call(a)};function isFunction(a){return"function"==typeof a}function typeStr(a){return c(a)?"array":typeof a}function escapeRegExp(a){return a.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}function hasProperty(a,i){return null!=a&&"object"==typeof a&&i in a}function primitiveHasOwnProperty(a,i){return null!=a&&"object"!=typeof a&&a.hasOwnProperty&&a.hasOwnProperty(i)}var w=RegExp.prototype.test;function testRegExp(a,i){return w.call(a,i)}var P=/\S/;function isWhitespace(a){return!testRegExp(P,a)}var A={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;","`":"&#x60;","=":"&#x3D;"};function escapeHtml(a){return String(a).replace(/[&<>"'`=\/]/g,function(a){return A[a]})}var x=/\s*/,k=/\s+/,R=/\s*=/,j=/\s*\}/,$=/#|\^|\/|>|\{|&|=|!/;function parseTemplate(a,i){if(!a)return[];var s,o,w,P,A,D,Z,U,z,V=!1,G=[],W=[],K=[],J=!1,Y=!1,X="",ee=0;function stripSpace(){if(J&&!Y)for(;K.length;)delete W[K.pop()];else K=[];J=!1,Y=!1}function compileTags(a){if("string"==typeof a&&(a=a.split(k,2)),!c(a)||2!==a.length)throw Error("Invalid tags: "+a);s=RegExp(escapeRegExp(a[0])+"\\s*"),o=RegExp("\\s*"+escapeRegExp(a[1])),w=RegExp("\\s*"+escapeRegExp("}"+a[1]))}compileTags(i||B.tags);for(var et=new Scanner(a);!et.eos();){if(P=et.pos,D=et.scanUntil(s))for(var er=0,ea=D.length;er<ea;++er)isWhitespace(Z=D.charAt(er))?(K.push(W.length),X+=Z):(Y=!0,V=!0,X+=" "),W.push(["text",Z,P,P+1]),P+=1,"\n"===Z&&(stripSpace(),X="",ee=0,V=!1);if(!et.scan(s))break;if(J=!0,A=et.scan($)||"name",et.scan(x),"="===A?(D=et.scanUntil(R),et.scan(R),et.scanUntil(o)):"{"===A?(D=et.scanUntil(w),et.scan(j),et.scanUntil(o),A="&"):D=et.scanUntil(o),!et.scan(o))throw Error("Unclosed tag at "+et.pos);if(U=">"==A?[A,D,P,et.pos,X,ee,V]:[A,D,P,et.pos],ee++,W.push(U),"#"===A||"^"===A)G.push(U);else if("/"===A){if(!(z=G.pop()))throw Error('Unopened section "'+D+'" at '+P);if(z[1]!==D)throw Error('Unclosed section "'+z[1]+'" at '+P)}else"name"===A||"{"===A||"&"===A?Y=!0:"="===A&&compileTags(D)}if(stripSpace(),z=G.pop())throw Error('Unclosed section "'+z[1]+'" at '+et.pos);return nestTokens(squashTokens(W))}function squashTokens(a){for(var i,s,o=[],c=0,w=a.length;c<w;++c)(i=a[c])&&("text"===i[0]&&s&&"text"===s[0]?(s[1]+=i[1],s[3]=i[3]):(o.push(i),s=i));return o}function nestTokens(a){for(var i,s=[],o=s,c=[],w=0,P=a.length;w<P;++w)switch((i=a[w])[0]){case"#":case"^":o.push(i),c.push(i),o=i[4]=[];break;case"/":c.pop()[5]=i[2],o=c.length>0?c[c.length-1][4]:s;break;default:o.push(i)}return s}function Scanner(a){this.string=a,this.tail=a,this.pos=0}function Context(a,i){this.view=a,this.cache={".":this.view},this.parent=i}function Writer(){this.templateCache={_cache:{},set:function(a,i){this._cache[a]=i},get:function(a){return this._cache[a]},clear:function(){this._cache={}}}}Scanner.prototype.eos=function(){return""===this.tail},Scanner.prototype.scan=function(a){var i=this.tail.match(a);if(!i||0!==i.index)return"";var s=i[0];return this.tail=this.tail.substring(s.length),this.pos+=s.length,s},Scanner.prototype.scanUntil=function(a){var i,s=this.tail.search(a);switch(s){case -1:i=this.tail,this.tail="";break;case 0:i="";break;default:i=this.tail.substring(0,s),this.tail=this.tail.substring(s)}return this.pos+=i.length,i},Context.prototype.push=function(a){return new Context(a,this)},Context.prototype.lookup=function(a){var i=this.cache;if(i.hasOwnProperty(a))s=i[a];else{for(var s,o,c,w,P=this,A=!1;P;){if(a.indexOf(".")>0)for(o=P.view,c=a.split("."),w=0;null!=o&&w<c.length;)w===c.length-1&&(A=hasProperty(o,c[w])||primitiveHasOwnProperty(o,c[w])),o=o[c[w++]];else o=P.view[a],A=hasProperty(P.view,a);if(A){s=o;break}P=P.parent}i[a]=s}return isFunction(s)&&(s=s.call(this.view)),s},Writer.prototype.clearCache=function(){void 0!==this.templateCache&&this.templateCache.clear()},Writer.prototype.parse=function(a,i){var s=this.templateCache,o=a+":"+(i||B.tags).join(":"),c=void 0!==s,w=c?s.get(o):void 0;return void 0==w&&(w=parseTemplate(a,i),c&&s.set(o,w)),w},Writer.prototype.render=function(a,i,s,o){var c=this.getConfigTags(o),w=this.parse(a,c),P=i instanceof Context?i:new Context(i,void 0);return this.renderTokens(w,P,s,a,o)},Writer.prototype.renderTokens=function(a,i,s,o,c){for(var w,P,A,x="",k=0,R=a.length;k<R;++k)A=void 0,"#"===(P=(w=a[k])[0])?A=this.renderSection(w,i,s,o,c):"^"===P?A=this.renderInverted(w,i,s,o,c):">"===P?A=this.renderPartial(w,i,s,c):"&"===P?A=this.unescapedValue(w,i):"name"===P?A=this.escapedValue(w,i,c):"text"===P&&(A=this.rawValue(w)),void 0!==A&&(x+=A);return x},Writer.prototype.renderSection=function(a,i,s,o,w){var P=this,A="",x=i.lookup(a[1]);function subRender(a){return P.render(a,i,s,w)}if(x){if(c(x))for(var k=0,R=x.length;k<R;++k)A+=this.renderTokens(a[4],i.push(x[k]),s,o,w);else if("object"==typeof x||"string"==typeof x||"number"==typeof x)A+=this.renderTokens(a[4],i.push(x),s,o,w);else if(isFunction(x)){if("string"!=typeof o)throw Error("Cannot use higher-order sections without the original template");null!=(x=x.call(i.view,o.slice(a[3],a[5]),subRender))&&(A+=x)}else A+=this.renderTokens(a[4],i,s,o,w);return A}},Writer.prototype.renderInverted=function(a,i,s,o,w){var P=i.lookup(a[1]);if(!P||c(P)&&0===P.length)return this.renderTokens(a[4],i,s,o,w)},Writer.prototype.indentPartial=function(a,i,s){for(var o=i.replace(/[^ \t]/g,""),c=a.split("\n"),w=0;w<c.length;w++)c[w].length&&(w>0||!s)&&(c[w]=o+c[w]);return c.join("\n")},Writer.prototype.renderPartial=function(a,i,s,o){if(s){var c=this.getConfigTags(o),w=isFunction(s)?s(a[1]):s[a[1]];if(null!=w){var P=a[6],A=a[5],x=a[4],k=w;0==A&&x&&(k=this.indentPartial(w,x,P));var R=this.parse(k,c);return this.renderTokens(R,i,s,k,o)}}},Writer.prototype.unescapedValue=function(a,i){var s=i.lookup(a[1]);if(null!=s)return s},Writer.prototype.escapedValue=function(a,i,s){var o=this.getConfigEscape(s)||B.escape,c=i.lookup(a[1]);if(null!=c)return"number"==typeof c&&o===B.escape?String(c):o(c)},Writer.prototype.rawValue=function(a){return a[1]},Writer.prototype.getConfigTags=function(a){return c(a)?a:a&&"object"==typeof a?a.tags:void 0},Writer.prototype.getConfigEscape=function(a){return a&&"object"==typeof a&&!c(a)?a.escape:void 0};var B={name:"mustache.js",version:"4.2.0",tags:["{{","}}"],clearCache:void 0,escape:void 0,parse:void 0,render:void 0,Scanner:void 0,Context:void 0,Writer:void 0,set templateCache(cache){D.templateCache=cache},get templateCache(){return D.templateCache}},D=new Writer;B.clearCache=function(){return D.clearCache()},B.parse=function(a,i){return D.parse(a,i)},B.render=function(a,i,s,o){if("string"!=typeof a)throw TypeError('Invalid template! Template should be a "string" but "'+typeStr(a)+'" was given as the first argument for mustache#render(template, view, partials)');return D.render(a,i,s,o)},B.escape=escapeHtml,B.Scanner=Scanner,B.Context=Context,B.Writer=Writer;let parseFString=a=>{let i=a.split(""),s=[],nextBracket=(a,s)=>{for(let o=s;o<i.length;o+=1)if(a.includes(i[o]))return o;return -1},o=0;for(;o<i.length;)if("{"===i[o]&&o+1<i.length&&"{"===i[o+1])s.push({type:"literal",text:"{"}),o+=2;else if("}"===i[o]&&o+1<i.length&&"}"===i[o+1])s.push({type:"literal",text:"}"}),o+=2;else if("{"===i[o]){let a=nextBracket("}",o);if(a<0)throw Error("Unclosed '{' in template.");s.push({type:"variable",name:i.slice(o+1,a).join("")}),o=a+1}else if("}"===i[o])throw Error("Single '}' in template.");else{let a=nextBracket("{}",o),c=(a<0?i.slice(o):i.slice(o,a)).join("");s.push({type:"literal",text:c}),o=a<0?i.length:a}return s},mustacheTemplateToNodes=a=>a.map(a=>{if("name"===a[0]){let i=a[1].includes(".")?a[1].split(".")[0]:a[1];return{type:"variable",name:i}}return"#"===a[0]?{type:"variable",name:a[1]}:{type:"literal",text:a[1]}}),Z={"f-string":(a,i)=>parseFString(a).reduce((a,s)=>{if("variable"===s.type){if(s.name in i)return a+i[s.name];throw Error(`(f-string) Missing value for input ${s.name}`)}return a+s.text},""),mustache:(a,i)=>B.render(a,i)},U={"f-string":parseFString,mustache:a=>{let i=B.parse(a);return mustacheTemplateToNodes(i)}},renderTemplate=(a,i,s)=>Z[i](a,s),template_parseTemplate=(a,i)=>U[i](a),checkValidTemplate=(a,i,s)=>{if(!(i in Z)){let a=Object.keys(Z);throw Error(`Invalid template format. Got \`${i}\`;
                         should be one of ${a}`)}try{let o=s.reduce((a,i)=>(a[i]="foo",a),{});Array.isArray(a)?a.forEach(a=>{if("text"===a.type)renderTemplate(a.text,i,o);else if("image_url"===a.type){if("string"==typeof a.image_url)renderTemplate(a.image_url,i,o);else{let s=a.image_url.url;renderTemplate(s,i,o)}}else throw Error(`Invalid message template received. ${JSON.stringify(a,null,2)}`)}):renderTemplate(a,i,o)}catch(a){throw Error(`Invalid prompt schema: ${a.message}`)}}},8477:function(a,i,s){"use strict";s.d(i,{eq:function(){return Runnable},Vh:function(){return RunnableAssign},dT:function(){return RunnableMap},lW:function(){return RunnableSequence}});var o=s(6418),c=s(1018),w=s(7018),P=s(6918),A=s(1448),x=s(2272),k=s(3478);let RunLogPatch=class RunLogPatch{constructor(a){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=a.ops??[]}concat(a){let i=this.ops.concat(a.ops),s=(0,P.af)({},i);return new RunLog({ops:i,state:s[s.length-1].newDocument})}};let RunLog=class RunLog extends RunLogPatch{constructor(a){super(a),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=a.state}concat(a){let i=this.ops.concat(a.ops),s=(0,P.af)(this.state,a.ops);return new RunLog({ops:i,state:s[s.length-1].newDocument})}static fromRunLogPatch(a){let i=(0,P.af)({},a.ops);return new RunLog({ops:a.ops,state:i[i.length-1].newDocument})}};async function _getStandardizedInputs(a,i){if("original"===i)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:s}=a;return["retriever","llm","prompt"].includes(a.run_type)?s:1!==Object.keys(s).length||s?.input!==""?s.input:void 0}async function _getStandardizedOutputs(a,i){let{outputs:s}=a;return"original"===i||["retriever","llm","prompt"].includes(a.run_type)?s:void 0!==s&&1===Object.keys(s).length&&s?.output!==void 0?s.output:s}function isChatGenerationChunk(a){return void 0!==a&&void 0!==a.message}let LogStreamCallbackHandler=class LogStreamCallbackHandler extends A.Z{constructor(a){super({_awaitHandler:!0,...a}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=a?.autoClose??!0,this.includeNames=a?.includeNames,this.includeTypes=a?.includeTypes,this.includeTags=a?.includeTags,this.excludeNames=a?.excludeNames,this.excludeTypes=a?.excludeTypes,this.excludeTags=a?.excludeTags,this._schemaFormat=a?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=x.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(a){}_includeRun(a){if(a.id===this.rootId)return!1;let i=a.tags??[],s=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(s=s||this.includeNames.includes(a.name)),void 0!==this.includeTypes&&(s=s||this.includeTypes.includes(a.run_type)),void 0!==this.includeTags&&(s=s||void 0!==i.find(a=>this.includeTags?.includes(a))),void 0!==this.excludeNames&&(s=s&&!this.excludeNames.includes(a.name)),void 0!==this.excludeTypes&&(s=s&&!this.excludeTypes.includes(a.run_type)),void 0!==this.excludeTags&&(s=s&&i.every(a=>!this.excludeTags?.includes(a))),s}async *tapOutputIterable(a,i){for await(let s of i){if(a!==this.rootId){let i=this.keyMapByRunId[a];i&&await this.writer.write(new RunLogPatch({ops:[{op:"add",path:`/logs/${i}/streamed_output/-`,value:s}]}))}yield s}}async onRunCreate(a){if(void 0===this.rootId&&(this.rootId=a.id,await this.writer.write(new RunLogPatch({ops:[{op:"replace",path:"",value:{id:a.id,name:a.name,type:a.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(a))return;void 0===this.counterMapByRunName[a.name]&&(this.counterMapByRunName[a.name]=0),this.counterMapByRunName[a.name]+=1;let i=this.counterMapByRunName[a.name];this.keyMapByRunId[a.id]=1===i?a.name:`${a.name}:${i}`;let s={id:a.id,name:a.name,type:a.run_type,tags:a.tags??[],metadata:a.extra?.metadata??{},start_time:new Date(a.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(s.inputs=await _getStandardizedInputs(a,this._schemaFormat)),await this.writer.write(new RunLogPatch({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[a.id]}`,value:s}]}))}async onRunUpdate(a){try{let i=this.keyMapByRunId[a.id];if(void 0===i)return;let s=[];"streaming_events"===this._schemaFormat&&s.push({op:"replace",path:`/logs/${i}/inputs`,value:await _getStandardizedInputs(a,this._schemaFormat)}),s.push({op:"add",path:`/logs/${i}/final_output`,value:await _getStandardizedOutputs(a,this._schemaFormat)}),void 0!==a.end_time&&s.push({op:"add",path:`/logs/${i}/end_time`,value:new Date(a.end_time).toISOString()});let o=new RunLogPatch({ops:s});await this.writer.write(o)}finally{if(a.id===this.rootId){let i=new RunLogPatch({ops:[{op:"replace",path:"/final_output",value:await _getStandardizedOutputs(a,this._schemaFormat)}]});await this.writer.write(i),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(a,i,s){let o;let c=this.keyMapByRunId[a.id];if(void 0===c)return;let w=void 0!==a.inputs.messages;o=w?isChatGenerationChunk(s?.chunk)?s?.chunk:new k.GC(i):i;let P=new RunLogPatch({ops:[{op:"add",path:`/logs/${c}/streamed_output_str/-`,value:i},{op:"add",path:`/logs/${c}/streamed_output/-`,value:o}]});await this.writer.write(P)}};var R=s(8498),j=s(9189),$=s(3830);let RootListenersTracer=class RootListenersTracer extends A.Z{constructor({config:a,onStart:i,onEnd:s,onError:o}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=a,this.argOnStart=i,this.argOnEnd=s,this.argOnError=o}persistRun(a){return Promise.resolve()}async onRunCreate(a){!this.rootId&&(this.rootId=a.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(a):2===this.argOnStart.length&&await this.argOnStart(a,this.config)))}async onRunUpdate(a){a.id===this.rootId&&(a.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(a):2===this.argOnError.length&&await this.argOnError(a,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(a):2===this.argOnEnd.length&&await this.argOnEnd(a,this.config)))}};function utils_isRunnableInterface(a){return!!a&&a.lc_runnable}let _RootEventFilter=class _RootEventFilter{constructor(a){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=a.includeNames,this.includeTypes=a.includeTypes,this.includeTags=a.includeTags,this.excludeNames=a.excludeNames,this.excludeTypes=a.excludeTypes,this.excludeTags=a.excludeTags}includeEvent(a,i){let s=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,o=a.tags??[];return void 0!==this.includeNames&&(s=s||this.includeNames.includes(a.name)),void 0!==this.includeTypes&&(s=s||this.includeTypes.includes(i)),void 0!==this.includeTags&&(s=s||o.some(a=>this.includeTags?.includes(a))),void 0!==this.excludeNames&&(s=s&&!this.excludeNames.includes(a.name)),void 0!==this.excludeTypes&&(s=s&&!this.excludeTypes.includes(i)),void 0!==this.excludeTags&&(s=s&&o.every(a=>!this.excludeTags?.includes(a))),s}};var B=s(5051),D=s(9711),Z=s(325),U=s(9634);function nodeDataJson(a){return utils_isRunnableInterface(a.data)?{type:"runnable",data:{id:a.data.lc_id,name:a.data.getName()}}:{type:"schema",data:{...(0,D.Y_)(a.data.schema),title:a.data.name}}}let Graph=class Graph{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let a={};return Object.values(this.nodes).forEach((i,s)=>{a[i.id]=(0,Z.Z)(i.id)?s:i.id}),{nodes:Object.values(this.nodes).map(i=>({id:a[i.id],...nodeDataJson(i)})),edges:this.edges.map(i=>i.data?{source:a[i.source],target:a[i.target],data:i.data}:{source:a[i.source],target:a[i.target]})}}addNode(a,i){if(void 0!==i&&void 0!==this.nodes[i])throw Error(`Node with id ${i} already exists`);let s=i||(0,U.Z)(),o={id:s,data:a};return this.nodes[s]=o,o}removeNode(a){delete this.nodes[a.id],this.edges=this.edges.filter(i=>i.source!==a.id&&i.target!==a.id)}addEdge(a,i,s){if(void 0===this.nodes[a.id])throw Error(`Source node ${a.id} not in graph`);if(void 0===this.nodes[i.id])throw Error(`Target node ${i.id} not in graph`);let o={source:a.id,target:i.id,data:s};return this.edges.push(o),o}firstNode(){let a=new Set(this.edges.map(a=>a.target)),i=[];return Object.values(this.nodes).forEach(s=>{a.has(s.id)||i.push(s)}),i[0]}lastNode(){let a=new Set(this.edges.map(a=>a.source)),i=[];return Object.values(this.nodes).forEach(s=>{a.has(s.id)||i.push(s)}),i[0]}extend(a){Object.entries(a.nodes).forEach(([a,i])=>{this.nodes[a]=i}),this.edges=[...this.edges,...a.edges]}trimFirstNode(){let a=this.firstNode();if(a){let i=this.edges.filter(i=>i.source===a.id);(1===Object.keys(this.nodes).length||1===i.length)&&this.removeNode(a)}}trimLastNode(){let a=this.lastNode();if(a){let i=this.edges.filter(i=>i.target===a.id);(1===Object.keys(this.nodes).length||1===i.length)&&this.removeNode(a)}}};function _coerceToDict(a,i){return!a||Array.isArray(a)||a instanceof Date||"object"!=typeof a?{[i]:a}:a}let Runnable=class Runnable extends R.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(a){let i=this.name??this.constructor.lc_name()??this.constructor.name;return a?`${i}${a}`:i}bind(a){return new RunnableBinding({bound:this,kwargs:a,config:{}})}map(){return new RunnableEach({bound:this})}withRetry(a){return new RunnableRetry({bound:this,kwargs:{},config:{},maxAttemptNumber:a?.stopAfterAttempt,...a})}withConfig(a){return new RunnableBinding({bound:this,config:a,kwargs:{}})}withFallbacks(a){return new RunnableWithFallbacks({runnable:this,fallbacks:a.fallbacks})}_getOptionsList(a,i=0){if(Array.isArray(a)&&a.length!==i)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${a.length} options for ${i} inputs`);if(Array.isArray(a))return a.map(j.LE);if(i>1&&!Array.isArray(a)&&a.runId){console.warn("Provided runId will be used only for the first element of the batch.");let s=Object.fromEntries(Object.entries(a).filter(([a])=>"runId"!==a));return Array.from({length:i},(i,o)=>(0,j.LE)(0===o?a:s))}return Array.from({length:i},()=>(0,j.LE)(a))}async batch(a,i,s){let o=this._getOptionsList(i??{},a.length),c=o[0]?.maxConcurrency??s?.maxConcurrency,w=new $.L({maxConcurrency:c,onFailedAttempt:a=>{throw a}}),P=a.map((a,i)=>w.call(async()=>{try{let s=await this.invoke(a,o[i]);return s}catch(a){if(s?.returnExceptions)return a;throw a}}));return Promise.all(P)}async *_streamIterator(a,i){yield this.invoke(a,i)}async stream(a,i){let s=new x.qq(this._streamIterator(a,(0,j.LE)(i)));return await s.setup,x.QJ.fromAsyncGenerator(s)}_separateRunnableConfigFromCallOptions(a){let i;i=void 0===a?(0,j.LE)(a):(0,j.LE)({callbacks:a.callbacks,tags:a.tags,metadata:a.metadata,runName:a.runName,configurable:a.configurable,recursionLimit:a.recursionLimit,maxConcurrency:a.maxConcurrency,runId:a.runId});let s={...a};return delete s.callbacks,delete s.tags,delete s.metadata,delete s.runName,delete s.configurable,delete s.recursionLimit,delete s.maxConcurrency,delete s.runId,[i,s]}async _callWithConfig(a,i,s){let o;let c=(0,j.LE)(s),w=await (0,j.Le)(c),P=await w?.handleChainStart(this.toJSON(),_coerceToDict(i,"input"),c.runId,c?.runType,void 0,void 0,c?.runName??this.getName());delete c.runId;try{o=await a.call(this,i,c,P)}catch(a){throw await P?.handleChainError(a),a}return await P?.handleChainEnd(_coerceToDict(o,"output")),o}async _batchWithConfig(a,i,s,o){let c;let w=this._getOptionsList(s??{},i.length),P=await Promise.all(w.map(j.Le)),A=await Promise.all(P.map(async(a,s)=>{let o=await a?.handleChainStart(this.toJSON(),_coerceToDict(i[s],"input"),w[s].runId,w[s].runType,void 0,void 0,w[s].runName??this.getName());return delete w[s].runId,o}));try{c=await a.call(this,i,w,A,o)}catch(a){throw await Promise.all(A.map(i=>i?.handleChainError(a))),a}return await Promise.all(A.map(a=>a?.handleChainEnd(_coerceToDict(c,"output")))),c}async *_transformStreamWithConfig(a,i,s){let o,c,w;let P=!0,A=!0,k=(0,j.LE)(s),R=await (0,j.Le)(k);async function*wrapInputForTracing(){for await(let i of a){if(P){if(void 0===o)o=i;else try{o=(0,x.zo)(o,i)}catch{o=void 0,P=!1}}yield i}}try{let a=await (0,x.E7)(i.bind(this),wrapInputForTracing(),async()=>R?.handleChainStart(this.toJSON(),{input:""},k.runId,k.runType,void 0,void 0,k.runName??this.getName()),k);delete k.runId,w=a.setup;let s=w?.handlers.find(a=>"log_stream_tracer"===a.name),o=a.output;for await(let i of(void 0!==s&&void 0!==w&&(o=await s.tapOutputIterable(w.runId,a.output)),o))if(yield i,A){if(void 0===c)c=i;else try{c=(0,x.zo)(c,i)}catch{c=void 0,A=!1}}}catch(a){throw await w?.handleChainError(a,void 0,void 0,void 0,{inputs:_coerceToDict(o,"input")}),a}await w?.handleChainEnd(c??{},void 0,void 0,void 0,{inputs:_coerceToDict(o,"input")})}getGraph(a){let i=new Graph,s=i.addNode({name:`${this.getName()}Input`,schema:o.z.any()}),c=i.addNode(this),w=i.addNode({name:`${this.getName()}Output`,schema:o.z.any()});return i.addEdge(s,c),i.addEdge(c,w),i}pipe(a){return new RunnableSequence({first:this,last:_coerceToRunnable(a)})}pick(a){return this.pipe(new RunnablePick(a))}assign(a){return this.pipe(new RunnableAssign(new RunnableMap({steps:a})))}async *transform(a,i){let s;for await(let i of a)s=void 0===s?i:(0,x.zo)(s,i);yield*this._streamIterator(s,(0,j.LE)(i))}async *streamLog(a,i,s){let o=new LogStreamCallbackHandler({...s,autoClose:!1,_schemaFormat:"original"}),c=(0,j.LE)(i);yield*this._streamLog(a,o,c)}async *_streamLog(a,i,s){let{callbacks:o}=s;if(void 0===o)s.callbacks=[i];else if(Array.isArray(o))s.callbacks=o.concat([i]);else{let a=o.copy();a.inheritableHandlers.push(i),s.callbacks=a}let c=this.stream(a,s);async function consumeRunnableStream(){try{let a=await c;for await(let s of a){let a=new RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:s}]});await i.writer.write(a)}}finally{await i.writer.close()}}let w=consumeRunnableStream();try{for await(let a of i)yield a}finally{await w}}async *streamEvents(a,i,s){let o;if("v1"!==i.version)throw Error('Only version "v1" of the events schema is currently supported.');let c=!1,w=(0,j.LE)(i),P=w.tags??[],A=w.metadata??{},x=w.runName??this.getName(),k=new LogStreamCallbackHandler({...s,autoClose:!1,_schemaFormat:"streaming_events"}),R=new _RootEventFilter({...s}),$=this._streamLog(a,k,w);for await(let i of $){if(void 0===(o=o?o.concat(i):RunLog.fromRunLogPatch(i)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!c){c=!0;let i={...o.state},s={run_id:i.id,event:`on_${i.type}_start`,name:x,tags:P,metadata:A,data:{input:a}};R.includeEvent(s,i.type)&&(yield s)}let s=i.ops.filter(a=>a.path.startsWith("/logs/")).map(a=>a.path.split("/")[2]),w=[...new Set(s)];for(let a of w){let i;let s={},c=o.state.logs[a];if("start"==(i=void 0===c.end_time?c.streamed_output.length>0?"stream":"start":"end"))void 0!==c.inputs&&(s.input=c.inputs);else if("end"===i)void 0!==c.inputs&&(s.input=c.inputs),s.output=c.final_output;else if("stream"===i){let a=c.streamed_output.length;if(1!==a)throw Error(`Expected exactly one chunk of streamed output, got ${a} instead. Encountered in: "${c.name}"`);s={chunk:c.streamed_output[0]},c.streamed_output=[]}yield{event:`on_${c.type}_${i}`,name:c.name,run_id:c.id,tags:c.tags,metadata:c.metadata,data:s}}let{state:k}=o;if(k.streamed_output.length>0){let a=k.streamed_output.length;if(1!==a)throw Error(`Expected exactly one chunk of streamed output, got ${a} instead. Encountered in: "${k.name}"`);let i={chunk:k.streamed_output[0]};k.streamed_output=[];let s={event:`on_${k.type}_stream`,run_id:k.id,tags:P,metadata:A,name:x,data:i};R.includeEvent(s,k.type)&&(yield s)}}let B=o?.state;if(void 0!==B){let a={event:`on_${B.type}_end`,name:x,run_id:B.id,tags:P,metadata:A,data:{output:B.final_output}};R.includeEvent(a,B.type)&&(yield a)}}static isRunnable(a){return utils_isRunnableInterface(a)}withListeners({onStart:a,onEnd:i,onError:s}){return new RunnableBinding({bound:this,config:{},configFactories:[o=>({callbacks:[new RootListenersTracer({config:o,onStart:a,onEnd:i,onError:s})]})]})}};let RunnableBinding=class RunnableBinding extends Runnable{static lc_name(){return"RunnableBinding"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=a.bound,this.kwargs=a.kwargs,this.config=a.config,this.configFactories=a.configFactories}getName(a){return this.bound.getName(a)}async _mergeConfig(...a){let i=(0,j.t8)(this.config,...a);return(0,j.t8)(i,...this.configFactories?await Promise.all(this.configFactories.map(async a=>await a(i))):[])}bind(a){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...a},config:this.config})}withConfig(a){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...a}})}withRetry(a){return new this.constructor({bound:this.bound.withRetry(a),kwargs:this.kwargs,config:this.config})}async invoke(a,i){return this.bound.invoke(a,await this._mergeConfig((0,j.LE)(i),this.kwargs))}async batch(a,i,s){let o=Array.isArray(i)?await Promise.all(i.map(async a=>this._mergeConfig((0,j.LE)(a),this.kwargs))):await this._mergeConfig((0,j.LE)(i),this.kwargs);return this.bound.batch(a,o,s)}async *_streamIterator(a,i){yield*this.bound._streamIterator(a,await this._mergeConfig((0,j.LE)(i),this.kwargs))}async stream(a,i){return this.bound.stream(a,await this._mergeConfig((0,j.LE)(i),this.kwargs))}async *transform(a,i){yield*this.bound.transform(a,await this._mergeConfig((0,j.LE)(i),this.kwargs))}async *streamEvents(a,i,s){yield*this.bound.streamEvents(a,{...await this._mergeConfig((0,j.LE)(i),this.kwargs),version:i.version},s)}static isRunnableBinding(a){return a.bound&&Runnable.isRunnable(a.bound)}withListeners({onStart:a,onEnd:i,onError:s}){return new RunnableBinding({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[o=>({callbacks:[new RootListenersTracer({config:o,onStart:a,onEnd:i,onError:s})]})]})}};let RunnableEach=class RunnableEach extends Runnable{static lc_name(){return"RunnableEach"}constructor(a){super(a),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=a.bound}bind(a){return new RunnableEach({bound:this.bound.bind(a)})}async invoke(a,i){return this._callWithConfig(this._invoke,a,i)}async _invoke(a,i,s){return this.bound.batch(a,(0,j.q)(i,{callbacks:s?.getChild()}))}withListeners({onStart:a,onEnd:i,onError:s}){return new RunnableEach({bound:this.bound.withListeners({onStart:a,onEnd:i,onError:s})})}};let RunnableRetry=class RunnableRetry extends RunnableBinding{static lc_name(){return"RunnableRetry"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=a.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=a.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(a,i,s){let o=a>1?`retry:attempt:${a}`:void 0;return(0,j.q)(i,{callbacks:s?.getChild(o)})}async _invoke(a,i,s){return c(o=>super.invoke(a,this._patchConfigForRetry(o,i,s)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(a,i){return this._callWithConfig(this._invoke,a,i)}async _batch(a,i,s,o){let w={};try{await c(async c=>{let P;let A=a.map((a,i)=>i).filter(a=>void 0===w[a.toString()]||w[a.toString()]instanceof Error),x=A.map(i=>a[i]),k=A.map(a=>this._patchConfigForRetry(c,i?.[a],s?.[a])),R=await super.batch(x,k,{...o,returnExceptions:!0});for(let a=0;a<R.length;a+=1){let i=R[a],s=A[a];i instanceof Error&&void 0===P&&(P=i),w[s.toString()]=i}if(P)throw P;return R},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(a){if(o?.returnExceptions!==!0)throw a}return Object.keys(w).sort((a,i)=>parseInt(a,10)-parseInt(i,10)).map(a=>w[parseInt(a,10)])}async batch(a,i,s){return this._batchWithConfig(this._batch.bind(this),a,i,s)}};let RunnableSequence=class RunnableSequence extends Runnable{static lc_name(){return"RunnableSequence"}constructor(a){super(a),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=a.first,this.middle=a.middle??this.middle,this.last=a.last,this.name=a.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(a,i){let s;let o=(0,j.LE)(i),c=await (0,j.Le)(o),w=await c?.handleChainStart(this.toJSON(),_coerceToDict(a,"input"),o.runId,void 0,void 0,void 0,o?.runName);delete o.runId;let P=a;try{let a=[this.first,...this.middle];for(let i=0;i<a.length;i+=1){let s=a[i];P=await s.invoke(P,(0,j.q)(o,{callbacks:w?.getChild(`seq:step:${i+1}`)}))}s=await this.last.invoke(P,(0,j.q)(o,{callbacks:w?.getChild(`seq:step:${this.steps.length}`)}))}catch(a){throw await w?.handleChainError(a),a}return await w?.handleChainEnd(_coerceToDict(s,"output")),s}async batch(a,i,s){let o=this._getOptionsList(i??{},a.length),c=await Promise.all(o.map(j.Le)),w=await Promise.all(c.map(async(i,s)=>{let c=await i?.handleChainStart(this.toJSON(),_coerceToDict(a[s],"input"),o[s].runId,void 0,void 0,void 0,o[s].runName);return delete o[s].runId,c})),P=a;try{for(let a=0;a<this.steps.length;a+=1){let i=this.steps[a];P=await i.batch(P,w.map((i,s)=>{let c=i?.getChild(`seq:step:${a+1}`);return(0,j.q)(o[s],{callbacks:c})}),s)}}catch(a){throw await Promise.all(w.map(i=>i?.handleChainError(a))),a}return await Promise.all(w.map(a=>a?.handleChainEnd(_coerceToDict(P,"output")))),P}async *_streamIterator(a,i){let s;let o=await (0,j.Le)(i),{runId:c,...w}=i??{},P=await o?.handleChainStart(this.toJSON(),_coerceToDict(a,"input"),c,void 0,void 0,void 0,w?.runName),A=[this.first,...this.middle,this.last],k=!0;async function*inputGenerator(){yield a}try{let a=A[0].transform(inputGenerator(),(0,j.q)(w,{callbacks:P?.getChild("seq:step:1")}));for(let i=1;i<A.length;i+=1){let s=A[i];a=await s.transform(a,(0,j.q)(w,{callbacks:P?.getChild(`seq:step:${i+1}`)}))}for await(let i of a)if(yield i,k){if(void 0===s)s=i;else try{s=(0,x.zo)(s,i)}catch(a){s=void 0,k=!1}}}catch(a){throw await P?.handleChainError(a),a}await P?.handleChainEnd(_coerceToDict(s,"output"))}getGraph(a){let i=new Graph,s=null;return this.steps.forEach((o,c)=>{let w=o.getGraph(a);0!==c&&w.trimFirstNode(),c!==this.steps.length-1&&w.trimLastNode(),i.extend(w);let P=w.firstNode();if(!P)throw Error(`Runnable ${o} has no first node`);s&&i.addEdge(s,P),s=w.lastNode()}),i}pipe(a){return new RunnableSequence(RunnableSequence.isRunnableSequence(a)?{first:this.first,middle:this.middle.concat([this.last,a.first,...a.middle]),last:a.last,name:this.name??a.name}:{first:this.first,middle:[...this.middle,this.last],last:_coerceToRunnable(a),name:this.name})}static isRunnableSequence(a){return Array.isArray(a.middle)&&Runnable.isRunnable(a)}static from([a,...i],s){return new RunnableSequence({first:_coerceToRunnable(a),middle:i.slice(0,-1).map(_coerceToRunnable),last:_coerceToRunnable(i[i.length-1]),name:s})}};let RunnableMap=class RunnableMap extends Runnable{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(a){for(let[i,s]of(super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(a.steps)))this.steps[i]=_coerceToRunnable(s)}static from(a){return new RunnableMap({steps:a})}async invoke(a,i){let s=(0,j.LE)(i),o=await (0,j.Le)(s),c=await o?.handleChainStart(this.toJSON(),{input:a},s.runId,void 0,void 0,void 0,s?.runName);delete s.runId;let w={};try{await Promise.all(Object.entries(this.steps).map(async([i,o])=>{w[i]=await o.invoke(a,(0,j.q)(s,{callbacks:c?.getChild(`map:key:${i}`)}))}))}catch(a){throw await c?.handleChainError(a),a}return await c?.handleChainEnd(w),w}async *_transform(a,i,s){let o={...this.steps},c=(0,x.y2)(a,Object.keys(o).length),w=new Map(Object.entries(o).map(([a,o],w)=>{let P=o.transform(c[w],(0,j.q)(s,{callbacks:i?.getChild(`map:key:${a}`)}));return[a,P.next().then(i=>({key:a,gen:P,result:i}))]}));for(;w.size;){let{key:a,result:i,gen:s}=await Promise.race(w.values());w.delete(a),i.done||(yield{[a]:i.value},w.set(a,s.next().then(i=>({key:a,gen:s,result:i}))))}}transform(a,i){return this._transformStreamWithConfig(a,this._transform.bind(this),i)}async stream(a,i){async function*generator(){yield a}let s=new x.qq(this.transform(generator(),i));return await s.setup,x.QJ.fromAsyncGenerator(s)}};let RunnableLambda=class RunnableLambda extends Runnable{static lc_name(){return"RunnableLambda"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=a.func}static from(a){return new RunnableLambda({func:a})}async _invoke(a,i,s){return new Promise((o,c)=>{let w=(0,j.q)(i,{callbacks:s?.getChild(),recursionLimit:(i?.recursionLimit??j.ov)-1});B.A.getInstance().run(w,async()=>{try{let s=await this.func(a,{...w,config:w});if(s&&Runnable.isRunnable(s)){if(i?.recursionLimit===0)throw Error("Recursion limit reached.");s=await s.invoke(a,{...w,recursionLimit:(w.recursionLimit??j.ov)-1})}o(s)}catch(a){c(a)}})})}async invoke(a,i){return this._callWithConfig(this._invoke,a,i)}async *_transform(a,i,s){let o;for await(let i of a)if(void 0===o)o=i;else try{o=(0,x.zo)(o,i)}catch(a){o=i}let c=await new Promise((a,i)=>{B.A.getInstance().run(s,async()=>{try{let i=await this.func(o,{...s,config:s});a(i)}catch(a){i(a)}})});if(c&&Runnable.isRunnable(c)){if(s?.recursionLimit===0)throw Error("Recursion limit reached.");let a=await c.stream(o,(0,j.q)(s,{callbacks:i?.getChild(),recursionLimit:(s?.recursionLimit??j.ov)-1}));for await(let i of a)yield i}else yield c}transform(a,i){return this._transformStreamWithConfig(a,this._transform.bind(this),i)}async stream(a,i){async function*generator(){yield a}let s=new x.qq(this.transform(generator(),i));return await s.setup,x.QJ.fromAsyncGenerator(s)}};let RunnableWithFallbacks=class RunnableWithFallbacks extends Runnable{static lc_name(){return"RunnableWithFallbacks"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=a.runnable,this.fallbacks=a.fallbacks}*runnables(){for(let a of(yield this.runnable,this.fallbacks))yield a}async invoke(a,i){let s;let o=await w.Ye.configure(i?.callbacks,void 0,i?.tags,void 0,i?.metadata),{runId:c,...P}=i??{},A=await o?.handleChainStart(this.toJSON(),_coerceToDict(a,"input"),c,void 0,void 0,void 0,P?.runName);for(let i of this.runnables())try{let s=await i.invoke(a,(0,j.q)(P,{callbacks:A?.getChild()}));return await A?.handleChainEnd(_coerceToDict(s,"output")),s}catch(a){void 0===s&&(s=a)}if(void 0===s)throw Error("No error stored at end of fallback.");throw await A?.handleChainError(s),s}async batch(a,i,s){let o;if(s?.returnExceptions)throw Error("Not implemented.");let c=this._getOptionsList(i??{},a.length),P=await Promise.all(c.map(a=>w.Ye.configure(a?.callbacks,void 0,a?.tags,void 0,a?.metadata))),A=await Promise.all(P.map(async(i,s)=>{let o=await i?.handleChainStart(this.toJSON(),_coerceToDict(a[s],"input"),c[s].runId,void 0,void 0,void 0,c[s].runName);return delete c[s].runId,o}));for(let i of this.runnables())try{let o=await i.batch(a,A.map((a,i)=>(0,j.q)(c[i],{callbacks:a?.getChild()})),s);return await Promise.all(A.map((a,i)=>a?.handleChainEnd(_coerceToDict(o[i],"output")))),o}catch(a){void 0===o&&(o=a)}if(!o)throw Error("No error stored at end of fallbacks.");throw await Promise.all(A.map(a=>a?.handleChainError(o))),o}};function _coerceToRunnable(a){if("function"==typeof a)return new RunnableLambda({func:a});if(Runnable.isRunnable(a))return a;if(Array.isArray(a)||"object"!=typeof a)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let i={};for(let[s,o]of Object.entries(a))i[s]=_coerceToRunnable(o);return new RunnableMap({steps:i})}}let RunnableAssign=class RunnableAssign extends Runnable{static lc_name(){return"RunnableAssign"}constructor(a){a instanceof RunnableMap&&(a={mapper:a}),super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=a.mapper}async invoke(a,i){let s=await this.mapper.invoke(a,i);return{...a,...s}}async *_transform(a,i,s){let o=this.mapper.getStepsKeys(),[c,w]=(0,x.y2)(a),P=this.mapper.transform(w,(0,j.q)(s,{callbacks:i?.getChild()})),A=P.next();for await(let a of c){if("object"!=typeof a||Array.isArray(a))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof a}`);let i=Object.fromEntries(Object.entries(a).filter(([a])=>!o.includes(a)));Object.keys(i).length>0&&(yield i)}for await(let a of(yield(await A).value,P))yield a}transform(a,i){return this._transformStreamWithConfig(a,this._transform.bind(this),i)}async stream(a,i){async function*generator(){yield a}let s=new x.qq(this.transform(generator(),i));return await s.setup,x.QJ.fromAsyncGenerator(s)}};let RunnablePick=class RunnablePick extends Runnable{static lc_name(){return"RunnablePick"}constructor(a){("string"==typeof a||Array.isArray(a))&&(a={keys:a}),super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=a.keys}async _pick(a){if("string"==typeof this.keys)return a[this.keys];{let i=this.keys.map(i=>[i,a[i]]).filter(a=>void 0!==a[1]);return 0===i.length?void 0:Object.fromEntries(i)}}async invoke(a,i){return this._callWithConfig(this._pick.bind(this),a,i)}async *_transform(a){for await(let i of a){let a=await this._pick(i);void 0!==a&&(yield a)}}transform(a,i){return this._transformStreamWithConfig(a,this._transform.bind(this),i)}async stream(a,i){async function*generator(){yield a}let s=new x.qq(this.transform(generator(),i));return await s.setup,x.QJ.fromAsyncGenerator(s)}}},9189:function(a,i,s){"use strict";s.d(i,{LE:function(){return ensureConfig},Le:function(){return getCallbackManagerForConfig},ov:function(){return w},q:function(){return patchConfig},t8:function(){return mergeConfigs}});var o=s(7018),c=s(5051);let w=25;async function getCallbackManagerForConfig(a){return o.Ye.configure(a?.callbacks,void 0,a?.tags,void 0,a?.metadata)}function mergeConfigs(...a){let i={};for(let s of a.filter(a=>!!a))for(let a of Object.keys(s))if("metadata"===a)i[a]={...i[a],...s[a]};else if("tags"===a){let o=i[a]??[];i[a]=[...new Set(o.concat(s[a]??[]))]}else if("configurable"===a)i[a]={...i[a],...s[a]};else if("callbacks"===a){let a=i.callbacks,c=s.callbacks;if(Array.isArray(c)){if(a){if(Array.isArray(a))i.callbacks=a.concat(c);else{let s=a.copy();for(let a of c)s.addHandler((0,o.xz)(a),!0);i.callbacks=s}}else i.callbacks=c}else if(c){if(a){if(Array.isArray(a)){let s=c.copy();for(let i of a)s.addHandler((0,o.xz)(i),!0);i.callbacks=s}else i.callbacks=new o.Ye(c._parentRunId,{handlers:a.handlers.concat(c.handlers),inheritableHandlers:a.inheritableHandlers.concat(c.inheritableHandlers),tags:Array.from(new Set(a.tags.concat(c.tags))),inheritableTags:Array.from(new Set(a.inheritableTags.concat(c.inheritableTags))),metadata:{...a.metadata,...c.metadata}})}else i.callbacks=c}}else i[a]=s[a]??i[a];return i}let P=new Set(["string","number","boolean"]);function ensureConfig(a){let i=a??c.A.getInstance().getStore(),s={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(i&&(s={...s,...i}),i?.configurable)for(let a of Object.keys(i.configurable))P.has(typeof i.configurable[a])&&!s.metadata?.[a]&&(s.metadata||(s.metadata={}),s.metadata[a]=i.configurable[a]);return s}function patchConfig(a={},{callbacks:i,maxConcurrency:s,recursionLimit:o,runName:c,configurable:w,runId:P}={}){let A=ensureConfig(a);return void 0!==i&&(delete A.runName,A.callbacks=i),void 0!==o&&(A.recursionLimit=o),void 0!==s&&(A.maxConcurrency=s),void 0!==c&&(A.runName=c),void 0!==w&&(A.configurable={...A.configurable,...w}),void 0!==P&&delete A.runId,A}},986:function(a,i,s){"use strict";s.d(i,{eq:function(){return o.eq},sk:function(){return passthrough_RunnablePassthrough},lW:function(){return o.lW},LE:function(){return c.LE},q:function(){return c.q}});var o=s(8477),c=s(9189),w=s(2272);let passthrough_RunnablePassthrough=class passthrough_RunnablePassthrough extends o.eq{static lc_name(){return"RunnablePassthrough"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),a&&(this.func=a.func)}async invoke(a,i){let s=(0,c.LE)(i);return this.func&&await this.func(a,s),this._callWithConfig(a=>Promise.resolve(a),a,s)}async *transform(a,i){let s;let o=(0,c.LE)(i),P=!0;for await(let i of this._transformStreamWithConfig(a,a=>a,o))if(yield i,P){if(void 0===s)s=i;else try{s=(0,w.zo)(s,i)}catch{s=void 0,P=!1}}this.func&&void 0!==s&&await this.func(s,o)}static assign(a){return new o.Vh(new o.dT({steps:a}))}};s(3478)},5051:function(a,i,s){"use strict";s.d(i,{A:function(){return o}});let MockAsyncLocalStorage=class MockAsyncLocalStorage{getStore(){}run(a,i){i()}};let AsyncLocalStorageProvider=class AsyncLocalStorageProvider{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new MockAsyncLocalStorage}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(a){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=a)}};let o=new AsyncLocalStorageProvider},1448:function(a,i,s){"use strict";s.d(i,{Z:function(){return BaseTracer}});var o=s(2713);function _coerceToDict(a,i){return a&&!Array.isArray(a)&&"object"==typeof a?a:{[i]:a}}function stripNonAlphanumeric(a){return a.replace(/[-:.]/g,"")}function convertToDottedOrderFormat(a,i){return stripNonAlphanumeric(`${new Date(a).toISOString().slice(0,-1)}000Z`)+i}let BaseTracer=class BaseTracer extends o.E{constructor(a){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(a){return a instanceof Error?a.message+(a?.stack?`

${a.stack}`:""):"string"==typeof a?a:`${a}`}_addChildRun(a,i){a.child_runs.push(i)}async _startTrace(a){let i=convertToDottedOrderFormat(a.start_time,a.id),s={...a};if(void 0!==s.parent_run_id){let a=this.runMap.get(s.parent_run_id);a&&(this._addChildRun(a,s),a.child_execution_order=Math.max(a.child_execution_order,s.child_execution_order),s.trace_id=a.trace_id,void 0!==a.dotted_order&&(s.dotted_order=[a.dotted_order,i].join(".")))}else s.trace_id=s.id,s.dotted_order=i;this.runMap.set(s.id,s),await this.onRunCreate?.(s)}async _endTrace(a){let i=void 0!==a.parent_run_id&&this.runMap.get(a.parent_run_id);i?i.child_execution_order=Math.max(i.child_execution_order,a.child_execution_order):await this.persistRun(a),this.runMap.delete(a.id),await this.onRunUpdate?.(a)}_getExecutionOrder(a){let i=void 0!==a&&this.runMap.get(a);return i?i.child_execution_order+1:1}async handleLLMStart(a,i,s,o,c,w,P,A){let x=this._getExecutionOrder(o),k=Date.now(),R=P?{...c,metadata:P}:c,j={id:s,name:A??a.id[a.id.length-1],parent_run_id:o,start_time:k,serialized:a,events:[{name:"start",time:new Date(k).toISOString()}],inputs:{prompts:i},execution_order:x,child_runs:[],child_execution_order:x,run_type:"llm",extra:R??{},tags:w||[]};return await this._startTrace(j),await this.onLLMStart?.(j),j}async handleChatModelStart(a,i,s,o,c,w,P,A){let x=this._getExecutionOrder(o),k=Date.now(),R=P?{...c,metadata:P}:c,j={id:s,name:A??a.id[a.id.length-1],parent_run_id:o,start_time:k,serialized:a,events:[{name:"start",time:new Date(k).toISOString()}],inputs:{messages:i},execution_order:x,child_runs:[],child_execution_order:x,run_type:"llm",extra:R??{},tags:w||[]};return await this._startTrace(j),await this.onLLMStart?.(j),j}async handleLLMEnd(a,i){let s=this.runMap.get(i);if(!s||s?.run_type!=="llm")throw Error("No LLM run to end.");return s.end_time=Date.now(),s.outputs=a,s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),await this.onLLMEnd?.(s),await this._endTrace(s),s}async handleLLMError(a,i){let s=this.runMap.get(i);if(!s||s?.run_type!=="llm")throw Error("No LLM run to end.");return s.end_time=Date.now(),s.error=this.stringifyError(a),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),await this.onLLMError?.(s),await this._endTrace(s),s}async handleChainStart(a,i,s,o,c,w,P,A){let x=this._getExecutionOrder(o),k=Date.now(),R={id:s,name:A??a.id[a.id.length-1],parent_run_id:o,start_time:k,serialized:a,events:[{name:"start",time:new Date(k).toISOString()}],inputs:i,execution_order:x,child_execution_order:x,run_type:P??"chain",child_runs:[],extra:w?{metadata:w}:{},tags:c||[]};return await this._startTrace(R),await this.onChainStart?.(R),R}async handleChainEnd(a,i,s,o,c){let w=this.runMap.get(i);if(!w)throw Error("No chain run to end.");return w.end_time=Date.now(),w.outputs=_coerceToDict(a,"output"),w.events.push({name:"end",time:new Date(w.end_time).toISOString()}),c?.inputs!==void 0&&(w.inputs=_coerceToDict(c.inputs,"input")),await this.onChainEnd?.(w),await this._endTrace(w),w}async handleChainError(a,i,s,o,c){let w=this.runMap.get(i);if(!w)throw Error("No chain run to end.");return w.end_time=Date.now(),w.error=this.stringifyError(a),w.events.push({name:"error",time:new Date(w.end_time).toISOString()}),c?.inputs!==void 0&&(w.inputs=_coerceToDict(c.inputs,"input")),await this.onChainError?.(w),await this._endTrace(w),w}async handleToolStart(a,i,s,o,c,w,P){let A=this._getExecutionOrder(o),x=Date.now(),k={id:s,name:P??a.id[a.id.length-1],parent_run_id:o,start_time:x,serialized:a,events:[{name:"start",time:new Date(x).toISOString()}],inputs:{input:i},execution_order:A,child_execution_order:A,run_type:"tool",child_runs:[],extra:w?{metadata:w}:{},tags:c||[]};return await this._startTrace(k),await this.onToolStart?.(k),k}async handleToolEnd(a,i){let s=this.runMap.get(i);if(!s||s?.run_type!=="tool")throw Error("No tool run to end");return s.end_time=Date.now(),s.outputs={output:a},s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),await this.onToolEnd?.(s),await this._endTrace(s),s}async handleToolError(a,i){let s=this.runMap.get(i);if(!s||s?.run_type!=="tool")throw Error("No tool run to end");return s.end_time=Date.now(),s.error=this.stringifyError(a),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),await this.onToolError?.(s),await this._endTrace(s),s}async handleAgentAction(a,i){let s=this.runMap.get(i);s&&s?.run_type==="chain"&&(s.actions=s.actions||[],s.actions.push(a),s.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:a}}),await this.onAgentAction?.(s))}async handleAgentEnd(a,i){let s=this.runMap.get(i);s&&s?.run_type==="chain"&&(s.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:a}}),await this.onAgentEnd?.(s))}async handleRetrieverStart(a,i,s,o,c,w,P){let A=this._getExecutionOrder(o),x=Date.now(),k={id:s,name:P??a.id[a.id.length-1],parent_run_id:o,start_time:x,serialized:a,events:[{name:"start",time:new Date(x).toISOString()}],inputs:{query:i},execution_order:A,child_execution_order:A,run_type:"retriever",child_runs:[],extra:w?{metadata:w}:{},tags:c||[]};return await this._startTrace(k),await this.onRetrieverStart?.(k),k}async handleRetrieverEnd(a,i){let s=this.runMap.get(i);if(!s||s?.run_type!=="retriever")throw Error("No retriever run to end");return s.end_time=Date.now(),s.outputs={documents:a},s.events.push({name:"end",time:new Date(s.end_time).toISOString()}),await this.onRetrieverEnd?.(s),await this._endTrace(s),s}async handleRetrieverError(a,i){let s=this.runMap.get(i);if(!s||s?.run_type!=="retriever")throw Error("No retriever run to end");return s.end_time=Date.now(),s.error=this.stringifyError(a),s.events.push({name:"error",time:new Date(s.end_time).toISOString()}),await this.onRetrieverError?.(s),await this._endTrace(s),s}async handleText(a,i){let s=this.runMap.get(i);s&&s?.run_type==="chain"&&(s.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:a}}),await this.onText?.(s))}async handleLLMNewToken(a,i,s,o,c,w){let P=this.runMap.get(s);if(!P||P?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return P.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:a,idx:i,chunk:w?.chunk}}),await this.onLLMNewToken?.(P,a,{chunk:w?.chunk}),P}}},3830:function(a,i,s){"use strict";s.d(i,{L:function(){return AsyncCaller}});var o=s(1018),c=s(4825);let w=[400,401,402,403,404,405,406,407,409],defaultFailedAttemptHandler=a=>{if(a.message.startsWith("Cancel")||a.message.startsWith("AbortError")||"AbortError"===a.name||a?.code==="ECONNABORTED")throw a;let i=a?.response?.status??a?.status;if(i&&w.includes(+i))throw a;if(a?.error?.code==="insufficient_quota"){let i=Error(a?.message);throw i.name="InsufficientQuotaError",i}};let AsyncCaller=class AsyncCaller{constructor(a){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=a.maxConcurrency??1/0,this.maxRetries=a.maxRetries??6,this.onFailedAttempt=a.onFailedAttempt??defaultFailedAttemptHandler;let i=c.default;this.queue=new i({concurrency:this.maxConcurrency})}call(a,...i){return this.queue.add(()=>o(()=>a(...i).catch(a=>{if(a instanceof Error)throw a;throw Error(a)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(a,i,...s){return a.signal?Promise.race([this.call(i,...s),new Promise((i,s)=>{a.signal?.addEventListener("abort",()=>{s(Error("AbortError"))})})]):this.call(i,...s)}fetch(...a){return this.call(()=>fetch(...a).then(a=>a.ok?a:Promise.reject(a)))}}},298:function(a,i,s){"use strict";let o;s.d(i,{lS:function(){return getEnvironmentVariable},sA:function(){return getRuntimeEnvironment}});var c=s(5656);let isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),isDeno=()=>"undefined"!=typeof Deno,isNode=()=>void 0!==c&&void 0!==c.versions&&void 0!==c.versions.node&&!isDeno(),getEnv=()=>isBrowser()?"browser":isNode()?"node":isWebWorker()?"webworker":isJsDom()?"jsdom":isDeno()?"deno":"other";async function getRuntimeEnvironment(){if(void 0===o){let a=getEnv();o={library:"langchain-js",runtime:a}}return o}function getEnvironmentVariable(a){try{return void 0!==c?c.env?.[a]:void 0}catch(a){return}}},6918:function(a,i,s){"use strict";s.d(i,{af:function(){return core_applyPatch},qu:function(){return compare}});var o={};s.r(o),s.d(o,{JsonPatchError:function(){return w},_areEquals:function(){return _areEquals},applyOperation:function(){return applyOperation},applyPatch:function(){return core_applyPatch},applyReducer:function(){return applyReducer},deepClone:function(){return P},getValueByPointer:function(){return getValueByPointer},validate:function(){return validate},validator:function(){return validator}});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */let c=Object.prototype.hasOwnProperty;function helpers_hasOwnProperty(a,i){return c.call(a,i)}function _objectKeys(a){if(Array.isArray(a)){let i=Array(a.length);for(let a=0;a<i.length;a++)i[a]=""+a;return i}if(Object.keys)return Object.keys(a);let i=[];for(let s in a)helpers_hasOwnProperty(a,s)&&i.push(s);return i}function helpers_deepClone(a){switch(typeof a){case"object":return JSON.parse(JSON.stringify(a));case"undefined":return null;default:return a}}function isInteger(a){let i,s=0,o=a.length;for(;s<o;){if((i=a.charCodeAt(s))>=48&&i<=57){s++;continue}return!1}return!0}function escapePathComponent(a){return -1===a.indexOf("/")&&-1===a.indexOf("~")?a:a.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapePathComponent(a){return a.replace(/~1/g,"/").replace(/~0/g,"~")}function hasUndefined(a){if(void 0===a)return!0;if(a){if(Array.isArray(a)){for(let i=0,s=a.length;i<s;i++)if(hasUndefined(a[i]))return!0}else if("object"==typeof a){let s=_objectKeys(a),o=s.length;for(var i=0;i<o;i++)if(hasUndefined(a[s[i]]))return!0}}return!1}function patchErrorMessageFormatter(a,i){let s=[a];for(let a in i){let o="object"==typeof i[a]?JSON.stringify(i[a],null,2):i[a];void 0!==o&&s.push(`${a}: ${o}`)}return s.join("\n")}let PatchError=class PatchError extends Error{constructor(a,i,s,o,c){super(patchErrorMessageFormatter(a,{name:i,index:s,operation:o,tree:c})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:o}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:c}),Object.setPrototypeOf(this,new.target.prototype),this.message=patchErrorMessageFormatter(a,{name:i,index:s,operation:o,tree:c})}};let w=PatchError,P=helpers_deepClone,A={add:function(a,i,s){return a[i]=this.value,{newDocument:s}},remove:function(a,i,s){var o=a[i];return delete a[i],{newDocument:s,removed:o}},replace:function(a,i,s){var o=a[i];return a[i]=this.value,{newDocument:s,removed:o}},move:function(a,i,s){let o=getValueByPointer(s,this.path);o&&(o=helpers_deepClone(o));let c=applyOperation(s,{op:"remove",path:this.from}).removed;return applyOperation(s,{op:"add",path:this.path,value:c}),{newDocument:s,removed:o}},copy:function(a,i,s){let o=getValueByPointer(s,this.from);return applyOperation(s,{op:"add",path:this.path,value:helpers_deepClone(o)}),{newDocument:s}},test:function(a,i,s){return{newDocument:s,test:_areEquals(a[i],this.value)}},_get:function(a,i,s){return this.value=a[i],{newDocument:s}}};var x={add:function(a,i,s){return isInteger(i)?a.splice(i,0,this.value):a[i]=this.value,{newDocument:s,index:i}},remove:function(a,i,s){return{newDocument:s,removed:a.splice(i,1)[0]}},replace:function(a,i,s){var o=a[i];return a[i]=this.value,{newDocument:s,removed:o}},move:A.move,copy:A.copy,test:A.test,_get:A._get};function getValueByPointer(a,i){if(""==i)return a;var s={op:"_get",path:i};return applyOperation(a,s),s.value}function applyOperation(a,i,s=!1,o=!0,c=!0,P=0){if(s&&("function"==typeof s?s(i,0,a,i.path):validator(i,0)),""===i.path){let o={newDocument:a};if("add"===i.op)return o.newDocument=i.value,o;if("replace"===i.op)return o.newDocument=i.value,o.removed=a,o;if("move"===i.op||"copy"===i.op)return o.newDocument=getValueByPointer(a,i.from),"move"===i.op&&(o.removed=a),o;if("test"===i.op){if(o.test=_areEquals(a,i.value),!1===o.test)throw new w("Test operation failed","TEST_OPERATION_FAILED",P,i,a);return o.newDocument=a,o}else{if("remove"===i.op)return o.removed=a,o.newDocument=null,o;if("_get"===i.op)return i.value=a,o;if(!s)return o;throw new w("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",P,i,a)}}{let k,R,j;o||(a=helpers_deepClone(a));let $=i.path||"",B=$.split("/"),D=a,Z=1,U=B.length;for(R="function"==typeof s?s:validator;;){if((k=B[Z])&&-1!=k.indexOf("~")&&(k=unescapePathComponent(k)),c&&("__proto__"==k||"prototype"==k&&Z>0&&"constructor"==B[Z-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(s&&void 0===j&&(void 0===D[k]?j=B.slice(0,Z).join("/"):Z==U-1&&(j=i.path),void 0!==j&&R(i,0,a,j)),Z++,Array.isArray(D)){if("-"===k)k=D.length;else{if(s&&!isInteger(k))throw new w("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",P,i,a);isInteger(k)&&(k=~~k)}if(Z>=U){if(s&&"add"===i.op&&k>D.length)throw new w("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",P,i,a);let o=x[i.op].call(i,D,k,a);if(!1===o.test)throw new w("Test operation failed","TEST_OPERATION_FAILED",P,i,a);return o}}else if(Z>=U){let s=A[i.op].call(i,D,k,a);if(!1===s.test)throw new w("Test operation failed","TEST_OPERATION_FAILED",P,i,a);return s}if(D=D[k],s&&Z<U&&(!D||"object"!=typeof D))throw new w("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",P,i,a)}}}function core_applyPatch(a,i,s,o=!0,c=!0){if(s&&!Array.isArray(i))throw new w("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");o||(a=helpers_deepClone(a));let P=Array(i.length);for(let o=0,w=i.length;o<w;o++)P[o]=applyOperation(a,i[o],s,!0,c,o),a=P[o].newDocument;return P.newDocument=a,P}function applyReducer(a,i,s){let o=applyOperation(a,i);if(!1===o.test)throw new w("Test operation failed","TEST_OPERATION_FAILED",s,i,a);return o.newDocument}function validator(a,i,s,o){if("object"!=typeof a||null===a||Array.isArray(a))throw new w("Operation is not an object","OPERATION_NOT_AN_OBJECT",i,a,s);if(A[a.op]){if("string"!=typeof a.path)throw new w("Operation `path` property is not a string","OPERATION_PATH_INVALID",i,a,s);if(0!==a.path.indexOf("/")&&a.path.length>0)throw new w('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",i,a,s);if(("move"===a.op||"copy"===a.op)&&"string"!=typeof a.from)throw new w("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",i,a,s);else if(("add"===a.op||"replace"===a.op||"test"===a.op)&&void 0===a.value)throw new w("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",i,a,s);else if(("add"===a.op||"replace"===a.op||"test"===a.op)&&hasUndefined(a.value))throw new w("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",i,a,s);else if(s){if("add"==a.op){var c=a.path.split("/").length,P=o.split("/").length;if(c!==P+1&&c!==P)throw new w("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",i,a,s)}else if("replace"===a.op||"remove"===a.op||"_get"===a.op){if(a.path!==o)throw new w("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",i,a,s)}else if("move"===a.op||"copy"===a.op){var x=validate([{op:"_get",path:a.from,value:void 0}],s);if(x&&"OPERATION_PATH_UNRESOLVABLE"===x.name)throw new w("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",i,a,s)}}}else throw new w("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",i,a,s)}function validate(a,i,s){try{if(!Array.isArray(a))throw new w("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(i)core_applyPatch(helpers_deepClone(i),helpers_deepClone(a),s||!0);else{s=s||validator;for(var o=0;o<a.length;o++)s(a[o],o,i,void 0)}}catch(a){if(a instanceof w)return a;throw a}}function _areEquals(a,i){if(a===i)return!0;if(a&&i&&"object"==typeof a&&"object"==typeof i){var s,o,c,w=Array.isArray(a),P=Array.isArray(i);if(w&&P){if((o=a.length)!=i.length)return!1;for(s=o;0!=s--;)if(!_areEquals(a[s],i[s]))return!1;return!0}if(w!=P)return!1;var A=Object.keys(a);if((o=A.length)!==Object.keys(i).length)return!1;for(s=o;0!=s--;)if(!i.hasOwnProperty(A[s]))return!1;for(s=o;0!=s--;)if(!_areEquals(a[c=A[s]],i[c]))return!1;return!0}return a!=a&&i!=i}function _generate(a,i,s,o,c){if(i!==a){"function"==typeof i.toJSON&&(i=i.toJSON());for(var w=_objectKeys(i),P=_objectKeys(a),A=!1,x=P.length-1;x>=0;x--){var k=P[x],R=a[k];if(helpers_hasOwnProperty(i,k)&&!(void 0===i[k]&&void 0!==R&&!1===Array.isArray(i))){var j=i[k];"object"==typeof R&&null!=R&&"object"==typeof j&&null!=j&&Array.isArray(R)===Array.isArray(j)?_generate(R,j,s,o+"/"+escapePathComponent(k),c):R!==j&&(c&&s.push({op:"test",path:o+"/"+escapePathComponent(k),value:helpers_deepClone(R)}),s.push({op:"replace",path:o+"/"+escapePathComponent(k),value:helpers_deepClone(j)}))}else Array.isArray(a)===Array.isArray(i)?(c&&s.push({op:"test",path:o+"/"+escapePathComponent(k),value:helpers_deepClone(R)}),s.push({op:"remove",path:o+"/"+escapePathComponent(k)}),A=!0):(c&&s.push({op:"test",path:o,value:a}),s.push({op:"replace",path:o,value:i}))}if(A||w.length!=P.length)for(var x=0;x<w.length;x++){var k=w[x];helpers_hasOwnProperty(a,k)||void 0===i[k]||s.push({op:"add",path:o+"/"+escapePathComponent(k),value:helpers_deepClone(i[k])})}}}function compare(a,i,s=!1){var o=[];return _generate(a,i,o,"",s),o}new WeakMap},2991:function(a,i,s){"use strict";function parseJsonMarkdown(a,i=parsePartialJson){a=a.trim();let s=/```(json)?(.*)```/s.exec(a);return i(s?s[2]:a)}function parsePartialJson(a){if(void 0===a)return null;try{return JSON.parse(a)}catch(a){}let i="",s=[],o=!1,c=!1;for(let w of a){if(o)'"'!==w||c?"\n"!==w||c?c="\\"===w&&!c:w="\\n":o=!1;else if('"'===w)o=!0,c=!1;else if("{"===w)s.push("}");else if("["===w)s.push("]");else if("}"===w||"]"===w){if(!s||s[s.length-1]!==w)return null;s.pop()}i+=w}o&&(i+='"');for(let a=s.length-1;a>=0;a-=1)i+=s[a];try{return JSON.parse(i)}catch(a){return null}}s.d(i,{M:function(){return parseJsonMarkdown},g:function(){return parsePartialJson}})},7578:function(a,i,s){"use strict";s.d(i,{q:function(){return o.qu}});var o=s(6918)},2272:function(a,i,s){"use strict";s.d(i,{E7:function(){return pipeGeneratorWithSetup},QJ:function(){return IterableReadableStream},qq:function(){return AsyncGeneratorWithSetup},y2:function(){return atee},zo:function(){return concat}});let IterableReadableStream=class IterableReadableStream extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let a=await this.reader.read();if(a.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:a.value}}catch(a){throw this.reader.releaseLock(),a}}async return(){if(this.ensureReader(),this.locked){let a=this.reader.cancel();this.reader.releaseLock(),await a}return{done:!0,value:void 0}}async throw(a){if(this.ensureReader(),this.locked){let a=this.reader.cancel();this.reader.releaseLock(),await a}throw a}[Symbol.asyncIterator](){return this}static fromReadableStream(a){let i=a.getReader();return new IterableReadableStream({start(a){return pump();function pump(){return i.read().then(({done:i,value:s})=>{if(i){a.close();return}return a.enqueue(s),pump()})}},cancel(){i.releaseLock()}})}static fromAsyncGenerator(a){return new IterableReadableStream({async pull(i){let{value:s,done:o}=await a.next();o&&i.close(),i.enqueue(s)},async cancel(i){await a.return(i)}})}};function atee(a,i=2){let s=Array.from({length:i},()=>[]);return s.map(async function*(i){for(;;)if(0===i.length){let i=await a.next();for(let a of s)a.push(i)}else{if(i[0].done)return;yield i.shift().value}})}function concat(a,i){if(Array.isArray(a)&&Array.isArray(i))return a.concat(i);if("string"==typeof a&&"string"==typeof i||"number"==typeof a&&"number"==typeof i)return a+i;if("concat"in a&&"function"==typeof a.concat)return a.concat(i);if("object"==typeof a&&"object"==typeof i){let s={...a};for(let[a,o]of Object.entries(i))a in s&&!Array.isArray(s[a])?s[a]=concat(s[a],o):s[a]=o;return s}throw Error(`Cannot concat ${typeof a} and ${typeof i}`)}let AsyncGeneratorWithSetup=class AsyncGeneratorWithSetup{constructor(a,i){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=a,this.setup=new Promise((s,o)=>{this.firstResult=a.next(),i?this.firstResult.then(i).then(s,o):this.firstResult.then(a=>s(void 0),o)})}async next(...a){return this.firstResultUsed?this.generator.next(...a):(this.firstResultUsed=!0,this.firstResult)}async return(a){return this.generator.return(a)}async throw(a){return this.generator.throw(a)}[Symbol.asyncIterator](){return this}};async function pipeGeneratorWithSetup(a,i,s,...o){let c=new AsyncGeneratorWithSetup(i,s),w=await c.setup;return{output:a(c,w,...o),setup:w}}},8463:function(a,i,s){"use strict";s.d(i,{BD:function(){return o.BD},qV:function(){return o.qV}});var o=s(7610)},3711:function(a,i,s){"use strict";s.d(i,{i:function(){return o.i}});var o=s(8498)},6261:function(a,i,s){"use strict";s.d(i,{Cr:function(){return o.Cr},GC:function(){return o.GC},HD:function(){return o.HD},J:function(){return o.J},QW:function(){return o.QW},TN:function(){return o.TN},Xz:function(){return o.Xz},Z0:function(){return o.Z0},gY:function(){return o.gY},ro:function(){return o.ro},xk:function(){return o.xk},xq:function(){return o.xq}});var o=s(3478)},7846:function(a,i,s){"use strict";s.d(i,{bI:function(){return o.bI},Qh:function(){return P.Qh},dS:function(){return o.dS},K:function(){return StructuredOutputParser}});var o=s(9073);s(242);var c=s(6418),w=s(9711);let StructuredOutputParser=class StructuredOutputParser extends o.bI{static lc_name(){return"StructuredOutputParser"}toJSON(){return this.toJSONNotImplemented()}constructor(a){super(a),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","structured"]})}static fromZodSchema(a){return new this(a)}static fromNamesAndDescriptions(a){let i=c.z.object(Object.fromEntries(Object.entries(a).map(([a,i])=>[a,c.z.string().describe(i)])));return new this(i)}getFormatInstructions(){return`You must format your output as a JSON value that adheres to a given "JSON Schema" instance.

"JSON Schema" is a declarative language that allows you to annotate and validate JSON documents.

For example, the example "JSON Schema" instance {{"properties": {{"foo": {{"description": "a list of test words", "type": "array", "items": {{"type": "string"}}}}}}, "required": ["foo"]}}}}
would match an object with one required property, "foo". The "type" property specifies "foo" must be an "array", and the "description" property semantically describes it as "a list of test words". The items within "foo" must be strings.
Thus, the object {{"foo": ["bar", "baz"]}} is a well-formatted instance of this example "JSON Schema". The object {{"properties": {{"foo": ["bar", "baz"]}}}} is not well-formatted.

Your output will be parsed and type-checked according to the provided schema instance, so make sure all fields in your output match the schema exactly and there are no trailing commas!

Here is the JSON Schema instance your output must adhere to. Include the enclosing markdown codeblock:
\`\`\`json
${JSON.stringify((0,w.Y_)(this.schema))}
\`\`\`
`}async parse(a){try{let i=a.includes("```")?a.trim().split(/```(?:json)?/)[1]:a.trim();return await this.schema.parseAsync(JSON.parse(i))}catch(i){throw new o.dS(`Failed to parse. Text: "${a}". Error: ${i}`,a)}}};var P=s(4559);s(7578)},6827:function(a,i,s){"use strict";s.d(i,{gc:function(){return c.gc},dy:function(){return o.d},ks:function(){return c.ks},kq:function(){return c.kq},ax:function(){return c.ax},Pf:function(){return w.PromptTemplate},ov:function(){return c.ov},SM:function(){return P.SM}});var o=s(4256),c=s(4359);s(1520);var w=s(4094);s(2566);var P=s(6184);s(6531)},3102:function(a,i,s){"use strict";s.d(i,{LE:function(){return o.LE},eq:function(){return o.eq},lW:function(){return o.lW},q:function(){return o.q},sk:function(){return o.sk}});var o=s(986)},1907:function(a,i,s){"use strict";s.d(i,{XQ:function(){return DynamicStructuredTool},UA:function(){return Tool},YE:function(){return ToolInputParsingException}});var o=s(6418),c=s(7018),w=s(7610),P=s(9189);let ToolInputParsingException=class ToolInputParsingException extends Error{constructor(a,i){super(a),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=i}};let StructuredTool=class StructuredTool extends w.BD{get lc_namespace(){return["langchain","tools"]}constructor(a){super(a??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(a,i){return this.call(a,(0,P.LE)(i))}async call(a,i,s){let o,w;try{o=await this.schema.parseAsync(a)}catch(i){throw new ToolInputParsingException("Received tool input did not match expected schema",JSON.stringify(a))}let P=(0,c.QH)(i),A=await c.Ye.configure(P.callbacks,this.callbacks,P.tags||s,this.tags,P.metadata,this.metadata,{verbose:this.verbose}),x=await A?.handleToolStart(this.toJSON(),"string"==typeof o?o:JSON.stringify(o),P.runId,void 0,void 0,void 0,P.runName);delete P.runId;try{w=await this._call(o,x,P)}catch(a){throw await x?.handleToolError(a),a}return await x?.handleToolEnd(w),w}};let Tool=class Tool extends StructuredTool{constructor(a){super(a),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:o.z.object({input:o.z.string().optional()}).transform(a=>a.input)})}call(a,i){return super.call("string"!=typeof a&&a?a:{input:a},i)}};let DynamicStructuredTool=class DynamicStructuredTool extends StructuredTool{static lc_name(){return"DynamicStructuredTool"}constructor(a){super(a),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=a.name,this.description=a.description,this.func=a.func,this.returnDirect=a.returnDirect??this.returnDirect,this.schema=a.schema}async call(a,i,s){let o=(0,c.QH)(i);return void 0===o.runName&&(o.runName=this.name),super.call(a,o,s)}_call(a,i,s){return this.func(a,i,s)}}},2488:function(a,i,s){"use strict";s.d(i,{lS:function(){return o.lS}});var o=s(298)},6896:function(a,i,s){"use strict";s.d(i,{sU:function(){return convertToOpenAIFunction},VE:function(){return convertToOpenAITool}});var o=s(9711);function convertToOpenAIFunction(a){return{name:a.name,description:a.description,parameters:(0,o.Y_)(a.schema)}}function convertToOpenAITool(a){return isStructuredTool(a)?{type:"function",function:convertToOpenAIFunction(a)}:a}function isStructuredTool(a){return void 0!==a&&Array.isArray(a.lc_namespace)}},1e3:function(a,i,s){"use strict";let o,c,w,P,A,x,k,R,j,$;s.d(i,{z7:function(){return chat_models_ChatOpenAI}});var B,D,Z,U,z,V,G,W,K,J,Y,X,ee,et,er,ea,en,ei,es,eo,el,eu,ec,ed,eh,ep,ef,em,eg,ey,eb,e_,ev,ew,eP,eA,eC,eE,eO,eS,eT,ex,ek,eI,eR,ej,eM,eN,eL,e$,eF,eB,eD,eZ,eU,ez,eV,eq,eH,eG,eW,eK,eJ,eQ,eY,eX,e0,e1,e2,e4,e5={};s.r(e5),s.d(e5,{APIConnectionError:function(){return APIConnectionError},APIConnectionTimeoutError:function(){return APIConnectionTimeoutError},APIError:function(){return APIError},APIUserAbortError:function(){return APIUserAbortError},AuthenticationError:function(){return AuthenticationError},BadRequestError:function(){return BadRequestError},ConflictError:function(){return ConflictError},InternalServerError:function(){return InternalServerError},NotFoundError:function(){return NotFoundError},OpenAIError:function(){return error_OpenAIError},PermissionDeniedError:function(){return PermissionDeniedError},RateLimitError:function(){return RateLimitError},UnprocessableEntityError:function(){return UnprocessableEntityError}});let e3="4.38.5",e9=!1;function setShims(a,i={auto:!1}){if(e9)throw Error(`you must \`import 'openai/shims/${a.kind}'\` before importing anything else from openai`);if(c)throw Error(`can't \`import 'openai/shims/${a.kind}'\` after \`import 'openai/shims/${c}'\``);e9=i.auto,c=a.kind,w=a.fetch,a.Request,a.Response,a.Headers,P=a.FormData,a.Blob,A=a.File,x=a.ReadableStream,k=a.getMultipartRequestOptions,R=a.getDefaultAgent,j=a.fileFromPath,$=a.isFsReadStream}let MultipartBody=class MultipartBody{constructor(a){this.body=a}get[Symbol.toStringTag](){return"MultipartBody"}};function getRuntime({manuallyImported:a}={}){let i,s,o,c;let w=a?"You may need to use polyfills":`Add one of these imports before your first \`import  from 'openai'\`:
- \`import 'openai/shims/node'\` (if you're running on Node)
- \`import 'openai/shims/web'\` (otherwise)
`;try{i=fetch,s=Request,o=Response,c=Headers}catch(a){throw Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${w}`)}return{kind:"web",fetch:i,Request:s,Response:o,Headers:c,FormData:"undefined"!=typeof FormData?FormData:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${w}`)}},Blob:"undefined"!=typeof Blob?Blob:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${w}`)}},File:"undefined"!=typeof File?File:class{constructor(){throw Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${w}`)}},ReadableStream:"undefined"!=typeof ReadableStream?ReadableStream:class{constructor(){throw Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${w}`)}},getMultipartRequestOptions:async(a,i)=>({...i,body:new MultipartBody(a)}),getDefaultAgent:a=>void 0,fileFromPath:()=>{throw Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1}}c||setShims(getRuntime(),{auto:!0});let error_OpenAIError=class error_OpenAIError extends Error{};let APIError=class APIError extends error_OpenAIError{constructor(a,i,s,o){super(`${APIError.makeMessage(a,i,s)}`),this.status=a,this.headers=o,this.request_id=o?.["x-request-id"],this.error=i,this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(a,i,s){let o=i?.message?"string"==typeof i.message?i.message:JSON.stringify(i.message):i?JSON.stringify(i):s;return a&&o?`${a} ${o}`:a?`${a} status code (no body)`:o||"(no status code or body)"}static generate(a,i,s,o){if(!a)return new APIConnectionError({cause:castToError(i)});let c=i?.error;return 400===a?new BadRequestError(a,c,s,o):401===a?new AuthenticationError(a,c,s,o):403===a?new PermissionDeniedError(a,c,s,o):404===a?new NotFoundError(a,c,s,o):409===a?new ConflictError(a,c,s,o):422===a?new UnprocessableEntityError(a,c,s,o):429===a?new RateLimitError(a,c,s,o):a>=500?new InternalServerError(a,c,s,o):new APIError(a,c,s,o)}};let APIUserAbortError=class APIUserAbortError extends APIError{constructor({message:a}={}){super(void 0,void 0,a||"Request was aborted.",void 0),this.status=void 0}};let APIConnectionError=class APIConnectionError extends APIError{constructor({message:a,cause:i}){super(void 0,void 0,a||"Connection error.",void 0),this.status=void 0,i&&(this.cause=i)}};let APIConnectionTimeoutError=class APIConnectionTimeoutError extends APIConnectionError{constructor({message:a}={}){super({message:a??"Request timed out."})}};let BadRequestError=class BadRequestError extends APIError{constructor(){super(...arguments),this.status=400}};let AuthenticationError=class AuthenticationError extends APIError{constructor(){super(...arguments),this.status=401}};let PermissionDeniedError=class PermissionDeniedError extends APIError{constructor(){super(...arguments),this.status=403}};let NotFoundError=class NotFoundError extends APIError{constructor(){super(...arguments),this.status=404}};let ConflictError=class ConflictError extends APIError{constructor(){super(...arguments),this.status=409}};let UnprocessableEntityError=class UnprocessableEntityError extends APIError{constructor(){super(...arguments),this.status=422}};let RateLimitError=class RateLimitError extends APIError{constructor(){super(...arguments),this.status=429}};let InternalServerError=class InternalServerError extends APIError{};var e8=s(1430).Buffer;let Stream=class Stream{constructor(a,i){this.iterator=a,this.controller=i}static fromSSEResponse(a,i){let s=!1;return new Stream(async function*(){if(s)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let o=!1;try{for await(let s of _iterSSEMessages(a,i))if(!o){if(s.data.startsWith("[DONE]")){o=!0;continue}if(null===s.event){let a;try{a=JSON.parse(s.data)}catch(a){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),a}if(a&&a.error)throw new APIError(void 0,a.error,void 0,void 0);yield a}else{let a;try{a=JSON.parse(s.data)}catch(a){throw console.error("Could not parse message into JSON:",s.data),console.error("From chunk:",s.raw),a}if("error"==s.event)throw new APIError(void 0,a.error,a.message,void 0);yield{event:s.event,data:a}}}o=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{o||i.abort()}},i)}static fromReadableStream(a,i){let s=!1;async function*iterLines(){let i=new LineDecoder,s=readableStreamAsyncIterable(a);for await(let a of s)for(let s of i.decode(a))yield s;for(let a of i.flush())yield a}return new Stream(async function*(){if(s)throw Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");s=!0;let a=!1;try{for await(let i of iterLines())!a&&i&&(yield JSON.parse(i));a=!0}catch(a){if(a instanceof Error&&"AbortError"===a.name)return;throw a}finally{a||i.abort()}},i)}[Symbol.asyncIterator](){return this.iterator()}tee(){let a=[],i=[],s=this.iterator(),teeIterator=o=>({next:()=>{if(0===o.length){let o=s.next();a.push(o),i.push(o)}return o.shift()}});return[new Stream(()=>teeIterator(a),this.controller),new Stream(()=>teeIterator(i),this.controller)]}toReadableStream(){let a;let i=this,s=new TextEncoder;return new x({async start(){a=i[Symbol.asyncIterator]()},async pull(i){try{let{value:o,done:c}=await a.next();if(c)return i.close();let w=s.encode(JSON.stringify(o)+"\n");i.enqueue(w)}catch(a){i.error(a)}},async cancel(){await a.return?.()}})}};async function*_iterSSEMessages(a,i){if(!a.body)throw i.abort(),new error_OpenAIError("Attempted to iterate over a response with no body");let s=new SSEDecoder,o=new LineDecoder,c=readableStreamAsyncIterable(a.body);for await(let a of iterSSEChunks(c))for(let i of o.decode(a)){let a=s.decode(i);a&&(yield a)}for(let a of o.flush()){let i=s.decode(a);i&&(yield i)}}async function*iterSSEChunks(a){let i=new Uint8Array;for await(let s of a){let a;if(null==s)continue;let o=s instanceof ArrayBuffer?new Uint8Array(s):"string"==typeof s?new TextEncoder().encode(s):s,c=new Uint8Array(i.length+o.length);for(c.set(i),c.set(o,i.length),i=c;-1!==(a=findDoubleNewlineIndex(i));)yield i.slice(0,a),i=i.slice(a)}i.length>0&&(yield i)}function findDoubleNewlineIndex(a){for(let i=0;i<a.length-2;i++){if(10===a[i]&&10===a[i+1]||13===a[i]&&13===a[i+1])return i+2;if(13===a[i]&&10===a[i+1]&&i+3<a.length&&13===a[i+2]&&10===a[i+3])return i+4}return -1}let SSEDecoder=class SSEDecoder{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(a){if(a.endsWith("\r")&&(a=a.substring(0,a.length-1)),!a){if(!this.event&&!this.data.length)return null;let a={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],a}if(this.chunks.push(a),a.startsWith(":"))return null;let[i,s,o]=partition(a,":");return o.startsWith(" ")&&(o=o.substring(1)),"event"===i?this.event=o:"data"===i&&this.data.push(o),null}};let LineDecoder=class LineDecoder{constructor(){this.buffer=[],this.trailingCR=!1}decode(a){let i=this.decodeText(a);if(this.trailingCR&&(i="\r"+i,this.trailingCR=!1),i.endsWith("\r")&&(this.trailingCR=!0,i=i.slice(0,-1)),!i)return[];let s=LineDecoder.NEWLINE_CHARS.has(i[i.length-1]||""),o=i.split(LineDecoder.NEWLINE_REGEXP);return(s&&o.pop(),1!==o.length||s)?(this.buffer.length>0&&(o=[this.buffer.join("")+o[0],...o.slice(1)],this.buffer=[]),s||(this.buffer=[o.pop()||""]),o):(this.buffer.push(o[0]),[])}decodeText(a){if(null==a)return"";if("string"==typeof a)return a;if(void 0!==e8){if(a instanceof e8)return a.toString();if(a instanceof Uint8Array)return e8.from(a).toString();throw new error_OpenAIError(`Unexpected: received non-Uint8Array (${a.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if("undefined"!=typeof TextDecoder){if(a instanceof Uint8Array||a instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(a);throw new error_OpenAIError(`Unexpected: received non-Uint8Array/ArrayBuffer (${a.constructor.name}) in a web platform. Please report this error.`)}throw new error_OpenAIError("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];let a=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,a}};function partition(a,i){let s=a.indexOf(i);return -1!==s?[a.substring(0,s),i,a.substring(s+i.length)]:[a,"",""]}function readableStreamAsyncIterable(a){if(a[Symbol.asyncIterator])return a;let i=a.getReader();return{async next(){try{let a=await i.read();return a?.done&&i.releaseLock(),a}catch(a){throw i.releaseLock(),a}},async return(){let a=i.cancel();return i.releaseLock(),await a,{done:!0,value:void 0}},[Symbol.asyncIterator](){return this}}}LineDecoder.NEWLINE_CHARS=new Set(["\n","\r"]),LineDecoder.NEWLINE_REGEXP=/\r\n|[\n\r]/g;var e6=s(1430).Buffer;let isResponseLike=a=>null!=a&&"object"==typeof a&&"string"==typeof a.url&&"function"==typeof a.blob,isFileLike=a=>null!=a&&"object"==typeof a&&"string"==typeof a.name&&"number"==typeof a.lastModified&&isBlobLike(a),isBlobLike=a=>null!=a&&"object"==typeof a&&"number"==typeof a.size&&"string"==typeof a.type&&"function"==typeof a.text&&"function"==typeof a.slice&&"function"==typeof a.arrayBuffer,isUploadable=a=>isFileLike(a)||isResponseLike(a)||$(a);async function toFile(a,i,s){if(a=await a,s??(s=isFileLike(a)?{lastModified:a.lastModified,type:a.type}:{}),isResponseLike(a)){let o=await a.blob();return i||(i=new URL(a.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new A([o],i,s)}let o=await getBytes(a);if(i||(i=getName(a)??"unknown_file"),!s.type){let a=o[0]?.type;"string"==typeof a&&(s={...s,type:a})}return new A(o,i,s)}async function getBytes(a){let i=[];if("string"==typeof a||ArrayBuffer.isView(a)||a instanceof ArrayBuffer)i.push(a);else if(isBlobLike(a))i.push(await a.arrayBuffer());else if(isAsyncIterableIterator(a))for await(let s of a)i.push(s);else throw Error(`Unexpected data type: ${typeof a}; constructor: ${a?.constructor?.name}; props: ${propsForError(a)}`);return i}function propsForError(a){let i=Object.getOwnPropertyNames(a);return`[${i.map(a=>`"${a}"`).join(", ")}]`}function getName(a){return getStringFromMaybeBuffer(a.name)||getStringFromMaybeBuffer(a.filename)||getStringFromMaybeBuffer(a.path)?.split(/[\\/]/).pop()}let getStringFromMaybeBuffer=a=>"string"==typeof a?a:void 0!==e6&&a instanceof e6?String(a):void 0,isAsyncIterableIterator=a=>null!=a&&"object"==typeof a&&"function"==typeof a[Symbol.asyncIterator],isMultipartBody=a=>a&&"object"==typeof a&&a.body&&"MultipartBody"===a[Symbol.toStringTag],multipartFormRequestOptions=async a=>{let i=await createForm(a.body);return k(i,a)},createForm=async a=>{let i=new P;return await Promise.all(Object.entries(a||{}).map(([a,s])=>addFormValue(i,a,s))),i},addFormValue=async(a,i,s)=>{if(void 0!==s){if(null==s)throw TypeError(`Received null for "${i}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof s||"number"==typeof s||"boolean"==typeof s)a.append(i,String(s));else if(isUploadable(s)){let o=await toFile(s);a.append(i,o)}else if(Array.isArray(s))await Promise.all(s.map(s=>addFormValue(a,i+"[]",s)));else if("object"==typeof s)await Promise.all(Object.entries(s).map(([s,o])=>addFormValue(a,`${i}[${s}]`,o)));else throw TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${s} instead`)}};var e7=s(1430).Buffer,te=s(5656),__classPrivateFieldSet=function(a,i,s,o,c){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!c)throw TypeError("Private accessor was defined without a setter");if("function"==typeof i?a!==i||!c:!i.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?c.call(a,s):c?c.value=s:i.set(a,s),s},__classPrivateFieldGet=function(a,i,s,o){if("a"===s&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof i?a!==i||!o:!i.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(a):o?o.value:i.get(a)};async function defaultParseResponse(a){let{response:i}=a;if(a.options.stream)return(debug("response",i.status,i.url,i.headers,i.body),a.options.__streamClass)?a.options.__streamClass.fromSSEResponse(i,a.controller):Stream.fromSSEResponse(i,a.controller);if(204===i.status)return null;if(a.options.__binaryResponse)return i;let s=i.headers.get("content-type"),o=s?.includes("application/json")||s?.includes("application/vnd.api+json");if(o){let a=await i.json();return debug("response",i.status,i.url,i.headers,a),a}let c=await i.text();return debug("response",i.status,i.url,i.headers,c),c}let APIPromise=class APIPromise extends Promise{constructor(a,i=defaultParseResponse){super(a=>{a(null)}),this.responsePromise=a,this.parseResponse=i}_thenUnwrap(a){return new APIPromise(this.responsePromise,async i=>a(await this.parseResponse(i)))}asResponse(){return this.responsePromise.then(a=>a.response)}async withResponse(){let[a,i]=await Promise.all([this.parse(),this.asResponse()]);return{data:a,response:i}}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(a,i){return this.parse().then(a,i)}catch(a){return this.parse().catch(a)}finally(a){return this.parse().finally(a)}};let APIClient=class APIClient{constructor({baseURL:a,maxRetries:i=2,timeout:s=6e5,httpAgent:o,fetch:c}){this.baseURL=a,this.maxRetries=validatePositiveInteger("maxRetries",i),this.timeout=validatePositiveInteger("timeout",s),this.httpAgent=o,this.fetch=c??w}authHeaders(a){return{}}defaultHeaders(a){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...getPlatformHeaders(),...this.authHeaders(a)}}validateHeaders(a,i){}defaultIdempotencyKey(){return`stainless-node-retry-${uuid4()}`}get(a,i){return this.methodRequest("get",a,i)}post(a,i){return this.methodRequest("post",a,i)}patch(a,i){return this.methodRequest("patch",a,i)}put(a,i){return this.methodRequest("put",a,i)}delete(a,i){return this.methodRequest("delete",a,i)}methodRequest(a,i,s){return this.request(Promise.resolve(s).then(s=>({method:a,path:i,...s})))}getAPIList(a,i,s){return this.requestAPIList(i,{method:"get",path:a,...s})}calculateContentLength(a){if("string"==typeof a){if(void 0!==e7)return e7.byteLength(a,"utf8").toString();if("undefined"!=typeof TextEncoder){let i=new TextEncoder,s=i.encode(a);return s.length.toString()}}return null}buildRequest(a){let{method:i,path:s,query:o,headers:c={}}=a,w=isMultipartBody(a.body)?a.body.body:a.body?JSON.stringify(a.body,null,2):null,P=this.calculateContentLength(w),A=this.buildURL(s,o);"timeout"in a&&validatePositiveInteger("timeout",a.timeout);let x=a.timeout??this.timeout,k=a.httpAgent??this.httpAgent??R(A),j=x+1e3;"number"==typeof k?.options?.timeout&&j>(k.options.timeout??0)&&(k.options.timeout=j),this.idempotencyHeader&&"get"!==i&&(a.idempotencyKey||(a.idempotencyKey=this.defaultIdempotencyKey()),c[this.idempotencyHeader]=a.idempotencyKey);let $=this.buildHeaders({options:a,headers:c,contentLength:P}),B={method:i,...w&&{body:w},headers:$,...k&&{agent:k},signal:a.signal??null};return{req:B,url:A,timeout:x}}buildHeaders({options:a,headers:i,contentLength:s}){let o={};s&&(o["content-length"]=s);let w=this.defaultHeaders(a);return applyHeadersMut(o,w),applyHeadersMut(o,i),isMultipartBody(a.body)&&"node"!==c&&delete o["content-type"],this.validateHeaders(o,i),o}async prepareOptions(a){}async prepareRequest(a,{url:i,options:s}){}parseHeaders(a){return a?Symbol.iterator in a?Object.fromEntries(Array.from(a).map(a=>[...a])):{...a}:{}}makeStatusError(a,i,s,o){return APIError.generate(a,i,s,o)}request(a,i=null){return new APIPromise(this.makeRequest(a,i))}async makeRequest(a,i){let s=await a;null==i&&(i=s.maxRetries??this.maxRetries),await this.prepareOptions(s);let{req:o,url:c,timeout:w}=this.buildRequest(s);if(await this.prepareRequest(o,{url:c,options:s}),debug("request",c,s,o.headers),s.signal?.aborted)throw new APIUserAbortError;let P=new AbortController,A=await this.fetchWithTimeout(c,o,w,P).catch(castToError);if(A instanceof Error){if(s.signal?.aborted)throw new APIUserAbortError;if(i)return this.retryRequest(s,i);if("AbortError"===A.name)throw new APIConnectionTimeoutError;throw new APIConnectionError({cause:A})}let x=createResponseHeaders(A.headers);if(!A.ok){if(i&&this.shouldRetry(A)){let a=`retrying, ${i} attempts remaining`;return debug(`response (error; ${a})`,A.status,c,x),this.retryRequest(s,i,x)}let a=await A.text().catch(a=>castToError(a).message),o=safeJSON(a),w=o?void 0:a,P=i?"(error; no more retries left)":"(error; not retryable)";debug(`response (error; ${P})`,A.status,c,x,w);let k=this.makeStatusError(A.status,o,w,x);throw k}return{response:A,options:s,controller:P}}requestAPIList(a,i){let s=this.makeRequest(i,null);return new PagePromise(this,s,a)}buildURL(a,i){let s=new URL(isAbsoluteURL(a)?a:this.baseURL+(this.baseURL.endsWith("/")&&a.startsWith("/")?a.slice(1):a)),o=this.defaultQuery();return isEmptyObj(o)||(i={...o,...i}),"object"==typeof i&&i&&!Array.isArray(i)&&(s.search=this.stringifyQuery(i)),s.toString()}stringifyQuery(a){return Object.entries(a).filter(([a,i])=>void 0!==i).map(([a,i])=>{if("string"==typeof i||"number"==typeof i||"boolean"==typeof i)return`${encodeURIComponent(a)}=${encodeURIComponent(i)}`;if(null===i)return`${encodeURIComponent(a)}=`;throw new error_OpenAIError(`Cannot stringify type ${typeof i}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}async fetchWithTimeout(a,i,s,o){let{signal:c,...w}=i||{};c&&c.addEventListener("abort",()=>o.abort());let P=setTimeout(()=>o.abort(),s);return this.getRequestClient().fetch.call(void 0,a,{signal:o.signal,...w}).finally(()=>{clearTimeout(P)})}getRequestClient(){return{fetch:this.fetch}}shouldRetry(a){let i=a.headers.get("x-should-retry");return"true"===i||"false"!==i&&(408===a.status||409===a.status||429===a.status||a.status>=500)}async retryRequest(a,i,s){let o;let c=s?.["retry-after-ms"];if(c){let a=parseFloat(c);Number.isNaN(a)||(o=a)}let w=s?.["retry-after"];if(w&&!o){let a=parseFloat(w);o=Number.isNaN(a)?Date.parse(w)-Date.now():1e3*a}if(!(o&&0<=o&&o<6e4)){let s=a.maxRetries??this.maxRetries;o=this.calculateDefaultRetryTimeoutMillis(i,s)}return await sleep(o),this.makeRequest(a,i-1)}calculateDefaultRetryTimeoutMillis(a,i){let s=Math.min(.5*Math.pow(2,i-a),8),o=1-.25*Math.random();return s*o*1e3}getUserAgent(){return`${this.constructor.name}/JS ${e3}`}};let AbstractPage=class AbstractPage{constructor(a,i,s,o){K.set(this,void 0),__classPrivateFieldSet(this,K,a,"f"),this.options=o,this.response=i,this.body=s}hasNextPage(){let a=this.getPaginatedItems();return!!a.length&&null!=this.nextPageInfo()}async getNextPage(){let a=this.nextPageInfo();if(!a)throw new error_OpenAIError("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");let i={...this.options};if("params"in a&&"object"==typeof i.query)i.query={...i.query,...a.params};else if("url"in a){let s=[...Object.entries(i.query||{}),...a.url.searchParams.entries()];for(let[i,o]of s)a.url.searchParams.set(i,o);i.query=void 0,i.path=a.url.toString()}return await __classPrivateFieldGet(this,K,"f").requestAPIList(this.constructor,i)}async *iterPages(){let a=this;for(yield a;a.hasNextPage();)a=await a.getNextPage(),yield a}async *[(K=new WeakMap,Symbol.asyncIterator)](){for await(let a of this.iterPages())for(let i of a.getPaginatedItems())yield i}};let PagePromise=class PagePromise extends APIPromise{constructor(a,i,s){super(i,async i=>new s(a,i.response,await defaultParseResponse(i),i.options))}async *[Symbol.asyncIterator](){let a=await this;for await(let i of a)yield i}};let createResponseHeaders=a=>new Proxy(Object.fromEntries(a.entries()),{get(a,i){let s=i.toString();return a[s.toLowerCase()]||a[s]}}),tt={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryResponse:!0,__streamClass:!0},isRequestOptions=a=>"object"==typeof a&&null!==a&&!isEmptyObj(a)&&Object.keys(a).every(a=>hasOwn(tt,a)),getPlatformProperties=()=>{if("undefined"!=typeof Deno&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":normalizePlatform(Deno.build.os),"X-Stainless-Arch":normalizeArch(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if("undefined"!=typeof EdgeRuntime)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":te.version};if("[object process]"===Object.prototype.toString.call(void 0!==te?te:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":normalizePlatform(te.platform),"X-Stainless-Arch":normalizeArch(te.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":te.version};let a=getBrowserInfo();return a?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${a.browser}`,"X-Stainless-Runtime-Version":a.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":e3,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}};function getBrowserInfo(){if("undefined"==typeof navigator||!navigator)return null;for(let{key:a,pattern:i}of[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}]){let s=i.exec(navigator.userAgent);if(s){let i=s[1]||0,o=s[2]||0,c=s[3]||0;return{browser:a,version:`${i}.${o}.${c}`}}}return null}let normalizeArch=a=>"x32"===a?"x32":"x86_64"===a||"x64"===a?"x64":"arm"===a?"arm":"aarch64"===a||"arm64"===a?"arm64":a?`other:${a}`:"unknown",normalizePlatform=a=>(a=a.toLowerCase()).includes("ios")?"iOS":"android"===a?"Android":"darwin"===a?"MacOS":"win32"===a?"Windows":"freebsd"===a?"FreeBSD":"openbsd"===a?"OpenBSD":"linux"===a?"Linux":a?`Other:${a}`:"Unknown",getPlatformHeaders=()=>o??(o=getPlatformProperties()),safeJSON=a=>{try{return JSON.parse(a)}catch(a){return}},tr=RegExp("^(?:[a-z]+:)?//","i"),isAbsoluteURL=a=>tr.test(a),sleep=a=>new Promise(i=>setTimeout(i,a)),validatePositiveInteger=(a,i)=>{if("number"!=typeof i||!Number.isInteger(i))throw new error_OpenAIError(`${a} must be an integer`);if(i<0)throw new error_OpenAIError(`${a} must be a positive integer`);return i},castToError=a=>a instanceof Error?a:Error(a),readEnv=a=>void 0!==te?te.env?.[a]?.trim()??void 0:"undefined"!=typeof Deno?Deno.env?.get?.(a)?.trim():void 0;function isEmptyObj(a){if(!a)return!0;for(let i in a)return!1;return!0}function hasOwn(a,i){return Object.prototype.hasOwnProperty.call(a,i)}function applyHeadersMut(a,i){for(let s in i){if(!hasOwn(i,s))continue;let o=s.toLowerCase();if(!o)continue;let c=i[s];null===c?delete a[o]:void 0!==c&&(a[o]=c)}}function debug(a,...i){void 0!==te&&te?.env?.DEBUG==="true"&&console.log(`OpenAI:DEBUG:${a}`,...i)}let uuid4=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,a=>{let i=16*Math.random()|0;return("x"===a?i:3&i|8).toString(16)}),isRunningInBrowser=()=>"undefined"!=typeof window&&void 0!==window.document&&"undefined"!=typeof navigator;function isObj(a){return null!=a&&"object"==typeof a&&!Array.isArray(a)}let Page=class Page extends AbstractPage{constructor(a,i,s,o){super(a,i,s,o),this.data=s.data||[],this.object=s.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}};let CursorPage=class CursorPage extends AbstractPage{constructor(a,i,s,o){super(a,i,s,o),this.data=s.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){let a=this.nextPageInfo();if(!a)return null;if("params"in a)return a.params;let i=Object.fromEntries(a.url.searchParams);return Object.keys(i).length?i:null}nextPageInfo(){let a=this.getPaginatedItems();if(!a.length)return null;let i=a[a.length-1]?.id;return i?{params:{after:i}}:null}};let APIResource=class APIResource{constructor(a){this._client=a}};let Completions=class Completions extends APIResource{create(a,i){return this._client.post("/completions",{body:a,...i,stream:a.stream??!1})}};Completions||(Completions={});let completions_Completions=class completions_Completions extends APIResource{create(a,i){return this._client.post("/chat/completions",{body:a,...i,stream:a.stream??!1})}};completions_Completions||(completions_Completions={});let Chat=class Chat extends APIResource{constructor(){super(...arguments),this.completions=new completions_Completions(this._client)}};(Chat||(Chat={})).Completions=completions_Completions;let embeddings_Embeddings=class embeddings_Embeddings extends APIResource{create(a,i){return this._client.post("/embeddings",{body:a,...i})}};embeddings_Embeddings||(embeddings_Embeddings={});let Files=class Files extends APIResource{create(a,i){return this._client.post("/files",multipartFormRequestOptions({body:a,...i}))}retrieve(a,i){return this._client.get(`/files/${a}`,i)}list(a={},i){return isRequestOptions(a)?this.list({},a):this._client.getAPIList("/files",FileObjectsPage,{query:a,...i})}del(a,i){return this._client.delete(`/files/${a}`,i)}content(a,i){return this._client.get(`/files/${a}/content`,{...i,__binaryResponse:!0})}retrieveContent(a,i){return this._client.get(`/files/${a}/content`,{...i,headers:{Accept:"application/json",...i?.headers}})}async waitForProcessing(a,{pollInterval:i=5e3,maxWait:s=18e5}={}){let o=new Set(["processed","error","deleted"]),c=Date.now(),w=await this.retrieve(a);for(;!w.status||!o.has(w.status);)if(await sleep(i),w=await this.retrieve(a),Date.now()-c>s)throw new APIConnectionTimeoutError({message:`Giving up on waiting for file ${a} to finish processing after ${s} milliseconds.`});return w}};let FileObjectsPage=class FileObjectsPage extends Page{};(Files||(Files={})).FileObjectsPage=FileObjectsPage;let Images=class Images extends APIResource{createVariation(a,i){return this._client.post("/images/variations",multipartFormRequestOptions({body:a,...i}))}edit(a,i){return this._client.post("/images/edits",multipartFormRequestOptions({body:a,...i}))}generate(a,i){return this._client.post("/images/generations",{body:a,...i})}};Images||(Images={});let Speech=class Speech extends APIResource{create(a,i){return this._client.post("/audio/speech",{body:a,...i,__binaryResponse:!0})}};Speech||(Speech={});let Transcriptions=class Transcriptions extends APIResource{create(a,i){return this._client.post("/audio/transcriptions",multipartFormRequestOptions({body:a,...i}))}};Transcriptions||(Transcriptions={});let Translations=class Translations extends APIResource{create(a,i){return this._client.post("/audio/translations",multipartFormRequestOptions({body:a,...i}))}};Translations||(Translations={});let Audio=class Audio extends APIResource{constructor(){super(...arguments),this.transcriptions=new Transcriptions(this._client),this.translations=new Translations(this._client),this.speech=new Speech(this._client)}};(B=Audio||(Audio={})).Transcriptions=Transcriptions,B.Translations=Translations,B.Speech=Speech;let Moderations=class Moderations extends APIResource{create(a,i){return this._client.post("/moderations",{body:a,...i})}};Moderations||(Moderations={});let Models=class Models extends APIResource{retrieve(a,i){return this._client.get(`/models/${a}`,i)}list(a){return this._client.getAPIList("/models",ModelsPage,a)}del(a,i){return this._client.delete(`/models/${a}`,i)}};let ModelsPage=class ModelsPage extends Page{};(Models||(Models={})).ModelsPage=ModelsPage;let Checkpoints=class Checkpoints extends APIResource{list(a,i={},s){return isRequestOptions(i)?this.list(a,{},i):this._client.getAPIList(`/fine_tuning/jobs/${a}/checkpoints`,FineTuningJobCheckpointsPage,{query:i,...s})}};let FineTuningJobCheckpointsPage=class FineTuningJobCheckpointsPage extends CursorPage{};(Checkpoints||(Checkpoints={})).FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage;let Jobs=class Jobs extends APIResource{constructor(){super(...arguments),this.checkpoints=new Checkpoints(this._client)}create(a,i){return this._client.post("/fine_tuning/jobs",{body:a,...i})}retrieve(a,i){return this._client.get(`/fine_tuning/jobs/${a}`,i)}list(a={},i){return isRequestOptions(a)?this.list({},a):this._client.getAPIList("/fine_tuning/jobs",FineTuningJobsPage,{query:a,...i})}cancel(a,i){return this._client.post(`/fine_tuning/jobs/${a}/cancel`,i)}listEvents(a,i={},s){return isRequestOptions(i)?this.listEvents(a,{},i):this._client.getAPIList(`/fine_tuning/jobs/${a}/events`,FineTuningJobEventsPage,{query:i,...s})}};let FineTuningJobsPage=class FineTuningJobsPage extends CursorPage{};let FineTuningJobEventsPage=class FineTuningJobEventsPage extends CursorPage{};(D=Jobs||(Jobs={})).FineTuningJobsPage=FineTuningJobsPage,D.FineTuningJobEventsPage=FineTuningJobEventsPage,D.Checkpoints=Checkpoints,D.FineTuningJobCheckpointsPage=FineTuningJobCheckpointsPage;let FineTuning=class FineTuning extends APIResource{constructor(){super(...arguments),this.jobs=new Jobs(this._client)}};(Z=FineTuning||(FineTuning={})).Jobs=Jobs,Z.FineTuningJobsPage=FineTuningJobsPage,Z.FineTuningJobEventsPage=FineTuningJobEventsPage;let Assistants=class Assistants extends APIResource{create(a,i){return this._client.post("/assistants",{body:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}retrieve(a,i){return this._client.get(`/assistants/${a}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}update(a,i,s){return this._client.post(`/assistants/${a}`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(a={},i){return isRequestOptions(a)?this.list({},a):this._client.getAPIList("/assistants",AssistantsPage,{query:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}del(a,i){return this._client.delete(`/assistants/${a}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}};let AssistantsPage=class AssistantsPage extends CursorPage{};function isRunnableFunctionWithParse(a){return"function"==typeof a.parse}(Assistants||(Assistants={})).AssistantsPage=AssistantsPage;let isAssistantMessage=a=>a?.role==="assistant",isFunctionMessage=a=>a?.role==="function",isToolMessage=a=>a?.role==="tool";var AbstractChatCompletionRunner_classPrivateFieldSet=function(a,i,s,o,c){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!c)throw TypeError("Private accessor was defined without a setter");if("function"==typeof i?a!==i||!c:!i.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?c.call(a,s):c?c.value=s:i.set(a,s),s},AbstractChatCompletionRunner_classPrivateFieldGet=function(a,i,s,o){if("a"===s&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof i?a!==i||!o:!i.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(a):o?o.value:i.get(a)};let AbstractChatCompletionRunner=class AbstractChatCompletionRunner{constructor(){J.add(this),this.controller=new AbortController,Y.set(this,void 0),X.set(this,()=>{}),ee.set(this,()=>{}),et.set(this,void 0),er.set(this,()=>{}),ea.set(this,()=>{}),en.set(this,{}),this._chatCompletions=[],this.messages=[],ei.set(this,!1),es.set(this,!1),eo.set(this,!1),el.set(this,!1),ef.set(this,a=>{if(AbstractChatCompletionRunner_classPrivateFieldSet(this,es,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new APIUserAbortError),a instanceof APIUserAbortError)return AbstractChatCompletionRunner_classPrivateFieldSet(this,eo,!0,"f"),this._emit("abort",a);if(a instanceof error_OpenAIError)return this._emit("error",a);if(a instanceof Error){let i=new error_OpenAIError(a.message);return i.cause=a,this._emit("error",i)}return this._emit("error",new error_OpenAIError(String(a)))}),AbstractChatCompletionRunner_classPrivateFieldSet(this,Y,new Promise((a,i)=>{AbstractChatCompletionRunner_classPrivateFieldSet(this,X,a,"f"),AbstractChatCompletionRunner_classPrivateFieldSet(this,ee,i,"f")}),"f"),AbstractChatCompletionRunner_classPrivateFieldSet(this,et,new Promise((a,i)=>{AbstractChatCompletionRunner_classPrivateFieldSet(this,er,a,"f"),AbstractChatCompletionRunner_classPrivateFieldSet(this,ea,i,"f")}),"f"),AbstractChatCompletionRunner_classPrivateFieldGet(this,Y,"f").catch(()=>{}),AbstractChatCompletionRunner_classPrivateFieldGet(this,et,"f").catch(()=>{})}_run(a){setTimeout(()=>{a().then(()=>{this._emitFinal(),this._emit("end")},AbstractChatCompletionRunner_classPrivateFieldGet(this,ef,"f"))},0)}_addChatCompletion(a){this._chatCompletions.push(a),this._emit("chatCompletion",a);let i=a.choices[0]?.message;return i&&this._addMessage(i),a}_addMessage(a,i=!0){if("content"in a||(a.content=null),this.messages.push(a),i){if(this._emit("message",a),(isFunctionMessage(a)||isToolMessage(a))&&a.content)this._emit("functionCallResult",a.content);else if(isAssistantMessage(a)&&a.function_call)this._emit("functionCall",a.function_call);else if(isAssistantMessage(a)&&a.tool_calls)for(let i of a.tool_calls)"function"===i.type&&this._emit("functionCall",i.function)}}_connected(){this.ended||(AbstractChatCompletionRunner_classPrivateFieldGet(this,X,"f").call(this),this._emit("connect"))}get ended(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,ei,"f")}get errored(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,es,"f")}get aborted(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,eo,"f")}abort(){this.controller.abort()}on(a,i){let s=AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a]||(AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a]=[]);return s.push({listener:i}),this}off(a,i){let s=AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a];if(!s)return this;let o=s.findIndex(a=>a.listener===i);return o>=0&&s.splice(o,1),this}once(a,i){let s=AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a]||(AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a]=[]);return s.push({listener:i,once:!0}),this}emitted(a){return new Promise((i,s)=>{AbstractChatCompletionRunner_classPrivateFieldSet(this,el,!0,"f"),"error"!==a&&this.once("error",s),this.once(a,i)})}async done(){AbstractChatCompletionRunner_classPrivateFieldSet(this,el,!0,"f"),await AbstractChatCompletionRunner_classPrivateFieldGet(this,et,"f")}async finalChatCompletion(){await this.done();let a=this._chatCompletions[this._chatCompletions.length-1];if(!a)throw new error_OpenAIError("stream ended without producing a ChatCompletion");return a}async finalContent(){return await this.done(),AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",eu).call(this)}async finalMessage(){return await this.done(),AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ec).call(this)}async finalFunctionCall(){return await this.done(),AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ed).call(this)}async finalFunctionCallResult(){return await this.done(),AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",eh).call(this)}async totalUsage(){return await this.done(),AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ep).call(this)}allChatCompletions(){return[...this._chatCompletions]}_emit(a,...i){if(AbstractChatCompletionRunner_classPrivateFieldGet(this,ei,"f"))return;"end"===a&&(AbstractChatCompletionRunner_classPrivateFieldSet(this,ei,!0,"f"),AbstractChatCompletionRunner_classPrivateFieldGet(this,er,"f").call(this));let s=AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a];if(s&&(AbstractChatCompletionRunner_classPrivateFieldGet(this,en,"f")[a]=s.filter(a=>!a.once),s.forEach(({listener:a})=>a(...i))),"abort"===a){let a=i[0];AbstractChatCompletionRunner_classPrivateFieldGet(this,el,"f")||s?.length||Promise.reject(a),AbstractChatCompletionRunner_classPrivateFieldGet(this,ee,"f").call(this,a),AbstractChatCompletionRunner_classPrivateFieldGet(this,ea,"f").call(this,a),this._emit("end");return}if("error"===a){let a=i[0];AbstractChatCompletionRunner_classPrivateFieldGet(this,el,"f")||s?.length||Promise.reject(a),AbstractChatCompletionRunner_classPrivateFieldGet(this,ee,"f").call(this,a),AbstractChatCompletionRunner_classPrivateFieldGet(this,ea,"f").call(this,a),this._emit("end")}}_emitFinal(){let a=this._chatCompletions[this._chatCompletions.length-1];a&&this._emit("finalChatCompletion",a);let i=AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ec).call(this);i&&this._emit("finalMessage",i);let s=AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",eu).call(this);s&&this._emit("finalContent",s);let o=AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ed).call(this);o&&this._emit("finalFunctionCall",o);let c=AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",eh).call(this);null!=c&&this._emit("finalFunctionCallResult",c),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ep).call(this))}async _createChatCompletion(a,i,s){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",em).call(this,i);let c=await a.create({...i,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addChatCompletion(c)}async _runChatCompletion(a,i,s){for(let a of i.messages)this._addMessage(a,!1);return await this._createChatCompletion(a,i,s)}async _runFunctions(a,i,s){let o="function",{function_call:c="auto",stream:w,...P}=i,A="string"!=typeof c&&c?.name,{maxChatCompletions:x=10}=s||{},k={};for(let a of i.functions)k[a.name||a.function.name]=a;let R=i.functions.map(a=>({name:a.name||a.function.name,parameters:a.parameters,description:a.description}));for(let a of i.messages)this._addMessage(a,!1);for(let i=0;i<x;++i){let i;let w=await this._createChatCompletion(a,{...P,function_call:c,functions:R,messages:[...this.messages]},s),x=w.choices[0]?.message;if(!x)throw new error_OpenAIError("missing message in ChatCompletion response");if(!x.function_call)return;let{name:j,arguments:$}=x.function_call,B=k[j];if(B){if(A&&A!==j){let a=`Invalid function_call: ${JSON.stringify(j)}. ${JSON.stringify(A)} requested. Please try again`;this._addMessage({role:o,name:j,content:a});continue}}else{let a=`Invalid function_call: ${JSON.stringify(j)}. Available options are: ${R.map(a=>JSON.stringify(a.name)).join(", ")}. Please try again`;this._addMessage({role:o,name:j,content:a});continue}try{i=isRunnableFunctionWithParse(B)?await B.parse($):$}catch(a){this._addMessage({role:o,name:j,content:a instanceof Error?a.message:String(a)});continue}let D=await B.function(i,this),Z=AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",eg).call(this,D);if(this._addMessage({role:o,name:j,content:Z}),A)return}}async _runTools(a,i,s){let o="tool",{tool_choice:c="auto",stream:w,...P}=i,A="string"!=typeof c&&c?.function?.name,{maxChatCompletions:x=10}=s||{},k={};for(let a of i.tools)"function"===a.type&&(k[a.function.name||a.function.function.name]=a.function);let R="tools"in i?i.tools.map(a=>"function"===a.type?{type:"function",function:{name:a.function.name||a.function.function.name,parameters:a.function.parameters,description:a.function.description}}:a):void 0;for(let a of i.messages)this._addMessage(a,!1);for(let i=0;i<x;++i){let i=await this._createChatCompletion(a,{...P,tool_choice:c,tools:R,messages:[...this.messages]},s),w=i.choices[0]?.message;if(!w)throw new error_OpenAIError("missing message in ChatCompletion response");if(!w.tool_calls)break;for(let a of w.tool_calls){let i;if("function"!==a.type)continue;let s=a.id,{name:c,arguments:w}=a.function,P=k[c];if(P){if(A&&A!==c){let a=`Invalid tool_call: ${JSON.stringify(c)}. ${JSON.stringify(A)} requested. Please try again`;this._addMessage({role:o,tool_call_id:s,content:a});continue}}else{let a=`Invalid tool_call: ${JSON.stringify(c)}. Available options are: ${R.map(a=>JSON.stringify(a.function.name)).join(", ")}. Please try again`;this._addMessage({role:o,tool_call_id:s,content:a});continue}try{i=isRunnableFunctionWithParse(P)?await P.parse(w):w}catch(i){let a=i instanceof Error?i.message:String(i);this._addMessage({role:o,tool_call_id:s,content:a});continue}let x=await P.function(i,this),j=AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",eg).call(this,x);if(this._addMessage({role:o,tool_call_id:s,content:j}),A)return}}}};Y=new WeakMap,X=new WeakMap,ee=new WeakMap,et=new WeakMap,er=new WeakMap,ea=new WeakMap,en=new WeakMap,ei=new WeakMap,es=new WeakMap,eo=new WeakMap,el=new WeakMap,ef=new WeakMap,J=new WeakSet,eu=function(){return AbstractChatCompletionRunner_classPrivateFieldGet(this,J,"m",ec).call(this).content??null},ec=function(){let a=this.messages.length;for(;a-- >0;){let i=this.messages[a];if(isAssistantMessage(i))return{...i,content:i.content??null}}throw new error_OpenAIError("stream ended without producing a ChatCompletionMessage with role=assistant")},ed=function(){for(let a=this.messages.length-1;a>=0;a--){let i=this.messages[a];if(isAssistantMessage(i)&&i?.function_call)return i.function_call;if(isAssistantMessage(i)&&i?.tool_calls?.length)return i.tool_calls.at(-1)?.function}},eh=function(){for(let a=this.messages.length-1;a>=0;a--){let i=this.messages[a];if(isFunctionMessage(i)&&null!=i.content||isToolMessage(i)&&null!=i.content&&this.messages.some(a=>"assistant"===a.role&&a.tool_calls?.some(a=>"function"===a.type&&a.id===i.tool_call_id)))return i.content}},ep=function(){let a={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(let{usage:i}of this._chatCompletions)i&&(a.completion_tokens+=i.completion_tokens,a.prompt_tokens+=i.prompt_tokens,a.total_tokens+=i.total_tokens);return a},em=function(a){if(null!=a.n&&a.n>1)throw new error_OpenAIError("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},eg=function(a){return"string"==typeof a?a:void 0===a?"undefined":JSON.stringify(a)};let ChatCompletionRunner=class ChatCompletionRunner extends AbstractChatCompletionRunner{static runFunctions(a,i,s){let o=new ChatCompletionRunner,c={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return o._run(()=>o._runFunctions(a,i,c)),o}static runTools(a,i,s){let o=new ChatCompletionRunner,c={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(a,i,c)),o}_addMessage(a){super._addMessage(a),isAssistantMessage(a)&&a.content&&this._emit("content",a.content)}};var ChatCompletionStream_classPrivateFieldGet=function(a,i,s,o){if("a"===s&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof i?a!==i||!o:!i.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(a):o?o.value:i.get(a)},ChatCompletionStream_classPrivateFieldSet=function(a,i,s,o,c){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!c)throw TypeError("Private accessor was defined without a setter");if("function"==typeof i?a!==i||!c:!i.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?c.call(a,s):c?c.value=s:i.set(a,s),s};let ChatCompletionStream=class ChatCompletionStream extends AbstractChatCompletionRunner{constructor(){super(...arguments),ey.add(this),eb.set(this,void 0)}get currentChatCompletionSnapshot(){return ChatCompletionStream_classPrivateFieldGet(this,eb,"f")}static fromReadableStream(a){let i=new ChatCompletionStream;return i._run(()=>i._fromReadableStream(a)),i}static createChatCompletion(a,i,s){let o=new ChatCompletionStream;return o._run(()=>o._runChatCompletion(a,{...i,stream:!0},{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),o}async _createChatCompletion(a,i,s){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),ChatCompletionStream_classPrivateFieldGet(this,ey,"m",e_).call(this);let c=await a.create({...i,stream:!0},{...s,signal:this.controller.signal});for await(let a of(this._connected(),c))ChatCompletionStream_classPrivateFieldGet(this,ey,"m",ev).call(this,a);if(c.controller.signal?.aborted)throw new APIUserAbortError;return this._addChatCompletion(ChatCompletionStream_classPrivateFieldGet(this,ey,"m",ew).call(this))}async _fromReadableStream(a,i){let s;let o=i?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort())),ChatCompletionStream_classPrivateFieldGet(this,ey,"m",e_).call(this),this._connected();let c=Stream.fromReadableStream(a,this.controller);for await(let a of c)s&&s!==a.id&&this._addChatCompletion(ChatCompletionStream_classPrivateFieldGet(this,ey,"m",ew).call(this)),ChatCompletionStream_classPrivateFieldGet(this,ey,"m",ev).call(this,a),s=a.id;if(c.controller.signal?.aborted)throw new APIUserAbortError;return this._addChatCompletion(ChatCompletionStream_classPrivateFieldGet(this,ey,"m",ew).call(this))}[(eb=new WeakMap,ey=new WeakSet,e_=function(){this.ended||ChatCompletionStream_classPrivateFieldSet(this,eb,void 0,"f")},ev=function(a){if(this.ended)return;let i=ChatCompletionStream_classPrivateFieldGet(this,ey,"m",eP).call(this,a);this._emit("chunk",a,i);let s=a.choices[0]?.delta?.content,o=i.choices[0]?.message;null!=s&&o?.role==="assistant"&&o?.content&&this._emit("content",s,o.content)},ew=function(){if(this.ended)throw new error_OpenAIError("stream has ended, this shouldn't happen");let a=ChatCompletionStream_classPrivateFieldGet(this,eb,"f");if(!a)throw new error_OpenAIError("request ended without sending any chunks");return ChatCompletionStream_classPrivateFieldSet(this,eb,void 0,"f"),finalizeChatCompletion(a)},eP=function(a){var i,s,o;let c=ChatCompletionStream_classPrivateFieldGet(this,eb,"f"),{choices:w,...P}=a;for(let{delta:w,finish_reason:A,index:x,logprobs:k=null,...R}of(c?Object.assign(c,P):c=ChatCompletionStream_classPrivateFieldSet(this,eb,{...P,choices:[]},"f"),a.choices)){let a=c.choices[x];if(a||(a=c.choices[x]={finish_reason:A,index:x,message:{},logprobs:k,...R}),k){if(a.logprobs){let{content:s,...o}=k;Object.assign(a.logprobs,o),s&&((i=a.logprobs).content??(i.content=[]),a.logprobs.content.push(...s))}else a.logprobs=Object.assign({},k)}if(A&&(a.finish_reason=A),Object.assign(a,R),!w)continue;let{content:P,function_call:j,role:$,tool_calls:B,...D}=w;if(Object.assign(a.message,D),P&&(a.message.content=(a.message.content||"")+P),$&&(a.message.role=$),j&&(a.message.function_call?(j.name&&(a.message.function_call.name=j.name),j.arguments&&((s=a.message.function_call).arguments??(s.arguments=""),a.message.function_call.arguments+=j.arguments)):a.message.function_call=j),B)for(let{index:i,id:s,type:c,function:w,...P}of(a.message.tool_calls||(a.message.tool_calls=[]),B)){let A=(o=a.message.tool_calls)[i]??(o[i]={});Object.assign(A,P),s&&(A.id=s),c&&(A.type=c),w&&(A.function??(A.function={arguments:""})),w?.name&&(A.function.name=w.name),w?.arguments&&(A.function.arguments+=w.arguments)}}return c},Symbol.asyncIterator)](){let a=[],i=[],s=!1;return this.on("chunk",s=>{let o=i.shift();o?o.resolve(s):a.push(s)}),this.on("end",()=>{for(let a of(s=!0,i))a.resolve(void 0);i.length=0}),this.on("abort",a=>{for(let o of(s=!0,i))o.reject(a);i.length=0}),this.on("error",a=>{for(let o of(s=!0,i))o.reject(a);i.length=0}),{next:async()=>{if(!a.length)return s?{value:void 0,done:!0}:new Promise((a,s)=>i.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0});let o=a.shift();return{value:o,done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}toReadableStream(){let a=new Stream(this[Symbol.asyncIterator].bind(this),this.controller);return a.toReadableStream()}};function finalizeChatCompletion(a){let{id:i,choices:s,created:o,model:c,system_fingerprint:w,...P}=a;return{...P,id:i,choices:s.map(({message:i,finish_reason:s,index:o,logprobs:c,...w})=>{if(!s)throw new error_OpenAIError(`missing finish_reason for choice ${o}`);let{content:P=null,function_call:A,tool_calls:x,...k}=i,R=i.role;if(!R)throw new error_OpenAIError(`missing role for choice ${o}`);if(A){let{arguments:a,name:i}=A;if(null==a)throw new error_OpenAIError(`missing function_call.arguments for choice ${o}`);if(!i)throw new error_OpenAIError(`missing function_call.name for choice ${o}`);return{...w,message:{content:P,function_call:{arguments:a,name:i},role:R},finish_reason:s,index:o,logprobs:c}}return x?{...w,index:o,finish_reason:s,logprobs:c,message:{...k,role:R,content:P,tool_calls:x.map((i,s)=>{let{function:c,type:w,id:P,...A}=i,{arguments:x,name:k,...R}=c||{};if(null==P)throw new error_OpenAIError(`missing choices[${o}].tool_calls[${s}].id
${str(a)}`);if(null==w)throw new error_OpenAIError(`missing choices[${o}].tool_calls[${s}].type
${str(a)}`);if(null==k)throw new error_OpenAIError(`missing choices[${o}].tool_calls[${s}].function.name
${str(a)}`);if(null==x)throw new error_OpenAIError(`missing choices[${o}].tool_calls[${s}].function.arguments
${str(a)}`);return{...A,id:P,type:w,function:{...R,name:k,arguments:x}}})}}:{...w,message:{...k,content:P,role:R},finish_reason:s,index:o,logprobs:c}}),created:o,model:c,object:"chat.completion",...w?{system_fingerprint:w}:{}}}function str(a){return JSON.stringify(a)}let ChatCompletionStreamingRunner=class ChatCompletionStreamingRunner extends ChatCompletionStream{static fromReadableStream(a){let i=new ChatCompletionStreamingRunner;return i._run(()=>i._fromReadableStream(a)),i}static runFunctions(a,i,s){let o=new ChatCompletionStreamingRunner,c={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return o._run(()=>o._runFunctions(a,i,c)),o}static runTools(a,i,s){let o=new ChatCompletionStreamingRunner,c={...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"runTools"}};return o._run(()=>o._runTools(a,i,c)),o}};let chat_completions_Completions=class chat_completions_Completions extends APIResource{runFunctions(a,i){return a.stream?ChatCompletionStreamingRunner.runFunctions(this._client.chat.completions,a,i):ChatCompletionRunner.runFunctions(this._client.chat.completions,a,i)}runTools(a,i){return a.stream?ChatCompletionStreamingRunner.runTools(this._client.chat.completions,a,i):ChatCompletionRunner.runTools(this._client.chat.completions,a,i)}stream(a,i){return ChatCompletionStream.createChatCompletion(this._client.chat.completions,a,i)}};let chat_Chat=class chat_Chat extends APIResource{constructor(){super(...arguments),this.completions=new chat_completions_Completions(this._client)}};(chat_Chat||(chat_Chat={})).Completions=chat_completions_Completions;var AbstractAssistantStreamRunner_classPrivateFieldSet=function(a,i,s,o,c){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!c)throw TypeError("Private accessor was defined without a setter");if("function"==typeof i?a!==i||!c:!i.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?c.call(a,s):c?c.value=s:i.set(a,s),s},AbstractAssistantStreamRunner_classPrivateFieldGet=function(a,i,s,o){if("a"===s&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof i?a!==i||!o:!i.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(a):o?o.value:i.get(a)};let AbstractAssistantStreamRunner=class AbstractAssistantStreamRunner{constructor(){this.controller=new AbortController,eA.set(this,void 0),eC.set(this,()=>{}),eE.set(this,()=>{}),eO.set(this,void 0),eS.set(this,()=>{}),eT.set(this,()=>{}),ex.set(this,{}),ek.set(this,!1),eI.set(this,!1),eR.set(this,!1),ej.set(this,!1),eM.set(this,a=>{if(AbstractAssistantStreamRunner_classPrivateFieldSet(this,eI,!0,"f"),a instanceof Error&&"AbortError"===a.name&&(a=new APIUserAbortError),a instanceof APIUserAbortError)return AbstractAssistantStreamRunner_classPrivateFieldSet(this,eR,!0,"f"),this._emit("abort",a);if(a instanceof error_OpenAIError)return this._emit("error",a);if(a instanceof Error){let i=new error_OpenAIError(a.message);return i.cause=a,this._emit("error",i)}return this._emit("error",new error_OpenAIError(String(a)))}),AbstractAssistantStreamRunner_classPrivateFieldSet(this,eA,new Promise((a,i)=>{AbstractAssistantStreamRunner_classPrivateFieldSet(this,eC,a,"f"),AbstractAssistantStreamRunner_classPrivateFieldSet(this,eE,i,"f")}),"f"),AbstractAssistantStreamRunner_classPrivateFieldSet(this,eO,new Promise((a,i)=>{AbstractAssistantStreamRunner_classPrivateFieldSet(this,eS,a,"f"),AbstractAssistantStreamRunner_classPrivateFieldSet(this,eT,i,"f")}),"f"),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eA,"f").catch(()=>{}),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eO,"f").catch(()=>{})}_run(a){setTimeout(()=>{a().then(()=>{this._emit("end")},AbstractAssistantStreamRunner_classPrivateFieldGet(this,eM,"f"))},0)}_addRun(a){return a}_connected(){this.ended||(AbstractAssistantStreamRunner_classPrivateFieldGet(this,eC,"f").call(this),this._emit("connect"))}get ended(){return AbstractAssistantStreamRunner_classPrivateFieldGet(this,ek,"f")}get errored(){return AbstractAssistantStreamRunner_classPrivateFieldGet(this,eI,"f")}get aborted(){return AbstractAssistantStreamRunner_classPrivateFieldGet(this,eR,"f")}abort(){this.controller.abort()}on(a,i){let s=AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a]||(AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a]=[]);return s.push({listener:i}),this}off(a,i){let s=AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a];if(!s)return this;let o=s.findIndex(a=>a.listener===i);return o>=0&&s.splice(o,1),this}once(a,i){let s=AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a]||(AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a]=[]);return s.push({listener:i,once:!0}),this}emitted(a){return new Promise((i,s)=>{AbstractAssistantStreamRunner_classPrivateFieldSet(this,ej,!0,"f"),"error"!==a&&this.once("error",s),this.once(a,i)})}async done(){AbstractAssistantStreamRunner_classPrivateFieldSet(this,ej,!0,"f"),await AbstractAssistantStreamRunner_classPrivateFieldGet(this,eO,"f")}_emit(a,...i){if(AbstractAssistantStreamRunner_classPrivateFieldGet(this,ek,"f"))return;"end"===a&&(AbstractAssistantStreamRunner_classPrivateFieldSet(this,ek,!0,"f"),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eS,"f").call(this));let s=AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a];if(s&&(AbstractAssistantStreamRunner_classPrivateFieldGet(this,ex,"f")[a]=s.filter(a=>!a.once),s.forEach(({listener:a})=>a(...i))),"abort"===a){let a=i[0];AbstractAssistantStreamRunner_classPrivateFieldGet(this,ej,"f")||s?.length||Promise.reject(a),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eE,"f").call(this,a),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eT,"f").call(this,a),this._emit("end");return}if("error"===a){let a=i[0];AbstractAssistantStreamRunner_classPrivateFieldGet(this,ej,"f")||s?.length||Promise.reject(a),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eE,"f").call(this,a),AbstractAssistantStreamRunner_classPrivateFieldGet(this,eT,"f").call(this,a),this._emit("end")}}async _threadAssistantStream(a,i,s){return await this._createThreadAssistantStream(i,a,s)}async _runAssistantStream(a,i,s,o){return await this._createAssistantStream(i,a,s,o)}async _runToolAssistantStream(a,i,s,o,c){return await this._createToolAssistantStream(s,a,i,o,c)}async _createThreadAssistantStream(a,i,s){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let c=await a.createAndRun({...i,stream:!1},{...s,signal:this.controller.signal});return this._connected(),this._addRun(c)}async _createToolAssistantStream(a,i,s,o,c){let w=c?.signal;w&&(w.aborted&&this.controller.abort(),w.addEventListener("abort",()=>this.controller.abort()));let P=await a.submitToolOutputs(i,s,{...o,stream:!1},{...c,signal:this.controller.signal});return this._connected(),this._addRun(P)}async _createAssistantStream(a,i,s,o){let c=o?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort()));let w=await a.create(i,{...s,stream:!1},{...o,signal:this.controller.signal});return this._connected(),this._addRun(w)}};eA=new WeakMap,eC=new WeakMap,eE=new WeakMap,eO=new WeakMap,eS=new WeakMap,eT=new WeakMap,ex=new WeakMap,ek=new WeakMap,eI=new WeakMap,eR=new WeakMap,ej=new WeakMap,eM=new WeakMap;var AssistantStream_classPrivateFieldGet=function(a,i,s,o){if("a"===s&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof i?a!==i||!o:!i.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(a):o?o.value:i.get(a)},AssistantStream_classPrivateFieldSet=function(a,i,s,o,c){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!c)throw TypeError("Private accessor was defined without a setter");if("function"==typeof i?a!==i||!c:!i.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?c.call(a,s):c?c.value=s:i.set(a,s),s};let AssistantStream=class AssistantStream extends AbstractAssistantStreamRunner{constructor(){super(...arguments),eN.add(this),eL.set(this,[]),e$.set(this,{}),eF.set(this,{}),eB.set(this,void 0),eD.set(this,void 0),eZ.set(this,void 0),eU.set(this,void 0),ez.set(this,void 0),eV.set(this,void 0),eq.set(this,void 0),eH.set(this,void 0),eG.set(this,void 0)}[(eL=new WeakMap,e$=new WeakMap,eF=new WeakMap,eB=new WeakMap,eD=new WeakMap,eZ=new WeakMap,eU=new WeakMap,ez=new WeakMap,eV=new WeakMap,eq=new WeakMap,eH=new WeakMap,eG=new WeakMap,eN=new WeakSet,Symbol.asyncIterator)](){let a=[],i=[],s=!1;return this.on("event",s=>{let o=i.shift();o?o.resolve(s):a.push(s)}),this.on("end",()=>{for(let a of(s=!0,i))a.resolve(void 0);i.length=0}),this.on("abort",a=>{for(let o of(s=!0,i))o.reject(a);i.length=0}),this.on("error",a=>{for(let o of(s=!0,i))o.reject(a);i.length=0}),{next:async()=>{if(!a.length)return s?{value:void 0,done:!0}:new Promise((a,s)=>i.push({resolve:a,reject:s})).then(a=>a?{value:a,done:!1}:{value:void 0,done:!0});let o=a.shift();return{value:o,done:!1}},return:async()=>(this.abort(),{value:void 0,done:!0})}}static fromReadableStream(a){let i=new AssistantStream;return i._run(()=>i._fromReadableStream(a)),i}async _fromReadableStream(a,i){let s=i?.signal;s&&(s.aborted&&this.controller.abort(),s.addEventListener("abort",()=>this.controller.abort())),this._connected();let o=Stream.fromReadableStream(a,this.controller);for await(let a of o)AssistantStream_classPrivateFieldGet(this,eN,"m",eW).call(this,a);if(o.controller.signal?.aborted)throw new APIUserAbortError;return this._addRun(AssistantStream_classPrivateFieldGet(this,eN,"m",eK).call(this))}toReadableStream(){let a=new Stream(this[Symbol.asyncIterator].bind(this),this.controller);return a.toReadableStream()}static createToolAssistantStream(a,i,s,o,c){let w=new AssistantStream;return w._run(()=>w._runToolAssistantStream(a,i,s,o,{...c,headers:{...c?.headers,"X-Stainless-Helper-Method":"stream"}})),w}async _createToolAssistantStream(a,i,s,o,c){let w=c?.signal;w&&(w.aborted&&this.controller.abort(),w.addEventListener("abort",()=>this.controller.abort()));let P={...o,stream:!0},A=await a.submitToolOutputs(i,s,P,{...c,signal:this.controller.signal});for await(let a of(this._connected(),A))AssistantStream_classPrivateFieldGet(this,eN,"m",eW).call(this,a);if(A.controller.signal?.aborted)throw new APIUserAbortError;return this._addRun(AssistantStream_classPrivateFieldGet(this,eN,"m",eK).call(this))}static createThreadAssistantStream(a,i,s){let o=new AssistantStream;return o._run(()=>o._threadAssistantStream(a,i,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),o}static createAssistantStream(a,i,s,o){let c=new AssistantStream;return c._run(()=>c._runAssistantStream(a,i,s,{...o,headers:{...o?.headers,"X-Stainless-Helper-Method":"stream"}})),c}currentEvent(){return AssistantStream_classPrivateFieldGet(this,eq,"f")}currentRun(){return AssistantStream_classPrivateFieldGet(this,eH,"f")}currentMessageSnapshot(){return AssistantStream_classPrivateFieldGet(this,eB,"f")}currentRunStepSnapshot(){return AssistantStream_classPrivateFieldGet(this,eG,"f")}async finalRunSteps(){return await this.done(),Object.values(AssistantStream_classPrivateFieldGet(this,e$,"f"))}async finalMessages(){return await this.done(),Object.values(AssistantStream_classPrivateFieldGet(this,eF,"f"))}async finalRun(){if(await this.done(),!AssistantStream_classPrivateFieldGet(this,eD,"f"))throw Error("Final run was not received.");return AssistantStream_classPrivateFieldGet(this,eD,"f")}async _createThreadAssistantStream(a,i,s){let o=s?.signal;o&&(o.aborted&&this.controller.abort(),o.addEventListener("abort",()=>this.controller.abort()));let c={...i,stream:!0},w=await a.createAndRun(c,{...s,signal:this.controller.signal});for await(let a of(this._connected(),w))AssistantStream_classPrivateFieldGet(this,eN,"m",eW).call(this,a);if(w.controller.signal?.aborted)throw new APIUserAbortError;return this._addRun(AssistantStream_classPrivateFieldGet(this,eN,"m",eK).call(this))}async _createAssistantStream(a,i,s,o){let c=o?.signal;c&&(c.aborted&&this.controller.abort(),c.addEventListener("abort",()=>this.controller.abort()));let w={...s,stream:!0},P=await a.create(i,w,{...o,signal:this.controller.signal});for await(let a of(this._connected(),P))AssistantStream_classPrivateFieldGet(this,eN,"m",eW).call(this,a);if(P.controller.signal?.aborted)throw new APIUserAbortError;return this._addRun(AssistantStream_classPrivateFieldGet(this,eN,"m",eK).call(this))}static accumulateDelta(a,i){for(let[s,o]of Object.entries(i)){if(!a.hasOwnProperty(s)){a[s]=o;continue}let i=a[s];if(null==i||"index"===s||"type"===s){a[s]=o;continue}if("string"==typeof i&&"string"==typeof o)i+=o;else if("number"==typeof i&&"number"==typeof o)i+=o;else if(isObj(i)&&isObj(o))i=this.accumulateDelta(i,o);else if(Array.isArray(i)&&Array.isArray(o)){if(i.every(a=>"string"==typeof a||"number"==typeof a)){i.push(...o);continue}}else throw Error(`Unhandled record type: ${s}, deltaValue: ${o}, accValue: ${i}`);a[s]=i}return a}};eW=function(a){if(!this.ended)switch(AssistantStream_classPrivateFieldSet(this,eq,a,"f"),AssistantStream_classPrivateFieldGet(this,eN,"m",eY).call(this,a),a.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":AssistantStream_classPrivateFieldGet(this,eN,"m",e2).call(this,a);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":AssistantStream_classPrivateFieldGet(this,eN,"m",eQ).call(this,a);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":AssistantStream_classPrivateFieldGet(this,eN,"m",eJ).call(this,a);break;case"error":throw Error("Encountered an error event in event processing - errors should be processed earlier")}},eK=function(){if(this.ended)throw new error_OpenAIError("stream has ended, this shouldn't happen");if(!AssistantStream_classPrivateFieldGet(this,eD,"f"))throw Error("Final run has not been received");return AssistantStream_classPrivateFieldGet(this,eD,"f")},eJ=function(a){let[i,s]=AssistantStream_classPrivateFieldGet(this,eN,"m",e0).call(this,a,AssistantStream_classPrivateFieldGet(this,eB,"f"));for(let a of(AssistantStream_classPrivateFieldSet(this,eB,i,"f"),AssistantStream_classPrivateFieldGet(this,eF,"f")[i.id]=i,s)){let s=i.content[a.index];s?.type=="text"&&this._emit("textCreated",s.text)}switch(a.event){case"thread.message.created":this._emit("messageCreated",a.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",a.data.delta,i),a.data.delta.content)for(let s of a.data.delta.content){if("text"==s.type&&s.text){let a=s.text,o=i.content[s.index];if(o&&"text"==o.type)this._emit("textDelta",a,o.text);else throw Error("The snapshot associated with this text delta is not text or missing")}if(s.index!=AssistantStream_classPrivateFieldGet(this,eZ,"f")){if(AssistantStream_classPrivateFieldGet(this,eU,"f"))switch(AssistantStream_classPrivateFieldGet(this,eU,"f").type){case"text":this._emit("textDone",AssistantStream_classPrivateFieldGet(this,eU,"f").text,AssistantStream_classPrivateFieldGet(this,eB,"f"));break;case"image_file":this._emit("imageFileDone",AssistantStream_classPrivateFieldGet(this,eU,"f").image_file,AssistantStream_classPrivateFieldGet(this,eB,"f"))}AssistantStream_classPrivateFieldSet(this,eZ,s.index,"f")}AssistantStream_classPrivateFieldSet(this,eU,i.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==AssistantStream_classPrivateFieldGet(this,eZ,"f")){let i=a.data.content[AssistantStream_classPrivateFieldGet(this,eZ,"f")];if(i)switch(i.type){case"image_file":this._emit("imageFileDone",i.image_file,AssistantStream_classPrivateFieldGet(this,eB,"f"));break;case"text":this._emit("textDone",i.text,AssistantStream_classPrivateFieldGet(this,eB,"f"))}}AssistantStream_classPrivateFieldGet(this,eB,"f")&&this._emit("messageDone",a.data),AssistantStream_classPrivateFieldSet(this,eB,void 0,"f")}},eQ=function(a){let i=AssistantStream_classPrivateFieldGet(this,eN,"m",eX).call(this,a);switch(AssistantStream_classPrivateFieldSet(this,eG,i,"f"),a.event){case"thread.run.step.created":this._emit("runStepCreated",a.data);break;case"thread.run.step.delta":let s=a.data.delta;if(s.step_details&&"tool_calls"==s.step_details.type&&s.step_details.tool_calls&&"tool_calls"==i.step_details.type)for(let a of s.step_details.tool_calls)a.index==AssistantStream_classPrivateFieldGet(this,ez,"f")?this._emit("toolCallDelta",a,i.step_details.tool_calls[a.index]):(AssistantStream_classPrivateFieldGet(this,eV,"f")&&this._emit("toolCallDone",AssistantStream_classPrivateFieldGet(this,eV,"f")),AssistantStream_classPrivateFieldSet(this,ez,a.index,"f"),AssistantStream_classPrivateFieldSet(this,eV,i.step_details.tool_calls[a.index],"f"),AssistantStream_classPrivateFieldGet(this,eV,"f")&&this._emit("toolCallCreated",AssistantStream_classPrivateFieldGet(this,eV,"f")));this._emit("runStepDelta",a.data.delta,i);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":AssistantStream_classPrivateFieldSet(this,eG,void 0,"f");let o=a.data.step_details;"tool_calls"==o.type&&AssistantStream_classPrivateFieldGet(this,eV,"f")&&(this._emit("toolCallDone",AssistantStream_classPrivateFieldGet(this,eV,"f")),AssistantStream_classPrivateFieldSet(this,eV,void 0,"f")),this._emit("runStepDone",a.data,i)}},eY=function(a){AssistantStream_classPrivateFieldGet(this,eL,"f").push(a),this._emit("event",a)},eX=function(a){switch(a.event){case"thread.run.step.created":return AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id]=a.data,a.data;case"thread.run.step.delta":let i=AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id];if(!i)throw Error("Received a RunStepDelta before creation of a snapshot");let s=a.data;if(s.delta){let o=AssistantStream.accumulateDelta(i,s.delta);AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id]=o}return AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id]=a.data}if(AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id])return AssistantStream_classPrivateFieldGet(this,e$,"f")[a.data.id];throw Error("No snapshot available")},e0=function(a,i){let s=[];switch(a.event){case"thread.message.created":return[a.data,s];case"thread.message.delta":if(!i)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let o=a.data;if(o.delta.content)for(let a of o.delta.content)if(a.index in i.content){let s=i.content[a.index];i.content[a.index]=AssistantStream_classPrivateFieldGet(this,eN,"m",e1).call(this,a,s)}else i.content[a.index]=a,s.push(a);return[i,s];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(i)return[i,s];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},e1=function(a,i){return AssistantStream.accumulateDelta(i,a)},e2=function(a){switch(AssistantStream_classPrivateFieldSet(this,eH,a.data,"f"),a.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":AssistantStream_classPrivateFieldSet(this,eD,a.data,"f"),AssistantStream_classPrivateFieldGet(this,eV,"f")&&(this._emit("toolCallDone",AssistantStream_classPrivateFieldGet(this,eV,"f")),AssistantStream_classPrivateFieldSet(this,eV,void 0,"f"))}};let Messages=class Messages extends APIResource{create(a,i,s){return this._client.post(`/threads/${a}/messages`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(a,i,s){return this._client.get(`/threads/${a}/messages/${i}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(a,i,s,o){return this._client.post(`/threads/${a}/messages/${i}`,{body:s,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(a,i={},s){return isRequestOptions(i)?this.list(a,{},i):this._client.getAPIList(`/threads/${a}/messages`,MessagesPage,{query:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}};let MessagesPage=class MessagesPage extends CursorPage{};(Messages||(Messages={})).MessagesPage=MessagesPage;let Steps=class Steps extends APIResource{retrieve(a,i,s,o){return this._client.get(`/threads/${a}/runs/${i}/steps/${s}`,{...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(a,i,s={},o){return isRequestOptions(s)?this.list(a,i,{},s):this._client.getAPIList(`/threads/${a}/runs/${i}/steps`,RunStepsPage,{query:s,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}};let RunStepsPage=class RunStepsPage extends CursorPage{};(Steps||(Steps={})).RunStepsPage=RunStepsPage;let Runs=class Runs extends APIResource{constructor(){super(...arguments),this.steps=new Steps(this._client)}create(a,i,s){return this._client.post(`/threads/${a}/runs`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:i.stream??!1})}retrieve(a,i,s){return this._client.get(`/threads/${a}/runs/${i}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}update(a,i,s,o){return this._client.post(`/threads/${a}/runs/${i}`,{body:s,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}list(a,i={},s){return isRequestOptions(i)?this.list(a,{},i):this._client.getAPIList(`/threads/${a}/runs`,RunsPage,{query:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(a,i,s){return this._client.post(`/threads/${a}/runs/${i}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(a,i,s){let o=await this.create(a,i,s);return await this.poll(a,o.id,s)}createAndStream(a,i,s){return AssistantStream.createAssistantStream(a,this._client.beta.threads.runs,i,s)}async poll(a,i,s){let o={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(o["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let{data:c,response:w}=await this.retrieve(a,i,{...s,headers:{...s?.headers,...o}}).withResponse();switch(c.status){case"queued":case"in_progress":case"cancelling":let P=5e3;if(s?.pollIntervalMs)P=s.pollIntervalMs;else{let a=w.headers.get("openai-poll-after-ms");if(a){let i=parseInt(a);isNaN(i)||(P=i)}}await sleep(P);break;case"requires_action":case"cancelled":case"completed":case"failed":case"expired":return c}}}stream(a,i,s){return AssistantStream.createAssistantStream(a,this._client.beta.threads.runs,i,s)}submitToolOutputs(a,i,s,o){return this._client.post(`/threads/${a}/runs/${i}/submit_tool_outputs`,{body:s,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers},stream:s.stream??!1})}async submitToolOutputsAndPoll(a,i,s,o){let c=await this.submitToolOutputs(a,i,s,o);return await this.poll(a,c.id,o)}submitToolOutputsStream(a,i,s,o){return AssistantStream.createToolAssistantStream(a,i,this._client.beta.threads.runs,s,o)}};let RunsPage=class RunsPage extends CursorPage{};(U=Runs||(Runs={})).RunsPage=RunsPage,U.Steps=Steps,U.RunStepsPage=RunStepsPage;let Threads=class Threads extends APIResource{constructor(){super(...arguments),this.runs=new Runs(this._client),this.messages=new Messages(this._client)}create(a={},i){return isRequestOptions(a)?this.create({},a):this._client.post("/threads",{body:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}retrieve(a,i){return this._client.get(`/threads/${a}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}update(a,i,s){return this._client.post(`/threads/${a}`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(a,i){return this._client.delete(`/threads/${a}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}createAndRun(a,i){return this._client.post("/threads/runs",{body:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers},stream:a.stream??!1})}async createAndRunPoll(a,i){let s=await this.createAndRun(a,i);return await this.runs.poll(s.thread_id,s.id,i)}createAndRunStream(a,i){return AssistantStream.createThreadAssistantStream(a,this._client.beta.threads,i)}};(z=Threads||(Threads={})).Runs=Runs,z.RunsPage=RunsPage,z.Messages=Messages,z.MessagesPage=MessagesPage;let allSettledWithThrow=async a=>{let i=await Promise.allSettled(a),s=i.filter(a=>"rejected"===a.status);if(s.length){for(let a of s)console.error(a.reason);throw Error(`${s.length} promise(s) failed - see the above errors`)}let o=[];for(let a of i)"fulfilled"===a.status&&o.push(a.value);return o};let files_Files=class files_Files extends APIResource{create(a,i,s){return this._client.post(`/vector_stores/${a}/files`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(a,i,s){return this._client.get(`/vector_stores/${a}/files/${i}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(a,i={},s){return isRequestOptions(i)?this.list(a,{},i):this._client.getAPIList(`/vector_stores/${a}/files`,VectorStoreFilesPage,{query:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}del(a,i,s){return this._client.delete(`/vector_stores/${a}/files/${i}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(a,i,s){let o=await this.create(a,i,s);return await this.poll(a,o.id,s)}async poll(a,i,s){let o={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(o["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let c=await this.retrieve(a,i,{...s,headers:o}).withResponse(),w=c.data;switch(w.status){case"in_progress":let P=5e3;if(s?.pollIntervalMs)P=s.pollIntervalMs;else{let a=c.response.headers.get("openai-poll-after-ms");if(a){let i=parseInt(a);isNaN(i)||(P=i)}}await sleep(P);break;case"failed":case"completed":return w}}}async upload(a,i,s){let o=await this._client.files.create({file:i,purpose:"assistants"},s);return this.create(a,{file_id:o.id},s)}async uploadAndPoll(a,i,s){let o=await this._client.files.create({file:i,purpose:"assistants"},s);return await this.poll(a,o.id,s)}};let VectorStoreFilesPage=class VectorStoreFilesPage extends CursorPage{};(files_Files||(files_Files={})).VectorStoreFilesPage=VectorStoreFilesPage;let FileBatches=class FileBatches extends APIResource{create(a,i,s){return this._client.post(`/vector_stores/${a}/file_batches`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}retrieve(a,i,s){return this._client.get(`/vector_stores/${a}/file_batches/${i}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}cancel(a,i,s){return this._client.post(`/vector_stores/${a}/file_batches/${i}/cancel`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}async createAndPoll(a,i,s){let o=await this.create(a,i);return await this.poll(a,o.id,s)}listFiles(a,i,s={},o){return isRequestOptions(s)?this.listFiles(a,i,{},s):this._client.getAPIList(`/vector_stores/${a}/file_batches/${i}/files`,VectorStoreFilesPage,{query:s,...o,headers:{"OpenAI-Beta":"assistants=v2",...o?.headers}})}async poll(a,i,s){let o={...s?.headers,"X-Stainless-Poll-Helper":"true"};for(s?.pollIntervalMs&&(o["X-Stainless-Custom-Poll-Interval"]=s.pollIntervalMs.toString());;){let{data:c,response:w}=await this.retrieve(a,i,{...s,headers:o}).withResponse();switch(c.status){case"in_progress":let P=5e3;if(s?.pollIntervalMs)P=s.pollIntervalMs;else{let a=w.headers.get("openai-poll-after-ms");if(a){let i=parseInt(a);isNaN(i)||(P=i)}}await sleep(P);break;case"failed":case"completed":return c}}}async uploadAndPoll(a,{files:i,fileIds:s=[]},o){if(null===i||0==i.length)throw Error("No files provided to process.");let c=o?.maxConcurrency??5,w=Math.min(c,i.length),P=this._client,A=i.values(),x=[...s];async function processFiles(a){for(let i of a){let a=await P.files.create({file:i,purpose:"assistants"},o);x.push(a.id)}}let k=Array(w).fill(A).map(processFiles);return await allSettledWithThrow(k),await this.createAndPoll(a,{file_ids:x})}};FileBatches||(FileBatches={});let VectorStores=class VectorStores extends APIResource{constructor(){super(...arguments),this.files=new files_Files(this._client),this.fileBatches=new FileBatches(this._client)}create(a,i){return this._client.post("/vector_stores",{body:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}retrieve(a,i){return this._client.get(`/vector_stores/${a}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}update(a,i,s){return this._client.post(`/vector_stores/${a}`,{body:i,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(a={},i){return isRequestOptions(a)?this.list({},a):this._client.getAPIList("/vector_stores",VectorStoresPage,{query:a,...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}del(a,i){return this._client.delete(`/vector_stores/${a}`,{...i,headers:{"OpenAI-Beta":"assistants=v2",...i?.headers}})}};let VectorStoresPage=class VectorStoresPage extends CursorPage{};(V=VectorStores||(VectorStores={})).VectorStoresPage=VectorStoresPage,V.Files=files_Files,V.VectorStoreFilesPage=VectorStoreFilesPage,V.FileBatches=FileBatches;let Beta=class Beta extends APIResource{constructor(){super(...arguments),this.vectorStores=new VectorStores(this._client),this.chat=new chat_Chat(this._client),this.assistants=new Assistants(this._client),this.threads=new Threads(this._client)}};(G=Beta||(Beta={})).VectorStores=VectorStores,G.VectorStoresPage=VectorStoresPage,G.Chat=chat_Chat,G.Assistants=Assistants,G.AssistantsPage=AssistantsPage,G.Threads=Threads;let Batches=class Batches extends APIResource{create(a,i){return this._client.post("/batches",{body:a,...i})}retrieve(a,i){return this._client.get(`/batches/${a}`,i)}list(a={},i){return isRequestOptions(a)?this.list({},a):this._client.getAPIList("/batches",BatchesPage,{query:a,...i})}cancel(a,i){return this._client.post(`/batches/${a}/cancel`,i)}};let BatchesPage=class BatchesPage extends CursorPage{};(Batches||(Batches={})).BatchesPage=BatchesPage;let openai_OpenAI=class openai_OpenAI extends APIClient{constructor({baseURL:a=readEnv("OPENAI_BASE_URL"),apiKey:i=readEnv("OPENAI_API_KEY"),organization:s=readEnv("OPENAI_ORG_ID")??null,project:o=readEnv("OPENAI_PROJECT_ID")??null,...c}={}){if(void 0===i)throw new error_OpenAIError("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");let w={apiKey:i,organization:s,project:o,...c,baseURL:a||"https://api.openai.com/v1"};if(!w.dangerouslyAllowBrowser&&isRunningInBrowser())throw new error_OpenAIError("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:w.baseURL,timeout:w.timeout??6e5,httpAgent:w.httpAgent,maxRetries:w.maxRetries,fetch:w.fetch}),this.completions=new Completions(this),this.chat=new Chat(this),this.embeddings=new embeddings_Embeddings(this),this.files=new Files(this),this.images=new Images(this),this.audio=new Audio(this),this.moderations=new Moderations(this),this.models=new Models(this),this.fineTuning=new FineTuning(this),this.beta=new Beta(this),this.batches=new Batches(this),this._options=w,this.apiKey=i,this.organization=s,this.project=o}defaultQuery(){return this._options.defaultQuery}defaultHeaders(a){return{...super.defaultHeaders(a),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(a){return{Authorization:`Bearer ${this.apiKey}`}}};e4=openai_OpenAI,openai_OpenAI.OpenAI=e4,openai_OpenAI.OpenAIError=error_OpenAIError,openai_OpenAI.APIError=APIError,openai_OpenAI.APIConnectionError=APIConnectionError,openai_OpenAI.APIConnectionTimeoutError=APIConnectionTimeoutError,openai_OpenAI.APIUserAbortError=APIUserAbortError,openai_OpenAI.NotFoundError=NotFoundError,openai_OpenAI.ConflictError=ConflictError,openai_OpenAI.RateLimitError=RateLimitError,openai_OpenAI.BadRequestError=BadRequestError,openai_OpenAI.AuthenticationError=AuthenticationError,openai_OpenAI.InternalServerError=InternalServerError,openai_OpenAI.PermissionDeniedError=PermissionDeniedError,openai_OpenAI.UnprocessableEntityError=UnprocessableEntityError,openai_OpenAI.toFile=toFile,openai_OpenAI.fileFromPath=j;let{OpenAIError:ta,APIError:tn,APIConnectionError:ti,APIConnectionTimeoutError:ts,APIUserAbortError:to,NotFoundError:tl,ConflictError:tu,RateLimitError:tc,BadRequestError:td,AuthenticationError:th,InternalServerError:tp,PermissionDeniedError:tf,UnprocessableEntityError:tm}=e5;(W=openai_OpenAI||(openai_OpenAI={})).Page=Page,W.CursorPage=CursorPage,W.Completions=Completions,W.Chat=Chat,W.Embeddings=embeddings_Embeddings,W.Files=Files,W.FileObjectsPage=FileObjectsPage,W.Images=Images,W.Audio=Audio,W.Moderations=Moderations,W.Models=Models,W.ModelsPage=ModelsPage,W.FineTuning=FineTuning,W.Beta=Beta,W.Batches=Batches,W.BatchesPage=BatchesPage;var tg=s(6261),ty=s(8398),tb=s(2488),t_=s(3478),tv=s(7610),tw=s(7018);let BaseChatModel=class BaseChatModel extends tv.qV{constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","chat_models",this._llmType()]})}_separateRunnableConfigFromCallOptions(a){let[i,s]=super._separateRunnableConfigFromCallOptions(a);return s?.timeout&&!s.signal&&(s.signal=AbortSignal.timeout(s.timeout)),[i,s]}async invoke(a,i){let s=BaseChatModel._convertInputToPromptValue(a),o=await this.generatePrompt([s],i,i?.callbacks),c=o.generations[0][0];return c.message}async *_streamResponseChunks(a,i,s){throw Error("Not implemented.")}async *_streamIterator(a,i){if(this._streamResponseChunks===BaseChatModel.prototype._streamResponseChunks)yield this.invoke(a,i);else{let s;let o=BaseChatModel._convertInputToPromptValue(a),c=o.toChatMessages(),[w,P]=this._separateRunnableConfigFromCallOptions(i),A=await tw.Ye.configure(w.callbacks,this.callbacks,w.tags,this.tags,w.metadata,this.metadata,{verbose:this.verbose}),x={options:P,invocation_params:this?.invocationParams(P),batch_size:1},k=await A?.handleChatModelStart(this.toJSON(),[c],w.runId,void 0,x,void 0,void 0,w.runName);try{for await(let a of this._streamResponseChunks(c,P,k?.[0]))a.message.response_metadata={...a.generationInfo,...a.message.response_metadata},yield a.message,s=s?s.concat(a):a}catch(a){throw await Promise.all((k??[]).map(i=>i?.handleLLMError(a))),a}await Promise.all((k??[]).map(a=>a?.handleLLMEnd({generations:[[s]]})))}}async _generateUncached(a,i,s){let o=a.map(a=>a.map(t_.E1)),c=await tw.Ye.configure(s.callbacks,this.callbacks,s.tags,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),w={options:i,invocation_params:this?.invocationParams(i),batch_size:1},P=await c?.handleChatModelStart(this.toJSON(),o,s.runId,void 0,w,void 0,void 0,s.runName),A=await Promise.allSettled(o.map((a,s)=>this._generate(a,{...i,promptIndex:s},P?.[s]))),x=[],k=[];await Promise.all(A.map(async(a,i)=>{if("fulfilled"!==a.status)return await P?.[i]?.handleLLMError(a.reason),Promise.reject(a.reason);{let s=a.value;for(let a of s.generations)a.message.response_metadata={...a.generationInfo,...a.message.response_metadata};return 1===s.generations.length&&(s.generations[0].message.response_metadata={...s.llmOutput,...s.generations[0].message.response_metadata}),x[i]=s.generations,k[i]=s.llmOutput,P?.[i]?.handleLLMEnd({generations:[s.generations],llmOutput:s.llmOutput})}}));let R={generations:x,llmOutput:k.length?this._combineLLMOutput?.(...k):void 0};return Object.defineProperty(R,ty.WH,{value:P?{runIds:P?.map(a=>a.runId)}:void 0,configurable:!0}),R}async _generateCached({messages:a,cache:i,llmStringKey:s,parsedOptions:o,handledOptions:c}){let w=a.map(a=>a.map(t_.E1)),P=await tw.Ye.configure(c.callbacks,this.callbacks,c.tags,this.tags,c.metadata,this.metadata,{verbose:this.verbose}),A={options:o,invocation_params:this?.invocationParams(o),batch_size:1,cached:!0},x=await P?.handleChatModelStart(this.toJSON(),w,c.runId,void 0,A,void 0,void 0,c.runName),k=[],R=await Promise.allSettled(w.map(async(a,o)=>{let c=BaseChatModel._convertInputToPromptValue(a).toString(),w=await i.lookup(c,s);return null==w&&k.push(o),w})),j=R.map((a,i)=>({result:a,runManager:x?.[i]})).filter(({result:a})=>"fulfilled"===a.status&&null!=a.value||"rejected"===a.status),$=[];await Promise.all(j.map(async({result:a,runManager:i},s)=>{if("fulfilled"!==a.status)return await i?.handleLLMError(a.reason),Promise.reject(a.reason);{let o=a.value;return $[s]=o,o.length&&await i?.handleLLMNewToken(o[0].text),i?.handleLLMEnd({generations:[o]})}}));let B={generations:$,missingPromptIndices:k};return Object.defineProperty(B,ty.WH,{value:x?{runIds:x?.map(a=>a.runId)}:void 0,configurable:!0}),B}async generate(a,i,s){let o;o=Array.isArray(i)?{stop:i}:i;let c=a.map(a=>a.map(t_.E1)),[w,P]=this._separateRunnableConfigFromCallOptions(o);if(w.callbacks=w.callbacks??s,!this.cache)return this._generateUncached(c,P,w);let{cache:A}=this,x=this._getSerializedCacheKeyParametersForCall(P),{generations:k,missingPromptIndices:R}=await this._generateCached({messages:c,cache:A,llmStringKey:x,parsedOptions:P,handledOptions:w}),j={};if(R.length>0){let a=await this._generateUncached(R.map(a=>c[a]),P,w);await Promise.all(a.generations.map(async(a,i)=>{let s=R[i];k[s]=a;let o=BaseChatModel._convertInputToPromptValue(c[s]).toString();return A.update(o,x,a)})),j=a.llmOutput??{}}return{generations:k,llmOutput:j}}invocationParams(a){return{}}_modelType(){return"base_chat_model"}serialize(){return{...this.invocationParams(),_type:this._llmType(),_model:this._modelType()}}async generatePrompt(a,i,s){let o=a.map(a=>a.toChatMessages());return this.generate(o,i,s)}async call(a,i,s){let o=await this.generate([a.map(t_.E1)],i,s),c=o.generations;return c[0][0].message}async callPrompt(a,i,s){let o=a.toChatMessages();return this.call(o,i,s)}async predictMessages(a,i,s){return this.call(a,i,s)}async predict(a,i,s){let o=new t_.xk(a),c=await this.call([o],i,s);if("string"!=typeof c.content)throw Error("Cannot use predict when output is not a string.");return c.content}};var tP=s(6896),tA=s(3102),tC=s(7846),tE=s(9073),tO=s(4559);function parseToolCall(a,i){let s;if(void 0===a.function)return;if(i?.partial)try{s=(0,tO.gP)(a.function.arguments??"{}")}catch(a){return}else try{s=JSON.parse(a.function.arguments)}catch(i){throw new tE.dS([`Function "${a.function.name}" arguments:`,"",a.function.arguments,"","are not valid JSON.",`Error: ${i.message}`].join("\n"))}let o={name:a.function.name,args:s};return i?.returnId&&(o.id=a.id),o}function convertLangChainToolCallToOpenAI(a){if(void 0===a.id)throw Error('All OpenAI tool calls must have an "id" field.');return{id:a.id,type:"function",function:{name:a.name,arguments:JSON.stringify(a.args)}}}function makeInvalidToolCall(a,i){return{name:a.function?.name,args:a.function?.arguments,id:a.id,error:i}}let JsonOutputToolsParser=class JsonOutputToolsParser extends tE.tw{static lc_name(){return"JsonOutputToolsParser"}constructor(a){super(a),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.returnId=a?.returnId??this.returnId}async parseResult(a){let i=a[0].message.additional_kwargs.tool_calls;if(!i)throw Error(`No tools_call in message ${JSON.stringify(a)}`);let s=JSON.parse(JSON.stringify(i)),o=[];for(let a of s){let i=parseToolCall(a,{partial:!0});if(void 0!==i){let a={type:i.name,args:i.args,id:i.id};Object.defineProperty(a,"name",{get(){return this.type}}),Object.defineProperty(a,"arguments",{get(){return this.args}}),o.push(a)}}return o}};let JsonOutputKeyToolsParser=class JsonOutputKeyToolsParser extends tE.tw{static lc_name(){return"JsonOutputKeyToolsParser"}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","openai_tools"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"returnId",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"keyName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSingle",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"initialParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"zodSchema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keyName=a.keyName,this.returnSingle=a.returnSingle??this.returnSingle,this.initialParser=new JsonOutputToolsParser(a),this.zodSchema=a.zodSchema}async _validateResult(a){if(void 0===this.zodSchema)return a;let i=await this.zodSchema.safeParseAsync(a);if(i.success)return i.data;throw new tE.dS(`Failed to parse. Text: "${JSON.stringify(a,null,2)}". Error: ${JSON.stringify(i.error.errors)}`,JSON.stringify(a,null,2))}async parseResult(a){let i=await this.initialParser.parseResult(a),s=i.filter(a=>a.type===this.keyName),o=s;if(this.returnId||(o=s.map(a=>a.args)),this.returnSingle)return this._validateResult(o[0]);let c=await Promise.all(o.map(a=>this._validateResult(a)));return c}};var tS=s(9711);function azure_getEndpoint(a){let{azureOpenAIApiDeploymentName:i,azureOpenAIApiInstanceName:s,azureOpenAIApiKey:o,azureOpenAIBasePath:c,baseURL:w}=a;if(o&&c&&i)return`${c}/${i}`;if(o){if(!s)throw Error("azureOpenAIApiInstanceName is required when using azureOpenAIApiKey");if(!i)throw Error("azureOpenAIApiDeploymentName is a required parameter when using azureOpenAIApiKey");return`https://${s}.openai.azure.com/openai/deployments/${i}`}return w}function openai_wrapOpenAIClientError(a){let i;return a.constructor.name===ts.name?(i=Error(a.message)).name="TimeoutError":a.constructor.name===to.name?(i=Error(a.message)).name="AbortError":i=a,i}function isAnyOfProp(a){return void 0!==a.anyOf&&Array.isArray(a.anyOf)}function formatFunctionDefinitions(a){let i=["namespace functions {",""];for(let s of a)s.description&&i.push(`// ${s.description}`),Object.keys(s.parameters.properties??{}).length>0?(i.push(`type ${s.name} = (_: {`),i.push(formatObjectProperties(s.parameters,0)),i.push("}) => any;")):i.push(`type ${s.name} = () => any;`),i.push("");return i.push("} // namespace functions"),i.join("\n")}function formatObjectProperties(a,i){let s=[];for(let[o,c]of Object.entries(a.properties??{}))c.description&&i<2&&s.push(`// ${c.description}`),a.required?.includes(o)?s.push(`${o}: ${formatType(c,i)},`):s.push(`${o}?: ${formatType(c,i)},`);return s.map(a=>" ".repeat(i)+a).join("\n")}function formatType(a,i){if(isAnyOfProp(a))return a.anyOf.map(a=>formatType(a,i)).join(" | ");switch(a.type){case"string":if(a.enum)return a.enum.map(a=>`"${a}"`).join(" | ");return"string";case"number":if(a.enum)return a.enum.map(a=>`${a}`).join(" | ");return"number";case"integer":if(a.enum)return a.enum.map(a=>`${a}`).join(" | ");return"number";case"boolean":return"boolean";case"null":return"null";case"object":return["{",formatObjectProperties(a,i+2),"}"].join("\n");case"array":if(a.items)return`${formatType(a.items,i)}[]`;return"any[]";default:return""}}function extractGenericMessageCustomRole(a){return"system"!==a.role&&"assistant"!==a.role&&"user"!==a.role&&"function"!==a.role&&"tool"!==a.role&&console.warn(`Unknown message role: ${a.role}`),a.role}function messageToOpenAIRole(a){let i=a._getType();switch(i){case"system":return"system";case"ai":return"assistant";case"human":return"user";case"function":return"function";case"tool":return"tool";case"generic":if(!tg.J.isInstance(a))throw Error("Invalid generic chat message");return extractGenericMessageCustomRole(a);default:throw Error(`Unknown message type: ${i}`)}}function openAIResponseToChatMessage(a){let i=a.tool_calls;if("assistant"===a.role){let s=[],o=[];for(let a of i??[])try{s.push(parseToolCall(a,{returnId:!0}))}catch(i){o.push(makeInvalidToolCall(a,i.message))}return new tg.gY({content:a.content||"",tool_calls:s,invalid_tool_calls:o,additional_kwargs:{function_call:a.function_call,tool_calls:i}})}return new tg.J(a.content||"",a.role??"unknown")}function _convertDeltaToMessageChunk(a,i){let s;let o=a.role??i,c=a.content??"";if(s=a.function_call?{function_call:a.function_call}:a.tool_calls?{tool_calls:a.tool_calls}:{},"user"===o)return new tg.ro({content:c});if("assistant"===o){let i=[];if(Array.isArray(a.tool_calls))for(let s of a.tool_calls)i.push({name:s.function?.name,args:s.function?.arguments,id:s.id,index:s.index});return new tg.GC({content:c,tool_call_chunks:i,additional_kwargs:s})}return"system"===o?new tg.xq({content:c}):"function"===o?new tg.Cr({content:c,additional_kwargs:s,name:a.name}):"tool"===o?new tg.Xz({content:c,additional_kwargs:s,tool_call_id:a.tool_call_id}):new tg.HD({content:c,role:o})}function convertMessagesToOpenAIParams(a){return a.map(a=>{let i={role:messageToOpenAIRole(a),content:a.content};return null!=a.name&&(i.name=a.name),null!=a.additional_kwargs.function_call&&(i.function_call=a.additional_kwargs.function_call),(0,tg.Z0)(a)&&a.tool_calls?.length?i.tool_calls=a.tool_calls.map(convertLangChainToolCallToOpenAI):(null!=a.additional_kwargs.tool_calls&&(i.tool_calls=a.additional_kwargs.tool_calls),null!=a.tool_call_id&&(i.tool_call_id=a.tool_call_id)),i})}let chat_models_ChatOpenAI=class chat_models_ChatOpenAI extends BaseChatModel{static lc_name(){return"ChatOpenAI"}get callKeys(){return[...super.callKeys,"options","function_call","functions","tools","tool_choice","promptIndex","response_format","seed"]}get lc_secrets(){return{openAIApiKey:"OPENAI_API_KEY",apiKey:"OPENAI_API_KEY",azureOpenAIApiKey:"AZURE_OPENAI_API_KEY",organization:"OPENAI_ORGANIZATION"}}get lc_aliases(){return{modelName:"model",openAIApiKey:"openai_api_key",apiKey:"openai_api_key",azureOpenAIApiVersion:"azure_openai_api_version",azureOpenAIApiKey:"azure_openai_api_key",azureOpenAIApiInstanceName:"azure_openai_api_instance_name",azureOpenAIApiDeploymentName:"azure_openai_api_deployment_name"}}constructor(a,i){if(super(a??{}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"temperature",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"topP",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"frequencyPenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"presencePenalty",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"logitBias",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"modelName",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"gpt-3.5-turbo"}),Object.defineProperty(this,"modelKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"stopSequences",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streaming",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"logprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"topLogprobs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"openAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiVersion",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiInstanceName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIApiDeploymentName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"azureOpenAIBasePath",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"organization",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"clientConfig",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.openAIApiKey=a?.apiKey??a?.openAIApiKey??(0,tb.lS)("OPENAI_API_KEY"),this.apiKey=this.openAIApiKey,this.azureOpenAIApiKey=a?.azureOpenAIApiKey??(0,tb.lS)("AZURE_OPENAI_API_KEY"),!this.azureOpenAIApiKey&&!this.apiKey)throw Error("OpenAI or Azure OpenAI API key not found");if(this.azureOpenAIApiInstanceName=a?.azureOpenAIApiInstanceName??(0,tb.lS)("AZURE_OPENAI_API_INSTANCE_NAME"),this.azureOpenAIApiDeploymentName=a?.azureOpenAIApiDeploymentName??(0,tb.lS)("AZURE_OPENAI_API_DEPLOYMENT_NAME"),this.azureOpenAIApiVersion=a?.azureOpenAIApiVersion??(0,tb.lS)("AZURE_OPENAI_API_VERSION"),this.azureOpenAIBasePath=a?.azureOpenAIBasePath??(0,tb.lS)("AZURE_OPENAI_BASE_PATH"),this.organization=a?.configuration?.organization??(0,tb.lS)("OPENAI_ORGANIZATION"),this.modelName=a?.model??a?.modelName??this.model,this.model=this.modelName,this.modelKwargs=a?.modelKwargs??{},this.timeout=a?.timeout,this.temperature=a?.temperature??this.temperature,this.topP=a?.topP??this.topP,this.frequencyPenalty=a?.frequencyPenalty??this.frequencyPenalty,this.presencePenalty=a?.presencePenalty??this.presencePenalty,this.maxTokens=a?.maxTokens,this.logprobs=a?.logprobs,this.topLogprobs=a?.topLogprobs,this.n=a?.n??this.n,this.logitBias=a?.logitBias,this.stop=a?.stopSequences??a?.stop,this.stopSequences=this?.stop,this.user=a?.user,this.streaming=a?.streaming??!1,this.azureOpenAIApiKey){if(!this.azureOpenAIApiInstanceName&&!this.azureOpenAIBasePath)throw Error("Azure OpenAI API instance name not found");if(!this.azureOpenAIApiDeploymentName)throw Error("Azure OpenAI API deployment name not found");if(!this.azureOpenAIApiVersion)throw Error("Azure OpenAI API version not found");this.apiKey=this.apiKey??""}this.clientConfig={apiKey:this.apiKey,organization:this.organization,baseURL:i?.basePath??a?.configuration?.basePath,dangerouslyAllowBrowser:!0,defaultHeaders:i?.baseOptions?.headers??a?.configuration?.baseOptions?.headers,defaultQuery:i?.baseOptions?.params??a?.configuration?.baseOptions?.params,...i,...a?.configuration}}bindTools(a,i){return this.bind({tools:a.map(tP.VE),...i})}invocationParams(a){function isStructuredToolArray(a){return void 0!==a&&a.every(a=>Array.isArray(a.lc_namespace))}let i={model:this.model,temperature:this.temperature,top_p:this.topP,frequency_penalty:this.frequencyPenalty,presence_penalty:this.presencePenalty,max_tokens:-1===this.maxTokens?void 0:this.maxTokens,logprobs:this.logprobs,top_logprobs:this.topLogprobs,n:this.n,logit_bias:this.logitBias,stop:a?.stop??this.stopSequences,user:this.user,stream:this.streaming,functions:a?.functions,function_call:a?.function_call,tools:isStructuredToolArray(a?.tools)?a?.tools.map(tP.VE):a?.tools,tool_choice:a?.tool_choice,response_format:a?.response_format,seed:a?.seed,...this.modelKwargs};return i}_identifyingParams(){return{model_name:this.model,...this.invocationParams(),...this.clientConfig}}async *_streamResponseChunks(a,i,s){let o;let c=convertMessagesToOpenAIParams(a),w={...this.invocationParams(i),messages:c,stream:!0},P=await this.completionWithRetry(w,i);for await(let a of P){let c=a?.choices[0];if(!c)continue;let{delta:w}=c;if(!w)continue;let P=_convertDeltaToMessageChunk(w,o);o=w.role??o;let A={prompt:i.promptIndex??0,completion:c.index??0};if("string"!=typeof P.content){console.log("[WARNING]: Received non-string content from OpenAI. This is currently not supported.");continue}let x={...A};void 0!==c.finish_reason&&(x.finish_reason=c.finish_reason),this.logprobs&&(x.logprobs=c.logprobs);let k=new ty.Ls({message:P,text:P.content,generationInfo:x});yield k,s?.handleLLMNewToken(k.text??"",A,void 0,void 0,void 0,{chunk:k})}if(i.signal?.aborted)throw Error("AbortError")}identifyingParams(){return this._identifyingParams()}async _generate(a,i,s){let o={},c=this.invocationParams(i),w=convertMessagesToOpenAIParams(a);if(c.stream){let c=this._streamResponseChunks(a,i,s),w={};for await(let a of c){a.message.response_metadata={...a.generationInfo,...a.message.response_metadata};let i=a.generationInfo?.completion??0;void 0===w[i]?w[i]=a:w[i]=w[i].concat(a)}let P=Object.entries(w).sort(([a],[i])=>parseInt(a,10)-parseInt(i,10)).map(([a,i])=>i),{functions:A,function_call:x}=this.invocationParams(i),k=await this.getEstimatedTokenCountFromPrompt(a,A,x),R=await this.getNumTokensFromGenerations(P);return o.promptTokens=k,o.completionTokens=R,o.totalTokens=k+R,{generations:P,llmOutput:{estimatedTokenUsage:o}}}{let a=await this.completionWithRetry({...c,stream:!1,messages:w},{signal:i?.signal,...i?.options}),{completion_tokens:s,prompt_tokens:P,total_tokens:A}=a?.usage??{};s&&(o.completionTokens=(o.completionTokens??0)+s),P&&(o.promptTokens=(o.promptTokens??0)+P),A&&(o.totalTokens=(o.totalTokens??0)+A);let x=[];for(let i of a?.choices??[]){let a=i.message?.content??"",s={text:a,message:openAIResponseToChatMessage(i.message??{role:"assistant"})};s.generationInfo={...i.finish_reason?{finish_reason:i.finish_reason}:{},...i.logprobs?{logprobs:i.logprobs}:{}},x.push(s)}return{generations:x,llmOutput:{tokenUsage:o}}}}async getEstimatedTokenCountFromPrompt(a,i,s){let o=(await this.getNumTokensFromMessages(a)).totalCount;if(i&&"auto"!==s){let a=formatFunctionDefinitions(i);o+=await this.getNumTokens(a)+9}return i&&a.find(a=>"system"===a._getType())&&(o-=4),"none"===s?o+=1:"object"==typeof s&&(o+=await this.getNumTokens(s.name)+4),o}async getNumTokensFromGenerations(a){let i=await Promise.all(a.map(async a=>a.message.additional_kwargs?.function_call?(await this.getNumTokensFromMessages([a.message])).countPerMessage[0]:await this.getNumTokens(a.message.content)));return i.reduce((a,i)=>a+i,0)}async getNumTokensFromMessages(a){let i=0,s=0,o=0;"gpt-3.5-turbo-0301"===this.model?(s=4,o=-1):(s=3,o=1);let c=await Promise.all(a.map(async a=>{let c=await this.getNumTokens(a.content),w=await this.getNumTokens(messageToOpenAIRole(a)),P=void 0!==a.name?o+await this.getNumTokens(a.name):0,A=c+s+w+P;if("function"===a._getType()&&(A-=2),a.additional_kwargs?.function_call&&(A+=3),a?.additional_kwargs.function_call?.name&&(A+=await this.getNumTokens(a.additional_kwargs.function_call?.name)),a.additional_kwargs.function_call?.arguments)try{A+=await this.getNumTokens(JSON.stringify(JSON.parse(a.additional_kwargs.function_call?.arguments)))}catch(i){console.error("Error parsing function arguments",i,JSON.stringify(a.additional_kwargs.function_call)),A+=await this.getNumTokens(a.additional_kwargs.function_call?.arguments)}return i+=A,A}));return{totalCount:i+=3,countPerMessage:c}}async completionWithRetry(a,i){let s=this._getClientOptions(i);return this.caller.call(async()=>{try{let i=await this.client.chat.completions.create(a,s);return i}catch(i){let a=openai_wrapOpenAIClientError(i);throw a}})}_getClientOptions(a){if(!this.client){let a={azureOpenAIApiDeploymentName:this.azureOpenAIApiDeploymentName,azureOpenAIApiInstanceName:this.azureOpenAIApiInstanceName,azureOpenAIApiKey:this.azureOpenAIApiKey,azureOpenAIBasePath:this.azureOpenAIBasePath,baseURL:this.clientConfig.baseURL},i=azure_getEndpoint(a),s={...this.clientConfig,baseURL:i,timeout:this.timeout,maxRetries:0};s.baseURL||delete s.baseURL,this.client=new openai_OpenAI(s)}let i={...this.clientConfig,...a};return this.azureOpenAIApiKey&&(i.headers={"api-key":this.azureOpenAIApiKey,...i.headers},i.query={"api-version":this.azureOpenAIApiVersion,...i.query}),i}_llmType(){return"openai"}_combineLLMOutput(...a){return a.reduce((a,i)=>(i&&i.tokenUsage&&(a.tokenUsage.completionTokens+=i.tokenUsage.completionTokens??0,a.tokenUsage.promptTokens+=i.tokenUsage.promptTokens??0,a.tokenUsage.totalTokens+=i.tokenUsage.totalTokens??0),a),{tokenUsage:{completionTokens:0,promptTokens:0,totalTokens:0}})}withStructuredOutput(a,i){let s,o,c,w,P,A;if(isStructuredOutputMethodParams(a)?(s=a.schema,o=a.name,c=a.method,w=a.includeRaw):(s=a,o=i?.name,c=i?.method,w=i?.includeRaw),"jsonMode"===c)P=this.bind({response_format:{type:"json_object"}}),A=isZodSchema(s)?tC.K.fromZodSchema(s):new tC.Qh;else{let a=o??"extract";if(isZodSchema(s)){let i=(0,tS.Y_)(s);P=this.bind({tools:[{type:"function",function:{name:a,description:i.description,parameters:i}}],tool_choice:{type:"function",function:{name:a}}}),A=new JsonOutputKeyToolsParser({returnSingle:!0,keyName:a,zodSchema:s})}else{let i;"string"==typeof s.name&&"object"==typeof s.parameters&&null!=s.parameters?(i=s,a=s.name):i={name:a=s.title??a,description:s.description??"",parameters:s},P=this.bind({tools:[{type:"function",function:i}],tool_choice:{type:"function",function:{name:a}}}),A=new JsonOutputKeyToolsParser({returnSingle:!0,keyName:a})}}if(!w)return P.pipe(A);let x=tA.sk.assign({parsed:(a,i)=>A.invoke(a.raw,i)}),k=tA.sk.assign({parsed:()=>null}),R=x.withFallbacks({fallbacks:[k]});return tA.lW.from([{raw:P},R])}};function isZodSchema(a){return"function"==typeof a?.parse}function isStructuredOutputMethodParams(a){return void 0!==a&&"object"==typeof a.schema}s(8463),s(3830);var tT=s(1907);let DallEAPIWrapper=class DallEAPIWrapper extends tT.UA{static lc_name(){return"DallEAPIWrapper"}constructor(a){super(a),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"A wrapper around OpenAI DALL-E API. Useful for when you need to generate images from a text description. Input should be an image description."}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"model",{enumerable:!0,configurable:!0,writable:!0,value:"dall-e-3"}),Object.defineProperty(this,"style",{enumerable:!0,configurable:!0,writable:!0,value:"vivid"}),Object.defineProperty(this,"quality",{enumerable:!0,configurable:!0,writable:!0,value:"standard"}),Object.defineProperty(this,"n",{enumerable:!0,configurable:!0,writable:!0,value:1}),Object.defineProperty(this,"size",{enumerable:!0,configurable:!0,writable:!0,value:"1024x1024"}),Object.defineProperty(this,"responseFormat",{enumerable:!0,configurable:!0,writable:!0,value:"url"}),Object.defineProperty(this,"user",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let i=a?.apiKey??a?.openAIApiKey??(0,tb.lS)("OPENAI_API_KEY"),s=a?.organization??(0,tb.lS)("OPENAI_ORGANIZATION");this.client=new openai_OpenAI({apiKey:i,organization:s,dangerouslyAllowBrowser:!0}),this.model=a?.model??a?.modelName??this.model,this.style=a?.style??this.style,this.quality=a?.quality??this.quality,this.n=a?.n??this.n,this.size=a?.size??this.size,this.responseFormat=a?.responseFormat??this.responseFormat,this.user=a?.user}async _call(a){let i=await this.client.images.generate({model:this.model,prompt:a,n:this.n,size:this.size,response_format:this.responseFormat,style:this.style,quality:this.quality,user:this.user}),s="";return"url"===this.responseFormat?[s]=i.data.map(a=>a.url).filter(a=>"undefined"!==a):[s]=i.data.map(a=>a.b64_json).filter(a=>"undefined"!==a),s}};Object.defineProperty(DallEAPIWrapper,"toolName",{enumerable:!0,configurable:!0,writable:!0,value:"dalle_api_wrapper"})},1739:function(a,i,s){"use strict";s.d(i,{wn:function(){return B}});var o=s(8249),c={code:"0",name:"text",parse:a=>{if("string"!=typeof a)throw Error('"text" parts expect a string value.');return{type:"text",value:a}}},w={code:"1",name:"function_call",parse:a=>{if(null==a||"object"!=typeof a||!("function_call"in a)||"object"!=typeof a.function_call||null==a.function_call||!("name"in a.function_call)||!("arguments"in a.function_call)||"string"!=typeof a.function_call.name||"string"!=typeof a.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:a}}},P={code:"2",name:"data",parse:a=>{if(!Array.isArray(a))throw Error('"data" parts expect an array value.');return{type:"data",value:a}}},A={code:"3",name:"error",parse:a=>{if("string"!=typeof a)throw Error('"error" parts expect a string value.');return{type:"error",value:a}}},x={code:"4",name:"assistant_message",parse:a=>{if(null==a||"object"!=typeof a||!("id"in a)||!("role"in a)||!("content"in a)||"string"!=typeof a.id||"string"!=typeof a.role||"assistant"!==a.role||!Array.isArray(a.content)||!a.content.every(a=>null!=a&&"object"==typeof a&&"type"in a&&"text"===a.type&&"text"in a&&null!=a.text&&"object"==typeof a.text&&"value"in a.text&&"string"==typeof a.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:a}}},k={code:"5",name:"assistant_control_data",parse:a=>{if(null==a||"object"!=typeof a||!("threadId"in a)||!("messageId"in a)||"string"!=typeof a.threadId||"string"!=typeof a.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:a.threadId,messageId:a.messageId}}}},R={code:"6",name:"data_message",parse:a=>{if(null==a||"object"!=typeof a||!("role"in a)||!("data"in a)||"string"!=typeof a.role||"data"!==a.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:a}}},j={code:"7",name:"tool_calls",parse:a=>{if(null==a||"object"!=typeof a||!("tool_calls"in a)||"object"!=typeof a.tool_calls||null==a.tool_calls||!Array.isArray(a.tool_calls)||a.tool_calls.some(a=>{null!=a&&"object"==typeof a&&"id"in a&&"string"==typeof a.id&&"type"in a&&"string"==typeof a.type&&"function"in a&&null!=a.function&&"object"==typeof a.function&&"arguments"in a.function&&"string"==typeof a.function.name&&a.function.arguments}))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:a}}},$={code:"8",name:"message_annotations",parse:a=>{if(!Array.isArray(a))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:a}}};c.code,w.code,P.code,A.code,x.code,k.code,R.code,j.code,$.code,c.name,c.code,w.name,w.code,P.name,P.code,A.name,A.code,x.name,x.code,k.name,k.code,R.name,R.code,j.name,j.code,$.name,$.code,[c,w,P,A,x,k,R,j,$].map(a=>a.code),(0,o.k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7),new TextDecoder("utf-8"),Symbol("internal_openai_fn_messages");var B=class extends Response{constructor(a,i,s){let o=a;s&&(o=a.pipeThrough(s.stream)),super(o,{...i,status:200,headers:{"Content-Type":"text/plain; charset=utf-8","X-Experimental-Stream-Data":s?"true":"false",...null==i?void 0:i.headers}})}}},9781:function(a,i,s){"use strict";s.d(i,{RJ:function(){return useChat}});var o,c=s(1798),w=s(5647);let noop=()=>{},P=noop(),A=Object,isUndefined=a=>a===P,isFunction=a=>"function"==typeof a,mergeObjects=(a,i)=>({...a,...i}),isPromiseLike=a=>isFunction(a.then),x=new WeakMap,k=0,stableHash=a=>{let i,s;let o=typeof a,c=a&&a.constructor,w=c==Date;if(A(a)!==a||w||c==RegExp)i=w?a.toJSON():"symbol"==o?a.toString():"string"==o?JSON.stringify(a):""+a;else{if(i=x.get(a))return i;if(i=++k+"~",x.set(a,i),c==Array){for(s=0,i="@";s<a.length;s++)i+=stableHash(a[s])+",";x.set(a,i)}if(c==A){i="#";let o=A.keys(a).sort();for(;!isUndefined(s=o.pop());)isUndefined(a[s])||(i+=s+":"+stableHash(a[s])+",");x.set(a,i)}}return i},R=new WeakMap,j={},$={},B="undefined",D=typeof window!=B,Z=typeof document!=B,hasRequestAnimationFrame=()=>D&&typeof window.requestAnimationFrame!=B,createCacheHelper=(a,i)=>{let s=R.get(a);return[()=>!isUndefined(i)&&a.get(i)||j,o=>{if(!isUndefined(i)){let c=a.get(i);i in $||($[i]=c),s[5](i,mergeObjects(c,o),c||j)}},s[6],()=>!isUndefined(i)&&i in $?$[i]:!isUndefined(i)&&a.get(i)||j]},U=!0,[z,V]=D&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[noop,noop],G={initFocus:a=>(Z&&document.addEventListener("visibilitychange",a),z("focus",a),()=>{Z&&document.removeEventListener("visibilitychange",a),V("focus",a)}),initReconnect:a=>{let onOnline=()=>{U=!0,a()},onOffline=()=>{U=!1};return z("online",onOnline),z("offline",onOffline),()=>{V("online",onOnline),V("offline",onOffline)}}},W=!c.useId,K=!D||"Deno"in window,rAF=a=>hasRequestAnimationFrame()?window.requestAnimationFrame(a):setTimeout(a,1),J=K?c.useEffect:c.useLayoutEffect,Y="undefined"!=typeof navigator&&navigator.connection,X=!K&&Y&&(["slow-2g","2g"].includes(Y.effectiveType)||Y.saveData),dist_serialize=a=>{if(isFunction(a))try{a=a()}catch(i){a=""}let i=a;return[a="string"==typeof a?a:(Array.isArray(a)?a.length:a)?stableHash(a):"",i]},ee=0,getTimestamp=()=>++ee;var et={ERROR_REVALIDATE_EVENT:3,FOCUS_EVENT:0,MUTATE_EVENT:2,RECONNECT_EVENT:1};async function internalMutate(...a){let[i,s,o,c]=a,w=mergeObjects({populateCache:!0,throwOnError:!0},"boolean"==typeof c?{revalidate:c}:c||{}),A=w.populateCache,x=w.rollbackOnError,k=w.optimisticData,j=!1!==w.revalidate,rollbackOnError=a=>"function"==typeof x?x(a):!1!==x,$=w.throwOnError;if(isFunction(s)){let a=[],o=i.keys();for(let c of o)!/^\$(inf|sub)\$/.test(c)&&s(i.get(c)._k)&&a.push(c);return Promise.all(a.map(mutateByKey))}return mutateByKey(s);async function mutateByKey(s){let c;let[w]=dist_serialize(s);if(!w)return;let[x,B]=createCacheHelper(i,w),[D,Z,U,z]=R.get(i),V=D[w],startRevalidate=()=>j&&(delete U[w],delete z[w],V&&V[0])?V[0](2).then(()=>x().data):x().data;if(a.length<3)return startRevalidate();let G=o,W=getTimestamp();Z[w]=[W,0];let K=!isUndefined(k),J=x(),Y=J.data,X=J._c,ee=isUndefined(X)?Y:X;if(K&&B({data:k=isFunction(k)?k(ee,Y):k,_c:ee}),isFunction(G))try{G=G(ee)}catch(a){c=a}if(G&&isPromiseLike(G)){if(G=await G.catch(a=>{c=a}),W!==Z[w][0]){if(c)throw c;return G}c&&K&&rollbackOnError(c)&&(A=!0,B({data:G=ee,_c:P}))}A&&!c&&(isFunction(A)&&(G=A(G,ee)),B({data:G,error:P,_c:P})),Z[w][1]=getTimestamp();let et=await startRevalidate();if(B({_c:P}),c){if($)throw c;return}return A?et:G}}let revalidateAllKeys=(a,i)=>{for(let s in a)a[s][0]&&a[s][0](i)},initCache=(a,i)=>{if(!R.has(a)){let s=mergeObjects(G,i),o={},c=internalMutate.bind(P,a),w=noop,A={},subscribe=(a,i)=>{let s=A[a]||[];return A[a]=s,s.push(i),()=>s.splice(s.indexOf(i),1)},setter=(i,s,o)=>{a.set(i,s);let c=A[i];if(c)for(let a of c)a(s,o)},initProvider=()=>{if(!R.has(a)&&(R.set(a,[o,{},{},{},c,setter,subscribe]),!K)){let i=s.initFocus(setTimeout.bind(P,revalidateAllKeys.bind(P,o,0))),c=s.initReconnect(setTimeout.bind(P,revalidateAllKeys.bind(P,o,1)));w=()=>{i&&i(),c&&c(),R.delete(a)}}};return initProvider(),[a,c,initProvider,w]}return[a,R.get(a)[4]]},[er,ea]=initCache(new Map),en=mergeObjects({onLoadingSlow:noop,onSuccess:noop,onError:noop,onErrorRetry:(a,i,s,o,c)=>{let w=s.errorRetryCount,P=c.retryCount,A=~~((Math.random()+.5)*(1<<(P<8?P:8)))*s.errorRetryInterval;(isUndefined(w)||!(P>w))&&setTimeout(o,A,c)},onDiscarded:noop,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:X?1e4:5e3,focusThrottleInterval:5e3,dedupingInterval:2e3,loadingTimeout:X?5e3:3e3,compare:(a,i)=>stableHash(a)==stableHash(i),isPaused:()=>!1,cache:er,mutate:ea,fallback:{}},{isOnline:()=>U,isVisible:()=>{let a=Z&&document.visibilityState;return isUndefined(a)||"hidden"!==a}}),mergeConfigs=(a,i)=>{let s=mergeObjects(a,i);if(i){let{use:o,fallback:c}=a,{use:w,fallback:P}=i;o&&w&&(s.use=o.concat(w)),c&&P&&(s.fallback=mergeObjects(c,P))}return s},ei=(0,c.createContext)({}),es=D&&window.__SWR_DEVTOOLS_USE__,eo=es?window.__SWR_DEVTOOLS_USE__:[],normalize=a=>isFunction(a[1])?[a[0],a[1],a[2]||{}]:[a[0],null,(null===a[1]?a[2]:a[1])||{}],useSWRConfig=()=>mergeObjects(en,(0,c.useContext)(ei)),el=eo.concat(a=>(i,s,o)=>{let c=s&&((...a)=>{let[o]=dist_serialize(i),[,,,c]=R.get(er),w=c[o];return isUndefined(w)?s(...a):(delete c[o],w)});return a(i,c,o)}),subscribeCallback=(a,i,s)=>{let o=i[a]||(i[a]=[]);return o.push(s),()=>{let a=o.indexOf(s);a>=0&&(o[a]=o[o.length-1],o.pop())}};es&&(window.__SWR_DEVTOOLS_REACT__=c);let eu=c.use||(a=>{if("pending"===a.status)throw a;if("fulfilled"===a.status)return a.value;if("rejected"===a.status)throw a.reason;throw a.status="pending",a.then(i=>{a.status="fulfilled",a.value=i},i=>{a.status="rejected",a.reason=i}),a}),ec={dedupe:!0};A.defineProperty(a=>{let{value:i}=a,s=(0,c.useContext)(ei),o=isFunction(i),w=(0,c.useMemo)(()=>o?i(s):i,[o,s,i]),A=(0,c.useMemo)(()=>o?w:mergeConfigs(s,w),[o,s,w]),x=w&&w.provider,k=(0,c.useRef)(P);x&&!k.current&&(k.current=initCache(x(A.cache||er),w));let R=k.current;return R&&(A.cache=R[0],A.mutate=R[1]),J(()=>{if(R)return R[2]&&R[2](),R[3]},[]),(0,c.createElement)(ei.Provider,mergeObjects(a,{value:A}))},"defaultValue",{value:en});let ed=(o=(a,i,s)=>{let{cache:o,compare:A,suspense:x,fallbackData:k,revalidateOnMount:j,revalidateIfStale:$,refreshInterval:B,refreshWhenHidden:D,refreshWhenOffline:Z,keepPreviousData:U}=s,[z,V,G,Y]=R.get(o),[X,ee]=dist_serialize(a),er=(0,c.useRef)(!1),ea=(0,c.useRef)(!1),en=(0,c.useRef)(X),ei=(0,c.useRef)(i),es=(0,c.useRef)(s),getConfig=()=>es.current,isActive=()=>getConfig().isVisible()&&getConfig().isOnline(),[eo,el,ed,eh]=createCacheHelper(o,X),ep=(0,c.useRef)({}).current,ef=isUndefined(k)?s.fallback[X]:k,isEqual=(a,i)=>{for(let s in ep)if("data"===s){if(!A(a[s],i[s])&&(!isUndefined(a[s])||!A(eA,i[s])))return!1}else if(i[s]!==a[s])return!1;return!0},em=(0,c.useMemo)(()=>{let a=!!X&&!!i&&(isUndefined(j)?!getConfig().isPaused()&&!x&&(!!isUndefined($)||$):j),getSelectedCache=i=>{let s=mergeObjects(i);return(delete s._k,a)?{isValidating:!0,isLoading:!0,...s}:s},s=eo(),o=eh(),c=getSelectedCache(s),w=s===o?c:getSelectedCache(o),P=c;return[()=>{let a=getSelectedCache(eo()),i=isEqual(a,P);return i?(P.data=a.data,P.isLoading=a.isLoading,P.isValidating=a.isValidating,P.error=a.error,P):(P=a,a)},()=>w]},[o,X]),eg=(0,w.useSyncExternalStore)((0,c.useCallback)(a=>ed(X,(i,s)=>{isEqual(s,i)||a()}),[o,X]),em[0],em[1]),ey=!er.current,eb=z[X]&&z[X].length>0,e_=eg.data,ev=isUndefined(e_)?ef:e_,ew=eg.error,eP=(0,c.useRef)(ev),eA=U?isUndefined(e_)?eP.current:e_:ev,eC=(!eb||!!isUndefined(ew))&&(ey&&!isUndefined(j)?j:!getConfig().isPaused()&&(x?!isUndefined(ev)&&$:isUndefined(ev)||$)),eE=!!(X&&i&&ey&&eC),eO=isUndefined(eg.isValidating)?eE:eg.isValidating,eS=isUndefined(eg.isLoading)?eE:eg.isLoading,eT=(0,c.useCallback)(async a=>{let i,o;let c=ei.current;if(!X||!c||ea.current||getConfig().isPaused())return!1;let w=!0,x=a||{},k=!G[X]||!x.dedupe,callbackSafeguard=()=>W?!ea.current&&X===en.current&&er.current:X===en.current,R={isValidating:!1,isLoading:!1},finishRequestAndUpdateState=()=>{el(R)},cleanupState=()=>{let a=G[X];a&&a[1]===o&&delete G[X]},j={isValidating:!0};isUndefined(eo().data)&&(j.isLoading=!0);try{if(k&&(el(j),s.loadingTimeout&&isUndefined(eo().data)&&setTimeout(()=>{w&&callbackSafeguard()&&getConfig().onLoadingSlow(X,s)},s.loadingTimeout),G[X]=[c(ee),getTimestamp()]),[i,o]=G[X],i=await i,k&&setTimeout(cleanupState,s.dedupingInterval),!G[X]||G[X][1]!==o)return k&&callbackSafeguard()&&getConfig().onDiscarded(X),!1;R.error=P;let a=V[X];if(!isUndefined(a)&&(o<=a[0]||o<=a[1]||0===a[1]))return finishRequestAndUpdateState(),k&&callbackSafeguard()&&getConfig().onDiscarded(X),!1;let x=eo().data;R.data=A(x,i)?x:i,k&&callbackSafeguard()&&getConfig().onSuccess(i,X,s)}catch(s){cleanupState();let a=getConfig(),{shouldRetryOnError:i}=a;!a.isPaused()&&(R.error=s,k&&callbackSafeguard()&&(a.onError(s,X,a),(!0===i||isFunction(i)&&i(s))&&isActive()&&a.onErrorRetry(s,X,a,a=>{let i=z[X];i&&i[0]&&i[0](et.ERROR_REVALIDATE_EVENT,a)},{retryCount:(x.retryCount||0)+1,dedupe:!0})))}return w=!1,finishRequestAndUpdateState(),!0},[X,o]),ex=(0,c.useCallback)((...a)=>internalMutate(o,en.current,...a),[]);if(J(()=>{ei.current=i,es.current=s,isUndefined(e_)||(eP.current=e_)}),J(()=>{if(!X)return;let a=eT.bind(P,ec),i=0,s=subscribeCallback(X,z,(s,o={})=>{if(s==et.FOCUS_EVENT){let s=Date.now();getConfig().revalidateOnFocus&&s>i&&isActive()&&(i=s+getConfig().focusThrottleInterval,a())}else if(s==et.RECONNECT_EVENT)getConfig().revalidateOnReconnect&&isActive()&&a();else if(s==et.MUTATE_EVENT)return eT();else if(s==et.ERROR_REVALIDATE_EVENT)return eT(o)});return ea.current=!1,en.current=X,er.current=!0,el({_k:ee}),eC&&(isUndefined(ev)||K?a():rAF(a)),()=>{ea.current=!0,s()}},[X]),J(()=>{let a;function next(){let i=isFunction(B)?B(eo().data):B;i&&-1!==a&&(a=setTimeout(execute,i))}function execute(){!eo().error&&(D||getConfig().isVisible())&&(Z||getConfig().isOnline())?eT(ec).then(next):next()}return next(),()=>{a&&(clearTimeout(a),a=-1)}},[B,D,Z,X]),(0,c.useDebugValue)(eA),x&&isUndefined(ev)&&X){if(!W&&K)throw Error("Fallback data is required when using suspense in SSR.");ei.current=i,es.current=s,ea.current=!1;let a=Y[X];if(!isUndefined(a)){let i=ex(a);eu(i)}if(isUndefined(ew)){let a=eT(ec);isUndefined(eA)||(a.status="fulfilled",a.value=!0),eu(a)}else throw ew}return{mutate:ex,get data(){return ep.data=!0,eA},get error(){return ep.error=!0,ew},get isValidating(){return ep.isValidating=!0,eO},get isLoading(){return ep.isLoading=!0,eS}}},function(...a){let i=useSWRConfig(),[s,c,w]=normalize(a),P=mergeConfigs(i,w),A=o,{use:x}=P,k=(x||[]).concat(el);for(let a=k.length;a--;)A=k[a](A);return A(s,c||P.fetcher||null,P)});var eh=s(8249),ep={code:"0",name:"text",parse:a=>{if("string"!=typeof a)throw Error('"text" parts expect a string value.');return{type:"text",value:a}}},ef={code:"1",name:"function_call",parse:a=>{if(null==a||"object"!=typeof a||!("function_call"in a)||"object"!=typeof a.function_call||null==a.function_call||!("name"in a.function_call)||!("arguments"in a.function_call)||"string"!=typeof a.function_call.name||"string"!=typeof a.function_call.arguments)throw Error('"function_call" parts expect an object with a "function_call" property.');return{type:"function_call",value:a}}},em={code:"2",name:"data",parse:a=>{if(!Array.isArray(a))throw Error('"data" parts expect an array value.');return{type:"data",value:a}}},eg={code:"3",name:"error",parse:a=>{if("string"!=typeof a)throw Error('"error" parts expect a string value.');return{type:"error",value:a}}},ey={code:"4",name:"assistant_message",parse:a=>{if(null==a||"object"!=typeof a||!("id"in a)||!("role"in a)||!("content"in a)||"string"!=typeof a.id||"string"!=typeof a.role||"assistant"!==a.role||!Array.isArray(a.content)||!a.content.every(a=>null!=a&&"object"==typeof a&&"type"in a&&"text"===a.type&&"text"in a&&null!=a.text&&"object"==typeof a.text&&"value"in a.text&&"string"==typeof a.text.value))throw Error('"assistant_message" parts expect an object with an "id", "role", and "content" property.');return{type:"assistant_message",value:a}}},eb={code:"5",name:"assistant_control_data",parse:a=>{if(null==a||"object"!=typeof a||!("threadId"in a)||!("messageId"in a)||"string"!=typeof a.threadId||"string"!=typeof a.messageId)throw Error('"assistant_control_data" parts expect an object with a "threadId" and "messageId" property.');return{type:"assistant_control_data",value:{threadId:a.threadId,messageId:a.messageId}}}},e_={code:"6",name:"data_message",parse:a=>{if(null==a||"object"!=typeof a||!("role"in a)||!("data"in a)||"string"!=typeof a.role||"data"!==a.role)throw Error('"data_message" parts expect an object with a "role" and "data" property.');return{type:"data_message",value:a}}},ev={code:"7",name:"tool_calls",parse:a=>{if(null==a||"object"!=typeof a||!("tool_calls"in a)||"object"!=typeof a.tool_calls||null==a.tool_calls||!Array.isArray(a.tool_calls)||a.tool_calls.some(a=>{null!=a&&"object"==typeof a&&"id"in a&&"string"==typeof a.id&&"type"in a&&"string"==typeof a.type&&"function"in a&&null!=a.function&&"object"==typeof a.function&&"arguments"in a.function&&"string"==typeof a.function.name&&a.function.arguments}))throw Error('"tool_calls" parts expect an object with a ToolCallPayload.');return{type:"tool_calls",value:a}}},ew={code:"8",name:"message_annotations",parse:a=>{if(!Array.isArray(a))throw Error('"message_annotations" parts expect an array value.');return{type:"message_annotations",value:a}}},eP={[ep.code]:ep,[ef.code]:ef,[em.code]:em,[eg.code]:eg,[ey.code]:ey,[eb.code]:eb,[e_.code]:e_,[ev.code]:ev,[ew.code]:ew};ep.name,ep.code,ef.name,ef.code,em.name,em.code,eg.name,eg.code,ey.name,ey.code,eb.name,eb.code,e_.name,e_.code,ev.name,ev.code,ew.name,ew.code;var eA=[ep,ef,em,eg,ey,eb,e_,ev,ew].map(a=>a.code),parseStreamPart=a=>{let i=a.indexOf(":");if(-1===i)throw Error("Failed to parse stream string. No separator found.");let s=a.slice(0,i);if(!eA.includes(s))throw Error(`Failed to parse stream string. Invalid code ${s}.`);let o=a.slice(i+1),c=JSON.parse(o);return eP[s].parse(c)};function concatChunks(a,i){let s=new Uint8Array(i),o=0;for(let i of a)s.set(i,o),o+=i.length;return a.length=0,s}async function*readDataStream(a,{isAborted:i}={}){let s=new TextDecoder,o=[],c=0;for(;;){let{value:w}=await a.read();if(w&&(o.push(w),c+=w.length,10!==w[w.length-1]))continue;if(0===o.length)break;let P=concatChunks(o,c);c=0;let A=s.decode(P,{stream:!0}).split("\n").filter(a=>""!==a).map(parseStreamPart);for(let a of A)yield a;if(null==i?void 0:i()){a.cancel();break}}}var eC=(0,eh.k)("0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",7);function createChunkDecoder(a){let i=new TextDecoder;return a?function(a){let s=i.decode(a,{stream:!0}).split("\n").filter(a=>""!==a);return s.map(parseStreamPart).filter(Boolean)}:function(a){return a?i.decode(a,{stream:!0}):""}}function assignAnnotationsToMessage(a,i){return a&&i&&i.length?{...a,annotations:[...i]}:a}async function parseComplexResponse({reader:a,abortControllerRef:i,update:s,onFinish:o,generateId:c=eC,getCurrentDate:w=()=>new Date}){let P;let A=w(),x={data:[]};for await(let{type:o,value:w}of readDataStream(a,{isAborted:()=>(null==i?void 0:i.current)===null})){"text"===o&&(x.text?x.text={...x.text,content:(x.text.content||"")+w}:x.text={id:c(),role:"assistant",content:w,createdAt:A});let a=null;"function_call"===o&&(x.function_call={id:c(),role:"assistant",content:"",function_call:w.function_call,name:w.function_call.name,createdAt:A},a=x.function_call);let i=null;"tool_calls"===o&&(x.tool_calls={id:c(),role:"assistant",content:"",tool_calls:w.tool_calls,createdAt:A},i=x.tool_calls),"data"===o&&x.data.push(...w);let k=x.text;if("message_annotations"===o&&(P?P.push(...w):P=[...w],a=assignAnnotationsToMessage(x.function_call,P),i=assignAnnotationsToMessage(x.tool_calls,P),k=assignAnnotationsToMessage(x.text,P)),null==P?void 0:P.length){let a=["text","function_call","tool_calls"];a.forEach(a=>{x[a]&&(x[a].annotations=[...P])})}let R=[a,i,k].filter(Boolean).map(a=>({...assignAnnotationsToMessage(a,P)}));s(R,[...x.data])}return null==o||o(x),{messages:[x.text,x.function_call,x.tool_calls].filter(Boolean),data:x.data}}async function callChatApi({api:a,messages:i,body:s,credentials:o,headers:c,abortController:w,appendMessage:P,restoreMessagesOnFailure:A,onResponse:x,onUpdate:k,onFinish:R,generateId:j}){var $;let B=await fetch(a,{method:"POST",body:JSON.stringify({messages:i,...s}),headers:{"Content-Type":"application/json",...c},signal:null==($=null==w?void 0:w())?void 0:$.signal,credentials:o}).catch(a=>{throw A(),a});if(x)try{await x(B)}catch(a){throw a}if(!B.ok)throw A(),Error(await B.text()||"Failed to fetch the chat response.");if(!B.body)throw Error("The response body is empty.");let D=B.body.getReader(),Z="true"===B.headers.get("X-Experimental-Stream-Data");if(Z)return await parseComplexResponse({reader:D,abortControllerRef:null!=w?{current:w()}:void 0,update:k,onFinish(a){R&&null!=a.text&&R(a.text)},generateId:j});{let a=new Date,i=createChunkDecoder(!1),s="",o=j(),c={id:o,createdAt:a,content:"",role:"assistant"};for(;;){let{done:a,value:o}=await D.read();if(a)break;if((s+=i(o)).startsWith('{"function_call":')?c.function_call=s:s.startsWith('{"tool_calls":')?c.tool_calls=s:c.content=s,P({...c}),(null==w?void 0:w())===null){D.cancel();break}}if(s.startsWith('{"function_call":')){let a=JSON.parse(s).function_call;c.function_call=a,P({...c})}if(s.startsWith('{"tool_calls":')){let a=JSON.parse(s).tool_calls;c.tool_calls=a,P({...c})}return R&&R(c),c}}async function processChatStream({getStreamedResponse:a,experimental_onFunctionCall:i,experimental_onToolCall:s,updateChatRequest:o,getCurrentMessages:c}){for(;;){let w=await a();if("messages"in w){let a=!1;for(let P of w.messages)if(void 0!==P.function_call&&"string"!=typeof P.function_call||void 0!==P.tool_calls&&"string"!=typeof P.tool_calls){if(a=!0,i){let s=P.function_call;if("object"!=typeof s){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let w=await i(c(),s);if(void 0===w){a=!1;break}o(w)}if(s){let i=P.tool_calls;if(!Array.isArray(i)||i.some(a=>"object"!=typeof a)){console.warn("experimental_onToolCall should not be defined when using tools");continue}let w=await s(c(),i);if(void 0===w){a=!1;break}o(w)}}if(!a)break}else{let fixFunctionCallArguments2=function(a){for(let i of a.messages){if(void 0!==i.tool_calls)for(let a of i.tool_calls)"object"==typeof a&&a.function.arguments&&"string"!=typeof a.function.arguments&&(a.function.arguments=JSON.stringify(a.function.arguments));void 0!==i.function_call&&"object"==typeof i.function_call&&i.function_call.arguments&&"string"!=typeof i.function_call.arguments&&(i.function_call.arguments=JSON.stringify(i.function_call.arguments))}};if((void 0===w.function_call||"string"==typeof w.function_call)&&(void 0===w.tool_calls||"string"==typeof w.tool_calls))break;if(i){let a=w.function_call;if("object"!=typeof a){console.warn("experimental_onFunctionCall should not be defined when using tools");continue}let s=await i(c(),a);if(void 0===s)break;fixFunctionCallArguments2(s),o(s)}if(s){let a=w.tool_calls;if("object"!=typeof a){console.warn("experimental_onToolCall should not be defined when using functions");continue}let i=await s(c(),a);if(void 0===i)break;fixFunctionCallArguments2(i),o(i)}}}}var getStreamedResponse=async(a,i,s,o,c,w,P,A,x,k,R,j)=>{var $,B;let D=P.current;s(i.messages,!1);let Z=j?i.messages:i.messages.map(({role:a,content:i,name:s,function_call:o,tool_calls:c,tool_call_id:w})=>({role:a,content:i,tool_call_id:w,...void 0!==s&&{name:s},...void 0!==o&&{function_call:o},...void 0!==c&&{tool_calls:c}}));if("string"!=typeof a){let o=x(),c=new Date,w={id:o,createdAt:c,content:"",role:"assistant"};async function readRow(a){let{content:o,ui:c,next:P}=await a;w.content=o,w.ui=await c,s([...i.messages,{...w}],!1),P&&await readRow(P)}try{let s=a({messages:Z,data:i.data});await readRow(s)}catch(a){throw s(D,!1),a}return k&&k(w),w}return await callChatApi({api:a,messages:Z,body:{data:i.data,...w.current.body,...null==($=i.options)?void 0:$.body,...void 0!==i.functions&&{functions:i.functions},...void 0!==i.function_call&&{function_call:i.function_call},...void 0!==i.tools&&{tools:i.tools},...void 0!==i.tool_choice&&{tool_choice:i.tool_choice}},credentials:w.current.credentials,headers:{...w.current.headers,...null==(B=i.options)?void 0:B.headers},abortController:()=>A.current,appendMessage(a){s([...i.messages,a],!1)},restoreMessagesOnFailure(){s(D,!1)},onResponse:R,onUpdate(a,w){s([...i.messages,...a],!1),o([...c||[],...w||[]],!1)},onFinish:k,generateId:x})};function useChat({api:a="/api/chat",id:i,initialMessages:s,initialInput:o="",sendExtraMessageFields:w,experimental_onFunctionCall:P,experimental_onToolCall:A,onResponse:x,onFinish:k,onError:R,credentials:j,headers:$,body:B,generateId:D=eC}={}){let Z=(0,c.useId)(),U=null!=i?i:Z,z="string"==typeof a?[a,U]:U,[V]=(0,c.useState)([]),{data:G,mutate:W}=ed([z,"messages"],null,{fallbackData:null!=s?s:V}),{data:K=!1,mutate:J}=ed([z,"loading"],null),{data:Y,mutate:X}=ed([z,"streamData"],null),{data:ee,mutate:et}=ed([z,"error"],null),er=(0,c.useRef)(G||[]);(0,c.useEffect)(()=>{er.current=G||[]},[G]);let ea=(0,c.useRef)(null),en=(0,c.useRef)({credentials:j,headers:$,body:B});(0,c.useEffect)(()=>{en.current={credentials:j,headers:$,body:B}},[j,$,B]);let ei=(0,c.useCallback)(async i=>{try{J(!0),et(void 0);let s=new AbortController;ea.current=s,await processChatStream({getStreamedResponse:()=>getStreamedResponse(a,i,W,X,Y,en,er,ea,D,k,x,w),experimental_onFunctionCall:P,experimental_onToolCall:A,updateChatRequest:a=>{i=a},getCurrentMessages:()=>er.current}),ea.current=null}catch(a){if("AbortError"===a.name)return ea.current=null,null;R&&a instanceof Error&&R(a),et(a)}finally{J(!1)}},[W,J,a,en,x,k,R,et,X,Y,w,P,A,er,ea,D]),es=(0,c.useCallback)(async(a,{options:i,functions:s,function_call:o,tools:c,tool_choice:w,data:P}={})=>{a.id||(a.id=D());let A={messages:er.current.concat(a),options:i,data:P,...void 0!==s&&{functions:s},...void 0!==o&&{function_call:o},...void 0!==c&&{tools:c},...void 0!==w&&{tool_choice:w}};return ei(A)},[ei,D]),eo=(0,c.useCallback)(async({options:a,functions:i,function_call:s,tools:o,tool_choice:c}={})=>{if(0===er.current.length)return null;let w=er.current[er.current.length-1];if("assistant"===w.role){let w={messages:er.current.slice(0,-1),options:a,...void 0!==i&&{functions:i},...void 0!==s&&{function_call:s},...void 0!==o&&{tools:o},...void 0!==c&&{tool_choice:c}};return ei(w)}let P={messages:er.current,options:a,...void 0!==i&&{functions:i},...void 0!==s&&{function_call:s},...void 0!==o&&{tools:o},...void 0!==c&&{tool_choice:c}};return ei(P)},[ei]),el=(0,c.useCallback)(()=>{ea.current&&(ea.current.abort(),ea.current=null)},[]),eu=(0,c.useCallback)(a=>{W(a,!1),er.current=a},[W]),[ec,eh]=(0,c.useState)(o),ep=(0,c.useCallback)((a,i={},s)=>{s&&(en.current={...en.current,...s}),a.preventDefault(),ec&&(es({content:ec,role:"user",createdAt:new Date},i),eh(""))},[ec,es]);return{messages:G||[],error:ee,append:es,reload:eo,stop:el,setMessages:eu,input:ec,setInput:eh,handleInputChange:a=>{eh(a.target.value)},handleSubmit:ep,isLoading:K,data:Y}}},3634:function(a,i,s){"use strict";s.d(i,{Ij:function(){return executor_AgentExecutor},Z:function(){return createOpenAIFunctionsAgent}});var o=s(5737);s(5465);var c=s(3711),w=s(1907);s(2738),s(5347);var P=s(3102),A=s(1974),x=s(7846),k=s(8699);let AgentExecutorIterator=class AgentExecutorIterator extends c.i{get finalOutputs(){return this._finalOutputs}async setFinalOutputs(a){if(this._finalOutputs=void 0,a){let i=await this.agentExecutor.prepOutputs(this.inputs,a,!0);this._finalOutputs=i}}get nameToToolMap(){let a=this.agentExecutor.tools.map(a=>({[a.name]:a}));return Object.assign({},...a)}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","executor_iterator"]}),Object.defineProperty(this,"agentExecutor",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_finalOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"runManager",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"intermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"iterations",{enumerable:!0,configurable:!0,writable:!0,value:0}),this.agentExecutor=a.agentExecutor,this.inputs=a.inputs,this.callbacks=a.callbacks,this.tags=a.tags,this.metadata=a.metadata,this.runName=a.runName,this.runManager=a.runManager,this.config=a.config}reset(){this.intermediateSteps=[],this.iterations=0,this._finalOutputs=void 0}updateIterations(){this.iterations+=1}async *streamIterator(){for(this.reset();;)try{0===this.iterations&&await this.onFirstStep();let a=await this._callNext();yield a}catch(a){if("message"in a&&a.message.startsWith("Final outputs already reached: ")){if(!this.finalOutputs)throw a;return this.finalOutputs}throw this.runManager&&await this.runManager.handleChainError(a),a}}async onFirstStep(){if(0===this.iterations){let a=await A.Ye.configure(this.callbacks,this.agentExecutor.callbacks,this.tags,this.agentExecutor.tags,this.metadata,this.agentExecutor.metadata,{verbose:this.agentExecutor.verbose});this.runManager=await a?.handleChainStart(this.agentExecutor.toJSON(),this.inputs,void 0,void 0,this.tags,this.metadata,this.runName)}}async _executeNextStep(a){return this.agentExecutor._takeNextStep(this.nameToToolMap,this.inputs,this.intermediateSteps,a,this.config)}async _processNextStepOutput(a,i){if("returnValues"in a){let s=await this.agentExecutor._return(a,this.intermediateSteps,i);return this.runManager&&await this.runManager.handleChainEnd(s),await this.setFinalOutputs(s),s}this.intermediateSteps=this.intermediateSteps.concat(a);let s={};if(Array.isArray(a)&&1===a.length){let o=a[0],c=await this.agentExecutor._getToolReturn(o);c&&(s=await this.agentExecutor._return(c,this.intermediateSteps,i),this.runManager&&await this.runManager.handleChainEnd(s),await this.setFinalOutputs(s))}return{intermediateSteps:a}}async _stop(){let a=await this.agentExecutor.agent.returnStoppedResponse(this.agentExecutor.earlyStoppingMethod,this.intermediateSteps,this.inputs),i=await this.agentExecutor._return(a,this.intermediateSteps,this.runManager);return await this.setFinalOutputs(i),i}async _callNext(){if(this.finalOutputs)throw Error(`Final outputs already reached: ${JSON.stringify(this.finalOutputs,null,2)}`);if(!this.agentExecutor.shouldContinueGetter(this.iterations))return this._stop();let a=await this._executeNextStep(this.runManager),i=await this._processNextStepOutput(a,this.runManager);return this.updateIterations(),i}};let ExceptionTool=class ExceptionTool extends w.UA{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"_Exception"}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:"Exception tool"})}async _call(a){return a}};let executor_AgentExecutor=class executor_AgentExecutor extends k.l{static lc_name(){return"AgentExecutor"}get lc_namespace(){return["langchain","agents","executor"]}get inputKeys(){return this.agent.inputKeys}get outputKeys(){return this.agent.returnValues}constructor(a){let i;let s=!0;if(P.eq.isRunnable(a.agent)?(i=o.fU.isAgentRunnableSequence(a.agent)?a.agent.singleAction?new o.Mj({runnable:a.agent,streamRunnable:a.agent.streamRunnable}):new o.zn({runnable:a.agent,streamRunnable:a.agent.streamRunnable}):new o.zn({runnable:a.agent}),s=!1):((0,o.Ck)(a.agent)&&(s=!1),i=a.agent),super(a),Object.defineProperty(this,"agent",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:15}),Object.defineProperty(this,"earlyStoppingMethod",{enumerable:!0,configurable:!0,writable:!0,value:"force"}),Object.defineProperty(this,"returnOnlyOutputs",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"handleParsingErrors",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.agent=i,this.tools=a.tools,this.handleParsingErrors=a.handleParsingErrors??this.handleParsingErrors,this.returnOnlyOutputs=s,"multi"===this.agent._agentActionType()){for(let a of this.tools)if(a.returnDirect)throw Error(`Tool with return direct ${a.name} not supported for multi-action agent.`)}this.returnIntermediateSteps=a.returnIntermediateSteps??this.returnIntermediateSteps,this.maxIterations=a.maxIterations??this.maxIterations,this.earlyStoppingMethod=a.earlyStoppingMethod??this.earlyStoppingMethod}static fromAgentAndTools(a){return new executor_AgentExecutor(a)}get shouldContinueGetter(){return this.shouldContinue.bind(this)}shouldContinue(a){return void 0===this.maxIterations||a<this.maxIterations}async _call(a,i,s){let o=Object.fromEntries(this.tools.map(a=>[a.name.toLowerCase(),a])),c=[],A=0,getOutput=async s=>{let o;let{returnValues:w}=s,P=await this.agent.prepareForOutput(w,c);return await i?.handleAgentEnd(s),o=this.returnIntermediateSteps?{...w,intermediateSteps:c,...P}:{...w,...P},this.returnOnlyOutputs||(o={...a,...o}),o};for(;this.shouldContinue(A);){let k,R;try{k=await this.agent.plan(c,a,i?.getChild(),s)}catch(a){if(a instanceof x.dS){let i;let s=a.message;if(!0===this.handleParsingErrors)a.sendToLLM?(i=a.observation,s=a.llmOutput??""):i="Invalid or incomplete response";else if("string"==typeof this.handleParsingErrors)i=this.handleParsingErrors;else if("function"==typeof this.handleParsingErrors)i=this.handleParsingErrors(a);else throw a;k={tool:"_Exception",toolInput:i,log:s}}else throw a}if("returnValues"in k)return getOutput(k);R=Array.isArray(k)?k:[k];let j=await Promise.all(R.map(async a=>{let c;await i?.handleAgentAction(a);let A="_Exception"===a.tool?new ExceptionTool:o[a.tool?.toLowerCase()];try{c=A?await A.invoke(a.toolInput,(0,P.q)(s,{callbacks:i?.getChild()})):`${a.tool} is not a valid tool, try another one.`}catch(a){if(a instanceof w.YE){if(!0===this.handleParsingErrors)c="Invalid or incomplete tool input. Please try again.";else if("string"==typeof this.handleParsingErrors)c=this.handleParsingErrors;else if("function"==typeof this.handleParsingErrors)c=this.handleParsingErrors(a);else throw a;c=await new ExceptionTool().call(c,i?.getChild())}}return{action:a,observation:c??""}}));c.push(...j);let $=c[c.length-1],B=o[$.action.tool?.toLowerCase()];if(B?.returnDirect)return getOutput({returnValues:{[this.agent.returnValues[0]]:$.observation},log:""});A+=1}let k=await this.agent.returnStoppedResponse(this.earlyStoppingMethod,c,a);return getOutput(k)}async _takeNextStep(a,i,s,o,c){let P,A;try{P=await this.agent.plan(s,i,o?.getChild(),c)}catch(a){if(a instanceof x.dS){let i;let s=a.message;if(!0===this.handleParsingErrors)a.sendToLLM?(i=a.observation,s=a.llmOutput??""):i="Invalid or incomplete response";else if("string"==typeof this.handleParsingErrors)i=this.handleParsingErrors;else if("function"==typeof this.handleParsingErrors)i=this.handleParsingErrors(a);else throw a;P={tool:"_Exception",toolInput:i,log:s}}else throw a}if("returnValues"in P)return P;A=Array.isArray(P)?P:[P];let k=[];for(let i of A){let s="";if(o&&await o?.handleAgentAction(i),i.tool in a){let c=a[i.tool];try{s=await c.call(i.toolInput,o?.getChild())}catch(a){if(a instanceof w.YE){if(!0===this.handleParsingErrors)s="Invalid or incomplete tool input. Please try again.";else if("string"==typeof this.handleParsingErrors)s=this.handleParsingErrors;else if("function"==typeof this.handleParsingErrors)s=this.handleParsingErrors(a);else throw a;s=await new ExceptionTool().call(s,o?.getChild())}}}else s=`${i.tool} is not a valid tool, try another available tool: ${Object.keys(a).join(", ")}`;k.push({action:i,observation:s})}return k}async _return(a,i,s){s&&await s.handleAgentEnd(a);let o=a.returnValues;return this.returnIntermediateSteps&&(o.intermediateSteps=i),o}async _getToolReturn(a){let{action:i,observation:s}=a,o=Object.fromEntries(this.tools.map(a=>[a.name.toLowerCase(),a])),[c="output"]=this.agent.returnValues;return i.tool in o&&o[i.tool].returnDirect?{returnValues:{[c]:s},log:""}:null}_returnStoppedResponse(a){if("force"===a)return{returnValues:{output:"Agent stopped due to iteration limit or time limit."},log:""};throw Error(`Got unsupported early_stopping_method: ${a}`)}async *_streamIterator(a,i){let s=new AgentExecutorIterator({inputs:a,agentExecutor:this,config:i,metadata:i?.metadata,tags:i?.tags,callbacks:i?.callbacks}),o=s.streamIterator();for await(let a of o)a&&(yield a)}_chainType(){return"agent_executor"}serialize(){throw Error("Cannot serialize an AgentExecutor")}};s(6596),s(6827),s(3830),s(2488);var R=s(6261);s(8498),s(3478);var j=s(2447);s(9711);var $=s(6896);let output_parser_OpenAIFunctionsAgentOutputParser=class output_parser_OpenAIFunctionsAgentOutputParser extends j.h{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","openai"]})}static lc_name(){return"OpenAIFunctionsAgentOutputParser"}async parse(a){throw Error(`OpenAIFunctionsAgentOutputParser can only parse messages.
Passed input: ${a}`)}async parseResult(a){if("message"in a[0]&&(0,R.QW)(a[0].message))return this.parseAIMessage(a[0].message);throw Error("parseResult on OpenAIFunctionsAgentOutputParser only works on ChatGeneration output")}parseAIMessage(a){if(a.content&&"string"!=typeof a.content)throw Error("This agent cannot parse non-string model responses.");if(!a.additional_kwargs.function_call)return{returnValues:{output:a.content},log:a.content};{let i=a.additional_kwargs.function_call;try{let s=i.arguments?JSON.parse(i.arguments):{};return{tool:i.name,toolInput:s,log:`Invoking "${i.name}" with ${i.arguments??"{}"}
${a.content}`,messageLog:[a]}}catch(a){throw new x.dS(`Failed to parse function arguments from chat model response. Text: "${i.arguments}". ${a}`)}}}getFormatInstructions(){throw Error("getFormatInstructions not implemented inside OpenAIFunctionsAgentOutputParser.")}};function formatToOpenAIFunctionMessages(a){return a.flatMap(({action:a,observation:i})=>{if(!("messageLog"in a)||void 0===a.messageLog)return[new R.gY(a.log)];{let s=a.messageLog;return s.concat(new R.TN(i,a.tool))}})}async function createOpenAIFunctionsAgent({llm:a,tools:i,prompt:s,streamRunnable:c}){if(!s.inputVariables.includes("agent_scratchpad"))throw Error(`Prompt must have an input variable named "agent_scratchpad".
Found ${JSON.stringify(s.inputVariables)} instead.`);let w=a.bind({functions:i.map($.sU)}),A=o.fU.fromRunnables([P.sk.assign({agent_scratchpad:a=>formatToOpenAIFunctionMessages(a.steps)}),s,w,new output_parser_OpenAIFunctionsAgentOutputParser],{name:"OpenAIFunctionsAgent",streamRunnable:c,singleAction:!0});return A}s(6949)},5737:function(a,i,s){"use strict";s.d(i,{Ck:function(){return isRunnableAgent},Mj:function(){return RunnableSingleActionAgent},Py:function(){return Agent},fU:function(){return AgentRunnableSequence},zn:function(){return RunnableMultiActionAgent}});var o=s(3711),c=s(3102);let ParseError=class ParseError extends Error{constructor(a,i){super(a),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=i}};let BaseAgent=class BaseAgent extends o.i{get returnValues(){return["output"]}get allowedTools(){}_agentType(){throw Error("Not implemented")}returnStoppedResponse(a,i,s,o){if("force"===a)return Promise.resolve({returnValues:{output:"Agent stopped due to max iterations."},log:""});throw Error(`Invalid stopping method: ${a}`)}async prepareForOutput(a,i){return{}}};let BaseSingleActionAgent=class BaseSingleActionAgent extends BaseAgent{_agentActionType(){return"single"}};let BaseMultiActionAgent=class BaseMultiActionAgent extends BaseAgent{_agentActionType(){return"multi"}};function isAgentAction(a){return!Array.isArray(a)&&a?.tool!==void 0}function isRunnableAgent(a){return void 0!==a.runnable}let AgentRunnableSequence=class AgentRunnableSequence extends c.lW{constructor(){super(...arguments),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"singleAction",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}static fromRunnables([a,...i],s){let o=c.lW.from([a,...i],s.name);return o.singleAction=s.singleAction,o.streamRunnable=s.streamRunnable,o}static isAgentRunnableSequence(a){return"boolean"==typeof a.singleAction}};let RunnableSingleActionAgent=class RunnableSingleActionAgent extends BaseSingleActionAgent{get inputKeys(){return[]}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","runnable"]}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"defaultRunName",{enumerable:!0,configurable:!0,writable:!0,value:"RunnableAgent"}),this.runnable=a.runnable,this.defaultRunName=a.defaultRunName??this.runnable.name??this.defaultRunName,this.streamRunnable=a.streamRunnable??this.streamRunnable}async plan(a,i,s,o){let w={...i,steps:a},P=(0,c.q)(o,{callbacks:s,runName:this.defaultRunName});if(!this.streamRunnable)return this.runnable.invoke(w,P);{let a;let i=await this.runnable.stream(w,P);for await(let s of i)if(void 0===a)a=s;else throw Error('Multiple agent actions/finishes received in streamed agent output.\nSet "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.');if(void 0===a)throw Error('No streaming output received from underlying runnable.\nSet "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.');return a}}};let RunnableMultiActionAgent=class RunnableMultiActionAgent extends BaseMultiActionAgent{get inputKeys(){return[]}constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","runnable"]}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"defaultRunName",{enumerable:!0,configurable:!0,writable:!0,value:"RunnableAgent"}),Object.defineProperty(this,"stop",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"streamRunnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),this.runnable=a.runnable,this.stop=a.stop,this.defaultRunName=a.defaultRunName??this.runnable.name??this.defaultRunName,this.streamRunnable=a.streamRunnable??this.streamRunnable}async plan(a,i,s,o){let w;let P={...i,steps:a},A=(0,c.q)(o,{callbacks:s,runName:this.defaultRunName});if(this.streamRunnable){let a;let i=await this.runnable.stream(P,A);for await(let s of i)if(void 0===a)a=s;else throw Error('Multiple agent actions/finishes received in streamed agent output.\nSet "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.');if(void 0===a)throw Error('No streaming output received from underlying runnable.\nSet "streamRunnable: false" when initializing the agent to invoke this agent in non-streaming mode.');w=a}else w=await this.runnable.invoke(P,A);return isAgentAction(w)?[w]:w}};let Agent=class Agent extends BaseSingleActionAgent{get allowedTools(){return this._allowedTools}get inputKeys(){return this.llmChain.inputKeys.filter(a=>"agent_scratchpad"!==a)}constructor(a){super(a),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_allowedTools",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=a.llmChain,this._allowedTools=a.allowedTools,this.outputParser=a.outputParser}static getDefaultOutputParser(a){throw Error("Not implemented")}static createPrompt(a,i){throw Error("Not implemented")}static fromLLMAndTools(a,i,s){throw Error("Not implemented")}static validateTools(a){}_stop(){return[`
${this.observationPrefix()}`]}finishToolName(){return"Final Answer"}async constructScratchPad(a){return a.reduce((a,{action:i,observation:s})=>a+[i.log,`${this.observationPrefix()}${s}`,this.llmPrefix()].join("\n"),"")}async _plan(a,i,s,o){let c=await this.constructScratchPad(a),w={...i,agent_scratchpad:s?`${c}${s}`:c};0!==this._stop().length&&(w.stop=this._stop());let P=await this.llmChain.predict(w,o);if(!this.outputParser)throw Error("Output parser not set");return this.outputParser.parse(P,o)}plan(a,i,s){return this._plan(a,i,void 0,s)}async returnStoppedResponse(a,i,s,o){if("force"===a)return{returnValues:{output:"Agent stopped due to max iterations."},log:""};if("generate"===a)try{let a=await this._plan(i,s,"\n\nI now need to return a final answer based on the previous steps:",o);if("returnValues"in a)return a;return{returnValues:{output:a.log},log:a.log}}catch(a){if(!(a instanceof ParseError))throw a;return{returnValues:{output:a.output},log:a.output}}throw Error(`Invalid stopping method: ${a}`)}static async deserialize(a){if("zero-shot-react-description"===a._type){let{ZeroShotAgent:i}=await Promise.resolve().then(s.bind(s,5347));return i.deserialize(a)}throw Error("Unknown agent type")}}},5347:function(a,i,s){"use strict";s.d(i,{ZeroShotAgent:function(){return ZeroShotAgent}});var o=s(6827),c=s(2738),w=s(5737);let deserializeHelper=async(a,i,s,o,w)=>{if(s.load_from_llm_and_tools){if(!a)throw Error("Loading from llm and tools, llm must be provided.");if(!i)throw Error("Loading from llm and tools, tools must be provided.");return o(a,i,s)}if(!s.llm_chain)throw Error("Loading from constructor, llm_chain must be provided.");let P=await c.LLMChain.deserialize(s.llm_chain);return w({...s,llmChain:P})};var P=s(6949),A=s(3009);let ZeroShotAgent=class ZeroShotAgent extends w.Py{static lc_name(){return"ZeroShotAgent"}constructor(a){let i=a?.outputParser??ZeroShotAgent.getDefaultOutputParser();super({...a,outputParser:i}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]})}_agentType(){return"zero-shot-react-description"}observationPrefix(){return"Observation: "}llmPrefix(){return"Thought:"}static getDefaultOutputParser(a){return new P.S(a)}static validateTools(a){let i=a.find(a=>!a.description);if(i){let a=`Got a tool ${i.name} without a description. This agent requires descriptions for all tools.`;throw Error(a)}}static createPrompt(a,i){let{prefix:s=A.Bq,suffix:c=A.NS,inputVariables:w=["input","agent_scratchpad"]}=i??{},P=a.map(a=>`${a.name}: ${a.description}`).join("\n"),x=a.map(a=>a.name),k=(0,o.SM)(A.cQ,"f-string",{tool_names:x}),R=[s,P,k,c].join("\n\n");return new o.Pf({template:R,inputVariables:w})}static fromLLMAndTools(a,i,s){ZeroShotAgent.validateTools(i);let o=ZeroShotAgent.createPrompt(i,s),w=s?.outputParser??ZeroShotAgent.getDefaultOutputParser(),P=new c.LLMChain({prompt:o,llm:a,callbacks:s?.callbacks??s?.callbackManager});return new ZeroShotAgent({llmChain:P,allowedTools:i.map(a=>a.name),outputParser:w})}static async deserialize(a){let{llm:i,tools:s,...o}=a;return deserializeHelper(i,s,o,(a,i,s)=>ZeroShotAgent.fromLLMAndTools(a,i,{prefix:s.prefix,suffix:s.suffix,inputVariables:s.input_variables}),a=>new ZeroShotAgent(a))}}},6949:function(a,i,s){"use strict";s.d(i,{S:function(){return ZeroShotAgentOutputParser}});var o=s(7846),c=s(2447),w=s(3009);let ZeroShotAgentOutputParser=class ZeroShotAgentOutputParser extends c.h{constructor(a){super(a),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","agents","mrkl"]}),Object.defineProperty(this,"finishToolName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.finishToolName=a?.finishToolName||"Final Answer:"}async parse(a){if(a.includes(this.finishToolName)){let i=a.split(this.finishToolName),s=i[i.length-1].trim();return{returnValues:{output:s},log:a}}let i=/Action:([\s\S]*?)(?:\nAction Input:([\s\S]*?))?$/.exec(a);if(!i)throw new o.dS(`Could not parse LLM output: ${a}`);return{tool:i[1].trim(),toolInput:i[2]?i[2].trim().replace(/^("+)(.*?)(\1)$/,"$2"):"",log:a}}getFormatInstructions(){return w.cQ}}},3009:function(a,i,s){"use strict";s.d(i,{Bq:function(){return o},NS:function(){return w},cQ:function(){return c}});let o="Answer the following questions as best you can. You have access to the following tools:",c=`Use the following format in your response:

Question: the input question you must answer
Thought: you should always think about what to do
Action: the action to take, should be one of [{tool_names}]
Action Input: the input to the action
Observation: the result of the action
... (this Thought/Action/Action Input/Observation can repeat N times)
Thought: I now know the final answer
Final Answer: the final answer to the original input question`,w=`Begin!

Question: {input}
Thought:{agent_scratchpad}`},2447:function(a,i,s){"use strict";s.d(i,{h:function(){return AgentActionOutputParser}});var o=s(7846);let AgentActionOutputParser=class AgentActionOutputParser extends o.bI{}},8699:function(a,i,s){"use strict";s.d(i,{l:function(){return BaseChain}});var o=s(8398),c=s(1974),w=s(3102),P=s(8463);let BaseChain=class BaseChain extends P.BD{get lc_namespace(){return["langchain","chains",this._chainType()]}constructor(a,i,s){if(1!=arguments.length||"object"!=typeof a||"saveContext"in a)super({verbose:i,callbacks:s}),this.memory=a;else{let{memory:i,callbackManager:s,...o}=a;super({...o,callbacks:s??o.callbacks}),this.memory=i}}_selectMemoryInputs(a){let i={...a};return"signal"in i&&delete i.signal,"timeout"in i&&delete i.timeout,i}async invoke(a,i){let s;let P=(0,w.LE)(i),A=await this._formatValues(a),x=await c.Ye.configure(P?.callbacks,this.callbacks,P?.tags,this.tags,P?.metadata,this.metadata,{verbose:this.verbose}),k=await x?.handleChainStart(this.toJSON(),A,void 0,void 0,void 0,void 0,P?.runName);try{s=await (A.signal?Promise.race([this._call(A,k,P),new Promise((a,i)=>{A.signal?.addEventListener("abort",()=>{i(Error("AbortError"))})})]):this._call(A,k,P))}catch(a){throw await k?.handleChainError(a),a}return null!=this.memory&&await this.memory.saveContext(this._selectMemoryInputs(a),s),await k?.handleChainEnd(s),Object.defineProperty(s,o.WH,{value:k?{runId:k?.runId}:void 0,configurable:!0}),s}_validateOutputs(a){let i=this.outputKeys.filter(i=>!(i in a));if(i.length)throw Error(`Missing output keys: ${i.join(", ")} from chain ${this._chainType()}`)}async prepOutputs(a,i,s=!1){return(this._validateOutputs(i),this.memory&&await this.memory.saveContext(a,i),s)?i:{...a,...i}}serialize(){throw Error("Method not implemented.")}async run(a,i){let s=this.inputKeys.filter(a=>!this.memory?.memoryKeys.includes(a)??!0),o=s.length<=1;if(!o)throw Error(`Chain ${this._chainType()} expects multiple inputs, cannot use 'run' `);let c=s.length?{[s[0]]:a}:{},w=await this.call(c,i),P=Object.keys(w);if(1===P.length)return w[P[0]];throw Error("return values have multiple keys, `run` only supported when one key currently")}async _formatValues(a){let i={...a};if(i.timeout&&!i.signal&&(i.signal=AbortSignal.timeout(i.timeout),delete i.timeout),null!=this.memory){let s=await this.memory.loadMemoryVariables(this._selectMemoryInputs(a));for(let[a,o]of Object.entries(s))i[a]=o}return i}async call(a,i,s){let o={tags:s,...(0,c.QH)(i)};return this.invoke(a,o)}async apply(a,i){return Promise.all(a.map(async(a,s)=>this.call(a,i?.[s])))}static async deserialize(a,i={}){switch(a._type){case"llm_chain":{let{LLMChain:i}=await Promise.resolve().then(s.bind(s,2738));return i.deserialize(a)}case"sequential_chain":{let{SequentialChain:i}=await s.e(96).then(s.bind(s,3096));return i.deserialize(a)}case"simple_sequential_chain":{let{SimpleSequentialChain:i}=await s.e(96).then(s.bind(s,3096));return i.deserialize(a)}case"stuff_documents_chain":{let{StuffDocumentsChain:i}=await Promise.resolve().then(s.bind(s,4482));return i.deserialize(a)}case"map_reduce_documents_chain":{let{MapReduceDocumentsChain:i}=await Promise.resolve().then(s.bind(s,4482));return i.deserialize(a)}case"refine_documents_chain":{let{RefineDocumentsChain:i}=await Promise.resolve().then(s.bind(s,4482));return i.deserialize(a)}case"vector_db_qa":{let{VectorDBQAChain:o}=await Promise.resolve().then(s.bind(s,6596));return o.deserialize(a,i)}case"api_chain":{let{APIChain:i}=await s.e(297).then(s.bind(s,2297));return i.deserialize(a)}default:throw Error(`Invalid prompt type in config: ${a._type}`)}}}},4482:function(a,i,s){"use strict";s.d(i,{MapReduceDocumentsChain:function(){return MapReduceDocumentsChain},RefineDocumentsChain:function(){return RefineDocumentsChain},StuffDocumentsChain:function(){return StuffDocumentsChain}});var o=s(6827),c=s(8699),w=s(2738);let StuffDocumentsChain=class StuffDocumentsChain extends c.l{static lc_name(){return"StuffDocumentsChain"}get inputKeys(){return[this.inputKey,...this.llmChain.inputKeys].filter(a=>a!==this.documentVariableName)}get outputKeys(){return this.llmChain.outputKeys}constructor(a){super(a),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),this.llmChain=a.llmChain,this.documentVariableName=a.documentVariableName??this.documentVariableName,this.inputKey=a.inputKey??this.inputKey}_prepInputs(a){if(!(this.inputKey in a))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:i,...s}=a,o=i.map(({pageContent:a})=>a),c=o.join("\n\n");return{...s,[this.documentVariableName]:c}}async _call(a,i){let s=await this.llmChain.call(this._prepInputs(a),i?.getChild("combine_documents"));return s}_chainType(){return"stuff_documents_chain"}static async deserialize(a){if(!a.llm_chain)throw Error("Missing llm_chain");return new StuffDocumentsChain({llmChain:await w.LLMChain.deserialize(a.llm_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize()}}};let MapReduceDocumentsChain=class MapReduceDocumentsChain extends c.l{static lc_name(){return"MapReduceDocumentsChain"}get inputKeys(){return[this.inputKey,...this.combineDocumentChain.inputKeys]}get outputKeys(){return this.combineDocumentChain.outputKeys}constructor(a){super(a),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"returnIntermediateSteps",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"maxTokens",{enumerable:!0,configurable:!0,writable:!0,value:3e3}),Object.defineProperty(this,"maxIterations",{enumerable:!0,configurable:!0,writable:!0,value:10}),Object.defineProperty(this,"ensureMapStep",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"combineDocumentChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.llmChain=a.llmChain,this.combineDocumentChain=a.combineDocumentChain,this.documentVariableName=a.documentVariableName??this.documentVariableName,this.ensureMapStep=a.ensureMapStep??this.ensureMapStep,this.inputKey=a.inputKey??this.inputKey,this.maxTokens=a.maxTokens??this.maxTokens,this.maxIterations=a.maxIterations??this.maxIterations,this.returnIntermediateSteps=a.returnIntermediateSteps??!1}async _call(a,i){if(!(this.inputKey in a))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:s,...o}=a,c=s,w=[];for(let a=0;a<this.maxIterations;a+=1){let s=c.map(a=>({[this.documentVariableName]:a.pageContent,...o})),P=0!==a||!this.ensureMapStep;if(P){let a=await this.combineDocumentChain.llmChain.prompt.format(this.combineDocumentChain._prepInputs({[this.combineDocumentChain.inputKey]:c,...o})),i=await this.combineDocumentChain.llmChain._getNumTokens(a),s=i<this.maxTokens;if(s)break}let A=await this.llmChain.apply(s,i?Array.from({length:s.length},(a,s)=>i.getChild(`map_${s+1}`)):void 0),{outputKey:x}=this.llmChain;this.returnIntermediateSteps&&(w=w.concat(A.map(a=>a[x]))),c=A.map(a=>({pageContent:a[x],metadata:{}}))}let P={[this.combineDocumentChain.inputKey]:c,...o},A=await this.combineDocumentChain.call(P,i?.getChild("combine_documents"));return this.returnIntermediateSteps?{...A,intermediateSteps:w}:A}_chainType(){return"map_reduce_documents_chain"}static async deserialize(a){if(!a.llm_chain)throw Error("Missing llm_chain");if(!a.combine_document_chain)throw Error("Missing combine_document_chain");return new MapReduceDocumentsChain({llmChain:await w.LLMChain.deserialize(a.llm_chain),combineDocumentChain:await StuffDocumentsChain.deserialize(a.combine_document_chain)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),combine_document_chain:this.combineDocumentChain.serialize()}}};let RefineDocumentsChain=class RefineDocumentsChain extends c.l{static lc_name(){return"RefineDocumentsChain"}get defaultDocumentPrompt(){return new o.Pf({inputVariables:["page_content"],template:"{page_content}"})}get inputKeys(){return[...new Set([this.inputKey,...this.llmChain.inputKeys,...this.refineLLMChain.inputKeys])].filter(a=>a!==this.documentVariableName&&a!==this.initialResponseName)}get outputKeys(){return[this.outputKey]}constructor(a){super(a),Object.defineProperty(this,"llmChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"input_documents"}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"output_text"}),Object.defineProperty(this,"documentVariableName",{enumerable:!0,configurable:!0,writable:!0,value:"context"}),Object.defineProperty(this,"initialResponseName",{enumerable:!0,configurable:!0,writable:!0,value:"existing_answer"}),Object.defineProperty(this,"refineLLMChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"documentPrompt",{enumerable:!0,configurable:!0,writable:!0,value:this.defaultDocumentPrompt}),this.llmChain=a.llmChain,this.refineLLMChain=a.refineLLMChain,this.documentVariableName=a.documentVariableName??this.documentVariableName,this.inputKey=a.inputKey??this.inputKey,this.outputKey=a.outputKey??this.outputKey,this.documentPrompt=a.documentPrompt??this.documentPrompt,this.initialResponseName=a.initialResponseName??this.initialResponseName}async _constructInitialInputs(a,i){let s={page_content:a.pageContent,...a.metadata},o={};this.documentPrompt.inputVariables.forEach(a=>{o[a]=s[a]});let c={[this.documentVariableName]:await this.documentPrompt.format({...o})},w={...c,...i};return w}async _constructRefineInputs(a,i){let s={page_content:a.pageContent,...a.metadata},o={};this.documentPrompt.inputVariables.forEach(a=>{o[a]=s[a]});let c={[this.documentVariableName]:await this.documentPrompt.format({...o})},w={[this.initialResponseName]:i,...c};return w}async _call(a,i){if(!(this.inputKey in a))throw Error(`Document key ${this.inputKey} not found.`);let{[this.inputKey]:s,...o}=a,c=await this._constructInitialInputs(s[0],o),w=await this.llmChain.predict({...c},i?.getChild("answer")),P=[w];for(let a=1;a<s.length;a+=1){let c=await this._constructRefineInputs(s[a],w),A={...c,...o};w=await this.refineLLMChain.predict({...A},i?.getChild("refine")),P.push(w)}return{[this.outputKey]:w}}_chainType(){return"refine_documents_chain"}static async deserialize(a){let i=a.llm_chain;if(!i)throw Error("Missing llm_chain");let s=a.refine_llm_chain;if(!s)throw Error("Missing refine_llm_chain");return new RefineDocumentsChain({llmChain:await w.LLMChain.deserialize(i),refineLLMChain:await w.LLMChain.deserialize(s)})}serialize(){return{_type:this._chainType(),llm_chain:this.llmChain.serialize(),refine_llm_chain:this.refineLLMChain.serialize()}}}},2738:function(a,i,s){"use strict";s.d(i,{LLMChain:function(){return LLMChain}});var o=s(8463),c=s(6827),w=s(3102),P=s(8699),A=s(7846);let NoOpOutputParser=class NoOpOutputParser extends A.bI{constructor(){super(...arguments),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain","output_parsers","default"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0})}static lc_name(){return"NoOpOutputParser"}parse(a){return Promise.resolve(a)}getFormatInstructions(){return""}};function isBaseLanguageModel(a){return"function"==typeof a._llmType}function _getLanguageModel(a){if(isBaseLanguageModel(a))return a;if("bound"in a&&w.eq.isRunnable(a.bound))return _getLanguageModel(a.bound);if("runnable"in a&&"fallbacks"in a&&w.eq.isRunnable(a.runnable))return _getLanguageModel(a.runnable);if("default"in a&&w.eq.isRunnable(a.default))return _getLanguageModel(a.default);throw Error("Unable to extract BaseLanguageModel from llmLike object.")}let LLMChain=class LLMChain extends P.l{static lc_name(){return"LLMChain"}get inputKeys(){return this.prompt.inputVariables}get outputKeys(){return[this.outputKey]}constructor(a){if(super(a),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"prompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llm",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"llmKwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"outputKey",{enumerable:!0,configurable:!0,writable:!0,value:"text"}),Object.defineProperty(this,"outputParser",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.prompt=a.prompt,this.llm=a.llm,this.llmKwargs=a.llmKwargs,this.outputKey=a.outputKey??this.outputKey,this.outputParser=a.outputParser??new NoOpOutputParser,this.prompt.outputParser){if(a.outputParser)throw Error("Cannot set both outputParser and prompt.outputParser");this.outputParser=this.prompt.outputParser}}getCallKeys(){let a="callKeys"in this.llm?this.llm.callKeys:[];return a}_selectMemoryInputs(a){let i=super._selectMemoryInputs(a),s=this.getCallKeys();for(let o of s)o in a&&delete i[o];return i}async _getFinalOutput(a,i,s){return this.outputParser?await this.outputParser.parseResultWithPrompt(a,i,s?.getChild()):a[0].text}call(a,i){return super.call(a,i)}async _call(a,i){let s={...a},o={...this.llmKwargs},c=this.getCallKeys();for(let i of c)i in a&&o&&(o[i]=a[i],delete s[i]);let w=await this.prompt.formatPromptValue(s);if("generatePrompt"in this.llm){let{generations:a}=await this.llm.generatePrompt([w],o,i?.getChild());return{[this.outputKey]:await this._getFinalOutput(a[0],w,i)}}let P=this.outputParser?this.llm.pipe(this.outputParser):this.llm,A=await P.invoke(w,i?.getChild());return{[this.outputKey]:A}}async predict(a,i){let s=await this.call(a,i);return s[this.outputKey]}_chainType(){return"llm"}static async deserialize(a){let{llm:i,prompt:s}=a;if(!i)throw Error("LLMChain must have llm");if(!s)throw Error("LLMChain must have prompt");return new LLMChain({llm:await o.qV.deserialize(i),prompt:await c.dy.deserialize(s)})}serialize(){let a="serialize"in this.llm?this.llm.serialize():void 0;return{_type:`${this._chainType()}_chain`,llm:a,prompt:this.prompt.serialize()}}_getNumTokens(a){return _getLanguageModel(this.llm).getNumTokens(a)}}},6596:function(a,i,s){"use strict";s.d(i,{VectorDBQAChain:function(){return VectorDBQAChain}});var o=s(8699),c=s(2738),w=s(4482),P=s(6827);s(8498);let BasePromptSelector=class BasePromptSelector{async getPromptAsync(a,i){let s=this.getPrompt(a);return s.partial(i?.partialVariables??{})}};let ConditionalPromptSelector=class ConditionalPromptSelector extends BasePromptSelector{constructor(a,i=[]){super(),Object.defineProperty(this,"defaultPrompt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"conditionals",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.defaultPrompt=a,this.conditionals=i}getPrompt(a){for(let[i,s]of this.conditionals)if(i(a))return s;return this.defaultPrompt}};function isChatModel(a){return"base_chat_model"===a._modelType()}let A=new P.Pf({template:"Use the following pieces of context to answer the question at the end. If you don't know the answer, just say that you don't know, don't try to make up an answer.\n\n{context}\n\nQuestion: {question}\nHelpful Answer:",inputVariables:["context","question"]}),x=`Use the following pieces of context to answer the users question. 
If you don't know the answer, just say that you don't know, don't try to make up an answer.
----------------
{context}`,k=[P.ov.fromTemplate(x),P.kq.fromTemplate("{question}")],R=P.ks.fromMessages(k),j=new ConditionalPromptSelector(A,[[isChatModel,R]]);function loadQAStuffChain(a,i={}){let{prompt:s=j.getPrompt(a),verbose:o}=i,P=new c.LLMChain({prompt:s,llm:a,verbose:o}),A=new w.StuffDocumentsChain({llmChain:P,verbose:o});return A}let VectorDBQAChain=class VectorDBQAChain extends o.l{static lc_name(){return"VectorDBQAChain"}get inputKeys(){return[this.inputKey]}get outputKeys(){return this.combineDocumentsChain.outputKeys.concat(this.returnSourceDocuments?["sourceDocuments"]:[])}constructor(a){super(a),Object.defineProperty(this,"k",{enumerable:!0,configurable:!0,writable:!0,value:4}),Object.defineProperty(this,"inputKey",{enumerable:!0,configurable:!0,writable:!0,value:"query"}),Object.defineProperty(this,"vectorstore",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"combineDocumentsChain",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"returnSourceDocuments",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.vectorstore=a.vectorstore,this.combineDocumentsChain=a.combineDocumentsChain,this.inputKey=a.inputKey??this.inputKey,this.k=a.k??this.k,this.returnSourceDocuments=a.returnSourceDocuments??this.returnSourceDocuments}async _call(a,i){if(!(this.inputKey in a))throw Error(`Question key ${this.inputKey} not found.`);let s=a[this.inputKey],o=await this.vectorstore.similaritySearch(s,this.k,a.filter,i?.getChild("vectorstore")),c=await this.combineDocumentsChain.call({question:s,input_documents:o},i?.getChild("combine_documents"));return this.returnSourceDocuments?{...c,sourceDocuments:o}:c}_chainType(){return"vector_db_qa"}static async deserialize(a,i){if(!("vectorstore"in i))throw Error("Need to pass in a vectorstore to deserialize VectorDBQAChain");let{vectorstore:s}=i;if(!a.combine_documents_chain)throw Error("VectorDBQAChain must have combine_documents_chain in serialized data");return new VectorDBQAChain({combineDocumentsChain:await o.l.deserialize(a.combine_documents_chain),k:a.k,vectorstore:s})}serialize(){return{_type:this._chainType(),combine_documents_chain:this.combineDocumentsChain.serialize(),k:this.k}}static fromLLM(a,i,s){let o=loadQAStuffChain(a);return new this({vectorstore:i,combineDocumentsChain:o,...s})}}},8249:function(a,i,s){"use strict";s.d(i,{k:function(){return customAlphabet}});let customAlphabet=(a,i=21)=>(s=i)=>{let o="",c=s;for(;c--;)o+=a[Math.random()*a.length|0];return o}},2322:function(a,i,s){"use strict";s.d(i,{Ix:function(){return A},Am:function(){return Q}});var o=s(1798);function r(a){var i,s,o="";if("string"==typeof a||"number"==typeof a)o+=a;else if("object"==typeof a){if(Array.isArray(a))for(i=0;i<a.length;i++)a[i]&&(s=r(a[i]))&&(o&&(o+=" "),o+=s);else for(i in a)a[i]&&(o&&(o+=" "),o+=i)}return o}var clsx_m=function(){for(var a,i,s=0,o="";s<arguments.length;)(a=arguments[s++])&&(i=r(a))&&(o&&(o+=" "),o+=i);return o};let u=a=>"number"==typeof a&&!isNaN(a),d=a=>"string"==typeof a,p=a=>"function"==typeof a,m=a=>d(a)||p(a)?a:null,f=a=>(0,o.isValidElement)(a)||d(a)||p(a)||u(a);function g(a,i,s){void 0===s&&(s=300);let{scrollHeight:o,style:c}=a;requestAnimationFrame(()=>{c.minHeight="initial",c.height=o+"px",c.transition=`all ${s}ms`,requestAnimationFrame(()=>{c.height="0",c.padding="0",c.margin="0",setTimeout(i,s)})})}function h(a){let{enter:i,exit:s,appendPosition:c=!1,collapse:w=!0,collapseDuration:P=300}=a;return function(a){let{children:A,position:x,preventExitTransition:k,done:R,nodeRef:j,isIn:$}=a,B=c?`${i}--${x}`:i,D=c?`${s}--${x}`:s,Z=(0,o.useRef)(0);return(0,o.useLayoutEffect)(()=>{let a=j.current,i=B.split(" "),n=s=>{s.target===j.current&&(a.dispatchEvent(new Event("d")),a.removeEventListener("animationend",n),a.removeEventListener("animationcancel",n),0===Z.current&&"animationcancel"!==s.type&&a.classList.remove(...i))};a.classList.add(...i),a.addEventListener("animationend",n),a.addEventListener("animationcancel",n)},[]),(0,o.useEffect)(()=>{let a=j.current,e=()=>{a.removeEventListener("animationend",e),w?g(a,R,P):R()};$||(k?e():(Z.current=1,a.className+=` ${D}`,a.addEventListener("animationend",e)))},[$]),o.createElement(o.Fragment,null,A)}}function y(a,i){return null!=a?{content:a.content,containerId:a.props.containerId,id:a.props.toastId,theme:a.props.theme,type:a.props.type,data:a.props.data||{},isLoading:a.props.isLoading,icon:a.props.icon,status:i}:{}}let c={list:new Map,emitQueue:new Map,on(a,i){return this.list.has(a)||this.list.set(a,[]),this.list.get(a).push(i),this},off(a,i){if(i){let s=this.list.get(a).filter(a=>a!==i);return this.list.set(a,s),this}return this.list.delete(a),this},cancelEmit(a){let i=this.emitQueue.get(a);return i&&(i.forEach(clearTimeout),this.emitQueue.delete(a)),this},emit(a){this.list.has(a)&&this.list.get(a).forEach(i=>{let s=setTimeout(()=>{i(...[].slice.call(arguments,1))},0);this.emitQueue.has(a)||this.emitQueue.set(a,[]),this.emitQueue.get(a).push(s)})}},T=a=>{let{theme:i,type:s,...c}=a;return o.createElement("svg",{viewBox:"0 0 24 24",width:"100%",height:"100%",fill:"colored"===i?"currentColor":`var(--toastify-icon-color-${s})`,...c})},w={info:function(a){return o.createElement(T,{...a},o.createElement("path",{d:"M12 0a12 12 0 1012 12A12.013 12.013 0 0012 0zm.25 5a1.5 1.5 0 11-1.5 1.5 1.5 1.5 0 011.5-1.5zm2.25 13.5h-4a1 1 0 010-2h.75a.25.25 0 00.25-.25v-4.5a.25.25 0 00-.25-.25h-.75a1 1 0 010-2h1a2 2 0 012 2v4.75a.25.25 0 00.25.25h.75a1 1 0 110 2z"}))},warning:function(a){return o.createElement(T,{...a},o.createElement("path",{d:"M23.32 17.191L15.438 2.184C14.728.833 13.416 0 11.996 0c-1.42 0-2.733.833-3.443 2.184L.533 17.448a4.744 4.744 0 000 4.368C1.243 23.167 2.555 24 3.975 24h16.05C22.22 24 24 22.044 24 19.632c0-.904-.251-1.746-.68-2.44zm-9.622 1.46c0 1.033-.724 1.823-1.698 1.823s-1.698-.79-1.698-1.822v-.043c0-1.028.724-1.822 1.698-1.822s1.698.79 1.698 1.822v.043zm.039-12.285l-.84 8.06c-.057.581-.408.943-.897.943-.49 0-.84-.367-.896-.942l-.84-8.065c-.057-.624.25-1.095.779-1.095h1.91c.528.005.84.476.784 1.1z"}))},success:function(a){return o.createElement(T,{...a},o.createElement("path",{d:"M12 0a12 12 0 1012 12A12.014 12.014 0 0012 0zm6.927 8.2l-6.845 9.289a1.011 1.011 0 01-1.43.188l-4.888-3.908a1 1 0 111.25-1.562l4.076 3.261 6.227-8.451a1 1 0 111.61 1.183z"}))},error:function(a){return o.createElement(T,{...a},o.createElement("path",{d:"M11.983 0a12.206 12.206 0 00-8.51 3.653A11.8 11.8 0 000 12.207 11.779 11.779 0 0011.8 24h.214A12.111 12.111 0 0024 11.791 11.766 11.766 0 0011.983 0zM10.5 16.542a1.476 1.476 0 011.449-1.53h.027a1.527 1.527 0 011.523 1.47 1.475 1.475 0 01-1.449 1.53h-.027a1.529 1.529 0 01-1.523-1.47zM11 12.5v-6a1 1 0 012 0v6a1 1 0 11-2 0z"}))},spinner:function(){return o.createElement("div",{className:"Toastify__spinner"})}};function C(a){let[,i]=(0,o.useReducer)(a=>a+1,0),[s,P]=(0,o.useState)([]),A=(0,o.useRef)(null),x=(0,o.useRef)(new Map).current,T=a=>-1!==s.indexOf(a),k=(0,o.useRef)({toastKey:1,displayedToast:0,count:0,queue:[],props:a,containerId:null,isToastActive:T,getToast:a=>x.get(a)}).current;function b(a){let{containerId:i}=a,{limit:s}=k.props;!s||i&&k.containerId!==i||(k.count-=k.queue.length,k.queue=[])}function I(a){P(i=>null==a?[]:i.filter(i=>i!==a))}function _(){let{toastContent:a,toastProps:i,staleId:s}=k.queue.shift();O(a,i,s)}function L(a,s){var P,R;let{delay:j,staleId:$,...B}=s;if(!f(a)||!A.current||k.props.enableMultiContainer&&B.containerId!==k.props.containerId||x.has(B.toastId)&&null==B.updateId)return;let{toastId:D,updateId:Z,data:U}=B,{props:z}=k,L=()=>I(D),V=null==Z;V&&k.count++;let G={...z,style:z.toastStyle,key:k.toastKey++,...Object.fromEntries(Object.entries(B).filter(a=>{let[i,s]=a;return null!=s})),toastId:D,updateId:Z,data:U,closeToast:L,isIn:!1,className:m(B.className||z.toastClassName),bodyClassName:m(B.bodyClassName||z.bodyClassName),progressClassName:m(B.progressClassName||z.progressClassName),autoClose:!B.isLoading&&(P=B.autoClose,R=z.autoClose,!1===P||u(P)&&P>0?P:R),deleteToast(){let a=y(x.get(D),"removed");x.delete(D),c.emit(4,a);let s=k.queue.length;if(k.count=null==D?k.count-k.displayedToast:k.count-1,k.count<0&&(k.count=0),s>0){let a=null==D?k.props.limit:1;if(1===s||1===a)k.displayedToast++,_();else{let i=a>s?s:a;k.displayedToast=i;for(let a=0;a<i;a++)_()}}else i()}};G.iconOut=function(a){let{theme:i,type:s,isLoading:c,icon:P}=a,A=null,x={theme:i,type:s};return!1===P||(p(P)?A=P(x):(0,o.isValidElement)(P)?A=(0,o.cloneElement)(P,x):d(P)||u(P)?A=P:c?A=w.spinner():s in w&&(A=w[s](x))),A}(G),p(B.onOpen)&&(G.onOpen=B.onOpen),p(B.onClose)&&(G.onClose=B.onClose),G.closeButton=z.closeButton,!1===B.closeButton||f(B.closeButton)?G.closeButton=B.closeButton:!0===B.closeButton&&(G.closeButton=!f(z.closeButton)||z.closeButton);let W=a;(0,o.isValidElement)(a)&&!d(a.type)?W=(0,o.cloneElement)(a,{closeToast:L,toastProps:G,data:U}):p(a)&&(W=a({closeToast:L,toastProps:G,data:U})),z.limit&&z.limit>0&&k.count>z.limit&&V?k.queue.push({toastContent:W,toastProps:G,staleId:$}):u(j)?setTimeout(()=>{O(W,G,$)},j):O(W,G,$)}function O(a,i,s){let{toastId:o}=i;s&&x.delete(s);let w={content:a,props:i};x.set(o,w),P(a=>[...a,o].filter(a=>a!==s)),c.emit(4,y(w,null==w.props.updateId?"added":"updated"))}return(0,o.useEffect)(()=>(k.containerId=a.containerId,c.cancelEmit(3).on(0,L).on(1,a=>A.current&&I(a)).on(5,b).emit(2,k),()=>{x.clear(),c.emit(3,k)}),[]),(0,o.useEffect)(()=>{k.props=a,k.isToastActive=T,k.displayedToast=s.length}),{getToastToRender:function(i){let s=new Map,o=Array.from(x.values());return a.newestOnTop&&o.reverse(),o.forEach(a=>{let{position:i}=a.props;s.has(i)||s.set(i,[]),s.get(i).push(a)}),Array.from(s,a=>i(a[0],a[1]))},containerRef:A,isToastActive:T}}function b(a){return a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].clientX:a.clientX}function I(a){return a.targetTouches&&a.targetTouches.length>=1?a.targetTouches[0].clientY:a.clientY}function _(a){let[i,s]=(0,o.useState)(!1),[c,w]=(0,o.useState)(!1),P=(0,o.useRef)(null),A=(0,o.useRef)({start:0,x:0,y:0,delta:0,removalDistance:0,canCloseOnClick:!0,canDrag:!1,boundingRect:null,didMove:!1}).current,x=(0,o.useRef)(a),{autoClose:k,pauseOnHover:R,closeToast:j,onClick:$,closeOnClick:B}=a;function v(i){if(a.draggable){"touchstart"===i.nativeEvent.type&&i.nativeEvent.preventDefault(),A.didMove=!1,document.addEventListener("mousemove",_),document.addEventListener("mouseup",L),document.addEventListener("touchmove",_),document.addEventListener("touchend",L);let s=P.current;A.canCloseOnClick=!0,A.canDrag=!0,A.boundingRect=s.getBoundingClientRect(),s.style.transition="",A.x=b(i.nativeEvent),A.y=I(i.nativeEvent),"x"===a.draggableDirection?(A.start=A.x,A.removalDistance=s.offsetWidth*(a.draggablePercent/100)):(A.start=A.y,A.removalDistance=s.offsetHeight*(80===a.draggablePercent?1.5*a.draggablePercent:a.draggablePercent/100))}}function T(i){if(A.boundingRect){let{top:s,bottom:o,left:c,right:w}=A.boundingRect;"touchend"!==i.nativeEvent.type&&a.pauseOnHover&&A.x>=c&&A.x<=w&&A.y>=s&&A.y<=o?C():E()}}function E(){s(!0)}function C(){s(!1)}function _(s){let o=P.current;A.canDrag&&o&&(A.didMove=!0,i&&C(),A.x=b(s),A.y=I(s),A.delta="x"===a.draggableDirection?A.x-A.start:A.y-A.start,A.start!==A.x&&(A.canCloseOnClick=!1),o.style.transform=`translate${a.draggableDirection}(${A.delta}px)`,o.style.opacity=""+(1-Math.abs(A.delta/A.removalDistance)))}function L(){document.removeEventListener("mousemove",_),document.removeEventListener("mouseup",L),document.removeEventListener("touchmove",_),document.removeEventListener("touchend",L);let i=P.current;if(A.canDrag&&A.didMove&&i){if(A.canDrag=!1,Math.abs(A.delta)>A.removalDistance)return w(!0),void a.closeToast();i.style.transition="transform 0.2s, opacity 0.2s",i.style.transform=`translate${a.draggableDirection}(0)`,i.style.opacity="1"}}(0,o.useEffect)(()=>{x.current=a}),(0,o.useEffect)(()=>(P.current&&P.current.addEventListener("d",E,{once:!0}),p(a.onOpen)&&a.onOpen((0,o.isValidElement)(a.children)&&a.children.props),()=>{let a=x.current;p(a.onClose)&&a.onClose((0,o.isValidElement)(a.children)&&a.children.props)}),[]),(0,o.useEffect)(()=>(a.pauseOnFocusLoss&&(document.hasFocus()||C(),window.addEventListener("focus",E),window.addEventListener("blur",C)),()=>{a.pauseOnFocusLoss&&(window.removeEventListener("focus",E),window.removeEventListener("blur",C))}),[a.pauseOnFocusLoss]);let D={onMouseDown:v,onTouchStart:v,onMouseUp:T,onTouchEnd:T};return k&&R&&(D.onMouseEnter=C,D.onMouseLeave=E),B&&(D.onClick=a=>{$&&$(a),A.canCloseOnClick&&j()}),{playToast:E,pauseToast:C,isRunning:i,preventExitTransition:c,toastRef:P,eventHandlers:D}}function L(a){let{closeToast:i,theme:s,ariaLabel:c="close"}=a;return o.createElement("button",{className:`Toastify__close-button Toastify__close-button--${s}`,type:"button",onClick:a=>{a.stopPropagation(),i(a)},"aria-label":c},o.createElement("svg",{"aria-hidden":"true",viewBox:"0 0 14 16"},o.createElement("path",{fillRule:"evenodd",d:"M7.71 8.23l3.75 3.75-1.48 1.48-3.75-3.75-3.75 3.75L1 11.98l3.75-3.75L1 4.48 2.48 3l3.75 3.75L9.98 3l1.48 1.48-3.75 3.75z"})))}function O(a){let{delay:i,isRunning:s,closeToast:c,type:w="default",hide:P,className:A,style:x,controlledProgress:k,progress:R,rtl:j,isIn:$,theme:B}=a,D=P||k&&0===R,Z={...x,animationDuration:`${i}ms`,animationPlayState:s?"running":"paused",opacity:D?0:1};k&&(Z.transform=`scaleX(${R})`);let U=clsx_m("Toastify__progress-bar",k?"Toastify__progress-bar--controlled":"Toastify__progress-bar--animated",`Toastify__progress-bar-theme--${B}`,`Toastify__progress-bar--${w}`,{"Toastify__progress-bar--rtl":j}),z=p(A)?A({rtl:j,type:w,defaultClassName:U}):clsx_m(U,A);return o.createElement("div",{role:"progressbar","aria-hidden":D?"true":"false","aria-label":"notification timer",className:z,style:Z,[k&&R>=1?"onTransitionEnd":"onAnimationEnd"]:k&&R<1?null:()=>{$&&c()}})}let N=a=>{let{isRunning:i,preventExitTransition:s,toastRef:c,eventHandlers:w}=_(a),{closeButton:P,children:A,autoClose:x,onClick:k,type:R,hideProgressBar:j,closeToast:$,transition:B,position:D,className:Z,style:U,bodyClassName:z,bodyStyle:V,progressClassName:G,progressStyle:W,updateId:K,role:J,progress:Y,rtl:X,toastId:ee,deleteToast:et,isIn:er,isLoading:ea,iconOut:en,closeOnClick:ei,theme:es}=a,eo=clsx_m("Toastify__toast",`Toastify__toast-theme--${es}`,`Toastify__toast--${R}`,{"Toastify__toast--rtl":X},{"Toastify__toast--close-on-click":ei}),el=p(Z)?Z({rtl:X,position:D,type:R,defaultClassName:eo}):clsx_m(eo,Z),eu=!!Y||!x,ec={closeToast:$,type:R,theme:es},ed=null;return!1===P||(ed=p(P)?P(ec):(0,o.isValidElement)(P)?(0,o.cloneElement)(P,ec):L(ec)),o.createElement(B,{isIn:er,done:et,position:D,preventExitTransition:s,nodeRef:c},o.createElement("div",{id:ee,onClick:k,className:el,...w,style:U,ref:c},o.createElement("div",{...er&&{role:J},className:p(z)?z({type:R}):clsx_m("Toastify__toast-body",z),style:V},null!=en&&o.createElement("div",{className:clsx_m("Toastify__toast-icon",{"Toastify--animate-icon Toastify__zoom-enter":!ea})},en),o.createElement("div",null,A)),ed,o.createElement(O,{...K&&!eu?{key:`pb-${K}`}:{},rtl:X,theme:es,delay:x,isRunning:i,isIn:er,closeToast:$,hide:j,type:R,style:W,className:G,controlledProgress:eu,progress:Y||0})))},M=function(a,i){return void 0===i&&(i=!1),{enter:`Toastify--animate Toastify__${a}-enter`,exit:`Toastify--animate Toastify__${a}-exit`,appendPosition:i}},P=h(M("bounce",!0)),A=(h(M("slide",!0)),h(M("zoom")),h(M("flip")),(0,o.forwardRef)((a,i)=>{let{getToastToRender:s,containerRef:c,isToastActive:w}=C(a),{className:P,style:A,rtl:x,containerId:k}=a;function f(a){let i=clsx_m("Toastify__toast-container",`Toastify__toast-container--${a}`,{"Toastify__toast-container--rtl":x});return p(P)?P({position:a,rtl:x,defaultClassName:i}):clsx_m(i,m(P))}return(0,o.useEffect)(()=>{i&&(i.current=c.current)},[]),o.createElement("div",{ref:c,className:"Toastify",id:k},s((a,i)=>{let s=i.length?{...A}:{...A,pointerEvents:"none"};return o.createElement("div",{className:f(a),style:s,key:`container-${a}`},i.map((a,s)=>{let{content:c,props:P}=a;return o.createElement(N,{...P,isIn:w(P.toastId),style:{...P.style,"--nth":s+1,"--len":i.length},key:`toast-${P.key}`},c)}))}))}));A.displayName="ToastContainer",A.defaultProps={position:"top-right",transition:P,autoClose:5e3,closeButton:L,pauseOnHover:!0,pauseOnFocusLoss:!0,closeOnClick:!0,draggable:!0,draggablePercent:80,draggableDirection:"x",role:"alert",theme:"light"};let x,k=new Map,R=[],j=1;function F(a){return a&&(d(a.toastId)||u(a.toastId))?a.toastId:""+j++}function H(a,i){return k.size>0?c.emit(0,a,i):R.push({content:a,options:i}),i.toastId}function S(a,i){return{...i,type:i&&i.type||a,toastId:F(i)}}function q(a){return(i,s)=>H(i,S(a,s))}function Q(a,i){return H(a,S("default",i))}Q.loading=(a,i)=>H(a,S("default",{isLoading:!0,autoClose:!1,closeOnClick:!1,closeButton:!1,draggable:!1,...i})),Q.promise=function(a,i,s){let o,{pending:c,error:w,success:P}=i;c&&(o=d(c)?Q.loading(c,s):Q.loading(c.render,{...s,...c}));let A={isLoading:null,autoClose:null,closeOnClick:null,closeButton:null,draggable:null},l=(a,i,c)=>{if(null==i)return void Q.dismiss(o);let w={type:a,...A,...s,data:c},P=d(i)?{render:i}:i;return o?Q.update(o,{...w,...P}):Q(P.render,{...w,...P}),c},x=p(a)?a():a;return x.then(a=>l("success",P,a)).catch(a=>l("error",w,a)),x},Q.success=q("success"),Q.info=q("info"),Q.error=q("error"),Q.warning=q("warning"),Q.warn=Q.warning,Q.dark=(a,i)=>H(a,S("default",{theme:"dark",...i})),Q.dismiss=a=>{k.size>0?c.emit(1,a):R=R.filter(i=>null!=a&&i.options.toastId!==a)},Q.clearWaitingQueue=function(a){return void 0===a&&(a={}),c.emit(5,a)},Q.isActive=a=>{let i=!1;return k.forEach(s=>{s.isToastActive&&s.isToastActive(a)&&(i=!0)}),i},Q.update=function(a,i){void 0===i&&(i={}),setTimeout(()=>{let s=function(a,i){let{containerId:s}=i,o=k.get(s||x);return o&&o.getToast(a)}(a,i);if(s){let{props:o,content:c}=s,w={delay:100,...o,...i,toastId:i.toastId||a,updateId:""+j++};w.toastId!==a&&(w.staleId=a);let P=w.render||c;delete w.render,H(P,w)}},0)},Q.done=a=>{Q.update(a,{progress:1})},Q.onChange=a=>(c.on(4,a),()=>{c.off(4,a)}),Q.POSITION={TOP_LEFT:"top-left",TOP_RIGHT:"top-right",TOP_CENTER:"top-center",BOTTOM_LEFT:"bottom-left",BOTTOM_RIGHT:"bottom-right",BOTTOM_CENTER:"bottom-center"},Q.TYPE={INFO:"info",SUCCESS:"success",WARNING:"warning",ERROR:"error",DEFAULT:"default"},c.on(2,a=>{x=a.containerId||a,k.set(x,a),R.forEach(a=>{c.emit(0,a.content,a.options)}),R=[]}).on(3,a=>{k.delete(a.containerId||a),0===k.size&&c.off(0).off(1).off(5)})},9711:function(a,i,s){"use strict";s.d(i,{Y_:function(){return zodToJsonSchema_zodToJsonSchema}});let o=Symbol("Let zodToJsonSchema decide on which parser to use"),c={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email",base64Strategy:"contentEncoding:base64"},getDefaultOptions=a=>"string"==typeof a?{...c,name:a}:{...c,...a},getRefs=a=>{let i=getDefaultOptions(a),s=void 0!==i.name?[...i.basePath,i.definitionPath,i.name]:i.basePath;return{...i,currentPath:s,propertyPath:void 0,seen:new Map(Object.entries(i.definitions).map(([a,s])=>[s._def,{def:s._def,path:[...i.basePath,i.definitionPath,a],jsonSchema:void 0}]))}};var w=s(6418);function parseAnyDef(){return{}}function addErrorMessage(a,i,s,o){o?.errorMessages&&s&&(a.errorMessage={...a.errorMessage,[i]:s})}function setResponseValueAndErrors(a,i,s,o,c){a[i]=s,addErrorMessage(a,i,o,c)}function parseArrayDef(a,i){let s={type:"array"};return a.type?._def?.typeName!==w.pA.ZodAny&&(s.items=parseDef_parseDef(a.type._def,{...i,currentPath:[...i.currentPath,"items"]})),a.minLength&&setResponseValueAndErrors(s,"minItems",a.minLength.value,a.minLength.message,i),a.maxLength&&setResponseValueAndErrors(s,"maxItems",a.maxLength.value,a.maxLength.message,i),a.exactLength&&(setResponseValueAndErrors(s,"minItems",a.exactLength.value,a.exactLength.message,i),setResponseValueAndErrors(s,"maxItems",a.exactLength.value,a.exactLength.message,i)),s}function parseBigintDef(a,i){let s={type:"integer",format:"int64"};if(!a.checks)return s;for(let o of a.checks)switch(o.kind){case"min":"jsonSchema7"===i.target?o.inclusive?setResponseValueAndErrors(s,"minimum",o.value,o.message,i):setResponseValueAndErrors(s,"exclusiveMinimum",o.value,o.message,i):(o.inclusive||(s.exclusiveMinimum=!0),setResponseValueAndErrors(s,"minimum",o.value,o.message,i));break;case"max":"jsonSchema7"===i.target?o.inclusive?setResponseValueAndErrors(s,"maximum",o.value,o.message,i):setResponseValueAndErrors(s,"exclusiveMaximum",o.value,o.message,i):(o.inclusive||(s.exclusiveMaximum=!0),setResponseValueAndErrors(s,"maximum",o.value,o.message,i));break;case"multipleOf":setResponseValueAndErrors(s,"multipleOf",o.value,o.message,i)}return s}function parseBooleanDef(){return{type:"boolean"}}function parseBrandedDef(a,i){return parseDef_parseDef(a.type._def,i)}let parseCatchDef=(a,i)=>parseDef_parseDef(a.innerType._def,i);function parseDateDef(a,i,s){let o=s??i.dateStrategy;if(Array.isArray(o))return{anyOf:o.map((s,o)=>parseDateDef(a,i,s))};switch(o){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return integerDateParser(a,i)}}let integerDateParser=(a,i)=>{let s={type:"integer",format:"unix-time"};if("openApi3"===i.target)return s;for(let o of a.checks)switch(o.kind){case"min":setResponseValueAndErrors(s,"minimum",o.value,o.message,i);break;case"max":setResponseValueAndErrors(s,"maximum",o.value,o.message,i)}return s};function parseDefaultDef(a,i){return{...parseDef_parseDef(a.innerType._def,i),default:a.defaultValue()}}function parseEffectsDef(a,i){return"input"===i.effectStrategy?parseDef_parseDef(a.schema._def,i):{}}function parseEnumDef(a){return{type:"string",enum:a.values}}let isJsonSchema7AllOfType=a=>(!("type"in a)||"string"!==a.type)&&"allOf"in a;function parseIntersectionDef(a,i){let s=[parseDef_parseDef(a.left._def,{...i,currentPath:[...i.currentPath,"allOf","0"]}),parseDef_parseDef(a.right._def,{...i,currentPath:[...i.currentPath,"allOf","1"]})].filter(a=>!!a),o="jsonSchema2019-09"===i.target?{unevaluatedProperties:!1}:void 0,c=[];return s.forEach(a=>{if(isJsonSchema7AllOfType(a))c.push(...a.allOf),void 0===a.unevaluatedProperties&&(o=void 0);else{let i=a;if("additionalProperties"in a&&!1===a.additionalProperties){let{additionalProperties:s,...o}=a;i=o}else o=void 0;c.push(i)}}),c.length?{allOf:c,...o}:void 0}function parseLiteralDef(a,i){let s=typeof a.value;return"bigint"!==s&&"number"!==s&&"boolean"!==s&&"string"!==s?{type:Array.isArray(a.value)?"array":"object"}:"openApi3"===i.target?{type:"bigint"===s?"integer":s,enum:[a.value]}:{type:"bigint"===s?"integer":s,const:a.value}}let P={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",base64:"^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$",nanoid:"^[a-zA-Z0-9_-]{21}$"};function parseStringDef(a,i){let s={type:"string"};function processPattern(a){return"escape"===i.patternStrategy?escapeNonAlphaNumeric(a):a}if(a.checks)for(let o of a.checks)switch(o.kind){case"min":setResponseValueAndErrors(s,"minLength","number"==typeof s.minLength?Math.max(s.minLength,o.value):o.value,o.message,i);break;case"max":setResponseValueAndErrors(s,"maxLength","number"==typeof s.maxLength?Math.min(s.maxLength,o.value):o.value,o.message,i);break;case"email":switch(i.emailStrategy){case"format:email":addFormat(s,"email",o.message,i);break;case"format:idn-email":addFormat(s,"idn-email",o.message,i);break;case"pattern:zod":addPattern(s,P.email,o.message,i)}break;case"url":addFormat(s,"uri",o.message,i);break;case"uuid":addFormat(s,"uuid",o.message,i);break;case"regex":addPattern(s,o.regex.source,o.message,i);break;case"cuid":addPattern(s,P.cuid,o.message,i);break;case"cuid2":addPattern(s,P.cuid2,o.message,i);break;case"startsWith":addPattern(s,"^"+processPattern(o.value),o.message,i);break;case"endsWith":addPattern(s,processPattern(o.value)+"$",o.message,i);break;case"datetime":addFormat(s,"date-time",o.message,i);break;case"date":addFormat(s,"date",o.message,i);break;case"time":addFormat(s,"time",o.message,i);break;case"duration":addFormat(s,"duration",o.message,i);break;case"length":setResponseValueAndErrors(s,"minLength","number"==typeof s.minLength?Math.max(s.minLength,o.value):o.value,o.message,i),setResponseValueAndErrors(s,"maxLength","number"==typeof s.maxLength?Math.min(s.maxLength,o.value):o.value,o.message,i);break;case"includes":addPattern(s,processPattern(o.value),o.message,i);break;case"ip":"v6"!==o.version&&addFormat(s,"ipv4",o.message,i),"v4"!==o.version&&addFormat(s,"ipv6",o.message,i);break;case"emoji":addPattern(s,P.emoji,o.message,i);break;case"ulid":addPattern(s,P.ulid,o.message,i);break;case"base64":switch(i.base64Strategy){case"format:binary":addFormat(s,"binary",o.message,i);break;case"contentEncoding:base64":setResponseValueAndErrors(s,"contentEncoding","base64",o.message,i);break;case"pattern:zod":addPattern(s,P.base64,o.message,i)}break;case"nanoid":addPattern(s,P.nanoid,o.message,i)}return s}let escapeNonAlphaNumeric=a=>Array.from(a).map(a=>/[a-zA-Z0-9]/.test(a)?a:`\\${a}`).join(""),addFormat=(a,i,s,o)=>{a.format||a.anyOf?.some(a=>a.format)?(a.anyOf||(a.anyOf=[]),a.format&&(a.anyOf.push({format:a.format,...a.errorMessage&&o.errorMessages&&{errorMessage:{format:a.errorMessage.format}}}),delete a.format,a.errorMessage&&(delete a.errorMessage.format,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.anyOf.push({format:i,...s&&o.errorMessages&&{errorMessage:{format:s}}})):setResponseValueAndErrors(a,"format",i,s,o)},addPattern=(a,i,s,o)=>{a.pattern||a.allOf?.some(a=>a.pattern)?(a.allOf||(a.allOf=[]),a.pattern&&(a.allOf.push({pattern:a.pattern,...a.errorMessage&&o.errorMessages&&{errorMessage:{pattern:a.errorMessage.pattern}}}),delete a.pattern,a.errorMessage&&(delete a.errorMessage.pattern,0===Object.keys(a.errorMessage).length&&delete a.errorMessage)),a.allOf.push({pattern:i,...s&&o.errorMessages&&{errorMessage:{pattern:s}}})):setResponseValueAndErrors(a,"pattern",i,s,o)};function parseRecordDef(a,i){if("openApi3"===i.target&&a.keyType?._def.typeName===w.pA.ZodEnum)return{type:"object",required:a.keyType._def.values,properties:a.keyType._def.values.reduce((s,o)=>({...s,[o]:parseDef_parseDef(a.valueType._def,{...i,currentPath:[...i.currentPath,"properties",o]})??{}}),{}),additionalProperties:!1};let s={type:"object",additionalProperties:parseDef_parseDef(a.valueType._def,{...i,currentPath:[...i.currentPath,"additionalProperties"]})??{}};if("openApi3"===i.target)return s;if(a.keyType?._def.typeName===w.pA.ZodString&&a.keyType._def.checks?.length){let o=Object.entries(parseStringDef(a.keyType._def,i)).reduce((a,[i,s])=>"type"===i?a:{...a,[i]:s},{});return{...s,propertyNames:o}}return a.keyType?._def.typeName===w.pA.ZodEnum?{...s,propertyNames:{enum:a.keyType._def.values}}:s}function parseMapDef(a,i){if("record"===i.mapStrategy)return parseRecordDef(a,i);let s=parseDef_parseDef(a.keyType._def,{...i,currentPath:[...i.currentPath,"items","items","0"]})||{},o=parseDef_parseDef(a.valueType._def,{...i,currentPath:[...i.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[s,o],minItems:2,maxItems:2}}}function parseNativeEnumDef(a){let i=a.values,s=Object.keys(a.values).filter(a=>"number"!=typeof i[i[a]]),o=s.map(a=>i[a]),c=Array.from(new Set(o.map(a=>typeof a)));return{type:1===c.length?"string"===c[0]?"string":"number":["string","number"],enum:o}}function parseNeverDef(){return{not:{}}}function parseNullDef(a){return"openApi3"===a.target?{enum:["null"],nullable:!0}:{type:"null"}}let A={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function parseUnionDef(a,i){if("openApi3"===i.target)return asAnyOf(a,i);let s=a.options instanceof Map?Array.from(a.options.values()):a.options;if(s.every(a=>a._def.typeName in A&&(!a._def.checks||!a._def.checks.length))){let a=s.reduce((a,i)=>{let s=A[i._def.typeName];return s&&!a.includes(s)?[...a,s]:a},[]);return{type:a.length>1?a:a[0]}}if(s.every(a=>"ZodLiteral"===a._def.typeName&&!a.description)){let a=s.reduce((a,i)=>{let s=typeof i._def.value;switch(s){case"string":case"number":case"boolean":return[...a,s];case"bigint":return[...a,"integer"];case"object":if(null===i._def.value)return[...a,"null"];default:return a}},[]);if(a.length===s.length){let i=a.filter((a,i,s)=>s.indexOf(a)===i);return{type:i.length>1?i:i[0],enum:s.reduce((a,i)=>a.includes(i._def.value)?a:[...a,i._def.value],[])}}}else if(s.every(a=>"ZodEnum"===a._def.typeName))return{type:"string",enum:s.reduce((a,i)=>[...a,...i._def.values.filter(i=>!a.includes(i))],[])};return asAnyOf(a,i)}let asAnyOf=(a,i)=>{let s=(a.options instanceof Map?Array.from(a.options.values()):a.options).map((a,s)=>parseDef_parseDef(a._def,{...i,currentPath:[...i.currentPath,"anyOf",`${s}`]})).filter(a=>!!a&&(!i.strictUnions||"object"==typeof a&&Object.keys(a).length>0));return s.length?{anyOf:s}:void 0};function parseNullableDef(a,i){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(a.innerType._def.typeName)&&(!a.innerType._def.checks||!a.innerType._def.checks.length))return"openApi3"===i.target?{type:A[a.innerType._def.typeName],nullable:!0}:{type:[A[a.innerType._def.typeName],"null"]};if("openApi3"===i.target){let s=parseDef_parseDef(a.innerType._def,{...i,currentPath:[...i.currentPath]});return s&&"$ref"in s?{allOf:[s],nullable:!0}:s&&{...s,nullable:!0}}let s=parseDef_parseDef(a.innerType._def,{...i,currentPath:[...i.currentPath,"anyOf","0"]});return s&&{anyOf:[s,{type:"null"}]}}function parseNumberDef(a,i){let s={type:"number"};if(!a.checks)return s;for(let o of a.checks)switch(o.kind){case"int":s.type="integer",addErrorMessage(s,"type",o.message,i);break;case"min":"jsonSchema7"===i.target?o.inclusive?setResponseValueAndErrors(s,"minimum",o.value,o.message,i):setResponseValueAndErrors(s,"exclusiveMinimum",o.value,o.message,i):(o.inclusive||(s.exclusiveMinimum=!0),setResponseValueAndErrors(s,"minimum",o.value,o.message,i));break;case"max":"jsonSchema7"===i.target?o.inclusive?setResponseValueAndErrors(s,"maximum",o.value,o.message,i):setResponseValueAndErrors(s,"exclusiveMaximum",o.value,o.message,i):(o.inclusive||(s.exclusiveMaximum=!0),setResponseValueAndErrors(s,"maximum",o.value,o.message,i));break;case"multipleOf":setResponseValueAndErrors(s,"multipleOf",o.value,o.message,i)}return s}function decideAdditionalProperties(a,i){return"strict"===i.removeAdditionalStrategy?"ZodNever"===a.catchall._def.typeName?"strict"!==a.unknownKeys:parseDef_parseDef(a.catchall._def,{...i,currentPath:[...i.currentPath,"additionalProperties"]})??!0:"ZodNever"===a.catchall._def.typeName?"passthrough"===a.unknownKeys:parseDef_parseDef(a.catchall._def,{...i,currentPath:[...i.currentPath,"additionalProperties"]})??!0}function parseObjectDef(a,i){let s={type:"object",...Object.entries(a.shape()).reduce((a,[s,o])=>{if(void 0===o||void 0===o._def)return a;let c=parseDef_parseDef(o._def,{...i,currentPath:[...i.currentPath,"properties",s],propertyPath:[...i.currentPath,"properties",s]});return void 0===c?a:{properties:{...a.properties,[s]:c},required:o.isOptional()?a.required:[...a.required,s]}},{properties:{},required:[]}),additionalProperties:decideAdditionalProperties(a,i)};return s.required.length||delete s.required,s}let parseOptionalDef=(a,i)=>{if(i.currentPath.toString()===i.propertyPath?.toString())return parseDef_parseDef(a.innerType._def,i);let s=parseDef_parseDef(a.innerType._def,{...i,currentPath:[...i.currentPath,"anyOf","1"]});return s?{anyOf:[{not:{}},s]}:{}},parsePipelineDef=(a,i)=>{if("input"===i.pipeStrategy)return parseDef_parseDef(a.in._def,i);if("output"===i.pipeStrategy)return parseDef_parseDef(a.out._def,i);let s=parseDef_parseDef(a.in._def,{...i,currentPath:[...i.currentPath,"allOf","0"]}),o=parseDef_parseDef(a.out._def,{...i,currentPath:[...i.currentPath,"allOf",s?"1":"0"]});return{allOf:[s,o].filter(a=>void 0!==a)}};function parsePromiseDef(a,i){return parseDef_parseDef(a.type._def,i)}function parseSetDef(a,i){let s=parseDef_parseDef(a.valueType._def,{...i,currentPath:[...i.currentPath,"items"]}),o={type:"array",uniqueItems:!0,items:s};return a.minSize&&setResponseValueAndErrors(o,"minItems",a.minSize.value,a.minSize.message,i),a.maxSize&&setResponseValueAndErrors(o,"maxItems",a.maxSize.value,a.maxSize.message,i),o}function parseTupleDef(a,i){return a.rest?{type:"array",minItems:a.items.length,items:a.items.map((a,s)=>parseDef_parseDef(a._def,{...i,currentPath:[...i.currentPath,"items",`${s}`]})).reduce((a,i)=>void 0===i?a:[...a,i],[]),additionalItems:parseDef_parseDef(a.rest._def,{...i,currentPath:[...i.currentPath,"additionalItems"]})}:{type:"array",minItems:a.items.length,maxItems:a.items.length,items:a.items.map((a,s)=>parseDef_parseDef(a._def,{...i,currentPath:[...i.currentPath,"items",`${s}`]})).reduce((a,i)=>void 0===i?a:[...a,i],[])}}function parseUndefinedDef(){return{not:{}}}function parseUnknownDef(){return{}}let parseReadonlyDef=(a,i)=>parseDef_parseDef(a.innerType._def,i);function parseDef_parseDef(a,i,s=!1){let c=i.seen.get(a);if(i.override){let w=i.override?.(a,i,c,s);if(w!==o)return w}if(c&&!s){let a=get$ref(c,i);if(void 0!==a)return a}let w={def:a,path:i.currentPath,jsonSchema:void 0};i.seen.set(a,w);let P=selectParser(a,a.typeName,i);return P&&addMeta(a,i,P),w.jsonSchema=P,P}let get$ref=(a,i)=>{switch(i.$refStrategy){case"root":return{$ref:a.path.join("/")};case"relative":return{$ref:getRelativePath(i.currentPath,a.path)};case"none":case"seen":if(a.path.length<i.currentPath.length&&a.path.every((a,s)=>i.currentPath[s]===a))return console.warn(`Recursive reference detected at ${i.currentPath.join("/")}! Defaulting to any`),{};return"seen"===i.$refStrategy?{}:void 0}},getRelativePath=(a,i)=>{let s=0;for(;s<a.length&&s<i.length&&a[s]===i[s];s++);return[(a.length-s).toString(),...i.slice(s)].join("/")},selectParser=(a,i,s)=>{switch(i){case w.pA.ZodString:return parseStringDef(a,s);case w.pA.ZodNumber:return parseNumberDef(a,s);case w.pA.ZodObject:return parseObjectDef(a,s);case w.pA.ZodBigInt:return parseBigintDef(a,s);case w.pA.ZodBoolean:return parseBooleanDef();case w.pA.ZodDate:return parseDateDef(a,s);case w.pA.ZodUndefined:return parseUndefinedDef();case w.pA.ZodNull:return parseNullDef(s);case w.pA.ZodArray:return parseArrayDef(a,s);case w.pA.ZodUnion:case w.pA.ZodDiscriminatedUnion:return parseUnionDef(a,s);case w.pA.ZodIntersection:return parseIntersectionDef(a,s);case w.pA.ZodTuple:return parseTupleDef(a,s);case w.pA.ZodRecord:return parseRecordDef(a,s);case w.pA.ZodLiteral:return parseLiteralDef(a,s);case w.pA.ZodEnum:return parseEnumDef(a);case w.pA.ZodNativeEnum:return parseNativeEnumDef(a);case w.pA.ZodNullable:return parseNullableDef(a,s);case w.pA.ZodOptional:return parseOptionalDef(a,s);case w.pA.ZodMap:return parseMapDef(a,s);case w.pA.ZodSet:return parseSetDef(a,s);case w.pA.ZodLazy:return parseDef_parseDef(a.getter()._def,s);case w.pA.ZodPromise:return parsePromiseDef(a,s);case w.pA.ZodNaN:case w.pA.ZodNever:return parseNeverDef();case w.pA.ZodEffects:return parseEffectsDef(a,s);case w.pA.ZodAny:return parseAnyDef();case w.pA.ZodUnknown:return parseUnknownDef();case w.pA.ZodDefault:return parseDefaultDef(a,s);case w.pA.ZodBranded:return parseBrandedDef(a,s);case w.pA.ZodReadonly:return parseReadonlyDef(a,s);case w.pA.ZodCatch:return parseCatchDef(a,s);case w.pA.ZodPipeline:return parsePipelineDef(a,s);case w.pA.ZodFunction:case w.pA.ZodVoid:case w.pA.ZodSymbol:default:return}},addMeta=(a,i,s)=>(a.description&&(s.description=a.description,i.markdownDescription&&(s.markdownDescription=a.description)),s),zodToJsonSchema_zodToJsonSchema=(a,i)=>{let s=getRefs(i),o="object"==typeof i&&i.definitions?Object.entries(i.definitions).reduce((a,[i,o])=>({...a,[i]:parseDef_parseDef(o._def,{...s,currentPath:[...s.basePath,s.definitionPath,i]},!0)??{}}),{}):void 0,c="string"==typeof i?i:i?.name,w=parseDef_parseDef(a._def,void 0===c?s:{...s,currentPath:[...s.basePath,s.definitionPath,c]},!1)??{},P=void 0===c?o?{...w,[s.definitionPath]:o}:w:{$ref:[..."relative"===s.$refStrategy?[]:s.basePath,s.definitionPath,c].join("/"),[s.definitionPath]:{...o,[c]:w}};return"jsonSchema7"===s.target?P.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===s.target&&(P.$schema="https://json-schema.org/draft/2019-09/schema#"),P}},6418:function(a,i,s){"use strict";let o;s.d(i,{pA:function(){return eF},z:function(){return eB}}),function(a){function assertIs(a){}function assertNever(a){throw Error()}function joinValues(a,i=" | "){return a.map(a=>"string"==typeof a?`'${a}'`:a).join(i)}a.assertEqual=a=>a,a.assertIs=assertIs,a.assertNever=assertNever,a.arrayToEnum=a=>{let i={};for(let s of a)i[s]=s;return i},a.getValidEnumValues=i=>{let s=a.objectKeys(i).filter(a=>"number"!=typeof i[i[a]]),o={};for(let a of s)o[a]=i[a];return a.objectValues(o)},a.objectValues=i=>a.objectKeys(i).map(function(a){return i[a]}),a.objectKeys="function"==typeof Object.keys?a=>Object.keys(a):a=>{let i=[];for(let s in a)Object.prototype.hasOwnProperty.call(a,s)&&i.push(s);return i},a.find=(a,i)=>{for(let s of a)if(i(s))return s},a.isInteger="function"==typeof Number.isInteger?a=>Number.isInteger(a):a=>"number"==typeof a&&isFinite(a)&&Math.floor(a)===a,a.joinValues=joinValues,a.jsonStringifyReplacer=(a,i)=>"bigint"==typeof i?i.toString():i}(ej||(ej={})),(eM||(eM={})).mergeShapes=(a,i)=>({...a,...i});let c=ej.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=a=>{let i=typeof a;switch(i){case"undefined":return c.undefined;case"string":return c.string;case"number":return isNaN(a)?c.nan:c.number;case"boolean":return c.boolean;case"function":return c.function;case"bigint":return c.bigint;case"symbol":return c.symbol;case"object":if(Array.isArray(a))return c.array;if(null===a)return c.null;if(a.then&&"function"==typeof a.then&&a.catch&&"function"==typeof a.catch)return c.promise;if("undefined"!=typeof Map&&a instanceof Map)return c.map;if("undefined"!=typeof Set&&a instanceof Set)return c.set;if("undefined"!=typeof Date&&a instanceof Date)return c.date;return c.object;default:return c.unknown}},w=ej.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let ZodError=class ZodError extends Error{constructor(a){super(),this.issues=[],this.addIssue=a=>{this.issues=[...this.issues,a]},this.addIssues=(a=[])=>{this.issues=[...this.issues,...a]};let i=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,i):this.__proto__=i,this.name="ZodError",this.issues=a}get errors(){return this.issues}format(a){let i=a||function(a){return a.message},s={_errors:[]},processError=a=>{for(let o of a.issues)if("invalid_union"===o.code)o.unionErrors.map(processError);else if("invalid_return_type"===o.code)processError(o.returnTypeError);else if("invalid_arguments"===o.code)processError(o.argumentsError);else if(0===o.path.length)s._errors.push(i(o));else{let a=s,c=0;for(;c<o.path.length;){let s=o.path[c],w=c===o.path.length-1;w?(a[s]=a[s]||{_errors:[]},a[s]._errors.push(i(o))):a[s]=a[s]||{_errors:[]},a=a[s],c++}}};return processError(this),s}static assert(a){if(!(a instanceof ZodError))throw Error(`Not a ZodError: ${a}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,ej.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(a=a=>a.message){let i={},s=[];for(let o of this.issues)o.path.length>0?(i[o.path[0]]=i[o.path[0]]||[],i[o.path[0]].push(a(o))):s.push(a(o));return{formErrors:s,fieldErrors:i}}get formErrors(){return this.flatten()}};ZodError.create=a=>{let i=new ZodError(a);return i};let errorMap=(a,i)=>{let s;switch(a.code){case w.invalid_type:s=a.received===c.undefined?"Required":`Expected ${a.expected}, received ${a.received}`;break;case w.invalid_literal:s=`Invalid literal value, expected ${JSON.stringify(a.expected,ej.jsonStringifyReplacer)}`;break;case w.unrecognized_keys:s=`Unrecognized key(s) in object: ${ej.joinValues(a.keys,", ")}`;break;case w.invalid_union:s="Invalid input";break;case w.invalid_union_discriminator:s=`Invalid discriminator value. Expected ${ej.joinValues(a.options)}`;break;case w.invalid_enum_value:s=`Invalid enum value. Expected ${ej.joinValues(a.options)}, received '${a.received}'`;break;case w.invalid_arguments:s="Invalid function arguments";break;case w.invalid_return_type:s="Invalid function return type";break;case w.invalid_date:s="Invalid date";break;case w.invalid_string:"object"==typeof a.validation?"includes"in a.validation?(s=`Invalid input: must include "${a.validation.includes}"`,"number"==typeof a.validation.position&&(s=`${s} at one or more positions greater than or equal to ${a.validation.position}`)):"startsWith"in a.validation?s=`Invalid input: must start with "${a.validation.startsWith}"`:"endsWith"in a.validation?s=`Invalid input: must end with "${a.validation.endsWith}"`:ej.assertNever(a.validation):s="regex"!==a.validation?`Invalid ${a.validation}`:"Invalid";break;case w.too_small:s="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at least":"more than"} ${a.minimum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at least":"over"} ${a.minimum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${a.minimum}`:"date"===a.type?`Date must be ${a.exact?"exactly equal to ":a.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(a.minimum))}`:"Invalid input";break;case w.too_big:s="array"===a.type?`Array must contain ${a.exact?"exactly":a.inclusive?"at most":"less than"} ${a.maximum} element(s)`:"string"===a.type?`String must contain ${a.exact?"exactly":a.inclusive?"at most":"under"} ${a.maximum} character(s)`:"number"===a.type?`Number must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"bigint"===a.type?`BigInt must be ${a.exact?"exactly":a.inclusive?"less than or equal to":"less than"} ${a.maximum}`:"date"===a.type?`Date must be ${a.exact?"exactly":a.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(a.maximum))}`:"Invalid input";break;case w.custom:s="Invalid input";break;case w.invalid_intersection_types:s="Intersection results could not be merged";break;case w.not_multiple_of:s=`Number must be a multiple of ${a.multipleOf}`;break;case w.not_finite:s="Number must be finite";break;default:s=i.defaultError,ej.assertNever(a)}return{message:s}},P=errorMap;function setErrorMap(a){P=a}function getErrorMap(){return P}let makeIssue=a=>{let{data:i,path:s,errorMaps:o,issueData:c}=a,w=[...s,...c.path||[]],P={...c,path:w};if(void 0!==c.message)return{...c,path:w,message:c.message};let A="",x=o.filter(a=>!!a).slice().reverse();for(let a of x)A=a(P,{data:i,defaultError:A}).message;return{...c,path:w,message:A}};function addIssueToContext(a,i){let s=getErrorMap(),o=makeIssue({issueData:i,data:a.data,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,s,s===errorMap?void 0:errorMap].filter(a=>!!a)});a.common.issues.push(o)}let ParseStatus=class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(a,i){let s=[];for(let o of i){if("aborted"===o.status)return A;"dirty"===o.status&&a.dirty(),s.push(o.value)}return{status:a.value,value:s}}static async mergeObjectAsync(a,i){let s=[];for(let a of i){let i=await a.key,o=await a.value;s.push({key:i,value:o})}return ParseStatus.mergeObjectSync(a,s)}static mergeObjectSync(a,i){let s={};for(let o of i){let{key:i,value:c}=o;if("aborted"===i.status||"aborted"===c.status)return A;"dirty"===i.status&&a.dirty(),"dirty"===c.status&&a.dirty(),"__proto__"!==i.value&&(void 0!==c.value||o.alwaysSet)&&(s[i.value]=c.value)}return{status:a.value,value:s}}};let A=Object.freeze({status:"aborted"}),DIRTY=a=>({status:"dirty",value:a}),OK=a=>({status:"valid",value:a}),isAborted=a=>"aborted"===a.status,isDirty=a=>"dirty"===a.status,isValid=a=>"valid"===a.status,isAsync=a=>"undefined"!=typeof Promise&&a instanceof Promise;function __classPrivateFieldGet(a,i,s,o){if("a"===s&&!o)throw TypeError("Private accessor was defined without a getter");if("function"==typeof i?a!==i||!o:!i.has(a))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===s?o:"a"===s?o.call(a):o?o.value:i.get(a)}function __classPrivateFieldSet(a,i,s,o,c){if("m"===o)throw TypeError("Private method is not writable");if("a"===o&&!c)throw TypeError("Private accessor was defined without a setter");if("function"==typeof i?a!==i||!c:!i.has(a))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===o?c.call(a,s):c?c.value=s:i.set(a,s),s}"function"==typeof SuppressedError&&SuppressedError,(eI=eN||(eN={})).errToObj=a=>"string"==typeof a?{message:a}:a||{},eI.toString=a=>"string"==typeof a?a:null==a?void 0:a.message;let ParseInputLazyPath=class ParseInputLazyPath{constructor(a,i,s,o){this._cachedPath=[],this.parent=a,this.data=i,this._path=s,this._key=o}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};let handleResult=(a,i)=>{if(isValid(i))return{success:!0,data:i.value};if(!a.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let i=new ZodError(a.common.issues);return this._error=i,this._error}}};function processCreateParams(a){if(!a)return{};let{errorMap:i,invalid_type_error:s,required_error:o,description:c}=a;if(i&&(s||o))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return i?{errorMap:i,description:c}:{errorMap:(i,c)=>{var w,P;let{message:A}=a;return"invalid_enum_value"===i.code?{message:null!=A?A:c.defaultError}:void 0===c.data?{message:null!==(w=null!=A?A:o)&&void 0!==w?w:c.defaultError}:"invalid_type"!==i.code?{message:c.defaultError}:{message:null!==(P=null!=A?A:s)&&void 0!==P?P:c.defaultError}},description:c}}let ZodType=class ZodType{constructor(a){this.spa=this.safeParseAsync,this._def=a,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(a){return getParsedType(a.data)}_getOrReturnCtx(a,i){return i||{common:a.parent.common,data:a.data,parsedType:getParsedType(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}_processInputParams(a){return{status:new ParseStatus,ctx:{common:a.parent.common,data:a.data,parsedType:getParsedType(a.data),schemaErrorMap:this._def.errorMap,path:a.path,parent:a.parent}}}_parseSync(a){let i=this._parse(a);if(isAsync(i))throw Error("Synchronous parse encountered promise.");return i}_parseAsync(a){let i=this._parse(a);return Promise.resolve(i)}parse(a,i){let s=this.safeParse(a,i);if(s.success)return s.data;throw s.error}safeParse(a,i){var s;let o={common:{issues:[],async:null!==(s=null==i?void 0:i.async)&&void 0!==s&&s,contextualErrorMap:null==i?void 0:i.errorMap},path:(null==i?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:getParsedType(a)},c=this._parseSync({data:a,path:o.path,parent:o});return handleResult(o,c)}async parseAsync(a,i){let s=await this.safeParseAsync(a,i);if(s.success)return s.data;throw s.error}async safeParseAsync(a,i){let s={common:{issues:[],contextualErrorMap:null==i?void 0:i.errorMap,async:!0},path:(null==i?void 0:i.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:a,parsedType:getParsedType(a)},o=this._parse({data:a,path:s.path,parent:s}),c=await (isAsync(o)?o:Promise.resolve(o));return handleResult(s,c)}refine(a,i){let getIssueProperties=a=>"string"==typeof i||void 0===i?{message:i}:"function"==typeof i?i(a):i;return this._refinement((i,s)=>{let o=a(i),setError=()=>s.addIssue({code:w.custom,...getIssueProperties(i)});return"undefined"!=typeof Promise&&o instanceof Promise?o.then(a=>!!a||(setError(),!1)):!!o||(setError(),!1)})}refinement(a,i){return this._refinement((s,o)=>!!a(s)||(o.addIssue("function"==typeof i?i(s,o):i),!1))}_refinement(a){return new ZodEffects({schema:this,typeName:eF.ZodEffects,effect:{type:"refinement",refinement:a}})}superRefine(a){return this._refinement(a)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(a){return ZodUnion.create([this,a],this._def)}and(a){return ZodIntersection.create(this,a,this._def)}transform(a){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:eF.ZodEffects,effect:{type:"transform",transform:a}})}default(a){return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:"function"==typeof a?a:()=>a,typeName:eF.ZodDefault})}brand(){return new ZodBranded({typeName:eF.ZodBranded,type:this,...processCreateParams(this._def)})}catch(a){return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:"function"==typeof a?a:()=>a,typeName:eF.ZodCatch})}describe(a){let i=this.constructor;return new i({...this._def,description:a})}pipe(a){return ZodPipeline.create(this,a)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};let x=/^c[^\s-]{8,}$/i,k=/^[0-9a-z]+$/,R=/^[0-9A-HJKMNP-TV-Z]{26}$/,j=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,$=/^[a-z0-9_-]{21}$/i,B=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,D=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Z=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,U=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,z=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,V="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",G=RegExp(`^${V}$`);function timeRegexSource(a){let i="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return a.precision?i=`${i}\\.\\d{${a.precision}}`:null==a.precision&&(i=`${i}(\\.\\d+)?`),i}function timeRegex(a){return RegExp(`^${timeRegexSource(a)}$`)}function datetimeRegex(a){let i=`${V}T${timeRegexSource(a)}`,s=[];return s.push(a.local?"Z?":"Z"),a.offset&&s.push("([+-]\\d{2}:?\\d{2})"),i=`${i}(${s.join("|")})`,RegExp(`^${i}$`)}function isValidIP(a,i){return!!(("v4"===i||!i)&&Z.test(a)||("v6"===i||!i)&&U.test(a))}let ZodString=class ZodString extends ZodType{_parse(a){let i;this._def.coerce&&(a.data=String(a.data));let s=this._getType(a);if(s!==c.string){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.string,received:i.parsedType}),A}let P=new ParseStatus;for(let s of this._def.checks)if("min"===s.kind)a.data.length<s.value&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),P.dirty());else if("max"===s.kind)a.data.length>s.value&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),P.dirty());else if("length"===s.kind){let o=a.data.length>s.value,c=a.data.length<s.value;(o||c)&&(i=this._getOrReturnCtx(a,i),o?addIssueToContext(i,{code:w.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):c&&addIssueToContext(i,{code:w.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),P.dirty())}else if("email"===s.kind)D.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"email",code:w.invalid_string,message:s.message}),P.dirty());else if("emoji"===s.kind)o||(o=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),o.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"emoji",code:w.invalid_string,message:s.message}),P.dirty());else if("uuid"===s.kind)j.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"uuid",code:w.invalid_string,message:s.message}),P.dirty());else if("nanoid"===s.kind)$.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"nanoid",code:w.invalid_string,message:s.message}),P.dirty());else if("cuid"===s.kind)x.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"cuid",code:w.invalid_string,message:s.message}),P.dirty());else if("cuid2"===s.kind)k.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"cuid2",code:w.invalid_string,message:s.message}),P.dirty());else if("ulid"===s.kind)R.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"ulid",code:w.invalid_string,message:s.message}),P.dirty());else if("url"===s.kind)try{new URL(a.data)}catch(o){addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"url",code:w.invalid_string,message:s.message}),P.dirty()}else if("regex"===s.kind){s.regex.lastIndex=0;let o=s.regex.test(a.data);o||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"regex",code:w.invalid_string,message:s.message}),P.dirty())}else if("trim"===s.kind)a.data=a.data.trim();else if("includes"===s.kind)a.data.includes(s.value,s.position)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),P.dirty());else if("toLowerCase"===s.kind)a.data=a.data.toLowerCase();else if("toUpperCase"===s.kind)a.data=a.data.toUpperCase();else if("startsWith"===s.kind)a.data.startsWith(s.value)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_string,validation:{startsWith:s.value},message:s.message}),P.dirty());else if("endsWith"===s.kind)a.data.endsWith(s.value)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_string,validation:{endsWith:s.value},message:s.message}),P.dirty());else if("datetime"===s.kind){let o=datetimeRegex(s);o.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_string,validation:"datetime",message:s.message}),P.dirty())}else if("date"===s.kind)G.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_string,validation:"date",message:s.message}),P.dirty());else if("time"===s.kind){let o=timeRegex(s);o.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_string,validation:"time",message:s.message}),P.dirty())}else"duration"===s.kind?B.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"duration",code:w.invalid_string,message:s.message}),P.dirty()):"ip"===s.kind?isValidIP(a.data,s.version)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"ip",code:w.invalid_string,message:s.message}),P.dirty()):"base64"===s.kind?z.test(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{validation:"base64",code:w.invalid_string,message:s.message}),P.dirty()):ej.assertNever(s);return{status:P.value,value:a.data}}_regex(a,i,s){return this.refinement(i=>a.test(i),{validation:i,code:w.invalid_string,...eN.errToObj(s)})}_addCheck(a){return new ZodString({...this._def,checks:[...this._def.checks,a]})}email(a){return this._addCheck({kind:"email",...eN.errToObj(a)})}url(a){return this._addCheck({kind:"url",...eN.errToObj(a)})}emoji(a){return this._addCheck({kind:"emoji",...eN.errToObj(a)})}uuid(a){return this._addCheck({kind:"uuid",...eN.errToObj(a)})}nanoid(a){return this._addCheck({kind:"nanoid",...eN.errToObj(a)})}cuid(a){return this._addCheck({kind:"cuid",...eN.errToObj(a)})}cuid2(a){return this._addCheck({kind:"cuid2",...eN.errToObj(a)})}ulid(a){return this._addCheck({kind:"ulid",...eN.errToObj(a)})}base64(a){return this._addCheck({kind:"base64",...eN.errToObj(a)})}ip(a){return this._addCheck({kind:"ip",...eN.errToObj(a)})}datetime(a){var i,s;return"string"==typeof a?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:a}):this._addCheck({kind:"datetime",precision:void 0===(null==a?void 0:a.precision)?null:null==a?void 0:a.precision,offset:null!==(i=null==a?void 0:a.offset)&&void 0!==i&&i,local:null!==(s=null==a?void 0:a.local)&&void 0!==s&&s,...eN.errToObj(null==a?void 0:a.message)})}date(a){return this._addCheck({kind:"date",message:a})}time(a){return"string"==typeof a?this._addCheck({kind:"time",precision:null,message:a}):this._addCheck({kind:"time",precision:void 0===(null==a?void 0:a.precision)?null:null==a?void 0:a.precision,...eN.errToObj(null==a?void 0:a.message)})}duration(a){return this._addCheck({kind:"duration",...eN.errToObj(a)})}regex(a,i){return this._addCheck({kind:"regex",regex:a,...eN.errToObj(i)})}includes(a,i){return this._addCheck({kind:"includes",value:a,position:null==i?void 0:i.position,...eN.errToObj(null==i?void 0:i.message)})}startsWith(a,i){return this._addCheck({kind:"startsWith",value:a,...eN.errToObj(i)})}endsWith(a,i){return this._addCheck({kind:"endsWith",value:a,...eN.errToObj(i)})}min(a,i){return this._addCheck({kind:"min",value:a,...eN.errToObj(i)})}max(a,i){return this._addCheck({kind:"max",value:a,...eN.errToObj(i)})}length(a,i){return this._addCheck({kind:"length",value:a,...eN.errToObj(i)})}nonempty(a){return this.min(1,eN.errToObj(a))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(a=>"datetime"===a.kind)}get isDate(){return!!this._def.checks.find(a=>"date"===a.kind)}get isTime(){return!!this._def.checks.find(a=>"time"===a.kind)}get isDuration(){return!!this._def.checks.find(a=>"duration"===a.kind)}get isEmail(){return!!this._def.checks.find(a=>"email"===a.kind)}get isURL(){return!!this._def.checks.find(a=>"url"===a.kind)}get isEmoji(){return!!this._def.checks.find(a=>"emoji"===a.kind)}get isUUID(){return!!this._def.checks.find(a=>"uuid"===a.kind)}get isNANOID(){return!!this._def.checks.find(a=>"nanoid"===a.kind)}get isCUID(){return!!this._def.checks.find(a=>"cuid"===a.kind)}get isCUID2(){return!!this._def.checks.find(a=>"cuid2"===a.kind)}get isULID(){return!!this._def.checks.find(a=>"ulid"===a.kind)}get isIP(){return!!this._def.checks.find(a=>"ip"===a.kind)}get isBase64(){return!!this._def.checks.find(a=>"base64"===a.kind)}get minLength(){let a=null;for(let i of this._def.checks)"min"===i.kind&&(null===a||i.value>a)&&(a=i.value);return a}get maxLength(){let a=null;for(let i of this._def.checks)"max"===i.kind&&(null===a||i.value<a)&&(a=i.value);return a}};function floatSafeRemainder(a,i){let s=(a.toString().split(".")[1]||"").length,o=(i.toString().split(".")[1]||"").length,c=s>o?s:o,w=parseInt(a.toFixed(c).replace(".","")),P=parseInt(i.toFixed(c).replace(".",""));return w%P/Math.pow(10,c)}ZodString.create=a=>{var i;return new ZodString({checks:[],typeName:eF.ZodString,coerce:null!==(i=null==a?void 0:a.coerce)&&void 0!==i&&i,...processCreateParams(a)})};let ZodNumber=class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(a){let i;this._def.coerce&&(a.data=Number(a.data));let s=this._getType(a);if(s!==c.number){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.number,received:i.parsedType}),A}let o=new ParseStatus;for(let s of this._def.checks)if("int"===s.kind)ej.isInteger(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.invalid_type,expected:"integer",received:"float",message:s.message}),o.dirty());else if("min"===s.kind){let c=s.inclusive?a.data<s.value:a.data<=s.value;c&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty())}else if("max"===s.kind){let c=s.inclusive?a.data>s.value:a.data>=s.value;c&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),o.dirty())}else"multipleOf"===s.kind?0!==floatSafeRemainder(a.data,s.value)&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):"finite"===s.kind?Number.isFinite(a.data)||(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.not_finite,message:s.message}),o.dirty()):ej.assertNever(s);return{status:o.value,value:a.data}}gte(a,i){return this.setLimit("min",a,!0,eN.toString(i))}gt(a,i){return this.setLimit("min",a,!1,eN.toString(i))}lte(a,i){return this.setLimit("max",a,!0,eN.toString(i))}lt(a,i){return this.setLimit("max",a,!1,eN.toString(i))}setLimit(a,i,s,o){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:a,value:i,inclusive:s,message:eN.toString(o)}]})}_addCheck(a){return new ZodNumber({...this._def,checks:[...this._def.checks,a]})}int(a){return this._addCheck({kind:"int",message:eN.toString(a)})}positive(a){return this._addCheck({kind:"min",value:0,inclusive:!1,message:eN.toString(a)})}negative(a){return this._addCheck({kind:"max",value:0,inclusive:!1,message:eN.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:0,inclusive:!0,message:eN.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:0,inclusive:!0,message:eN.toString(a)})}multipleOf(a,i){return this._addCheck({kind:"multipleOf",value:a,message:eN.toString(i)})}finite(a){return this._addCheck({kind:"finite",message:eN.toString(a)})}safe(a){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:eN.toString(a)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:eN.toString(a)})}get minValue(){let a=null;for(let i of this._def.checks)"min"===i.kind&&(null===a||i.value>a)&&(a=i.value);return a}get maxValue(){let a=null;for(let i of this._def.checks)"max"===i.kind&&(null===a||i.value<a)&&(a=i.value);return a}get isInt(){return!!this._def.checks.find(a=>"int"===a.kind||"multipleOf"===a.kind&&ej.isInteger(a.value))}get isFinite(){let a=null,i=null;for(let s of this._def.checks){if("finite"===s.kind||"int"===s.kind||"multipleOf"===s.kind)return!0;"min"===s.kind?(null===i||s.value>i)&&(i=s.value):"max"===s.kind&&(null===a||s.value<a)&&(a=s.value)}return Number.isFinite(i)&&Number.isFinite(a)}};ZodNumber.create=a=>new ZodNumber({checks:[],typeName:eF.ZodNumber,coerce:(null==a?void 0:a.coerce)||!1,...processCreateParams(a)});let ZodBigInt=class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(a){let i;this._def.coerce&&(a.data=BigInt(a.data));let s=this._getType(a);if(s!==c.bigint){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.bigint,received:i.parsedType}),A}let o=new ParseStatus;for(let s of this._def.checks)if("min"===s.kind){let c=s.inclusive?a.data<s.value:a.data<=s.value;c&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty())}else if("max"===s.kind){let c=s.inclusive?a.data>s.value:a.data>=s.value;c&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),o.dirty())}else"multipleOf"===s.kind?a.data%s.value!==BigInt(0)&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.not_multiple_of,multipleOf:s.value,message:s.message}),o.dirty()):ej.assertNever(s);return{status:o.value,value:a.data}}gte(a,i){return this.setLimit("min",a,!0,eN.toString(i))}gt(a,i){return this.setLimit("min",a,!1,eN.toString(i))}lte(a,i){return this.setLimit("max",a,!0,eN.toString(i))}lt(a,i){return this.setLimit("max",a,!1,eN.toString(i))}setLimit(a,i,s,o){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:a,value:i,inclusive:s,message:eN.toString(o)}]})}_addCheck(a){return new ZodBigInt({...this._def,checks:[...this._def.checks,a]})}positive(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:eN.toString(a)})}negative(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:eN.toString(a)})}nonpositive(a){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:eN.toString(a)})}nonnegative(a){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:eN.toString(a)})}multipleOf(a,i){return this._addCheck({kind:"multipleOf",value:a,message:eN.toString(i)})}get minValue(){let a=null;for(let i of this._def.checks)"min"===i.kind&&(null===a||i.value>a)&&(a=i.value);return a}get maxValue(){let a=null;for(let i of this._def.checks)"max"===i.kind&&(null===a||i.value<a)&&(a=i.value);return a}};ZodBigInt.create=a=>{var i;return new ZodBigInt({checks:[],typeName:eF.ZodBigInt,coerce:null!==(i=null==a?void 0:a.coerce)&&void 0!==i&&i,...processCreateParams(a)})};let ZodBoolean=class ZodBoolean extends ZodType{_parse(a){this._def.coerce&&(a.data=!!a.data);let i=this._getType(a);if(i!==c.boolean){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.boolean,received:i.parsedType}),A}return OK(a.data)}};ZodBoolean.create=a=>new ZodBoolean({typeName:eF.ZodBoolean,coerce:(null==a?void 0:a.coerce)||!1,...processCreateParams(a)});let ZodDate=class ZodDate extends ZodType{_parse(a){let i;this._def.coerce&&(a.data=new Date(a.data));let s=this._getType(a);if(s!==c.date){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.date,received:i.parsedType}),A}if(isNaN(a.data.getTime())){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_date}),A}let o=new ParseStatus;for(let s of this._def.checks)"min"===s.kind?a.data.getTime()<s.value&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),o.dirty()):"max"===s.kind?a.data.getTime()>s.value&&(addIssueToContext(i=this._getOrReturnCtx(a,i),{code:w.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),o.dirty()):ej.assertNever(s);return{status:o.value,value:new Date(a.data.getTime())}}_addCheck(a){return new ZodDate({...this._def,checks:[...this._def.checks,a]})}min(a,i){return this._addCheck({kind:"min",value:a.getTime(),message:eN.toString(i)})}max(a,i){return this._addCheck({kind:"max",value:a.getTime(),message:eN.toString(i)})}get minDate(){let a=null;for(let i of this._def.checks)"min"===i.kind&&(null===a||i.value>a)&&(a=i.value);return null!=a?new Date(a):null}get maxDate(){let a=null;for(let i of this._def.checks)"max"===i.kind&&(null===a||i.value<a)&&(a=i.value);return null!=a?new Date(a):null}};ZodDate.create=a=>new ZodDate({checks:[],coerce:(null==a?void 0:a.coerce)||!1,typeName:eF.ZodDate,...processCreateParams(a)});let ZodSymbol=class ZodSymbol extends ZodType{_parse(a){let i=this._getType(a);if(i!==c.symbol){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.symbol,received:i.parsedType}),A}return OK(a.data)}};ZodSymbol.create=a=>new ZodSymbol({typeName:eF.ZodSymbol,...processCreateParams(a)});let ZodUndefined=class ZodUndefined extends ZodType{_parse(a){let i=this._getType(a);if(i!==c.undefined){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.undefined,received:i.parsedType}),A}return OK(a.data)}};ZodUndefined.create=a=>new ZodUndefined({typeName:eF.ZodUndefined,...processCreateParams(a)});let ZodNull=class ZodNull extends ZodType{_parse(a){let i=this._getType(a);if(i!==c.null){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.null,received:i.parsedType}),A}return OK(a.data)}};ZodNull.create=a=>new ZodNull({typeName:eF.ZodNull,...processCreateParams(a)});let ZodAny=class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(a){return OK(a.data)}};ZodAny.create=a=>new ZodAny({typeName:eF.ZodAny,...processCreateParams(a)});let ZodUnknown=class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(a){return OK(a.data)}};ZodUnknown.create=a=>new ZodUnknown({typeName:eF.ZodUnknown,...processCreateParams(a)});let ZodNever=class ZodNever extends ZodType{_parse(a){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.never,received:i.parsedType}),A}};ZodNever.create=a=>new ZodNever({typeName:eF.ZodNever,...processCreateParams(a)});let ZodVoid=class ZodVoid extends ZodType{_parse(a){let i=this._getType(a);if(i!==c.undefined){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.void,received:i.parsedType}),A}return OK(a.data)}};ZodVoid.create=a=>new ZodVoid({typeName:eF.ZodVoid,...processCreateParams(a)});let ZodArray=class ZodArray extends ZodType{_parse(a){let{ctx:i,status:s}=this._processInputParams(a),o=this._def;if(i.parsedType!==c.array)return addIssueToContext(i,{code:w.invalid_type,expected:c.array,received:i.parsedType}),A;if(null!==o.exactLength){let a=i.data.length>o.exactLength.value,c=i.data.length<o.exactLength.value;(a||c)&&(addIssueToContext(i,{code:a?w.too_big:w.too_small,minimum:c?o.exactLength.value:void 0,maximum:a?o.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:o.exactLength.message}),s.dirty())}if(null!==o.minLength&&i.data.length<o.minLength.value&&(addIssueToContext(i,{code:w.too_small,minimum:o.minLength.value,type:"array",inclusive:!0,exact:!1,message:o.minLength.message}),s.dirty()),null!==o.maxLength&&i.data.length>o.maxLength.value&&(addIssueToContext(i,{code:w.too_big,maximum:o.maxLength.value,type:"array",inclusive:!0,exact:!1,message:o.maxLength.message}),s.dirty()),i.common.async)return Promise.all([...i.data].map((a,s)=>o.type._parseAsync(new ParseInputLazyPath(i,a,i.path,s)))).then(a=>ParseStatus.mergeArray(s,a));let P=[...i.data].map((a,s)=>o.type._parseSync(new ParseInputLazyPath(i,a,i.path,s)));return ParseStatus.mergeArray(s,P)}get element(){return this._def.type}min(a,i){return new ZodArray({...this._def,minLength:{value:a,message:eN.toString(i)}})}max(a,i){return new ZodArray({...this._def,maxLength:{value:a,message:eN.toString(i)}})}length(a,i){return new ZodArray({...this._def,exactLength:{value:a,message:eN.toString(i)}})}nonempty(a){return this.min(1,a)}};function deepPartialify(a){if(a instanceof ZodObject){let i={};for(let s in a.shape){let o=a.shape[s];i[s]=ZodOptional.create(deepPartialify(o))}return new ZodObject({...a._def,shape:()=>i})}return a instanceof ZodArray?new ZodArray({...a._def,type:deepPartialify(a.element)}):a instanceof ZodOptional?ZodOptional.create(deepPartialify(a.unwrap())):a instanceof ZodNullable?ZodNullable.create(deepPartialify(a.unwrap())):a instanceof ZodTuple?ZodTuple.create(a.items.map(a=>deepPartialify(a))):a}ZodArray.create=(a,i)=>new ZodArray({type:a,minLength:null,maxLength:null,exactLength:null,typeName:eF.ZodArray,...processCreateParams(i)});let ZodObject=class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let a=this._def.shape(),i=ej.objectKeys(a);return this._cached={shape:a,keys:i}}_parse(a){let i=this._getType(a);if(i!==c.object){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.object,received:i.parsedType}),A}let{status:s,ctx:o}=this._processInputParams(a),{shape:P,keys:x}=this._getCached(),k=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(let a in o.data)x.includes(a)||k.push(a);let R=[];for(let a of x){let i=P[a],s=o.data[a];R.push({key:{status:"valid",value:a},value:i._parse(new ParseInputLazyPath(o,s,o.path,a)),alwaysSet:a in o.data})}if(this._def.catchall instanceof ZodNever){let a=this._def.unknownKeys;if("passthrough"===a)for(let a of k)R.push({key:{status:"valid",value:a},value:{status:"valid",value:o.data[a]}});else if("strict"===a)k.length>0&&(addIssueToContext(o,{code:w.unrecognized_keys,keys:k}),s.dirty());else if("strip"===a);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let a=this._def.catchall;for(let i of k){let s=o.data[i];R.push({key:{status:"valid",value:i},value:a._parse(new ParseInputLazyPath(o,s,o.path,i)),alwaysSet:i in o.data})}}return o.common.async?Promise.resolve().then(async()=>{let a=[];for(let i of R){let s=await i.key,o=await i.value;a.push({key:s,value:o,alwaysSet:i.alwaysSet})}return a}).then(a=>ParseStatus.mergeObjectSync(s,a)):ParseStatus.mergeObjectSync(s,R)}get shape(){return this._def.shape()}strict(a){return eN.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==a?{errorMap:(i,s)=>{var o,c,w,P;let A=null!==(w=null===(c=(o=this._def).errorMap)||void 0===c?void 0:c.call(o,i,s).message)&&void 0!==w?w:s.defaultError;return"unrecognized_keys"===i.code?{message:null!==(P=eN.errToObj(a).message)&&void 0!==P?P:A}:{message:A}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(a){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...a})})}merge(a){let i=new ZodObject({unknownKeys:a._def.unknownKeys,catchall:a._def.catchall,shape:()=>({...this._def.shape(),...a._def.shape()}),typeName:eF.ZodObject});return i}setKey(a,i){return this.augment({[a]:i})}catchall(a){return new ZodObject({...this._def,catchall:a})}pick(a){let i={};return ej.objectKeys(a).forEach(s=>{a[s]&&this.shape[s]&&(i[s]=this.shape[s])}),new ZodObject({...this._def,shape:()=>i})}omit(a){let i={};return ej.objectKeys(this.shape).forEach(s=>{a[s]||(i[s]=this.shape[s])}),new ZodObject({...this._def,shape:()=>i})}deepPartial(){return deepPartialify(this)}partial(a){let i={};return ej.objectKeys(this.shape).forEach(s=>{let o=this.shape[s];a&&!a[s]?i[s]=o:i[s]=o.optional()}),new ZodObject({...this._def,shape:()=>i})}required(a){let i={};return ej.objectKeys(this.shape).forEach(s=>{if(a&&!a[s])i[s]=this.shape[s];else{let a=this.shape[s],o=a;for(;o instanceof ZodOptional;)o=o._def.innerType;i[s]=o}}),new ZodObject({...this._def,shape:()=>i})}keyof(){return createZodEnum(ej.objectKeys(this.shape))}};ZodObject.create=(a,i)=>new ZodObject({shape:()=>a,unknownKeys:"strip",catchall:ZodNever.create(),typeName:eF.ZodObject,...processCreateParams(i)}),ZodObject.strictCreate=(a,i)=>new ZodObject({shape:()=>a,unknownKeys:"strict",catchall:ZodNever.create(),typeName:eF.ZodObject,...processCreateParams(i)}),ZodObject.lazycreate=(a,i)=>new ZodObject({shape:a,unknownKeys:"strip",catchall:ZodNever.create(),typeName:eF.ZodObject,...processCreateParams(i)});let ZodUnion=class ZodUnion extends ZodType{_parse(a){let{ctx:i}=this._processInputParams(a),s=this._def.options;function handleResults(a){for(let i of a)if("valid"===i.result.status)return i.result;for(let s of a)if("dirty"===s.result.status)return i.common.issues.push(...s.ctx.common.issues),s.result;let s=a.map(a=>new ZodError(a.ctx.common.issues));return addIssueToContext(i,{code:w.invalid_union,unionErrors:s}),A}if(i.common.async)return Promise.all(s.map(async a=>{let s={...i,common:{...i.common,issues:[]},parent:null};return{result:await a._parseAsync({data:i.data,path:i.path,parent:s}),ctx:s}})).then(handleResults);{let a;let o=[];for(let c of s){let s={...i,common:{...i.common,issues:[]},parent:null},w=c._parseSync({data:i.data,path:i.path,parent:s});if("valid"===w.status)return w;"dirty"!==w.status||a||(a={result:w,ctx:s}),s.common.issues.length&&o.push(s.common.issues)}if(a)return i.common.issues.push(...a.ctx.common.issues),a.result;let c=o.map(a=>new ZodError(a));return addIssueToContext(i,{code:w.invalid_union,unionErrors:c}),A}}get options(){return this._def.options}};ZodUnion.create=(a,i)=>new ZodUnion({options:a,typeName:eF.ZodUnion,...processCreateParams(i)});let getDiscriminator=a=>{if(a instanceof ZodLazy)return getDiscriminator(a.schema);if(a instanceof ZodEffects)return getDiscriminator(a.innerType());if(a instanceof ZodLiteral)return[a.value];if(a instanceof ZodEnum)return a.options;if(a instanceof ZodNativeEnum)return ej.objectValues(a.enum);if(a instanceof ZodDefault)return getDiscriminator(a._def.innerType);if(a instanceof ZodUndefined)return[void 0];else if(a instanceof ZodNull)return[null];else if(a instanceof ZodOptional)return[void 0,...getDiscriminator(a.unwrap())];else if(a instanceof ZodNullable)return[null,...getDiscriminator(a.unwrap())];else if(a instanceof ZodBranded)return getDiscriminator(a.unwrap());else if(a instanceof ZodReadonly)return getDiscriminator(a.unwrap());else if(a instanceof ZodCatch)return getDiscriminator(a._def.innerType);else return[]};let ZodDiscriminatedUnion=class ZodDiscriminatedUnion extends ZodType{_parse(a){let{ctx:i}=this._processInputParams(a);if(i.parsedType!==c.object)return addIssueToContext(i,{code:w.invalid_type,expected:c.object,received:i.parsedType}),A;let s=this.discriminator,o=i.data[s],P=this.optionsMap.get(o);return P?i.common.async?P._parseAsync({data:i.data,path:i.path,parent:i}):P._parseSync({data:i.data,path:i.path,parent:i}):(addIssueToContext(i,{code:w.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[s]}),A)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(a,i,s){let o=new Map;for(let s of i){let i=getDiscriminator(s.shape[a]);if(!i.length)throw Error(`A discriminator value for key \`${a}\` could not be extracted from all schema options`);for(let c of i){if(o.has(c))throw Error(`Discriminator property ${String(a)} has duplicate value ${String(c)}`);o.set(c,s)}}return new ZodDiscriminatedUnion({typeName:eF.ZodDiscriminatedUnion,discriminator:a,options:i,optionsMap:o,...processCreateParams(s)})}};function mergeValues(a,i){let s=getParsedType(a),o=getParsedType(i);if(a===i)return{valid:!0,data:a};if(s===c.object&&o===c.object){let s=ej.objectKeys(i),o=ej.objectKeys(a).filter(a=>-1!==s.indexOf(a)),c={...a,...i};for(let s of o){let o=mergeValues(a[s],i[s]);if(!o.valid)return{valid:!1};c[s]=o.data}return{valid:!0,data:c}}if(s===c.array&&o===c.array){if(a.length!==i.length)return{valid:!1};let s=[];for(let o=0;o<a.length;o++){let c=a[o],w=i[o],P=mergeValues(c,w);if(!P.valid)return{valid:!1};s.push(P.data)}return{valid:!0,data:s}}return s===c.date&&o===c.date&&+a==+i?{valid:!0,data:a}:{valid:!1}}let ZodIntersection=class ZodIntersection extends ZodType{_parse(a){let{status:i,ctx:s}=this._processInputParams(a),handleParsed=(a,o)=>{if(isAborted(a)||isAborted(o))return A;let c=mergeValues(a.value,o.value);return c.valid?((isDirty(a)||isDirty(o))&&i.dirty(),{status:i.value,value:c.data}):(addIssueToContext(s,{code:w.invalid_intersection_types}),A)};return s.common.async?Promise.all([this._def.left._parseAsync({data:s.data,path:s.path,parent:s}),this._def.right._parseAsync({data:s.data,path:s.path,parent:s})]).then(([a,i])=>handleParsed(a,i)):handleParsed(this._def.left._parseSync({data:s.data,path:s.path,parent:s}),this._def.right._parseSync({data:s.data,path:s.path,parent:s}))}};ZodIntersection.create=(a,i,s)=>new ZodIntersection({left:a,right:i,typeName:eF.ZodIntersection,...processCreateParams(s)});let ZodTuple=class ZodTuple extends ZodType{_parse(a){let{status:i,ctx:s}=this._processInputParams(a);if(s.parsedType!==c.array)return addIssueToContext(s,{code:w.invalid_type,expected:c.array,received:s.parsedType}),A;if(s.data.length<this._def.items.length)return addIssueToContext(s,{code:w.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),A;let o=this._def.rest;!o&&s.data.length>this._def.items.length&&(addIssueToContext(s,{code:w.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),i.dirty());let P=[...s.data].map((a,i)=>{let o=this._def.items[i]||this._def.rest;return o?o._parse(new ParseInputLazyPath(s,a,s.path,i)):null}).filter(a=>!!a);return s.common.async?Promise.all(P).then(a=>ParseStatus.mergeArray(i,a)):ParseStatus.mergeArray(i,P)}get items(){return this._def.items}rest(a){return new ZodTuple({...this._def,rest:a})}};ZodTuple.create=(a,i)=>{if(!Array.isArray(a))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:a,typeName:eF.ZodTuple,rest:null,...processCreateParams(i)})};let ZodRecord=class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:i,ctx:s}=this._processInputParams(a);if(s.parsedType!==c.object)return addIssueToContext(s,{code:w.invalid_type,expected:c.object,received:s.parsedType}),A;let o=[],P=this._def.keyType,x=this._def.valueType;for(let a in s.data)o.push({key:P._parse(new ParseInputLazyPath(s,a,s.path,a)),value:x._parse(new ParseInputLazyPath(s,s.data[a],s.path,a)),alwaysSet:a in s.data});return s.common.async?ParseStatus.mergeObjectAsync(i,o):ParseStatus.mergeObjectSync(i,o)}get element(){return this._def.valueType}static create(a,i,s){return new ZodRecord(i instanceof ZodType?{keyType:a,valueType:i,typeName:eF.ZodRecord,...processCreateParams(s)}:{keyType:ZodString.create(),valueType:a,typeName:eF.ZodRecord,...processCreateParams(i)})}};let ZodMap=class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(a){let{status:i,ctx:s}=this._processInputParams(a);if(s.parsedType!==c.map)return addIssueToContext(s,{code:w.invalid_type,expected:c.map,received:s.parsedType}),A;let o=this._def.keyType,P=this._def.valueType,x=[...s.data.entries()].map(([a,i],c)=>({key:o._parse(new ParseInputLazyPath(s,a,s.path,[c,"key"])),value:P._parse(new ParseInputLazyPath(s,i,s.path,[c,"value"]))}));if(s.common.async){let a=new Map;return Promise.resolve().then(async()=>{for(let s of x){let o=await s.key,c=await s.value;if("aborted"===o.status||"aborted"===c.status)return A;("dirty"===o.status||"dirty"===c.status)&&i.dirty(),a.set(o.value,c.value)}return{status:i.value,value:a}})}{let a=new Map;for(let s of x){let o=s.key,c=s.value;if("aborted"===o.status||"aborted"===c.status)return A;("dirty"===o.status||"dirty"===c.status)&&i.dirty(),a.set(o.value,c.value)}return{status:i.value,value:a}}}};ZodMap.create=(a,i,s)=>new ZodMap({valueType:i,keyType:a,typeName:eF.ZodMap,...processCreateParams(s)});let ZodSet=class ZodSet extends ZodType{_parse(a){let{status:i,ctx:s}=this._processInputParams(a);if(s.parsedType!==c.set)return addIssueToContext(s,{code:w.invalid_type,expected:c.set,received:s.parsedType}),A;let o=this._def;null!==o.minSize&&s.data.size<o.minSize.value&&(addIssueToContext(s,{code:w.too_small,minimum:o.minSize.value,type:"set",inclusive:!0,exact:!1,message:o.minSize.message}),i.dirty()),null!==o.maxSize&&s.data.size>o.maxSize.value&&(addIssueToContext(s,{code:w.too_big,maximum:o.maxSize.value,type:"set",inclusive:!0,exact:!1,message:o.maxSize.message}),i.dirty());let P=this._def.valueType;function finalizeSet(a){let s=new Set;for(let o of a){if("aborted"===o.status)return A;"dirty"===o.status&&i.dirty(),s.add(o.value)}return{status:i.value,value:s}}let x=[...s.data.values()].map((a,i)=>P._parse(new ParseInputLazyPath(s,a,s.path,i)));return s.common.async?Promise.all(x).then(a=>finalizeSet(a)):finalizeSet(x)}min(a,i){return new ZodSet({...this._def,minSize:{value:a,message:eN.toString(i)}})}max(a,i){return new ZodSet({...this._def,maxSize:{value:a,message:eN.toString(i)}})}size(a,i){return this.min(a,i).max(a,i)}nonempty(a){return this.min(1,a)}};ZodSet.create=(a,i)=>new ZodSet({valueType:a,minSize:null,maxSize:null,typeName:eF.ZodSet,...processCreateParams(i)});let ZodFunction=class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(a){let{ctx:i}=this._processInputParams(a);if(i.parsedType!==c.function)return addIssueToContext(i,{code:w.invalid_type,expected:c.function,received:i.parsedType}),A;function makeArgsIssue(a,s){return makeIssue({data:a,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,getErrorMap(),errorMap].filter(a=>!!a),issueData:{code:w.invalid_arguments,argumentsError:s}})}function makeReturnsIssue(a,s){return makeIssue({data:a,path:i.path,errorMaps:[i.common.contextualErrorMap,i.schemaErrorMap,getErrorMap(),errorMap].filter(a=>!!a),issueData:{code:w.invalid_return_type,returnTypeError:s}})}let s={errorMap:i.common.contextualErrorMap},o=i.data;if(this._def.returns instanceof ZodPromise){let a=this;return OK(async function(...i){let c=new ZodError([]),w=await a._def.args.parseAsync(i,s).catch(a=>{throw c.addIssue(makeArgsIssue(i,a)),c}),P=await Reflect.apply(o,this,w),A=await a._def.returns._def.type.parseAsync(P,s).catch(a=>{throw c.addIssue(makeReturnsIssue(P,a)),c});return A})}{let a=this;return OK(function(...i){let c=a._def.args.safeParse(i,s);if(!c.success)throw new ZodError([makeArgsIssue(i,c.error)]);let w=Reflect.apply(o,this,c.data),P=a._def.returns.safeParse(w,s);if(!P.success)throw new ZodError([makeReturnsIssue(w,P.error)]);return P.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...a){return new ZodFunction({...this._def,args:ZodTuple.create(a).rest(ZodUnknown.create())})}returns(a){return new ZodFunction({...this._def,returns:a})}implement(a){let i=this.parse(a);return i}strictImplement(a){let i=this.parse(a);return i}static create(a,i,s){return new ZodFunction({args:a||ZodTuple.create([]).rest(ZodUnknown.create()),returns:i||ZodUnknown.create(),typeName:eF.ZodFunction,...processCreateParams(s)})}};let ZodLazy=class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(a){let{ctx:i}=this._processInputParams(a),s=this._def.getter();return s._parse({data:i.data,path:i.path,parent:i})}};ZodLazy.create=(a,i)=>new ZodLazy({getter:a,typeName:eF.ZodLazy,...processCreateParams(i)});let ZodLiteral=class ZodLiteral extends ZodType{_parse(a){if(a.data!==this._def.value){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{received:i.data,code:w.invalid_literal,expected:this._def.value}),A}return{status:"valid",value:a.data}}get value(){return this._def.value}};function createZodEnum(a,i){return new ZodEnum({values:a,typeName:eF.ZodEnum,...processCreateParams(i)})}ZodLiteral.create=(a,i)=>new ZodLiteral({value:a,typeName:eF.ZodLiteral,...processCreateParams(i)});let ZodEnum=class ZodEnum extends ZodType{constructor(){super(...arguments),eL.set(this,void 0)}_parse(a){if("string"!=typeof a.data){let i=this._getOrReturnCtx(a),s=this._def.values;return addIssueToContext(i,{expected:ej.joinValues(s),received:i.parsedType,code:w.invalid_type}),A}if(__classPrivateFieldGet(this,eL,"f")||__classPrivateFieldSet(this,eL,new Set(this._def.values),"f"),!__classPrivateFieldGet(this,eL,"f").has(a.data)){let i=this._getOrReturnCtx(a),s=this._def.values;return addIssueToContext(i,{received:i.data,code:w.invalid_enum_value,options:s}),A}return OK(a.data)}get options(){return this._def.values}get enum(){let a={};for(let i of this._def.values)a[i]=i;return a}get Values(){let a={};for(let i of this._def.values)a[i]=i;return a}get Enum(){let a={};for(let i of this._def.values)a[i]=i;return a}extract(a,i=this._def){return ZodEnum.create(a,{...this._def,...i})}exclude(a,i=this._def){return ZodEnum.create(this.options.filter(i=>!a.includes(i)),{...this._def,...i})}};eL=new WeakMap,ZodEnum.create=createZodEnum;let ZodNativeEnum=class ZodNativeEnum extends ZodType{constructor(){super(...arguments),e$.set(this,void 0)}_parse(a){let i=ej.getValidEnumValues(this._def.values),s=this._getOrReturnCtx(a);if(s.parsedType!==c.string&&s.parsedType!==c.number){let a=ej.objectValues(i);return addIssueToContext(s,{expected:ej.joinValues(a),received:s.parsedType,code:w.invalid_type}),A}if(__classPrivateFieldGet(this,e$,"f")||__classPrivateFieldSet(this,e$,new Set(ej.getValidEnumValues(this._def.values)),"f"),!__classPrivateFieldGet(this,e$,"f").has(a.data)){let a=ej.objectValues(i);return addIssueToContext(s,{received:s.data,code:w.invalid_enum_value,options:a}),A}return OK(a.data)}get enum(){return this._def.values}};e$=new WeakMap,ZodNativeEnum.create=(a,i)=>new ZodNativeEnum({values:a,typeName:eF.ZodNativeEnum,...processCreateParams(i)});let ZodPromise=class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(a){let{ctx:i}=this._processInputParams(a);if(i.parsedType!==c.promise&&!1===i.common.async)return addIssueToContext(i,{code:w.invalid_type,expected:c.promise,received:i.parsedType}),A;let s=i.parsedType===c.promise?i.data:Promise.resolve(i.data);return OK(s.then(a=>this._def.type.parseAsync(a,{path:i.path,errorMap:i.common.contextualErrorMap})))}};ZodPromise.create=(a,i)=>new ZodPromise({type:a,typeName:eF.ZodPromise,...processCreateParams(i)});let ZodEffects=class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===eF.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(a){let{status:i,ctx:s}=this._processInputParams(a),o=this._def.effect||null,c={addIssue:a=>{addIssueToContext(s,a),a.fatal?i.abort():i.dirty()},get path(){return s.path}};if(c.addIssue=c.addIssue.bind(c),"preprocess"===o.type){let a=o.transform(s.data,c);if(s.common.async)return Promise.resolve(a).then(async a=>{if("aborted"===i.value)return A;let o=await this._def.schema._parseAsync({data:a,path:s.path,parent:s});return"aborted"===o.status?A:"dirty"===o.status||"dirty"===i.value?DIRTY(o.value):o});{if("aborted"===i.value)return A;let o=this._def.schema._parseSync({data:a,path:s.path,parent:s});return"aborted"===o.status?A:"dirty"===o.status||"dirty"===i.value?DIRTY(o.value):o}}if("refinement"===o.type){let executeRefinement=a=>{let i=o.refinement(a,c);if(s.common.async)return Promise.resolve(i);if(i instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return a};if(!1!==s.common.async)return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>"aborted"===a.status?A:("dirty"===a.status&&i.dirty(),executeRefinement(a.value).then(()=>({status:i.value,value:a.value}))));{let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?A:("dirty"===a.status&&i.dirty(),executeRefinement(a.value),{status:i.value,value:a.value})}}if("transform"===o.type){if(!1!==s.common.async)return this._def.schema._parseAsync({data:s.data,path:s.path,parent:s}).then(a=>isValid(a)?Promise.resolve(o.transform(a.value,c)).then(a=>({status:i.value,value:a})):a);{let a=this._def.schema._parseSync({data:s.data,path:s.path,parent:s});if(!isValid(a))return a;let w=o.transform(a.value,c);if(w instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:i.value,value:w}}}ej.assertNever(o)}};ZodEffects.create=(a,i,s)=>new ZodEffects({schema:a,typeName:eF.ZodEffects,effect:i,...processCreateParams(s)}),ZodEffects.createWithPreprocess=(a,i,s)=>new ZodEffects({schema:i,effect:{type:"preprocess",transform:a},typeName:eF.ZodEffects,...processCreateParams(s)});let ZodOptional=class ZodOptional extends ZodType{_parse(a){let i=this._getType(a);return i===c.undefined?OK(void 0):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}};ZodOptional.create=(a,i)=>new ZodOptional({innerType:a,typeName:eF.ZodOptional,...processCreateParams(i)});let ZodNullable=class ZodNullable extends ZodType{_parse(a){let i=this._getType(a);return i===c.null?OK(null):this._def.innerType._parse(a)}unwrap(){return this._def.innerType}};ZodNullable.create=(a,i)=>new ZodNullable({innerType:a,typeName:eF.ZodNullable,...processCreateParams(i)});let ZodDefault=class ZodDefault extends ZodType{_parse(a){let{ctx:i}=this._processInputParams(a),s=i.data;return i.parsedType===c.undefined&&(s=this._def.defaultValue()),this._def.innerType._parse({data:s,path:i.path,parent:i})}removeDefault(){return this._def.innerType}};ZodDefault.create=(a,i)=>new ZodDefault({innerType:a,typeName:eF.ZodDefault,defaultValue:"function"==typeof i.default?i.default:()=>i.default,...processCreateParams(i)});let ZodCatch=class ZodCatch extends ZodType{_parse(a){let{ctx:i}=this._processInputParams(a),s={...i,common:{...i.common,issues:[]}},o=this._def.innerType._parse({data:s.data,path:s.path,parent:{...s}});return isAsync(o)?o.then(a=>({status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ZodError(s.common.issues)},input:s.data})})):{status:"valid",value:"valid"===o.status?o.value:this._def.catchValue({get error(){return new ZodError(s.common.issues)},input:s.data})}}removeCatch(){return this._def.innerType}};ZodCatch.create=(a,i)=>new ZodCatch({innerType:a,typeName:eF.ZodCatch,catchValue:"function"==typeof i.catch?i.catch:()=>i.catch,...processCreateParams(i)});let ZodNaN=class ZodNaN extends ZodType{_parse(a){let i=this._getType(a);if(i!==c.nan){let i=this._getOrReturnCtx(a);return addIssueToContext(i,{code:w.invalid_type,expected:c.nan,received:i.parsedType}),A}return{status:"valid",value:a.data}}};ZodNaN.create=a=>new ZodNaN({typeName:eF.ZodNaN,...processCreateParams(a)});let W=Symbol("zod_brand");let ZodBranded=class ZodBranded extends ZodType{_parse(a){let{ctx:i}=this._processInputParams(a),s=i.data;return this._def.type._parse({data:s,path:i.path,parent:i})}unwrap(){return this._def.type}};let ZodPipeline=class ZodPipeline extends ZodType{_parse(a){let{status:i,ctx:s}=this._processInputParams(a);if(s.common.async){let handleAsync=async()=>{let a=await this._def.in._parseAsync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?A:"dirty"===a.status?(i.dirty(),DIRTY(a.value)):this._def.out._parseAsync({data:a.value,path:s.path,parent:s})};return handleAsync()}{let a=this._def.in._parseSync({data:s.data,path:s.path,parent:s});return"aborted"===a.status?A:"dirty"===a.status?(i.dirty(),{status:"dirty",value:a.value}):this._def.out._parseSync({data:a.value,path:s.path,parent:s})}}static create(a,i){return new ZodPipeline({in:a,out:i,typeName:eF.ZodPipeline})}};let ZodReadonly=class ZodReadonly extends ZodType{_parse(a){let i=this._def.innerType._parse(a);return isValid(i)&&(i.value=Object.freeze(i.value)),i}unwrap(){return this._def.innerType}};function custom(a,i={},s){return a?ZodAny.create().superRefine((o,c)=>{var w,P;if(!a(o)){let a="function"==typeof i?i(o):"string"==typeof i?{message:i}:i,A=null===(P=null!==(w=a.fatal)&&void 0!==w?w:s)||void 0===P||P,x="string"==typeof a?{message:a}:a;c.addIssue({code:"custom",...x,fatal:A})}}):ZodAny.create()}ZodReadonly.create=(a,i)=>new ZodReadonly({innerType:a,typeName:eF.ZodReadonly,...processCreateParams(i)});let K={object:ZodObject.lazycreate};(eR=eF||(eF={})).ZodString="ZodString",eR.ZodNumber="ZodNumber",eR.ZodNaN="ZodNaN",eR.ZodBigInt="ZodBigInt",eR.ZodBoolean="ZodBoolean",eR.ZodDate="ZodDate",eR.ZodSymbol="ZodSymbol",eR.ZodUndefined="ZodUndefined",eR.ZodNull="ZodNull",eR.ZodAny="ZodAny",eR.ZodUnknown="ZodUnknown",eR.ZodNever="ZodNever",eR.ZodVoid="ZodVoid",eR.ZodArray="ZodArray",eR.ZodObject="ZodObject",eR.ZodUnion="ZodUnion",eR.ZodDiscriminatedUnion="ZodDiscriminatedUnion",eR.ZodIntersection="ZodIntersection",eR.ZodTuple="ZodTuple",eR.ZodRecord="ZodRecord",eR.ZodMap="ZodMap",eR.ZodSet="ZodSet",eR.ZodFunction="ZodFunction",eR.ZodLazy="ZodLazy",eR.ZodLiteral="ZodLiteral",eR.ZodEnum="ZodEnum",eR.ZodEffects="ZodEffects",eR.ZodNativeEnum="ZodNativeEnum",eR.ZodOptional="ZodOptional",eR.ZodNullable="ZodNullable",eR.ZodDefault="ZodDefault",eR.ZodCatch="ZodCatch",eR.ZodPromise="ZodPromise",eR.ZodBranded="ZodBranded",eR.ZodPipeline="ZodPipeline",eR.ZodReadonly="ZodReadonly";let J=ZodString.create,Y=ZodNumber.create,X=ZodNaN.create,ee=ZodBigInt.create,et=ZodBoolean.create,er=ZodDate.create,ea=ZodSymbol.create,en=ZodUndefined.create,ei=ZodNull.create,es=ZodAny.create,eo=ZodUnknown.create,el=ZodNever.create,eu=ZodVoid.create,ec=ZodArray.create,ed=ZodObject.create,eh=ZodObject.strictCreate,ep=ZodUnion.create,ef=ZodDiscriminatedUnion.create,em=ZodIntersection.create,eg=ZodTuple.create,ey=ZodRecord.create,eb=ZodMap.create,e_=ZodSet.create,ev=ZodFunction.create,ew=ZodLazy.create,eP=ZodLiteral.create,eA=ZodEnum.create,eC=ZodNativeEnum.create,eE=ZodPromise.create,eO=ZodEffects.create,eS=ZodOptional.create,eT=ZodNullable.create,ex=ZodEffects.createWithPreprocess,ek=ZodPipeline.create;var eI,eR,ej,eM,eN,eL,e$,eF,eB=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:setErrorMap,getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:[],addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:A,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return ej},get objectUtil(){return eM},ZodParsedType:c,getParsedType:getParsedType,ZodType:ZodType,datetimeRegex:datetimeRegex,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:W,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,ZodReadonly:ZodReadonly,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:K,get ZodFirstPartyTypeKind(){return eF},coerce:{string:a=>ZodString.create({...a,coerce:!0}),number:a=>ZodNumber.create({...a,coerce:!0}),boolean:a=>ZodBoolean.create({...a,coerce:!0}),bigint:a=>ZodBigInt.create({...a,coerce:!0}),date:a=>ZodDate.create({...a,coerce:!0})},any:es,array:ec,bigint:ee,boolean:et,date:er,discriminatedUnion:ef,effect:eO,enum:eA,function:ev,instanceof:(a,i={message:`Input not instance of ${a.name}`})=>custom(i=>i instanceof a,i),intersection:em,lazy:ew,literal:eP,map:eb,nan:X,nativeEnum:eC,never:el,null:ei,nullable:eT,number:Y,object:ed,oboolean:()=>et().optional(),onumber:()=>Y().optional(),optional:eS,ostring:()=>J().optional(),pipeline:ek,preprocess:ex,promise:eE,record:ey,set:e_,strictObject:eh,string:J,symbol:ea,transformer:eO,tuple:eg,undefined:en,union:ep,unknown:eo,void:eu,NEVER:A,ZodIssueCode:w,quotelessJson:a=>{let i=JSON.stringify(a,null,2);return i.replace(/"([^"]+)":/g,"$1:")},ZodError:ZodError})}}]);