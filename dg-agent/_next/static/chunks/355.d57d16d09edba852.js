"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[355],{1860:function(__unused_webpack_module,__webpack_exports__,__webpack_require__){__webpack_require__.d(__webpack_exports__,{l7:function(){return createToolkit},yk:function(){return createTool}});var zod__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(6418),_langchain_core_tools__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(1907),dedent_js__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(4821),dedent_js__WEBPACK_IMPORTED_MODULE_1___default=__webpack_require__.n(dedent_js__WEBPACK_IMPORTED_MODULE_1__);function evalWithScope(context,code){function __eval(){return eval(code)}return __eval.call(context)}function createSchema(n){if(!n)throw Error("Schema is null!");let r=dedent_js__WEBPACK_IMPORTED_MODULE_1___default()("\n    const z = this.z;\n    ".concat(n,"\n    ")),a=evalWithScope({z:zod__WEBPACK_IMPORTED_MODULE_2__.z},r);return a}function createTool(n){let{name:r,description:a,schema:o,action:i}=n,s=createSchema(o),c=evalWithScope({},"(".concat(i,")")),l=new _langchain_core_tools__WEBPACK_IMPORTED_MODULE_0__.XQ({name:r,description:a,func:c,schema:s});return l}function createToolkit(n){let r=JSON.parse(n),a=r.map(n=>createTool(n));return a}let weatherAPISchema=zod__WEBPACK_IMPORTED_MODULE_2__.z.object({location:zod__WEBPACK_IMPORTED_MODULE_2__.z.string().nonempty().describe("The location: district, state to get weather data for.")}),weatherAPITool=new _langchain_core_tools__WEBPACK_IMPORTED_MODULE_0__.XQ({name:"weather-api",description:"Get the weather data for a given location.",schema:weatherAPISchema,func:async n=>{let{location:r}=n,a="https://farmerchat.farmstack.co/vistaar/api/weather/get_weather_forecast/?location=".concat(r,"&source=TOMORROW_NOW");try{let n=await fetch(a);if(!n.ok)throw Error("Failed to fetch weather data.");let r=await n.text();return r}catch(n){throw Error("Failed to fetch weather data.")}}}),docQAAPIInputsSchema=zod__WEBPACK_IMPORTED_MODULE_2__.z.object({query:zod__WEBPACK_IMPORTED_MODULE_2__.z.string().nonempty().describe("The question related to a crop."),crop:zod__WEBPACK_IMPORTED_MODULE_2__.z.enum(["coffee","dairy","wheat"]).describe("The crop to which query is related.")}),docQATool=new _langchain_core_tools__WEBPACK_IMPORTED_MODULE_0__.XQ({name:"doc-qa-tool",description:"Get answers to crop-related queries.",schema:docQAAPIInputsSchema,func:async n=>{let{query:r,crop:a}=n,o="https://farmerchat.farmstack.co/dev/telegram_app/doc_qa/",i={query:r,crop:a.charAt(0).toUpperCase()+a.slice(1)},s={"Content-Type":"application/json"};try{let n=await fetch(o,{method:"POST",headers:s,body:JSON.stringify(i)});if(!n.ok)throw Error("Failed to get answers.");let r=await n.json();return r.response||""}catch(n){throw Error("Failed to get answers.")}}}),videoSearchAPIInputsSchema=zod__WEBPACK_IMPORTED_MODULE_2__.z.object({query:zod__WEBPACK_IMPORTED_MODULE_2__.z.string().nonempty().max(255).describe("The question related to a crop."),crop:zod__WEBPACK_IMPORTED_MODULE_2__.z.enum(["coffee","dairy","wheat"]).describe("The crop to which query is related.")}),videoSearchTool=new _langchain_core_tools__WEBPACK_IMPORTED_MODULE_0__.XQ({name:"video-search-tool",description:"Get the crop-related video link.",schema:videoSearchAPIInputsSchema,func:async n=>{let{query:r,crop:a}=n,o="https://farmerchat.farmstack.co/dev/telegram_app/video_search/",i={query:r,crop:a.charAt(0).toUpperCase()+a.slice(1)},s={"Content-Type":"application/json"};try{let n=await fetch(o,{method:"POST",headers:s,body:JSON.stringify(i)});if(!n.ok)throw Error("Failed to get video link.");let r=await n.json();return r.video_link||""}catch(n){throw Error("Failed to get video link.")}}})},1791:function(n,r,a){a.d(r,{Dq:function(){return h},Qh:function(){return d},Ye:function(){return c},dc:function(){return s},nR:function(){return l}});var o=a(4821),i=a.n(o);let s="system_prompt",c="openai_key",l="openai_model_name",d="tools_json",h=i()("\n    You are Farmer.CHAT, an initiative by Digital Green Foundation,\n    aimed at providing comprehensive assistance in various farming\n    practices, a highly knowledgeable AI assistant specializing in\n    providing accurate agricultural advice.\n\n    As an assistant, engage in friendly conversation towards\n    answering the query of the user.  If some input necessary to\n    answer the question is not in the query or the chat history, ask\n    the user politely for it.  If the answer is unknown, politely\n    apologize to the user for being unable to answer the question.\n    Only answer from data obtained via the tools.\n")},1355:function(n,r,a){a.r(r),a.d(r,{default:function(){return ToolBox}});var o=a(8896),i=a(1860),s=a(1798);function Tool(n){let[r,a]=(0,s.useState)(null),c=(0,s.useRef)(null),{info:l,onSave:d,onDelete:h}=n,u=l.uuid;function handleDelete(){h&&h(l)}async function handleSave(){let n=c.current;if(!n)return;let r=new FormData(n),o=Object.fromEntries(r.entries()),s=o.name,l=o.description,h=o.schema,p=o.action,f=o.testInput,m={uuid:u,name:s,description:l,schema:h,action:p};try{let n=(0,i.yk)(m);f&&await n.invoke(JSON.parse(f))}catch(n){console.error("Error while creating tool info"),console.error(n),a("Error while creating tool info: ".concat(n));return}a("Success"),d&&d(m)}return(0,o.jsxs)("div",{className:"p-4 md:p-8 rounded bg-[#35252d] w-full",children:[(0,o.jsx)("h1",{className:"text-3xl md:text-4xl mb-4",children:"Tool"}),(0,o.jsx)("form",{onSubmit:n=>n.preventDefault(),ref:c,children:(0,o.jsxs)("ul",{children:[(0,o.jsxs)("li",{className:"flex flex-row p-1 items-baseline",children:[(0,o.jsx)("label",{children:"Name:"}),(0,o.jsx)("input",{className:"m-4",type:"text",defaultValue:l.name,name:"name"}),(0,o.jsx)("label",{children:"Description:"}),(0,o.jsx)("input",{className:"m-4 flex-grow",type:"text",defaultValue:l.description,name:"description"})]}),(0,o.jsxs)("li",{className:"flex flex-row p-1 w-full",children:[(0,o.jsx)("div",{className:"p-1 flex-grow",children:(0,o.jsxs)("label",{children:["Input Schema:",(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{className:"m-4 w-full monospace",rows:15,defaultValue:l.schema,name:"schema"})]})}),(0,o.jsx)("div",{className:"p-1 flex-grow",children:(0,o.jsxs)("label",{children:["Action:",(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{className:"m-4 w-full monospace",rows:15,defaultValue:l.action,name:"action"})]})}),(0,o.jsx)("div",{className:"p-1 flex-grow",children:(0,o.jsxs)("label",{children:["Action:",(0,o.jsx)("br",{}),(0,o.jsx)("textarea",{className:"m-4 w-full monospace",rows:15,placeholder:"Enter test input as JSON here.",name:"testInput"})]})})]}),(0,o.jsxs)("li",{className:"flex flex-row p-1 w-full",children:[(0,o.jsx)("button",{type:"submit",className:"shrink-0 px-8 py-4 bg-sky-600 rounded w-28",onClick:n=>handleSave(),children:"Save"}),"â€ƒ",(0,o.jsx)("button",{type:"submit",className:"shrink-0 px-8 py-4 bg-sky-600 rounded w-28",onClick:n=>handleDelete(),children:"Delete"})]})]})}),r&&(0,o.jsx)("h2",{children:r})]})}var c=a(2105),l=a(4821),d=a.n(l),h=a(1791),u=a(9634);let p={uuid:(0,u.Z)(),name:"weather-api",description:"Get the weather data for a given location.",schema:d()('\n        z.object({\n            location: z.string().nonempty()\n                    .describe("The location: district, state to get weather data for."),\n        })\n    '),action:d()('\n        async function ({ location }) {\n            const URL = `https://farmerchat.farmstack.co/vistaar/api/weather/get_weather_forecast/?location=${location}&source=TOMORROW_NOW`;\n        \n            try {\n                const response = await fetch(URL);\n                if (!response.ok) {\n                    throw new Error("Failed to fetch weather data.");\n                }\n                const text_data = await response.text();\n                return text_data;\n            } catch (error) {\n                throw new Error("Failed to fetch weather data.");\n            }\n        } \n    ')},f={uuid:(0,u.Z)(),name:"doc-qa-tool",description:"Get answers to crop-related queries.",schema:d()('\n        z.object({\n            query: z.string().nonempty().describe("The question related to a crop."),\n            crop: z.enum(["coffee", "dairy", "wheat"]).describe("The crop to which query is related."),\n        })\n    '),action:d()("\n        async function ({ query, crop }) {\n            const url = \"https://farmerchat.farmstack.co/dev/telegram_app/doc_qa/\";\n\n            const payload = {\n                query,\n                crop: crop.charAt(0).toUpperCase() + crop.slice(1),\n            };\n            const headers = {\n                'Content-Type': 'application/json'\n            };\n\n            try {\n                const response = await fetch(url, {\n                    method: 'POST',\n                    headers,\n                    body: JSON.stringify(payload),\n                });\n                if (!response.ok) {\n                    throw new Error(\"Failed to get answers.\");\n                }\n                const data = await response.json();\n                return data.response || '';\n            } catch (error) {\n                throw new Error(\"Failed to get answers.\");\n            }\n        }\n    ")},m={uuid:(0,u.Z)(),name:"video-search-tool",description:"Get the crop-related video link.",schema:d()('\n        z.object({\n            query: z.string().nonempty().max(255).describe("The question related to a crop."),\n            crop: z.enum(["coffee", "dairy", "wheat"]).describe("The crop to which query is related."),\n        })\n    '),action:d()("\n        async function ({ query, crop }) {\n            const url = \"https://farmerchat.farmstack.co/dev/telegram_app/video_search/\";\n\n            const payload = {\n                query,\n                crop: crop.charAt(0).toUpperCase() + crop.slice(1) // Capitalize the crop name\n            };\n            const headers = {\n                'Content-Type': 'application/json'\n            };\n\n            try {\n                const response = await fetch(url, {\n                    method: 'POST',\n                    headers,\n                    body: JSON.stringify(payload),\n                });\n                if (!response.ok) {\n                    throw new Error(\"Failed to get video link.\");\n                }\n                const data = await response.json();\n                return data.video_link || '';\n            } catch (error) {\n                throw new Error(\"Failed to get video link.\");\n            }\n        }\n    ")},w=JSON.stringify([p,f,m]);function ToolBox(){let[n,r]=(0,c._)(h.Qh,w),[a,i]=(0,s.useState)(null),l=JSON.parse(n),p=l.length;function handleEdit(n){i(n)}function handleDelete(n){let a=l.filter(r=>r.uuid!==n.uuid);r(JSON.stringify(a)),i(null)}function handleAddTool(){let n={uuid:(0,u.Z)(),name:"new-tool",description:"New tool description",schema:d()("\n                z.object({\n                    // Define the schema here\n                })\n            "),action:d()("\n                async function ({ }) {\n                    // Define the action here\n                }\n            ")},a=[...l,n];r(JSON.stringify(a)),i(n)}if(console.log(l),l.map((n,r)=>(0,o.jsxs)("li",{children:[(0,o.jsx)("h2",{children:n.name}),(0,o.jsx)("h3",{children:n.description})]},n.uuid)),!a)return(0,o.jsxs)("div",{className:"p-4 md:p-8 rounded bg-[#35252d] w-full",children:[(0,o.jsx)("h1",{children:"Toolkit Configuration"}),(0,o.jsxs)("table",{className:"w-full",children:[(0,o.jsx)("thead",{children:(0,o.jsxs)("tr",{children:[(0,o.jsx)("th",{children:"Name"}),(0,o.jsx)("th",{children:"Description"}),(0,o.jsx)("th",{children:"Actions"})]})}),(0,o.jsx)("tbody",{children:l.map(n=>(0,o.jsxs)("tr",{children:[(0,o.jsx)("td",{children:n.name}),(0,o.jsx)("td",{children:n.description}),(0,o.jsx)("td",{children:(0,o.jsxs)("div",{className:"flex flex-row justify-center w-full",children:[(0,o.jsx)("button",{className:"m-4",onClick:r=>handleEdit(n),children:"Edit"}),(0,o.jsx)("button",{className:"m-4",onClick:r=>handleDelete(n),children:"Delete"})]})})]},n.name))})]}),(0,o.jsxs)("p",{children:["Using ",p," tools currently"]}),(0,o.jsx)("button",{onClick:()=>handleAddTool(),type:"button",className:"shrink-0 px-8 py-4 bg-sky-600 rounded w-28",children:"Add Tool"})]});function handleToolSave(n){let a=l.map(r=>r.uuid===n.uuid?n:r);r(JSON.stringify(a)),i(null)}return(0,o.jsx)(Tool,{info:a,onSave:handleToolSave,onDelete:handleDelete})}}}]);