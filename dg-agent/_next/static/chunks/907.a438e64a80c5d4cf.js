(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[907],{9919:function(e,t,r){"use strict";e=r.nmd(e);let wrapAnsi256=(e=0)=>t=>`\u001B[${38+e};5;${t}m`,wrapAnsi16m=(e=0)=>(t,r,a)=>`\u001B[${38+e};2;${t};${r};${a}m`;Object.defineProperty(e,"exports",{enumerable:!0,get:function(){let e=new Map,t={modifier:{reset:[0,0],bold:[1,22],dim:[2,22],italic:[3,23],underline:[4,24],overline:[53,55],inverse:[7,27],hidden:[8,28],strikethrough:[9,29]},color:{black:[30,39],red:[31,39],green:[32,39],yellow:[33,39],blue:[34,39],magenta:[35,39],cyan:[36,39],white:[37,39],blackBright:[90,39],redBright:[91,39],greenBright:[92,39],yellowBright:[93,39],blueBright:[94,39],magentaBright:[95,39],cyanBright:[96,39],whiteBright:[97,39]},bgColor:{bgBlack:[40,49],bgRed:[41,49],bgGreen:[42,49],bgYellow:[43,49],bgBlue:[44,49],bgMagenta:[45,49],bgCyan:[46,49],bgWhite:[47,49],bgBlackBright:[100,49],bgRedBright:[101,49],bgGreenBright:[102,49],bgYellowBright:[103,49],bgBlueBright:[104,49],bgMagentaBright:[105,49],bgCyanBright:[106,49],bgWhiteBright:[107,49]}};for(let[r,a]of(t.color.gray=t.color.blackBright,t.bgColor.bgGray=t.bgColor.bgBlackBright,t.color.grey=t.color.blackBright,t.bgColor.bgGrey=t.bgColor.bgBlackBright,Object.entries(t))){for(let[r,n]of Object.entries(a))t[r]={open:`\u001B[${n[0]}m`,close:`\u001B[${n[1]}m`},a[r]=t[r],e.set(n[0],n[1]);Object.defineProperty(t,r,{value:a,enumerable:!1})}return Object.defineProperty(t,"codes",{value:e,enumerable:!1}),t.color.close="\x1b[39m",t.bgColor.close="\x1b[49m",t.color.ansi256=wrapAnsi256(),t.color.ansi16m=wrapAnsi16m(),t.bgColor.ansi256=wrapAnsi256(10),t.bgColor.ansi16m=wrapAnsi16m(10),Object.defineProperties(t,{rgbToAnsi256:{value:(e,t,r)=>e===t&&t===r?e<8?16:e>248?231:Math.round((e-8)/247*24)+232:16+36*Math.round(e/255*5)+6*Math.round(t/255*5)+Math.round(r/255*5),enumerable:!1},hexToRgb:{value:e=>{let t=/(?<colorString>[a-f\d]{6}|[a-f\d]{3})/i.exec(e.toString(16));if(!t)return[0,0,0];let{colorString:r}=t.groups;3===r.length&&(r=r.split("").map(e=>e+e).join(""));let a=Number.parseInt(r,16);return[a>>16&255,a>>8&255,255&a]},enumerable:!1},hexToAnsi256:{value:e=>t.rgbToAnsi256(...t.hexToRgb(e)),enumerable:!1}}),t}})},1226:function(e,t){"use strict";t.byteLength=byteLength,t.toByteArray=toByteArray,t.fromByteArray=fromByteArray;for(var r=[],a=[],n="undefined"!=typeof Uint8Array?Uint8Array:Array,i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,o=i.length;s<o;++s)r[s]=i[s],a[i.charCodeAt(s)]=s;function getLens(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var r=e.indexOf("=");-1===r&&(r=t);var a=r===t?0:4-r%4;return[r,a]}function byteLength(e){var t=getLens(e),r=t[0],a=t[1];return(r+a)*3/4-a}function _byteLength(e,t,r){return(t+r)*3/4-r}function toByteArray(e){var t,r,i=getLens(e),s=i[0],o=i[1],l=new n(_byteLength(e,s,o)),u=0,d=o>0?s-4:s;for(r=0;r<d;r+=4)t=a[e.charCodeAt(r)]<<18|a[e.charCodeAt(r+1)]<<12|a[e.charCodeAt(r+2)]<<6|a[e.charCodeAt(r+3)],l[u++]=t>>16&255,l[u++]=t>>8&255,l[u++]=255&t;return 2===o&&(t=a[e.charCodeAt(r)]<<2|a[e.charCodeAt(r+1)]>>4,l[u++]=255&t),1===o&&(t=a[e.charCodeAt(r)]<<10|a[e.charCodeAt(r+1)]<<4|a[e.charCodeAt(r+2)]>>2,l[u++]=t>>8&255,l[u++]=255&t),l}function tripletToBase64(e){return r[e>>18&63]+r[e>>12&63]+r[e>>6&63]+r[63&e]}function encodeChunk(e,t,r){for(var a=[],n=t;n<r;n+=3)a.push(tripletToBase64((e[n]<<16&16711680)+(e[n+1]<<8&65280)+(255&e[n+2])));return a.join("")}function fromByteArray(e){for(var t,a=e.length,n=a%3,i=[],s=0,o=a-n;s<o;s+=16383)i.push(encodeChunk(e,s,s+16383>o?o:s+16383));return 1===n?i.push(r[(t=e[a-1])>>2]+r[t<<4&63]+"=="):2===n&&i.push(r[(t=(e[a-2]<<8)+e[a-1])>>10]+r[t>>4&63]+r[t<<2&63]+"="),i.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},2455:function(e){"use strict";let t=/[\p{Lu}]/u,r=/[\p{Ll}]/u,a=/^[\p{Lu}](?![\p{Lu}])/gu,n=/([\p{Alpha}\p{N}_]|$)/u,i=/[_.\- ]+/,s=RegExp("^"+i.source),o=RegExp(i.source+n.source,"gu"),l=RegExp("\\d+"+n.source,"gu"),preserveCamelCase=(e,a,n)=>{let i=!1,s=!1,o=!1;for(let l=0;l<e.length;l++){let u=e[l];i&&t.test(u)?(e=e.slice(0,l)+"-"+e.slice(l),i=!1,o=s,s=!0,l++):s&&o&&r.test(u)?(e=e.slice(0,l-1)+"-"+e.slice(l-1),o=s,s=!1,i=!0):(i=a(u)===u&&n(u)!==u,o=s,s=n(u)===u&&a(u)!==u)}return e},preserveConsecutiveUppercase=(e,t)=>(a.lastIndex=0,e.replace(a,e=>t(e))),postProcess=(e,t)=>(o.lastIndex=0,l.lastIndex=0,e.replace(o,(e,r)=>t(r)).replace(l,e=>t(e))),camelCase=(e,t)=>{if(!("string"==typeof e||Array.isArray(e)))throw TypeError("Expected the input to be `string | string[]`");if(t={pascalCase:!1,preserveConsecutiveUppercase:!1,...t},0===(e=Array.isArray(e)?e.map(e=>e.trim()).filter(e=>e.length).join("-"):e.trim()).length)return"";let r=!1===t.locale?e=>e.toLowerCase():e=>e.toLocaleLowerCase(t.locale),a=!1===t.locale?e=>e.toUpperCase():e=>e.toLocaleUpperCase(t.locale);if(1===e.length)return t.pascalCase?a(e):r(e);let n=e!==r(e);return n&&(e=preserveCamelCase(e,r,a)),e=e.replace(s,""),e=t.preserveConsecutiveUppercase?preserveConsecutiveUppercase(e,r):r(e),t.pascalCase&&(e=a(e.charAt(0))+e.slice(1)),postProcess(e,a)};e.exports=camelCase,e.exports.default=camelCase},4521:function(e){"use strict";e.exports=function(e,t){if("string"!=typeof e)throw TypeError("Expected a string");return t=void 0===t?"_":t,e.replace(/([a-z\d])([A-Z])/g,"$1"+t+"$2").replace(/([A-Z]+)([A-Z][a-z\d]+)/g,"$1"+t+"$2").toLowerCase()}},7913:function(e){"use strict";var t=Object.prototype.hasOwnProperty,r="~";function Events(){}function EE(e,t,r){this.fn=e,this.context=t,this.once=r||!1}function addListener(e,t,a,n,i){if("function"!=typeof a)throw TypeError("The listener must be a function");var s=new EE(a,n||e,i),o=r?r+t:t;return e._events[o]?e._events[o].fn?e._events[o]=[e._events[o],s]:e._events[o].push(s):(e._events[o]=s,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(r=!1)),EventEmitter.prototype.eventNames=function(){var e,a,n=[];if(0===this._eventsCount)return n;for(a in e=this._events)t.call(e,a)&&n.push(r?a.slice(1):a);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(e)):n},EventEmitter.prototype.listeners=function(e){var t=r?r+e:e,a=this._events[t];if(!a)return[];if(a.fn)return[a.fn];for(var n=0,i=a.length,s=Array(i);n<i;n++)s[n]=a[n].fn;return s},EventEmitter.prototype.listenerCount=function(e){var t=r?r+e:e,a=this._events[t];return a?a.fn?1:a.length:0},EventEmitter.prototype.emit=function(e,t,a,n,i,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,d=this._events[o],c=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),c){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,a),!0;case 4:return d.fn.call(d.context,t,a,n),!0;case 5:return d.fn.call(d.context,t,a,n,i),!0;case 6:return d.fn.call(d.context,t,a,n,i,s),!0}for(u=1,l=Array(c-1);u<c;u++)l[u-1]=arguments[u];d.fn.apply(d.context,l)}else{var h,p=d.length;for(u=0;u<p;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),c){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,a);break;case 4:d[u].fn.call(d[u].context,t,a,n);break;default:if(!l)for(h=1,l=Array(c-1);h<c;h++)l[h-1]=arguments[h];d[u].fn.apply(d[u].context,l)}}return!0},EventEmitter.prototype.on=function(e,t,r){return addListener(this,e,t,r,!1)},EventEmitter.prototype.once=function(e,t,r){return addListener(this,e,t,r,!0)},EventEmitter.prototype.removeListener=function(e,t,a,n){var i=r?r+e:e;if(!this._events[i])return this;if(!t)return clearEvent(this,i),this;var s=this._events[i];if(s.fn)s.fn!==t||n&&!s.once||a&&s.context!==a||clearEvent(this,i);else{for(var o=0,l=[],u=s.length;o<u;o++)(s[o].fn!==t||n&&!s[o].once||a&&s[o].context!==a)&&l.push(s[o]);l.length?this._events[i]=1===l.length?l[0]:l:clearEvent(this,i)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=r,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter},9014:function(e){"use strict";e.exports=(e,t)=>(t=t||(()=>{}),e.then(e=>new Promise(e=>{e(t())}).then(()=>e),e=>new Promise(e=>{e(t())}).then(()=>{throw e})))},4825:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(7913),n=r(6586),i=r(5517),empty=()=>{},s=new n.TimeoutError;let PQueue=class PQueue extends a{constructor(e){var t,r,a,n;if(super(),this._intervalCount=0,this._intervalEnd=0,this._pendingCount=0,this._resolveEmpty=empty,this._resolveIdle=empty,!("number"==typeof(e=Object.assign({carryoverConcurrencyCount:!1,intervalCap:1/0,interval:0,concurrency:1/0,autoStart:!0,queueClass:i.default},e)).intervalCap&&e.intervalCap>=1))throw TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${null!==(r=null===(t=e.intervalCap)||void 0===t?void 0:t.toString())&&void 0!==r?r:""}\` (${typeof e.intervalCap})`);if(void 0===e.interval||!(Number.isFinite(e.interval)&&e.interval>=0))throw TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${null!==(n=null===(a=e.interval)||void 0===a?void 0:a.toString())&&void 0!==n?n:""}\` (${typeof e.interval})`);this._carryoverConcurrencyCount=e.carryoverConcurrencyCount,this._isIntervalIgnored=e.intervalCap===1/0||0===e.interval,this._intervalCap=e.intervalCap,this._interval=e.interval,this._queue=new e.queueClass,this._queueClass=e.queueClass,this.concurrency=e.concurrency,this._timeout=e.timeout,this._throwOnTimeout=!0===e.throwOnTimeout,this._isPaused=!1===e.autoStart}get _doesIntervalAllowAnother(){return this._isIntervalIgnored||this._intervalCount<this._intervalCap}get _doesConcurrentAllowAnother(){return this._pendingCount<this._concurrency}_next(){this._pendingCount--,this._tryToStartAnother(),this.emit("next")}_resolvePromises(){this._resolveEmpty(),this._resolveEmpty=empty,0===this._pendingCount&&(this._resolveIdle(),this._resolveIdle=empty,this.emit("idle"))}_onResumeInterval(){this._onInterval(),this._initializeIntervalIfNeeded(),this._timeoutId=void 0}_isIntervalPaused(){let e=Date.now();if(void 0===this._intervalId){let t=this._intervalEnd-e;if(!(t<0))return void 0===this._timeoutId&&(this._timeoutId=setTimeout(()=>{this._onResumeInterval()},t)),!0;this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0}return!1}_tryToStartAnother(){if(0===this._queue.size)return this._intervalId&&clearInterval(this._intervalId),this._intervalId=void 0,this._resolvePromises(),!1;if(!this._isPaused){let e=!this._isIntervalPaused();if(this._doesIntervalAllowAnother&&this._doesConcurrentAllowAnother){let t=this._queue.dequeue();return!!t&&(this.emit("active"),t(),e&&this._initializeIntervalIfNeeded(),!0)}}return!1}_initializeIntervalIfNeeded(){this._isIntervalIgnored||void 0!==this._intervalId||(this._intervalId=setInterval(()=>{this._onInterval()},this._interval),this._intervalEnd=Date.now()+this._interval)}_onInterval(){0===this._intervalCount&&0===this._pendingCount&&this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0),this._intervalCount=this._carryoverConcurrencyCount?this._pendingCount:0,this._processQueue()}_processQueue(){for(;this._tryToStartAnother(););}get concurrency(){return this._concurrency}set concurrency(e){if(!("number"==typeof e&&e>=1))throw TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${e}\` (${typeof e})`);this._concurrency=e,this._processQueue()}async add(e,t={}){return new Promise((r,a)=>{let run=async()=>{this._pendingCount++,this._intervalCount++;try{let i=void 0===this._timeout&&void 0===t.timeout?e():n.default(Promise.resolve(e()),void 0===t.timeout?this._timeout:t.timeout,()=>{(void 0===t.throwOnTimeout?this._throwOnTimeout:t.throwOnTimeout)&&a(s)});r(await i)}catch(e){a(e)}this._next()};this._queue.enqueue(run,t),this._tryToStartAnother(),this.emit("add")})}async addAll(e,t){return Promise.all(e.map(async e=>this.add(e,t)))}start(){return this._isPaused&&(this._isPaused=!1,this._processQueue()),this}pause(){this._isPaused=!0}clear(){this._queue=new this._queueClass}async onEmpty(){if(0!==this._queue.size)return new Promise(e=>{let t=this._resolveEmpty;this._resolveEmpty=()=>{t(),e()}})}async onIdle(){if(0!==this._pendingCount||0!==this._queue.size)return new Promise(e=>{let t=this._resolveIdle;this._resolveIdle=()=>{t(),e()}})}get size(){return this._queue.size}sizeBy(e){return this._queue.filter(e).length}get pending(){return this._pendingCount}get isPaused(){return this._isPaused}get timeout(){return this._timeout}set timeout(e){this._timeout=e}};t.default=PQueue},2736:function(e,t){"use strict";function lowerBound(e,t,r){let a=0,n=e.length;for(;n>0;){let i=n/2|0,s=a+i;0>=r(e[s],t)?(a=++s,n-=i+1):n=i}return a}Object.defineProperty(t,"__esModule",{value:!0}),t.default=lowerBound},5517:function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});let a=r(2736);let PriorityQueue=class PriorityQueue{constructor(){this._queue=[]}enqueue(e,t){t=Object.assign({priority:0},t);let r={priority:t.priority,run:e};if(this.size&&this._queue[this.size-1].priority>=t.priority){this._queue.push(r);return}let n=a.default(this._queue,r,(e,t)=>t.priority-e.priority);this._queue.splice(n,0,r)}dequeue(){let e=this._queue.shift();return null==e?void 0:e.run}filter(e){return this._queue.filter(t=>t.priority===e.priority).map(e=>e.run)}get size(){return this._queue.length}};t.default=PriorityQueue},1018:function(e,t,r){"use strict";let a=r(9182),n=["Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Network request failed"];let AbortError=class AbortError extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}};let decorateErrorWithCounts=(e,t,r)=>{let a=r.retries-(t-1);return e.attemptNumber=t,e.retriesLeft=a,e},isNetworkError=e=>n.includes(e),pRetry=(e,t)=>new Promise((r,n)=>{t={onFailedAttempt:()=>{},retries:10,...t};let i=a.operation(t);i.attempt(async a=>{try{r(await e(a))}catch(e){if(!(e instanceof Error)){n(TypeError(`Non-error was thrown: "${e}". You should only throw errors.`));return}if(e instanceof AbortError)i.stop(),n(e.originalError);else if(e instanceof TypeError&&!isNetworkError(e.message))i.stop(),n(e);else{decorateErrorWithCounts(e,a,t);try{await t.onFailedAttempt(e)}catch(e){n(e);return}i.retry(e)||n(i.mainError())}}})});e.exports=pRetry,e.exports.default=pRetry,e.exports.AbortError=AbortError},6586:function(e,t,r){"use strict";let a=r(9014);let TimeoutError=class TimeoutError extends Error{constructor(e){super(e),this.name="TimeoutError"}};let pTimeout=(e,t,r)=>new Promise((n,i)=>{if("number"!=typeof t||t<0)throw TypeError("Expected `milliseconds` to be a positive number");if(t===1/0){n(e);return}let s=setTimeout(()=>{if("function"==typeof r){try{n(r())}catch(e){i(e)}return}let a="string"==typeof r?r:`Promise timed out after ${t} milliseconds`,s=r instanceof Error?r:new TimeoutError(a);"function"==typeof e.cancel&&e.cancel(),i(s)},t);a(e.then(n,i),()=>{clearTimeout(s)})});e.exports=pTimeout,e.exports.default=pTimeout,e.exports.TimeoutError=TimeoutError},9182:function(e,t,r){e.exports=r(7530)},7530:function(e,t,r){var a=r(9283);t.operation=function(e){return new a(t.timeouts(e),{forever:e&&(e.forever||e.retries===1/0),unref:e&&e.unref,maxRetryTime:e&&e.maxRetryTime})},t.timeouts=function(e){if(e instanceof Array)return[].concat(e);var t={retries:10,factor:2,minTimeout:1e3,maxTimeout:1/0,randomize:!1};for(var r in e)t[r]=e[r];if(t.minTimeout>t.maxTimeout)throw Error("minTimeout is greater than maxTimeout");for(var a=[],n=0;n<t.retries;n++)a.push(this.createTimeout(n,t));return e&&e.forever&&!a.length&&a.push(this.createTimeout(n,t)),a.sort(function(e,t){return e-t}),a},t.createTimeout=function(e,t){return Math.min(Math.round((t.randomize?Math.random()+1:1)*Math.max(t.minTimeout,1)*Math.pow(t.factor,e)),t.maxTimeout)},t.wrap=function(e,r,a){if(r instanceof Array&&(a=r,r=null),!a)for(var n in a=[],e)"function"==typeof e[n]&&a.push(n);for(var i=0;i<a.length;i++){var s=a[i],o=e[s];e[s]=(function(a){var n=t.operation(r),i=Array.prototype.slice.call(arguments,1),s=i.pop();i.push(function(e){n.retry(e)||(e&&(arguments[0]=n.mainError()),s.apply(this,arguments))}),n.attempt(function(){a.apply(e,i)})}).bind(e,o),e[s].options=r}}},9283:function(e){function RetryOperation(e,t){"boolean"==typeof t&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}e.exports=RetryOperation,RetryOperation.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},RetryOperation.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},RetryOperation.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var r=this._timeouts.shift();if(void 0===r){if(!this._cachedTimeouts)return!1;this._errors.splice(0,this._errors.length-1),r=this._cachedTimeouts.slice(-1)}var a=this;return this._timer=setTimeout(function(){a._attempts++,a._operationTimeoutCb&&(a._timeout=setTimeout(function(){a._operationTimeoutCb(a._attempts)},a._operationTimeout),a._options.unref&&a._timeout.unref()),a._fn(a._attempts)},r),this._options.unref&&this._timer.unref(),!0},RetryOperation.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var r=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){r._operationTimeoutCb()},r._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},RetryOperation.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},RetryOperation.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},RetryOperation.prototype.start=RetryOperation.prototype.try,RetryOperation.prototype.errors=function(){return this._errors},RetryOperation.prototype.attempts=function(){return this._attempts},RetryOperation.prototype.mainError=function(){if(0===this._errors.length)return null;for(var e={},t=null,r=0,a=0;a<this._errors.length;a++){var n=this._errors[a],i=n.message,s=(e[i]||0)+1;e[i]=s,s>=r&&(t=n,r=s)}return t}},9634:function(e,t,r){"use strict";let a;r.d(t,{Z:function(){return esm_browser_v4}});let n="undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var i={randomUUID:n};let s=new Uint8Array(16);function rng(){if(!a&&!(a="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)))throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return a(s)}let o=[];for(let e=0;e<256;++e)o.push((e+256).toString(16).slice(1));function unsafeStringify(e,t=0){return o[e[t+0]]+o[e[t+1]]+o[e[t+2]]+o[e[t+3]]+"-"+o[e[t+4]]+o[e[t+5]]+"-"+o[e[t+6]]+o[e[t+7]]+"-"+o[e[t+8]]+o[e[t+9]]+"-"+o[e[t+10]]+o[e[t+11]]+o[e[t+12]]+o[e[t+13]]+o[e[t+14]]+o[e[t+15]]}var esm_browser_v4=function(e,t,r){if(i.randomUUID&&!t&&!e)return i.randomUUID();e=e||{};let a=e.random||(e.rng||rng)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t){r=r||0;for(let e=0;e<16;++e)t[r+e]=a[e];return t}return unsafeStringify(a)}},325:function(e,t,r){"use strict";r.d(t,{Z:function(){return esm_browser_validate}});var a=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i,esm_browser_validate=function(e){return"string"==typeof e&&a.test(e)}},2713:function(e,t,r){"use strict";r.d(t,{E:function(){return BaseCallbackHandler}});var a=r(9634),n=r(8498),i=r(298);let BaseCallbackHandlerMethodsClass=class BaseCallbackHandlerMethodsClass{};let BaseCallbackHandler=class BaseCallbackHandler extends BaseCallbackHandlerMethodsClass{get lc_namespace(){return["langchain_core","callbacks",this.name]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,(0,n.j)(this.constructor)]}constructor(e){super(),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"ignoreLLM",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreChain",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreAgent",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"ignoreRetriever",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"awaitHandlers",{enumerable:!0,configurable:!0,writable:!0,value:"true"!==(0,i.lS)("LANGCHAIN_CALLBACKS_BACKGROUND")}),this.lc_kwargs=e||{},e&&(this.ignoreLLM=e.ignoreLLM??this.ignoreLLM,this.ignoreChain=e.ignoreChain??this.ignoreChain,this.ignoreAgent=e.ignoreAgent??this.ignoreAgent,this.ignoreRetriever=e.ignoreRetriever??this.ignoreRetriever,this.awaitHandlers=e._awaitHandler??this.awaitHandlers)}copy(){return new this.constructor(this)}toJSON(){return n.i.prototype.toJSON.call(this)}toJSONNotImplemented(){return n.i.prototype.toJSONNotImplemented.call(this)}static fromMethods(e){let Handler=class Handler extends BaseCallbackHandler{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:a.Z()}),Object.assign(this,e)}};return new Handler}}},7018:function(e,t,r){"use strict";let a,n,i,s;r.d(t,{Ye:function(){return CallbackManager},xz:function(){return ensureHandler},QH:function(){return parseCallbackConfigArg}});var o=r(9634),l=r(2713),u=r(9919),d=r(1448);function wrap(e,t){return`${e.open}${t}${e.close}`}function tryJsonStringify(e,t){try{return JSON.stringify(e,null,2)}catch(e){return t}}function elapsed(e){if(!e.end_time)return"";let t=e.end_time-e.start_time;return t<1e3?`${t}ms`:`${(t/1e3).toFixed(2)}s`}let{color:c}=u;let ConsoleCallbackHandler=class ConsoleCallbackHandler extends d.Z{constructor(){super(...arguments),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"console_callback_handler"})}persistRun(e){return Promise.resolve()}getParents(e){let t=[],r=e;for(;r.parent_run_id;){let e=this.runMap.get(r.parent_run_id);if(e)t.push(e),r=e;else break}return t}getBreadcrumbs(e){let t=this.getParents(e).reverse(),r=[...t,e].map((e,t,r)=>{let a=`${e.execution_order}:${e.run_type}:${e.name}`;return t===r.length-1?wrap(u.bold,a):a}).join(" > ");return wrap(c.grey,r)}onChainStart(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.green,"[chain/start]")} [${t}] Entering Chain run with input: ${tryJsonStringify(e.inputs,"[inputs]")}`)}onChainEnd(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.cyan,"[chain/end]")} [${t}] [${elapsed(e)}] Exiting Chain run with output: ${tryJsonStringify(e.outputs,"[outputs]")}`)}onChainError(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.red,"[chain/error]")} [${t}] [${elapsed(e)}] Chain run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onLLMStart(e){let t=this.getBreadcrumbs(e),r="prompts"in e.inputs?{prompts:e.inputs.prompts.map(e=>e.trim())}:e.inputs;console.log(`${wrap(c.green,"[llm/start]")} [${t}] Entering LLM run with input: ${tryJsonStringify(r,"[inputs]")}`)}onLLMEnd(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.cyan,"[llm/end]")} [${t}] [${elapsed(e)}] Exiting LLM run with output: ${tryJsonStringify(e.outputs,"[response]")}`)}onLLMError(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.red,"[llm/error]")} [${t}] [${elapsed(e)}] LLM run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onToolStart(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.green,"[tool/start]")} [${t}] Entering Tool run with input: "${e.inputs.input?.trim()}"`)}onToolEnd(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.cyan,"[tool/end]")} [${t}] [${elapsed(e)}] Exiting Tool run with output: "${e.outputs?.output?.trim()}"`)}onToolError(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.red,"[tool/error]")} [${t}] [${elapsed(e)}] Tool run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onRetrieverStart(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.green,"[retriever/start]")} [${t}] Entering Retriever run with input: ${tryJsonStringify(e.inputs,"[inputs]")}`)}onRetrieverEnd(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.cyan,"[retriever/end]")} [${t}] [${elapsed(e)}] Exiting Retriever run with output: ${tryJsonStringify(e.outputs,"[outputs]")}`)}onRetrieverError(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.red,"[retriever/error]")} [${t}] [${elapsed(e)}] Retriever run errored with error: ${tryJsonStringify(e.error,"[error]")}`)}onAgentAction(e){let t=this.getBreadcrumbs(e);console.log(`${wrap(c.blue,"[agent/action]")} [${t}] Agent selected action: ${tryJsonStringify(e.actions[e.actions.length-1],"[action]")}`)}};var h=r(325),p=r(1018),f=r(4825);let m=[400,401,403,404,405,406,407,408],g=[409];let AsyncCaller=class AsyncCaller{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedResponseHook",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6;let t=f.default;this.queue=new t({concurrency:this.maxConcurrency}),this.onFailedResponseHook=e?.onFailedResponseHook}call(e,...t){let r=this.onFailedResponseHook;return this.queue.add(()=>p(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{async onFailedAttempt(e){if(e.message.startsWith("Cancel")||e.message.startsWith("TimeoutError")||e.message.startsWith("AbortError")||e?.code==="ECONNABORTED")throw e;let t=e?.response,a=t?.status;if(a){if(m.includes(+a))throw e;if(g.includes(+a))return;r&&await r(t)}},retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}};function isLangChainMessage(e){return"function"==typeof e?._getType}function convertLangChainMessageToExample(e){let t={type:e._getType(),data:{content:e.content}};return e?.additional_kwargs&&Object.keys(e.additional_kwargs).length>0&&(t.data.additional_kwargs={...e.additional_kwargs}),t}var y=r(5656);let isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),isDeno=()=>"undefined"!=typeof Deno,isNode=()=>void 0!==y&&void 0!==y.versions&&void 0!==y.versions.node&&!isDeno(),getEnv=()=>a||(a=isBrowser()?"browser":isNode()?"node":isWebWorker()?"webworker":isJsDom()?"jsdom":isDeno()?"deno":"other");async function env_getRuntimeEnvironment(){if(void 0===n){let e=getEnv(),t=getShas();n={library:"langsmith",runtime:e,sdk:"langsmith-js",sdk_version:b,...t}}return n}function getLangChainEnvVarsMetadata(){let e=getEnvironmentVariables()||{},t={},r=["LANGCHAIN_API_KEY","LANGCHAIN_ENDPOINT","LANGCHAIN_TRACING_V2","LANGCHAIN_PROJECT","LANGCHAIN_SESSION"];for(let[a,n]of Object.entries(e))!a.startsWith("LANGCHAIN_")||"string"!=typeof n||r.includes(a)||a.toLowerCase().includes("key")||a.toLowerCase().includes("secret")||a.toLowerCase().includes("token")||("LANGCHAIN_REVISION_ID"===a?t.revision_id=n:t[a]=n);return t}function getEnvironmentVariables(){try{if(void 0!==y&&y.env)return Object.entries(y.env).reduce((e,[t,r])=>(e[t]=String(r),e),{});return}catch(e){return}}function env_getEnvironmentVariable(e){try{return void 0!==y?y.env?.[e]:void 0}catch(e){return}}function getShas(){if(void 0!==i)return i;let e={};for(let t of["VERCEL_GIT_COMMIT_SHA","NEXT_PUBLIC_VERCEL_GIT_COMMIT_SHA","COMMIT_REF","RENDER_GIT_COMMIT","CI_COMMIT_SHA","CIRCLE_SHA1","CF_PAGES_COMMIT_SHA","REACT_APP_GIT_SHA","SOURCE_VERSION","GITHUB_SHA","TRAVIS_COMMIT","GIT_COMMIT","BUILD_VCS_NUMBER","bamboo_planRepository_revision","Build.SourceVersion","BITBUCKET_COMMIT","DRONE_COMMIT_SHA","SEMAPHORE_GIT_SHA","BUILDKITE_COMMIT"]){let r=env_getEnvironmentVariable(t);void 0!==r&&(e[t]=r)}return i=e,e}async function mergeRuntimeEnvIntoRunCreates(e){let t=await env_getRuntimeEnvironment(),r=getLangChainEnvVarsMetadata();return e.map(e=>{let a=e.extra??{},n=a.metadata;return e.extra={...a,runtime:{...t,...a?.runtime},metadata:{...r,...r.revision_id||e.revision_id?{revision_id:e.revision_id??r.revision_id}:{},...n}},e})}let getTracingSamplingRate=()=>{let e=env_getEnvironmentVariable("LANGCHAIN_TRACING_SAMPLING_RATE");if(void 0===e)return;let t=parseFloat(e);if(t<0||t>1)throw Error(`LANGCHAIN_TRACING_SAMPLING_RATE must be between 0 and 1 if set. Got: ${t}`);return t},isLocalhost=e=>{let t=e.replace("http://","").replace("https://",""),r=t.split("/")[0].split(":")[0];return"localhost"===r||"127.0.0.1"===r||"::1"===r},raiseForStatus=async(e,t)=>{let r=await e.text();if(!e.ok)throw Error(`Failed to ${t}: ${e.status} ${e.statusText} ${r}`)};async function toArray(e){let t=[];for await(let r of e)t.push(r);return t}function trimQuotes(e){if(void 0!==e)return e.trim().replace(/^"(.*)"$/,"$1").replace(/^'(.*)'$/,"$1")}function assertUuid(e){if(!h.Z(e))throw Error(`Invalid UUID: ${e}`)}let handle429=async e=>{if(e?.status===429){let t=1e3*parseInt(e.headers.get("retry-after")??"30",10);if(t>0)return await new Promise(e=>setTimeout(e,t)),!0}return!1};let Queue=class Queue{constructor(){Object.defineProperty(this,"items",{enumerable:!0,configurable:!0,writable:!0,value:[]})}get size(){return this.items.length}push(e){return new Promise(t=>{this.items.push([e,t])})}pop(e){if(e<1)throw Error("Number of items to pop off may not be less than 1.");let t=[];for(;t.length<e&&this.items.length;){let e=this.items.shift();if(e)t.push(e);else break}return[t.map(e=>e[0]),()=>t.forEach(e=>e[1]())]}};let client_Client=class client_Client{constructor(e={}){Object.defineProperty(this,"apiKey",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"apiUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"webUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"batchIngestCaller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"timeout_ms",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_tenantId",{enumerable:!0,configurable:!0,writable:!0,value:null}),Object.defineProperty(this,"hideInputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"hideOutputs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tracingSampleRate",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"sampledPostUuids",{enumerable:!0,configurable:!0,writable:!0,value:new Set}),Object.defineProperty(this,"autoBatchTracing",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"batchEndpointSupported",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchQueue",{enumerable:!0,configurable:!0,writable:!0,value:new Queue}),Object.defineProperty(this,"pendingAutoBatchedRunLimit",{enumerable:!0,configurable:!0,writable:!0,value:100}),Object.defineProperty(this,"autoBatchTimeout",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"autoBatchInitialDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:250}),Object.defineProperty(this,"autoBatchAggregationDelayMs",{enumerable:!0,configurable:!0,writable:!0,value:50}),Object.defineProperty(this,"serverInfo",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fetchOptions",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let t=client_Client.getDefaultClientConfig();this.tracingSampleRate=getTracingSamplingRate(),this.apiUrl=trimQuotes(e.apiUrl??t.apiUrl)??"",this.apiKey=trimQuotes(e.apiKey??t.apiKey),this.webUrl=trimQuotes(e.webUrl??t.webUrl),this.timeout_ms=e.timeout_ms??12e3,this.caller=new AsyncCaller(e.callerOptions??{}),this.batchIngestCaller=new AsyncCaller({...e.callerOptions??{},onFailedResponseHook:handle429}),this.hideInputs=e.hideInputs??t.hideInputs,this.hideOutputs=e.hideOutputs??t.hideOutputs,this.autoBatchTracing=e.autoBatchTracing??this.autoBatchTracing,this.pendingAutoBatchedRunLimit=e.pendingAutoBatchedRunLimit??this.pendingAutoBatchedRunLimit,this.fetchOptions=e.fetchOptions||{}}static getDefaultClientConfig(){let e=env_getEnvironmentVariable("LANGCHAIN_API_KEY"),t=env_getEnvironmentVariable("LANGCHAIN_ENDPOINT")??"https://api.smith.langchain.com",r="true"===env_getEnvironmentVariable("LANGCHAIN_HIDE_INPUTS"),a="true"===env_getEnvironmentVariable("LANGCHAIN_HIDE_OUTPUTS");return{apiUrl:t,apiKey:e,webUrl:void 0,hideInputs:r,hideOutputs:a}}getHostUrl(){return this.webUrl?this.webUrl:isLocalhost(this.apiUrl)?(this.webUrl="http://localhost","http://localhost"):this.apiUrl.includes("/api")&&!this.apiUrl.split(".",1)[0].endsWith("api")?(this.webUrl=this.apiUrl.replace("/api",""),this.webUrl):this.apiUrl.split(".",1)[0].includes("dev")?(this.webUrl="https://dev.smith.langchain.com","https://dev.smith.langchain.com"):(this.webUrl="https://smith.langchain.com","https://smith.langchain.com")}get headers(){let e={"User-Agent":`langsmith-js/${b}`};return this.apiKey&&(e["x-api-key"]=`${this.apiKey}`),e}processInputs(e){return!1===this.hideInputs?e:!0===this.hideInputs?{}:"function"==typeof this.hideInputs?this.hideInputs(e):e}processOutputs(e){return!1===this.hideOutputs?e:!0===this.hideOutputs?{}:"function"==typeof this.hideOutputs?this.hideOutputs(e):e}prepareRunCreateOrUpdateInputs(e){let t={...e};return void 0!==t.inputs&&(t.inputs=this.processInputs(t.inputs)),void 0!==t.outputs&&(t.outputs=this.processOutputs(t.outputs)),t}async _getResponse(e,t){let r=t?.toString()??"",a=`${this.apiUrl}${e}?${r}`,n=await this.caller.call(fetch,a,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw Error(`Failed to fetch ${e}: ${n.status} ${n.statusText}`);return n}async _get(e,t){let r=await this._getResponse(e,t);return r.json()}async *_getPaginated(e,t=new URLSearchParams){let r=Number(t.get("offset"))||0,a=Number(t.get("limit"))||100;for(;;){t.set("offset",String(r)),t.set("limit",String(a));let n=`${this.apiUrl}${e}?${t}`,i=await this.caller.call(fetch,n,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!i.ok)throw Error(`Failed to fetch ${e}: ${i.status} ${i.statusText}`);let s=await i.json();if(0===s.length||(yield s,s.length<a))break;r+=s.length}}async *_getCursorPaginatedList(e,t=null,r="POST",a="runs"){let n=t?{...t}:{};for(;;){let t=await this.caller.call(fetch,`${this.apiUrl}${e}`,{method:r,headers:{...this.headers,"Content-Type":"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions,body:JSON.stringify(n)}),i=await t.json();if(!i||!i[a])break;yield i[a];let s=i.cursors;if(!s||!s.next)break;n.cursor=s.next}}_filterForSampling(e,t=!1){if(void 0===this.tracingSampleRate)return e;if(t){let t=[];for(let r of e)this.sampledPostUuids.has(r.id)&&(t.push(r),this.sampledPostUuids.delete(r.id));return t}{let t=[];for(let r of e)Math.random()<this.tracingSampleRate&&(t.push(r),this.sampledPostUuids.add(r.id));return t}}async drainAutoBatchQueue(){for(;this.autoBatchQueue.size>=0;){let[e,t]=this.autoBatchQueue.pop(this.pendingAutoBatchedRunLimit);if(!e.length){t();return}try{await this.batchIngestRuns({runCreates:e.filter(e=>"create"===e.action).map(e=>e.item),runUpdates:e.filter(e=>"update"===e.action).map(e=>e.item)})}finally{t()}}}async processRunOperation(e,t){let r=this.autoBatchTimeout;clearTimeout(this.autoBatchTimeout),this.autoBatchTimeout=void 0;let a=this.autoBatchQueue.push(e);return(t||this.autoBatchQueue.size>this.pendingAutoBatchedRunLimit)&&await this.drainAutoBatchQueue(),this.autoBatchQueue.size>0&&(this.autoBatchTimeout=setTimeout(()=>{this.autoBatchTimeout=void 0,this.drainAutoBatchQueue().catch(console.error)},r?this.autoBatchAggregationDelayMs:this.autoBatchInitialDelayMs)),a}async _getServerInfo(){let e=await fetch(`${this.apiUrl}/info`,{method:"GET",headers:{Accept:"application/json"},signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!e.ok)throw await e.text(),Error("Failed to retrieve server info.");return e.json()}async batchEndpointIsSupported(){try{this.serverInfo=await this._getServerInfo()}catch(e){return!1}return!0}async createRun(e){if(!this._filterForSampling([e]).length)return;let t={...this.headers,"Content-Type":"application/json"},r=e.project_name;delete e.project_name;let a=this.prepareRunCreateOrUpdateInputs({session_name:r,...e,start_time:e.start_time??Date.now()});if(this.autoBatchTracing&&void 0!==a.trace_id&&void 0!==a.dotted_order){this.processRunOperation({action:"create",item:a}).catch(console.error);return}let n=await mergeRuntimeEnvIntoRunCreates([a]),i=await this.caller.call(fetch,`${this.apiUrl}/runs`,{method:"POST",headers:t,body:JSON.stringify(n[0]),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(i,"create run")}async batchIngestRuns({runCreates:e,runUpdates:t}){if(void 0===e&&void 0===t)return;let r=e?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[],a=t?.map(e=>this.prepareRunCreateOrUpdateInputs(e))??[];if(r.length>0&&a.length>0){let e=r.reduce((e,t)=>(t.id&&(e[t.id]=t),e),{}),t=[];for(let r of a)void 0!==r.id&&e[r.id]?e[r.id]={...e[r.id],...r}:t.push(r);r=Object.values(e),a=t}let n={post:this._filterForSampling(r),patch:this._filterForSampling(a,!0)};if(!n.post.length&&!n.patch.length)return;if(r=await mergeRuntimeEnvIntoRunCreates(r),void 0===this.batchEndpointSupported&&(this.batchEndpointSupported=await this.batchEndpointIsSupported()),!this.batchEndpointSupported){for(let e of(this.autoBatchTracing=!1,n.post))await this.createRun(e);for(let e of n.patch)void 0!==e.id&&await this.updateRun(e.id,e);return}let i=this.serverInfo?.batch_ingest_config?.size_limit_bytes??20971520,s={post:[],patch:[]},o=0;for(let e of["post","patch"]){let t=n[e].reverse(),r=t.pop();for(;void 0!==r;){let a=JSON.stringify(r);o>0&&o+a.length>i&&(await this._postBatchIngestRuns(JSON.stringify(s)),o=0,s.post=[],s.patch=[]),o+=a.length,s[e].push(r),r=t.pop()}}(s.post.length>0||s.patch.length>0)&&await this._postBatchIngestRuns(JSON.stringify(s))}async _postBatchIngestRuns(e){let t={...this.headers,"Content-Type":"application/json",Accept:"application/json"},r=await this.batchIngestCaller.call(fetch,`${this.apiUrl}/runs/batch`,{method:"POST",headers:t,body:e,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(r,"batch create run")}async updateRun(e,t){assertUuid(e),t.inputs&&(t.inputs=this.processInputs(t.inputs)),t.outputs&&(t.outputs=this.processOutputs(t.outputs));let r={...t,id:e};if(!this._filterForSampling([r],!0).length)return;if(this.autoBatchTracing&&void 0!==r.trace_id&&void 0!==r.dotted_order){void 0!==t.end_time&&void 0===r.parent_run_id?await this.processRunOperation({action:"update",item:r},!0):this.processRunOperation({action:"update",item:r}).catch(console.error);return}let a={...this.headers,"Content-Type":"application/json"},n=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}`,{method:"PATCH",headers:a,body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(n,"update run")}async readRun(e,{loadChildRuns:t}={loadChildRuns:!1}){assertUuid(e);let r=await this._get(`/runs/${e}`);return t&&r.child_run_ids&&(r=await this._loadChildRuns(r)),r}async getRunUrl({runId:e,run:t,projectOpts:r}){if(void 0!==t){let e;if(t.session_id)e=t.session_id;else if(r?.projectName)e=(await this.readProject({projectName:r?.projectName})).id;else if(r?.projectId)e=r?.projectId;else{let t=await this.readProject({projectName:env_getEnvironmentVariable("LANGCHAIN_PROJECT")||"default"});e=t.id}let a=await this._getTenantId();return`${this.getHostUrl()}/o/${a}/projects/p/${e}/r/${t.id}?poll=true`}if(void 0!==e){let t=await this.readRun(e);if(!t.app_path)throw Error(`Run ${e} has no app_path`);let r=this.getHostUrl();return`${r}${t.app_path}`}throw Error("Must provide either runId or run")}async _loadChildRuns(e){let t=await toArray(this.listRuns({id:e.child_run_ids})),r={},a={};for(let e of(t.sort((e,t)=>(e?.dotted_order??"").localeCompare(t?.dotted_order??"")),t)){if(null===e.parent_run_id||void 0===e.parent_run_id)throw Error(`Child run ${e.id} has no parent`);e.parent_run_id in r||(r[e.parent_run_id]=[]),r[e.parent_run_id].push(e),a[e.id]=e}for(let t in e.child_runs=r[e.id]||[],r)t!==e.id&&(a[t].child_runs=r[t]);return e}async *listRuns(e){let{projectId:t,projectName:r,parentRunId:a,traceId:n,referenceExampleId:i,startTime:s,executionOrder:o,isRoot:l,runType:u,error:d,id:c,query:h,filter:p,traceFilter:f,treeFilter:m,limit:g,select:y}=e,b=[];if(t&&(b=Array.isArray(t)?t:[t]),r){let e=Array.isArray(r)?r:[r],t=await Promise.all(e.map(e=>this.readProject({projectName:e}).then(e=>e.id)));b.push(...t)}let _={session:b.length?b:null,run_type:u,reference_example:i,query:h,filter:p,trace_filter:f,tree_filter:m,execution_order:o,parent_run:a,start_time:s?s.toISOString():null,error:d,id:c,limit:g,trace:n,select:y||["app_path","child_run_ids","completion_cost","completion_tokens","dotted_order","end_time","error","events","extra","feedback_stats","first_token_time","id","inputs","name","outputs","parent_run_id","parent_run_ids","prompt_cost","prompt_tokens","reference_example_id","run_type","session_id","start_time","status","tags","total_cost","total_tokens","trace_id"],is_root:l};for await(let e of this._getCursorPaginatedList("/runs/query",_))yield*e}async shareRun(e,{shareId:t}={}){let r={run_id:e,share_token:t||o.Z()};assertUuid(e);let a=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await a.json();if(null===n||!("share_token"in n))throw Error("Invalid response from server");return`${this.getHostUrl()}/public/${n.share_token}/r`}async unshareRun(e){assertUuid(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(t,"unshare run")}async readRunSharedLink(e){assertUuid(e);let t=await this.caller.call(fetch,`${this.apiUrl}/runs/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();if(null!==r&&"share_token"in r)return`${this.getHostUrl()}/public/${r.share_token}/r`}async listSharedRuns(e,{runIds:t}={}){let r=new URLSearchParams({share_token:e});if(void 0!==t)for(let e of t)r.append("id",e);assertUuid(e);let a=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/runs${r}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await a.json();return n}async readDatasetSharedSchema(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");if(!e){let r=await this.readDataset({datasetName:t});e=r.id}assertUuid(e);let r=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),a=await r.json();return a.url=`${this.getHostUrl()}/public/${a.share_token}/d`,a}async shareDataset(e,t){if(!e&&!t)throw Error("Either datasetId or datasetName must be given");if(!e){let r=await this.readDataset({datasetName:t});e=r.id}let r={dataset_id:e};assertUuid(e);let a=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"PUT",headers:this.headers,body:JSON.stringify(r),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),n=await a.json();return n.url=`${this.getHostUrl()}/public/${n.share_token}/d`,n}async unshareDataset(e){assertUuid(e);let t=await this.caller.call(fetch,`${this.apiUrl}/datasets/${e}/share`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(t,"unshare dataset")}async readSharedDataset(e){assertUuid(e);let t=await this.caller.call(fetch,`${this.apiUrl}/public/${e}/datasets`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),r=await t.json();return r}async createProject({projectName:e,description:t=null,metadata:r=null,upsert:a=!1,projectExtra:n=null,referenceDatasetId:i=null}){let s=`${this.apiUrl}/sessions${a?"?upsert=true":""}`,o=n||{};r&&(o.metadata=r);let l={name:e,extra:o,description:t};null!==i&&(l.reference_dataset_id=i);let u=await this.caller.call(fetch,s,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await u.json();if(!u.ok)throw Error(`Failed to create session ${e}: ${u.status} ${u.statusText}`);return d}async updateProject(e,{name:t=null,description:r=null,metadata:a=null,projectExtra:n=null,endTime:i=null}){let s=`${this.apiUrl}/sessions/${e}`,o=n;a&&(o={...o||{},metadata:a});let l={name:t,extra:o,description:r,end_time:i?new Date(i).toISOString():null},u=await this.caller.call(fetch,s,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(l),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),d=await u.json();if(!u.ok)throw Error(`Failed to update project ${e}: ${u.status} ${u.statusText}`);return d}async hasProject({projectId:e,projectName:t}){let r="/sessions",a=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)assertUuid(e),r+=`/${e}`;else if(void 0!==t)a.append("name",t);else throw Error("Must provide projectName or projectId");let n=await this.caller.call(fetch,`${this.apiUrl}${r}?${a}`,{method:"GET",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});try{let e=await n.json();if(!n.ok)return!1;if(Array.isArray(e))return e.length>0;return!0}catch(e){return!1}}async readProject({projectId:e,projectName:t,includeStats:r}){let a,n="/sessions",i=new URLSearchParams;if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");if(void 0!==e)assertUuid(e),n+=`/${e}`;else if(void 0!==t)i.append("name",t);else throw Error("Must provide projectName or projectId");void 0!==r&&i.append("include_stats",r.toString());let s=await this._get(n,i);if(Array.isArray(s)){if(0===s.length)throw Error(`Project[id=${e}, name=${t}] not found`);a=s[0]}else a=s;return a}async _getTenantId(){if(null!==this._tenantId)return this._tenantId;let e=new URLSearchParams({limit:"1"});for await(let t of this._getPaginated("/sessions",e))return this._tenantId=t[0].tenant_id,t[0].tenant_id;throw Error("No projects found to resolve tenant.")}async *listProjects({projectIds:e,name:t,nameContains:r,referenceDatasetId:a,referenceDatasetName:n,referenceFree:i}={}){let s=new URLSearchParams;if(void 0!==e)for(let t of e)s.append("id",t);if(void 0!==t&&s.append("name",t),void 0!==r&&s.append("name_contains",r),void 0!==a)s.append("reference_dataset",a);else if(void 0!==n){let e=await this.readDataset({datasetName:n});s.append("reference_dataset",e.id)}for await(let e of(void 0!==i&&s.append("reference_free",i.toString()),this._getPaginated("/sessions",s)))yield*e}async deleteProject({projectId:e,projectName:t}){let r;if(void 0===e&&void 0===t)throw Error("Must provide projectName or projectId");if(void 0!==e&&void 0!==t)throw Error("Must provide either projectName or projectId, not both");assertUuid(r=void 0===e?(await this.readProject({projectName:t})).id:e);let a=await this.caller.call(fetch,`${this.apiUrl}/sessions/${r}`,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(a,`delete session ${r} (${t})`)}async uploadCsv({csvFile:e,fileName:t,inputKeys:r,outputKeys:a,description:n,dataType:i,name:s}){let o=`${this.apiUrl}/datasets/upload`,l=new FormData;l.append("file",e,t),r.forEach(e=>{l.append("input_keys",e)}),a.forEach(e=>{l.append("output_keys",e)}),n&&l.append("description",n),i&&l.append("data_type",i),s&&l.append("name",s);let u=await this.caller.call(fetch,o,{method:"POST",headers:this.headers,body:l,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!u.ok){let e=await u.json();if(e.detail&&e.detail.includes("already exists"))throw Error(`Dataset ${t} already exists`);throw Error(`Failed to upload CSV: ${u.status} ${u.statusText}`)}let d=await u.json();return d}async createDataset(e,{description:t,dataType:r}={}){let a={name:e,description:t};r&&(a.data_type=r);let n=await this.caller.call(fetch,`${this.apiUrl}/datasets`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(a),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok){let t=await n.json();if(t.detail&&t.detail.includes("already exists"))throw Error(`Dataset ${e} already exists`);throw Error(`Failed to create dataset ${n.status} ${n.statusText}`)}let i=await n.json();return i}async readDataset({datasetId:e,datasetName:t}){let r,a="/datasets",n=new URLSearchParams({limit:"1"});if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)assertUuid(e),a+=`/${e}`;else if(void 0!==t)n.append("name",t);else throw Error("Must provide datasetName or datasetId");let i=await this._get(a,n);if(Array.isArray(i)){if(0===i.length)throw Error(`Dataset[id=${e}, name=${t}] not found`);r=i[0]}else r=i;return r}async diffDatasetVersions({datasetId:e,datasetName:t,fromVersion:r,toVersion:a}){let n=e;if(void 0===n&&void 0===t)throw Error("Must provide either datasetName or datasetId");if(void 0!==n&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===n){let e=await this.readDataset({datasetName:t});n=e.id}let i=new URLSearchParams({from_version:"string"==typeof r?r:r.toISOString(),to_version:"string"==typeof a?a:a.toISOString()}),s=await this._get(`/datasets/${n}/versions/diff`,i);return s}async readDatasetOpenaiFinetuning({datasetId:e,datasetName:t}){if(void 0!==e);else if(void 0!==t)e=(await this.readDataset({datasetName:t})).id;else throw Error("Must provide datasetName or datasetId");let r=await this._getResponse(`/datasets/${e}/openai_ft`),a=await r.text(),n=a.trim().split("\n").map(e=>JSON.parse(e));return n}async *listDatasets({limit:e=100,offset:t=0,datasetIds:r,datasetName:a,datasetNameContains:n}={}){let i=new URLSearchParams({limit:e.toString(),offset:t.toString()});if(void 0!==r)for(let e of r)i.append("id",e);for await(let e of(void 0!==a&&i.append("name",a),void 0!==n&&i.append("name_contains",n),this._getPaginated("/datasets",i)))yield*e}async deleteDataset({datasetId:e,datasetName:t}){let r="/datasets",a=e;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==t){let e=await this.readDataset({datasetName:t});a=e.id}if(void 0!==a)assertUuid(a),r+=`/${a}`;else throw Error("Must provide datasetName or datasetId");let n=await this.caller.call(fetch,this.apiUrl+r,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!n.ok)throw Error(`Failed to delete ${r}: ${n.status} ${n.statusText}`);await n.json()}async createExample(e,t,{datasetId:r,datasetName:a,createdAt:n,exampleId:i,metadata:s}){let o=r;if(void 0===o&&void 0===a)throw Error("Must provide either datasetName or datasetId");if(void 0!==o&&void 0!==a)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===o){let e=await this.readDataset({datasetName:a});o=e.id}let l=n||new Date,u={dataset_id:o,inputs:e,outputs:t,created_at:l?.toISOString(),id:i,metadata:s},d=await this.caller.call(fetch,`${this.apiUrl}/examples`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw Error(`Failed to create example: ${d.status} ${d.statusText}`);let c=await d.json();return c}async createExamples(e){let{inputs:t,outputs:r,metadata:a,sourceRunIds:n,exampleIds:i,datasetId:s,datasetName:o}=e,l=s;if(void 0===l&&void 0===o)throw Error("Must provide either datasetName or datasetId");if(void 0!==l&&void 0!==o)throw Error("Must provide either datasetName or datasetId, not both");if(void 0===l){let e=await this.readDataset({datasetName:o});l=e.id}let u=t.map((e,t)=>({dataset_id:l,inputs:e,outputs:r?r[t]:void 0,metadata:a?a[t]:void 0,id:i?i[t]:void 0,source_run_id:n?n[t]:void 0})),d=await this.caller.call(fetch,`${this.apiUrl}/examples/bulk`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(u),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!d.ok)throw Error(`Failed to create examples: ${d.status} ${d.statusText}`);let c=await d.json();return c}async createLLMExample(e,t,r){return this.createExample({input:e},{output:t},r)}async createChatExample(e,t,r){let a=e.map(e=>isLangChainMessage(e)?convertLangChainMessageToExample(e):e),n=isLangChainMessage(t)?convertLangChainMessageToExample(t):t;return this.createExample({input:a},{output:n},r)}async readExample(e){assertUuid(e);let t=`/examples/${e}`;return await this._get(t)}async *listExamples({datasetId:e,datasetName:t,exampleIds:r,asOf:a,inlineS3Urls:n}={}){let i;if(void 0!==e&&void 0!==t)throw Error("Must provide either datasetName or datasetId, not both");if(void 0!==e)i=e;else if(void 0!==t){let e=await this.readDataset({datasetName:t});i=e.id}else throw Error("Must provide a datasetName or datasetId");let s=new URLSearchParams({dataset:i}),o=a?"string"==typeof a?a:a?.toISOString():void 0;if(o&&s.append("as_of",o),s.append("inline_s3_urls",(n??!0).toString()),void 0!==r)for(let e of r)s.append("id",e);for await(let e of this._getPaginated("/examples",s))yield*e}async deleteExample(e){assertUuid(e);let t=`/examples/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async updateExample(e,t){assertUuid(e);let r=await this.caller.call(fetch,`${this.apiUrl}/examples/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(t),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw Error(`Failed to update example ${e}: ${r.status} ${r.statusText}`);let a=await r.json();return a}async evaluateRun(e,t,{sourceInfo:r,loadChildRuns:a,referenceExample:n}={loadChildRuns:!1}){let i;if("string"==typeof e)i=await this.readRun(e,{loadChildRuns:a});else if("object"==typeof e&&"id"in e)i=e;else throw Error(`Invalid run type: ${typeof e}`);null!==i.reference_example_id&&void 0!==i.reference_example_id&&(n=await this.readExample(i.reference_example_id));let s=await t.evaluateRun(i,n),o=r??{};s.evaluatorInfo&&(o={...o,...s.evaluatorInfo});let l=s.targetRunId??i.id;return await this.createFeedback(l,s.key,{score:s?.score,value:s?.value,comment:s?.comment,correction:s?.correction,sourceInfo:o,feedbackSourceType:"model",sourceRunId:s?.sourceRunId})}async createFeedback(e,t,{score:r,value:a,correction:n,comment:i,sourceInfo:s,feedbackSourceType:l="api",sourceRunId:u,feedbackId:d,feedbackConfig:c}){let h={type:l??"api",metadata:s??{}};void 0===u||h?.metadata===void 0||h.metadata.__run||(h.metadata.__run={run_id:u}),h?.metadata!==void 0&&h.metadata.__run?.run_id!==void 0&&assertUuid(h.metadata.__run.run_id);let p={id:d??o.Z(),run_id:e,key:t,score:r,value:a,correction:n,comment:i,feedback_source:h,feedbackConfig:c},f=`${this.apiUrl}/feedback`,m=await this.caller.call(fetch,f,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(p),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});return await raiseForStatus(m,"create feedback"),p}async updateFeedback(e,{score:t,value:r,correction:a,comment:n}){let i={};null!=t&&(i.score=t),null!=r&&(i.value=r),null!=a&&(i.correction=a),null!=n&&(i.comment=n),assertUuid(e);let s=await this.caller.call(fetch,`${this.apiUrl}/feedback/${e}`,{method:"PATCH",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});await raiseForStatus(s,"update feedback")}async readFeedback(e){assertUuid(e);let t=`/feedback/${e}`,r=await this._get(t);return r}async deleteFeedback(e){assertUuid(e);let t=`/feedback/${e}`,r=await this.caller.call(fetch,this.apiUrl+t,{method:"DELETE",headers:this.headers,signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions});if(!r.ok)throw Error(`Failed to delete ${t}: ${r.status} ${r.statusText}`);await r.json()}async *listFeedback({runIds:e,feedbackKeys:t,feedbackSourceTypes:r}={}){let a=new URLSearchParams;if(e&&a.append("run",e.join(",")),t)for(let e of t)a.append("key",e);if(r)for(let e of r)a.append("source",e);for await(let e of this._getPaginated("/feedback",a))yield*e}async createPresignedFeedbackToken(e,t,{expiration:r,feedbackConfig:a}={}){let n={run_id:e,feedback_key:t,feedback_config:a};r?"string"==typeof r?n.expires_at=r:(r?.hours||r?.minutes||r?.days)&&(n.expires_in=r):n.expires_in={hours:3};let i=await this.caller.call(fetch,`${this.apiUrl}/feedback/tokens`,{method:"POST",headers:{...this.headers,"Content-Type":"application/json"},body:JSON.stringify(n),signal:AbortSignal.timeout(this.timeout_ms),...this.fetchOptions}),s=await i.json();return s}async *listPresignedFeedbackTokens(e){assertUuid(e);let t=new URLSearchParams({run_id:e});for await(let e of this._getPaginated("/feedback/tokens",t))yield*e}};let b="0.1.20";var _=r(298);let tracer_langchain_LangChainTracer=class tracer_langchain_LangChainTracer extends d.Z{constructor(e={}){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"langchain_tracer"}),Object.defineProperty(this,"projectName",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"exampleId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"client",{enumerable:!0,configurable:!0,writable:!0,value:void 0});let{exampleId:t,projectName:r,client:a}=e;this.projectName=r??(0,_.lS)("LANGCHAIN_PROJECT")??(0,_.lS)("LANGCHAIN_SESSION"),this.exampleId=t,this.client=a??new client_Client({})}async _convertToCreate(e,t){return{...e,extra:{...e.extra,runtime:await (0,_.sA)()},child_runs:void 0,session_name:this.projectName,reference_example_id:e.parent_run_id?void 0:t}}async persistRun(e){}async onRunCreate(e){let t=await this._convertToCreate(e,this.exampleId);await this.client.createRun(t)}async onRunUpdate(e){let t={end_time:e.end_time,error:e.error,outputs:e.outputs,events:e.events,inputs:e.inputs,trace_id:e.trace_id,dotted_order:e.dotted_order,parent_run_id:e.parent_run_id};await this.client.updateRun(e.id,t)}getRun(e){return this.runMap.get(e)}};var v=r(3478);async function getTracingV2CallbackHandler(){return new tracer_langchain_LangChainTracer}function createQueue(){let e=f.default;return new e({autoStart:!0,concurrency:1})}async function consumeCallback(e,t){!0===t?await e():(void 0===s&&(s=createQueue()),s.add(e))}function parseCallbackConfigArg(e){return e?Array.isArray(e)||"name"in e?{callbacks:e}:e:{}}let BaseCallbackManager=class BaseCallbackManager{setHandler(e){return this.setHandlers([e])}};let BaseRunManager=class BaseRunManager{constructor(e,t,r,a,n,i,s,o){Object.defineProperty(this,"runId",{enumerable:!0,configurable:!0,writable:!0,value:e}),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:i}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:s}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:o})}async handleText(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{try{await t.handleText?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleText: ${e}`)}},t.awaitHandlers)))}};let CallbackManagerForRetrieverRun=class CallbackManagerForRetrieverRun extends BaseRunManager{getChild(e){let t=new CallbackManager(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleRetrieverEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetriever`)}},t.awaitHandlers)))}async handleRetrieverError(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreRetriever)try{await t.handleRetrieverError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleRetrieverError: ${e}`)}},t.awaitHandlers)))}};let CallbackManagerForLLMRun=class CallbackManagerForLLMRun extends BaseRunManager{async handleLLMNewToken(e,t,r,a,n,i){await Promise.all(this.handlers.map(r=>consumeCallback(async()=>{if(!r.ignoreLLM)try{await r.handleLLMNewToken?.(e,t??{prompt:0,completion:0},this.runId,this._parentRunId,this.tags,i)}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMNewToken: ${e}`)}},r.awaitHandlers)))}async handleLLMError(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreLLM)try{await t.handleLLMError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMError: ${e}`)}},t.awaitHandlers)))}async handleLLMEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreLLM)try{await t.handleLLMEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleLLMEnd: ${e}`)}},t.awaitHandlers)))}};let CallbackManagerForChainRun=class CallbackManagerForChainRun extends BaseRunManager{getChild(e){let t=new CallbackManager(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleChainError(e,t,r,a,n){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreChain)try{await t.handleChainError?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainError: ${e}`)}},t.awaitHandlers)))}async handleChainEnd(e,t,r,a,n){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreChain)try{await t.handleChainEnd?.(e,this.runId,this._parentRunId,this.tags,n)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleChainEnd: ${e}`)}},t.awaitHandlers)))}async handleAgentAction(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreAgent)try{await t.handleAgentAction?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentAction: ${e}`)}},t.awaitHandlers)))}async handleAgentEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreAgent)try{await t.handleAgentEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleAgentEnd: ${e}`)}},t.awaitHandlers)))}};let CallbackManagerForToolRun=class CallbackManagerForToolRun extends BaseRunManager{getChild(e){let t=new CallbackManager(this.runId);return t.setHandlers(this.inheritableHandlers),t.addTags(this.inheritableTags),t.addMetadata(this.inheritableMetadata),e&&t.addTags([e],!1),t}async handleToolError(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreAgent)try{await t.handleToolError?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolError: ${e}`)}},t.awaitHandlers)))}async handleToolEnd(e){await Promise.all(this.handlers.map(t=>consumeCallback(async()=>{if(!t.ignoreAgent)try{await t.handleToolEnd?.(e,this.runId,this._parentRunId,this.tags)}catch(e){console.error(`Error in handler ${t.constructor.name}, handleToolEnd: ${e}`)}},t.awaitHandlers)))}};let CallbackManager=class CallbackManager extends BaseCallbackManager{constructor(e,t){super(),Object.defineProperty(this,"handlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableHandlers",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"inheritableTags",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"inheritableMetadata",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"callback_manager"}),Object.defineProperty(this,"_parentRunId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.handlers=t?.handlers??this.handlers,this.inheritableHandlers=t?.inheritableHandlers??this.inheritableHandlers,this.tags=t?.tags??this.tags,this.inheritableTags=t?.inheritableTags??this.inheritableTags,this.metadata=t?.metadata??this.metadata,this.inheritableMetadata=t?.inheritableMetadata??this.inheritableMetadata,this._parentRunId=e}getParentRunId(){return this._parentRunId}async handleLLMStart(e,t,r,a,n,i,s,l){return Promise.all(t.map(async(t,a)=>{let i=0===a&&r?r:(0,o.Z)();return await Promise.all(this.handlers.map(r=>consumeCallback(async()=>{if(!r.ignoreLLM)try{await r.handleLLMStart?.(e,[t],i,this._parentRunId,n,this.tags,this.metadata,l)}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`)}},r.awaitHandlers))),new CallbackManagerForLLMRun(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChatModelStart(e,t,r,a,n,i,s,l){return Promise.all(t.map(async(t,a)=>{let i=0===a&&r?r:(0,o.Z)();return await Promise.all(this.handlers.map(r=>consumeCallback(async()=>{if(!r.ignoreLLM)try{if(r.handleChatModelStart)await r.handleChatModelStart?.(e,[t],i,this._parentRunId,n,this.tags,this.metadata,l);else if(r.handleLLMStart){let a=(0,v.zs)(t);await r.handleLLMStart?.(e,[a],i,this._parentRunId,n,this.tags,this.metadata,l)}}catch(e){console.error(`Error in handler ${r.constructor.name}, handleLLMStart: ${e}`)}},r.awaitHandlers))),new CallbackManagerForLLMRun(i,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}))}async handleChainStart(e,t,r=(0,o.Z)(),a,n,i,s){return await Promise.all(this.handlers.map(n=>consumeCallback(async()=>{if(!n.ignoreChain)try{await n.handleChainStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,a,s)}catch(e){console.error(`Error in handler ${n.constructor.name}, handleChainStart: ${e}`)}},n.awaitHandlers))),new CallbackManagerForChainRun(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleToolStart(e,t,r=(0,o.Z)(),a,n,i,s){return await Promise.all(this.handlers.map(a=>consumeCallback(async()=>{if(!a.ignoreAgent)try{await a.handleToolStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleToolStart: ${e}`)}},a.awaitHandlers))),new CallbackManagerForToolRun(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}async handleRetrieverStart(e,t,r=(0,o.Z)(),a,n,i,s){return await Promise.all(this.handlers.map(a=>consumeCallback(async()=>{if(!a.ignoreRetriever)try{await a.handleRetrieverStart?.(e,t,r,this._parentRunId,this.tags,this.metadata,s)}catch(e){console.error(`Error in handler ${a.constructor.name}, handleRetrieverStart: ${e}`)}},a.awaitHandlers))),new CallbackManagerForRetrieverRun(r,this.handlers,this.inheritableHandlers,this.tags,this.inheritableTags,this.metadata,this.inheritableMetadata,this._parentRunId)}addHandler(e,t=!0){this.handlers.push(e),t&&this.inheritableHandlers.push(e)}removeHandler(e){this.handlers=this.handlers.filter(t=>t!==e),this.inheritableHandlers=this.inheritableHandlers.filter(t=>t!==e)}setHandlers(e,t=!0){for(let r of(this.handlers=[],this.inheritableHandlers=[],e))this.addHandler(r,t)}addTags(e,t=!0){this.removeTags(e),this.tags.push(...e),t&&this.inheritableTags.push(...e)}removeTags(e){this.tags=this.tags.filter(t=>!e.includes(t)),this.inheritableTags=this.inheritableTags.filter(t=>!e.includes(t))}addMetadata(e,t=!0){this.metadata={...this.metadata,...e},t&&(this.inheritableMetadata={...this.inheritableMetadata,...e})}removeMetadata(e){for(let t of Object.keys(e))delete this.metadata[t],delete this.inheritableMetadata[t]}copy(e=[],t=!0){let r=new CallbackManager(this._parentRunId);for(let e of this.handlers){let t=this.inheritableHandlers.includes(e);r.addHandler(e,t)}for(let e of this.tags){let t=this.inheritableTags.includes(e);r.addTags([e],t)}for(let e of Object.keys(this.metadata)){let t=Object.keys(this.inheritableMetadata).includes(e);r.addMetadata({[e]:this.metadata[e]},t)}for(let a of e)r.handlers.filter(e=>"console_callback_handler"===e.name).some(e=>e.name===a.name)||r.addHandler(a,t);return r}static fromHandlers(e){let Handler=class Handler extends l.E{constructor(){super(),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:(0,o.Z)()}),Object.assign(this,e)}};let t=new this;return t.addHandler(new Handler),t}static async configure(e,t,r,a,n,i,s){let o;(e||t)&&(Array.isArray(e)||!e?(o=new CallbackManager).setHandlers(e?.map(ensureHandler)??[],!0):o=e,o=o.copy(Array.isArray(t)?t.map(ensureHandler):t?.handlers,!1));let l="true"===(0,_.lS)("LANGCHAIN_VERBOSE")||s?.verbose,u="true"===(0,_.lS)("LANGCHAIN_TRACING_V2"),d=u||((0,_.lS)("LANGCHAIN_TRACING")??!1);if(l||d){if(o||(o=new CallbackManager),l&&!o.handlers.some(e=>e.name===ConsoleCallbackHandler.prototype.name)){let e=new ConsoleCallbackHandler;o.addHandler(e,!0)}d&&!o.handlers.some(e=>"langchain_tracer"===e.name)&&u&&o.addHandler(await getTracingV2CallbackHandler(),!0)}return(r||a)&&o&&(o.addTags(r??[]),o.addTags(a??[],!1)),(n||i)&&o&&(o.addMetadata(n??{}),o.addMetadata(i??{},!1)),o}};function ensureHandler(e){return"name"in e?e:l.E.fromMethods(e)}},7610:function(e,t,r){"use strict";r.d(t,{BD:function(){return BaseLangChain},qV:function(){return BaseLanguageModel}});/*
 * [js-sha1]{@link https://github.com/emn178/js-sha1}
 *
 * @version 0.6.0
 * @author Chen, Yi-Cyuan [emn178@gmail.com]
 * @copyright Chen, Yi-Cyuan 2014-2017
 * @license MIT
 */var a,n,i,s="object"==typeof window?window:{},o="0123456789abcdef".split(""),l=[-2147483648,8388608,32768,128],u=[24,16,8,0],d=[];function Sha1(e){e?(d[0]=d[16]=d[1]=d[2]=d[3]=d[4]=d[5]=d[6]=d[7]=d[8]=d[9]=d[10]=d[11]=d[12]=d[13]=d[14]=d[15]=0,this.blocks=d):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],this.h0=1732584193,this.h1=4023233417,this.h2=2562383102,this.h3=271733878,this.h4=3285377520,this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0}Sha1.prototype.update=function(e){if(!this.finalized){var t="string"!=typeof e;t&&e.constructor===s.ArrayBuffer&&(e=new Uint8Array(e));for(var r,a,n=0,i=e.length||0,o=this.blocks;n<i;){if(this.hashed&&(this.hashed=!1,o[0]=this.block,o[16]=o[1]=o[2]=o[3]=o[4]=o[5]=o[6]=o[7]=o[8]=o[9]=o[10]=o[11]=o[12]=o[13]=o[14]=o[15]=0),t)for(a=this.start;n<i&&a<64;++n)o[a>>2]|=e[n]<<u[3&a++];else for(a=this.start;n<i&&a<64;++n)(r=e.charCodeAt(n))<128?o[a>>2]|=r<<u[3&a++]:(r<2048?o[a>>2]|=(192|r>>6)<<u[3&a++]:(r<55296||r>=57344?o[a>>2]|=(224|r>>12)<<u[3&a++]:(r=65536+((1023&r)<<10|1023&e.charCodeAt(++n)),o[a>>2]|=(240|r>>18)<<u[3&a++],o[a>>2]|=(128|r>>12&63)<<u[3&a++]),o[a>>2]|=(128|r>>6&63)<<u[3&a++]),o[a>>2]|=(128|63&r)<<u[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=o[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha1.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=l[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha1.prototype.hash=function(){var e,t,r,a=this.h0,n=this.h1,i=this.h2,s=this.h3,o=this.h4,l=this.blocks;for(t=16;t<80;++t)r=l[t-3]^l[t-8]^l[t-14]^l[t-16],l[t]=r<<1|r>>>31;for(t=0;t<20;t+=5)e=n&i|~n&s,o=(r=a<<5|a>>>27)+e+o+1518500249+l[t]<<0,e=a&(n=n<<30|n>>>2)|~a&i,s=(r=o<<5|o>>>27)+e+s+1518500249+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|~o&n,i=(r=s<<5|s>>>27)+e+i+1518500249+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|~s&a,n=(r=i<<5|i>>>27)+e+n+1518500249+l[t+3]<<0,e=i&(s=s<<30|s>>>2)|~i&o,a=(r=n<<5|n>>>27)+e+a+1518500249+l[t+4]<<0,i=i<<30|i>>>2;for(;t<40;t+=5)e=n^i^s,o=(r=a<<5|a>>>27)+e+o+1859775393+l[t]<<0,e=a^(n=n<<30|n>>>2)^i,s=(r=o<<5|o>>>27)+e+s+1859775393+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^n,i=(r=s<<5|s>>>27)+e+i+1859775393+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^a,n=(r=i<<5|i>>>27)+e+n+1859775393+l[t+3]<<0,e=i^(s=s<<30|s>>>2)^o,a=(r=n<<5|n>>>27)+e+a+1859775393+l[t+4]<<0,i=i<<30|i>>>2;for(;t<60;t+=5)e=n&i|n&s|i&s,o=(r=a<<5|a>>>27)+e+o-1894007588+l[t]<<0,e=a&(n=n<<30|n>>>2)|a&i|n&i,s=(r=o<<5|o>>>27)+e+s-1894007588+l[t+1]<<0,e=o&(a=a<<30|a>>>2)|o&n|a&n,i=(r=s<<5|s>>>27)+e+i-1894007588+l[t+2]<<0,e=s&(o=o<<30|o>>>2)|s&a|o&a,n=(r=i<<5|i>>>27)+e+n-1894007588+l[t+3]<<0,e=i&(s=s<<30|s>>>2)|i&o|s&o,a=(r=n<<5|n>>>27)+e+a-1894007588+l[t+4]<<0,i=i<<30|i>>>2;for(;t<80;t+=5)e=n^i^s,o=(r=a<<5|a>>>27)+e+o-899497514+l[t]<<0,e=a^(n=n<<30|n>>>2)^i,s=(r=o<<5|o>>>27)+e+s-899497514+l[t+1]<<0,e=o^(a=a<<30|a>>>2)^n,i=(r=s<<5|s>>>27)+e+i-899497514+l[t+2]<<0,e=s^(o=o<<30|o>>>2)^a,n=(r=i<<5|i>>>27)+e+n-899497514+l[t+3]<<0,e=i^(s=s<<30|s>>>2)^o,a=(r=n<<5|n>>>27)+e+a-899497514+l[t+4]<<0,i=i<<30|i>>>2;this.h0=this.h0+a<<0,this.h1=this.h1+n<<0,this.h2=this.h2+i<<0,this.h3=this.h3+s<<0,this.h4=this.h4+o<<0},Sha1.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return o[e>>28&15]+o[e>>24&15]+o[e>>20&15]+o[e>>16&15]+o[e>>12&15]+o[e>>8&15]+o[e>>4&15]+o[15&e]+o[t>>28&15]+o[t>>24&15]+o[t>>20&15]+o[t>>16&15]+o[t>>12&15]+o[t>>8&15]+o[t>>4&15]+o[15&t]+o[r>>28&15]+o[r>>24&15]+o[r>>20&15]+o[r>>16&15]+o[r>>12&15]+o[r>>8&15]+o[r>>4&15]+o[15&r]+o[a>>28&15]+o[a>>24&15]+o[a>>20&15]+o[a>>16&15]+o[a>>12&15]+o[a>>8&15]+o[a>>4&15]+o[15&a]+o[n>>28&15]+o[n>>24&15]+o[n>>20&15]+o[n>>16&15]+o[n>>12&15]+o[n>>8&15]+o[n>>4&15]+o[15&n]},Sha1.prototype.toString=Sha1.prototype.hex,Sha1.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,a=this.h3,n=this.h4;return[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,a>>24&255,a>>16&255,a>>8&255,255&a,n>>24&255,n>>16&255,n>>8&255,255&n]},Sha1.prototype.array=Sha1.prototype.digest,Sha1.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(20),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),e};let insecureHash=e=>new Sha1(!0).update(e).hex();var c=r(3478);let getCacheKey=(...e)=>insecureHash(e.join("_"));let BaseCache=class BaseCache{};let h=new Map;let InMemoryCache=class InMemoryCache extends BaseCache{constructor(e){super(),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.cache=e??new Map}lookup(e,t){return Promise.resolve(this.cache.get(getCacheKey(e,t))??null)}async update(e,t,r){this.cache.set(getCacheKey(e,t),r)}static global(){return new InMemoryCache(h)}};var p=r(4697),f=r(3830),m=r(1226),g=Object.defineProperty;function bytePairMerge(e,t){let r=Array.from({length:e.length},(e,t)=>({start:t,end:t+1}));for(;r.length>1;){let a=null;for(let n=0;n<r.length-1;n++){let i=e.slice(r[n].start,r[n+1].end),s=t.get(i.join(","));null!=s&&(null==a||s<a[0])&&(a=[s,n])}if(null!=a){let e=a[1];r[e]={start:r[e].start,end:r[e+1].end},r.splice(e+1,1)}else break}return r}function bytePairEncode(e,t){return 1===e.length?[t.get(e.join(","))]:bytePairMerge(e,t).map(r=>t.get(e.slice(r.start,r.end).join(","))).filter(e=>null!=e)}function escapeRegex(e){return e.replace(/[\\^$*+?.()|[\]{}]/g,"\\$&")}var y=class{specialTokens;inverseSpecialTokens;patStr;textEncoder=new TextEncoder;textDecoder=new TextDecoder("utf-8");rankMap=new Map;textMap=new Map;constructor(e,t){this.patStr=e.pat_str;let r=e.bpe_ranks.split("\n").filter(Boolean).reduce((e,t)=>{let[r,a,...n]=t.split(" "),i=Number.parseInt(a,10);return n.forEach((t,r)=>e[t]=i+r),e},{});for(let[e,t]of Object.entries(r)){let r=m.toByteArray(e);this.rankMap.set(r.join(","),t),this.textMap.set(t,r)}this.specialTokens={...e.special_tokens,...t},this.inverseSpecialTokens=Object.entries(this.specialTokens).reduce((e,[t,r])=>(e[r]=this.textEncoder.encode(t),e),{})}encode(e,t=[],r="all"){let a=RegExp(this.patStr,"ug"),n=y.specialTokenRegex(Object.keys(this.specialTokens)),i=[],s=new Set("all"===t?Object.keys(this.specialTokens):t),o=new Set("all"===r?Object.keys(this.specialTokens).filter(e=>!s.has(e)):r);if(o.size>0){let t=y.specialTokenRegex([...o]),r=e.match(t);if(null!=r)throw Error(`The text contains a special token that is not allowed: ${r[0]}`)}let l=0;for(;;){let t=null,r=l;for(;n.lastIndex=r,!(null==(t=n.exec(e))||s.has(t[0]));)r=t.index+1;let o=t?.index??e.length;for(let t of e.substring(l,o).matchAll(a)){let e=this.textEncoder.encode(t[0]),r=this.rankMap.get(e.join(","));if(null!=r){i.push(r);continue}i.push(...bytePairEncode(e,this.rankMap))}if(null==t)break;let u=this.specialTokens[t[0]];i.push(u),l=t.index+t[0].length}return i}decode(e){let t=[],r=0;for(let a=0;a<e.length;++a){let n=e[a],i=this.textMap.get(n)??this.inverseSpecialTokens[n];null!=i&&(t.push(i),r+=i.length)}let a=new Uint8Array(r),n=0;for(let e of t)a.set(e,n),n+=e.length;return this.textDecoder.decode(a)}};function getEncodingNameForModel(e){switch(e){case"gpt2":return"gpt2";case"code-cushman-001":case"code-cushman-002":case"code-davinci-001":case"code-davinci-002":case"cushman-codex":case"davinci-codex":case"davinci-002":case"text-davinci-002":case"text-davinci-003":return"p50k_base";case"code-davinci-edit-001":case"text-davinci-edit-001":return"p50k_edit";case"ada":case"babbage":case"babbage-002":case"code-search-ada-code-001":case"code-search-babbage-code-001":case"curie":case"davinci":case"text-ada-001":case"text-babbage-001":case"text-curie-001":case"text-davinci-001":case"text-search-ada-doc-001":case"text-search-babbage-doc-001":case"text-search-curie-doc-001":case"text-search-davinci-doc-001":case"text-similarity-ada-001":case"text-similarity-babbage-001":case"text-similarity-curie-001":case"text-similarity-davinci-001":return"r50k_base";case"gpt-3.5-turbo-instruct-0914":case"gpt-3.5-turbo-instruct":case"gpt-3.5-turbo-16k-0613":case"gpt-3.5-turbo-16k":case"gpt-3.5-turbo-0613":case"gpt-3.5-turbo-0301":case"gpt-3.5-turbo":case"gpt-4-32k-0613":case"gpt-4-32k-0314":case"gpt-4-32k":case"gpt-4-0613":case"gpt-4-0314":case"gpt-4":case"gpt-3.5-turbo-1106":case"gpt-35-turbo":case"gpt-4-1106-preview":case"gpt-4-vision-preview":case"gpt-3.5-turbo-0125":case"gpt-4-turbo":case"gpt-4-turbo-2024-04-09":case"gpt-4-turbo-preview":case"gpt-4-0125-preview":case"text-embedding-ada-002":return"cl100k_base";default:throw Error("Unknown model")}}a="symbol"!=typeof(i="specialTokenRegex")?i+"":i,n=e=>RegExp(e.map(e=>escapeRegex(e)).join("|"),"g"),a in y?g(y,a,{enumerable:!0,configurable:!0,writable:!0,value:n}):y[a]=n;let b={},_=new f.L({});async function getEncoding(e){return e in b||(b[e]=_.fetch(`https://tiktoken.pages.dev/js/${e}.json`).then(e=>e.json()).then(e=>new y(e)).catch(t=>{throw delete b[e],t})),await b[e]}async function tiktoken_encodingForModel(e){return getEncoding(getEncodingNameForModel(e))}var v=r(8477);let getModelNameForTiktoken=e=>e.startsWith("gpt-3.5-turbo-16k")?"gpt-3.5-turbo-16k":e.startsWith("gpt-3.5-turbo-")?"gpt-3.5-turbo":e.startsWith("gpt-4-32k")?"gpt-4-32k":e.startsWith("gpt-4-")?"gpt-4":e,getVerbosity=()=>!1;let BaseLangChain=class BaseLangChain extends v.eq{get lc_attributes(){return{callbacks:void 0,verbose:void 0}}constructor(e){super(e),Object.defineProperty(this,"verbose",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"callbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"tags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.verbose=e.verbose??getVerbosity(),this.callbacks=e.callbacks,this.tags=e.tags??[],this.metadata=e.metadata??{}}};let BaseLanguageModel=class BaseLanguageModel extends BaseLangChain{get callKeys(){return["stop","timeout","signal","tags","metadata","callbacks"]}constructor({callbacks:e,callbackManager:t,...r}){super({callbacks:e??t,...r}),Object.defineProperty(this,"caller",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"cache",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_encoding",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),"object"==typeof r.cache?this.cache=r.cache:r.cache?this.cache=InMemoryCache.global():this.cache=void 0,this.caller=new f.L(r??{})}async getNumTokens(e){if("string"!=typeof e)return 0;let t=Math.ceil(e.length/4);if(!this._encoding)try{this._encoding=await tiktoken_encodingForModel("modelName"in this?getModelNameForTiktoken(this.modelName):"gpt2")}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}if(this._encoding)try{t=this._encoding.encode(e).length}catch(e){console.warn("Failed to calculate number of tokens, falling back to approximate count",e)}return t}static _convertInputToPromptValue(e){return"string"==typeof e?new p.nw(e):Array.isArray(e)?new p.GU(e.map(c.E1)):e}_identifyingParams(){return{}}_getSerializedCacheKeyParametersForCall(e){let t={...this._identifyingParams(),...e,_type:this._llmType(),_model:this._modelType()},r=Object.entries(t).filter(([e,t])=>void 0!==t),a=r.map(([e,t])=>`${e}:${JSON.stringify(t)}`).sort().join(",");return a}serialize(){return{...this._identifyingParams(),_type:this._llmType(),_model:this._modelType()}}static async deserialize(e){throw Error("Use .toJSON() instead")}}},8498:function(e,t,r){"use strict";r.d(t,{i:function(){return Serializable},j:function(){return get_lc_unique_name}});var a=r(4521);function keyToJson(e,t){return t?.[e]||a(e)}function mapKeys(e,t,r){let a={};for(let n in e)Object.hasOwn(e,n)&&(a[t(n,r)]=e[n]);return a}function shallowCopy(e){return Array.isArray(e)?[...e]:{...e}}function replaceSecrets(e,t){let r=shallowCopy(e);for(let[e,a]of Object.entries(t)){let[t,...n]=e.split(".").reverse(),i=r;for(let e of n.reverse()){if(void 0===i[e])break;i[e]=shallowCopy(i[e]),i=i[e]}void 0!==i[t]&&(i[t]={lc:1,type:"secret",id:[a]})}return r}function get_lc_unique_name(e){let t=Object.getPrototypeOf(e),r="function"==typeof e.lc_name&&("function"!=typeof t.lc_name||e.lc_name()!==t.lc_name());return r?e.lc_name():e.name}r(2455);let Serializable=class Serializable{static lc_name(){return this.name}get lc_id(){return[...this.lc_namespace,get_lc_unique_name(this.constructor)]}get lc_secrets(){}get lc_attributes(){}get lc_aliases(){}constructor(e,...t){Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!1}),Object.defineProperty(this,"lc_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.lc_kwargs=e||{}}toJSON(){if(!this.lc_serializable||this.lc_kwargs instanceof Serializable||"object"!=typeof this.lc_kwargs||Array.isArray(this.lc_kwargs))return this.toJSONNotImplemented();let e={},t={},r=Object.keys(this.lc_kwargs).reduce((e,t)=>(e[t]=t in this?this[t]:this.lc_kwargs[t],e),{});for(let a=Object.getPrototypeOf(this);a;a=Object.getPrototypeOf(a))Object.assign(e,Reflect.get(a,"lc_aliases",this)),Object.assign(t,Reflect.get(a,"lc_secrets",this)),Object.assign(r,Reflect.get(a,"lc_attributes",this));return Object.keys(t).forEach(e=>{let t=this,a=r,[n,...i]=e.split(".").reverse();for(let e of i.reverse()){if(!(e in t)||void 0===t[e])return;e in a&&void 0!==a[e]||("object"==typeof t[e]&&null!=t[e]?a[e]={}:Array.isArray(t[e])&&(a[e]=[])),t=t[e],a=a[e]}n in t&&void 0!==t[n]&&(a[n]=a[n]||t[n])}),{lc:1,type:"constructor",id:this.lc_id,kwargs:mapKeys(Object.keys(t).length?replaceSecrets(r,t):r,keyToJson,e)}}toJSONNotImplemented(){return{lc:1,type:"not_implemented",id:this.lc_id}}}},7708:function(e,t,r){"use strict";r.d(t,{GC:function(){return AIMessageChunk},Z0:function(){return isAIMessage},gY:function(){return AIMessage}});var a=r(2991),n=r(1808),i=r(9033);let AIMessage=class AIMessage extends n.ku{get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls"}}constructor(e,t){let r;if("string"==typeof e)r={content:e,tool_calls:[],invalid_tool_calls:[],additional_kwargs:t??{}};else{r=e;let t=r.additional_kwargs?.tool_calls,a=r.tool_calls;null!=t&&t.length>0&&(void 0===a||0===a.length)&&console.warn("New LangChain packages are available that more efficiently handle tool calling.\n\nPlease upgrade your packages to versions that set message tool calls. e.g., `yarn add @langchain/anthropic`, yarn add @langchain/openai`, etc.");try{if(null!=t&&void 0===a){let[e,a]=(0,i.jC)(t);r.tool_calls=e??[],r.invalid_tool_calls=a??[]}else r.tool_calls=r.tool_calls??[],r.invalid_tool_calls=r.invalid_tool_calls??[]}catch(e){r.tool_calls=[],r.invalid_tool_calls=[]}}super(r),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),"string"!=typeof r&&(this.tool_calls=r.tool_calls??this.tool_calls,this.invalid_tool_calls=r.invalid_tool_calls??this.invalid_tool_calls)}static lc_name(){return"AIMessage"}_getType(){return"ai"}};function isAIMessage(e){return"ai"===e._getType()}let AIMessageChunk=class AIMessageChunk extends n.$k{constructor(e){let t;if("string"==typeof e)t={content:e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else if(void 0===e.tool_call_chunks)t={...e,tool_calls:[],invalid_tool_calls:[],tool_call_chunks:[]};else{let r=[],n=[];for(let t of e.tool_call_chunks){let e={};try{if(e=(0,a.g)(t.args??"{}")??{},"object"!=typeof e||Array.isArray(e))throw Error("Malformed tool call chunk args.");r.push({name:t.name??"",args:e,id:t.id})}catch(e){n.push({name:t.name,args:t.args,id:t.id,error:"Malformed args."})}}t={...e,tool_calls:r,invalid_tool_calls:n}}super(t),Object.defineProperty(this,"tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"invalid_tool_calls",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"tool_call_chunks",{enumerable:!0,configurable:!0,writable:!0,value:[]}),this.tool_call_chunks=t?.tool_call_chunks??this.tool_call_chunks,this.tool_calls=t?.tool_calls??this.tool_calls,this.invalid_tool_calls=t?.invalid_tool_calls??this.invalid_tool_calls}get lc_aliases(){return{...super.lc_aliases,tool_calls:"tool_calls",invalid_tool_calls:"invalid_tool_calls",tool_call_chunks:"tool_call_chunks"}}static lc_name(){return"AIMessageChunk"}_getType(){return"ai"}concat(e){let t={content:(0,n.Wf)(this.content,e.content),additional_kwargs:(0,n.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,n.wv)(this.response_metadata,e.response_metadata),tool_call_chunks:[]};if(void 0!==this.tool_call_chunks||void 0!==e.tool_call_chunks){let r=(0,n.eL)(this.tool_call_chunks,e.tool_call_chunks);void 0!==r&&r.length>0&&(t.tool_call_chunks=r)}return new AIMessageChunk(t)}}},1808:function(e,t,r){"use strict";r.d(t,{$k:function(){return BaseMessageChunk},QW:function(){return isBaseMessage},Wf:function(){return mergeContent},a2:function(){return isBaseMessageChunk},eL:function(){return _mergeLists},ku:function(){return BaseMessage},wv:function(){return _mergeDicts}});var a=r(8498);function mergeContent(e,t){return"string"==typeof e?"string"==typeof t?e+t:[{type:"text",text:e},...t]:Array.isArray(t)?[...e,...t]:[...e,{type:"text",text:t}]}let BaseMessage=class BaseMessage extends a.i{get lc_aliases(){return{additional_kwargs:"additional_kwargs",response_metadata:"response_metadata"}}get text(){return"string"==typeof this.content?this.content:""}constructor(e,t){"string"==typeof e&&(e={content:e,additional_kwargs:t,response_metadata:{}}),e.additional_kwargs||(e.additional_kwargs={}),e.response_metadata||(e.response_metadata={}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","messages"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"content",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"additional_kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"response_metadata",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.content=e.content,this.additional_kwargs=e.additional_kwargs,this.response_metadata=e.response_metadata}toDict(){return{type:this._getType(),data:this.toJSON().kwargs}}};function _mergeDicts(e,t){let r={...e};for(let[e,a]of Object.entries(t))if(null==r[e])r[e]=a;else if(null==a)continue;else if(typeof r[e]!=typeof a||Array.isArray(r[e])!==Array.isArray(a))throw Error(`field[${e}] already exists in the message chunk, but with a different type.`);else if("string"==typeof r[e])r[e]=r[e]+a;else if(Array.isArray(r[e])||"object"!=typeof r[e]){if(Array.isArray(r[e]))r[e]=_mergeLists(r[e],a);else{if(r[e]===a)continue;console.warn(`field[${e}] already exists in this message chunk and value has unsupported type.`)}}else r[e]=_mergeDicts(r[e],a);return r}function _mergeLists(e,t){if(void 0!==e||void 0!==t){if(void 0===e||void 0===t)return e||t;{let r=[...e];for(let e of t)if("object"==typeof e&&"index"in e&&"number"==typeof e.index){let t=r.findIndex(t=>t.index===e.index);-1!==t?r[t]=_mergeDicts(r[t],e):r.push(e)}else r.push(e);return r}}}let BaseMessageChunk=class BaseMessageChunk extends BaseMessage{};function isBaseMessage(e){return"function"==typeof e?._getType}function isBaseMessageChunk(e){return isBaseMessage(e)&&"function"==typeof e.concat}},4630:function(e,t,r){"use strict";r.d(t,{H:function(){return ChatMessageChunk},J:function(){return ChatMessage}});var a=r(1808);let ChatMessage=class ChatMessage extends a.ku{static lc_name(){return"ChatMessage"}static _chatMessageClass(){return ChatMessage}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}static isInstance(e){return"generic"===e._getType()}};let ChatMessageChunk=class ChatMessageChunk extends a.$k{static lc_name(){return"ChatMessageChunk"}constructor(e,t){"string"==typeof e&&(e={content:e,role:t}),super(e),Object.defineProperty(this,"role",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.role=e.role}_getType(){return"generic"}concat(e){return new ChatMessageChunk({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),role:this.role})}}},1434:function(e,t,r){"use strict";r.d(t,{C:function(){return FunctionMessageChunk},T:function(){return FunctionMessage}});var a=r(1808);let FunctionMessage=class FunctionMessage extends a.ku{static lc_name(){return"FunctionMessage"}constructor(e,t){"string"==typeof e&&(e={content:e,name:t}),super(e)}_getType(){return"function"}};let FunctionMessageChunk=class FunctionMessageChunk extends a.$k{static lc_name(){return"FunctionMessageChunk"}_getType(){return"function"}concat(e){return new FunctionMessageChunk({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),name:this.name??""})}}},8470:function(e,t,r){"use strict";r.d(t,{r:function(){return HumanMessageChunk},x:function(){return HumanMessage}});var a=r(1808);let HumanMessage=class HumanMessage extends a.ku{static lc_name(){return"HumanMessage"}_getType(){return"human"}};let HumanMessageChunk=class HumanMessageChunk extends a.$k{static lc_name(){return"HumanMessageChunk"}_getType(){return"human"}concat(e){return new HumanMessageChunk({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata)})}}},3478:function(e,t,r){"use strict";r.d(t,{Cr:function(){return s.C},E1:function(){return u.E1},GC:function(){return a.GC},HD:function(){return i.H},J:function(){return i.J},QW:function(){return n.QW},TN:function(){return s.T},Xz:function(){return d.Xz},Z0:function(){return a.Z0},gY:function(){return a.gY},jN:function(){return l.j},ku:function(){return n.ku},ro:function(){return o.r},xk:function(){return o.x},xq:function(){return l.x},zs:function(){return u.zs}});var a=r(7708),n=r(1808),i=r(4630),s=r(1434),o=r(8470),l=r(2723),u=r(2334),d=r(9033)},2723:function(e,t,r){"use strict";r.d(t,{j:function(){return SystemMessage},x:function(){return SystemMessageChunk}});var a=r(1808);let SystemMessage=class SystemMessage extends a.ku{static lc_name(){return"SystemMessage"}_getType(){return"system"}};let SystemMessageChunk=class SystemMessageChunk extends a.$k{static lc_name(){return"SystemMessageChunk"}_getType(){return"system"}concat(e){return new SystemMessageChunk({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata)})}}},9033:function(e,t,r){"use strict";r.d(t,{Xz:function(){return ToolMessageChunk},jC:function(){return defaultToolCallParser}});var a=r(1808);let ToolMessageChunk=class ToolMessageChunk extends a.$k{constructor(e){super(e),Object.defineProperty(this,"tool_call_id",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.tool_call_id=e.tool_call_id}static lc_name(){return"ToolMessageChunk"}_getType(){return"tool"}concat(e){return new ToolMessageChunk({content:(0,a.Wf)(this.content,e.content),additional_kwargs:(0,a.wv)(this.additional_kwargs,e.additional_kwargs),response_metadata:(0,a.wv)(this.response_metadata,e.response_metadata),tool_call_id:this.tool_call_id})}};function defaultToolCallParser(e){let t=[],r=[];for(let a of e)if(a.function){let e=a.function.name;try{let r=JSON.parse(a.function.arguments),n={name:e||"",args:r||{},id:a.id};t.push(n)}catch(t){r.push({name:e,args:a.function.arguments,id:a.id,error:"Malformed args."})}}return[t,r]}},2334:function(e,t,r){"use strict";r.d(t,{E1:function(){return coerceMessageLikeToMessage},Oy:function(){return convertToChunk},zs:function(){return getBufferString}});var a=r(1808),n=r(8470),i=r(7708),s=r(2723),o=r(4630),l=r(1434);function coerceMessageLikeToMessage(e){if("string"==typeof e)return new n.x(e);if((0,a.QW)(e))return e;let[t,r]=e;if("human"===t||"user"===t)return new n.x({content:r});if("ai"===t||"assistant"===t)return new i.gY({content:r});if("system"===t)return new s.j({content:r});throw Error("Unable to coerce message from array: only human, AI, or system message coercion is currently supported.")}function getBufferString(e,t="Human",r="AI"){let a=[];for(let n of e){let e;if("human"===n._getType())e=t;else if("ai"===n._getType())e=r;else if("system"===n._getType())e="System";else if("function"===n._getType())e="Function";else if("tool"===n._getType())e="Tool";else if("generic"===n._getType())e=n.role;else throw Error(`Got unsupported message type: ${n._getType()}`);let i=n.name?`${n.name}, `:"";a.push(`${e}: ${i}${n.content}`)}return a.join("\n")}function convertToChunk(e){let t=e._getType();if("human"===t)return new n.r({...e});if("ai"===t)return new i.GC({...e});if("system"===t)return new s.x({...e});if("function"===t)return new l.C({...e});if(o.J.isInstance(e))return new o.H({...e});throw Error("Unknown message type.")}r(9033)},4697:function(e,t,r){"use strict";r.d(t,{GU:function(){return ChatPromptValue},Nn:function(){return ImagePromptValue},nw:function(){return StringPromptValue}});var a=r(8498),n=r(3478);let BasePromptValue=class BasePromptValue extends a.i{};let StringPromptValue=class StringPromptValue extends BasePromptValue{static lc_name(){return"StringPromptValue"}constructor(e){super({value:e}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.value=e}toString(){return this.value}toChatMessages(){return[new n.xk(this.value)]}};let ChatPromptValue=class ChatPromptValue extends BasePromptValue{static lc_name(){return"ChatPromptValue"}constructor(e){Array.isArray(e)&&(e={messages:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"messages",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.messages=e.messages}toString(){return(0,n.zs)(this.messages)}toChatMessages(){return this.messages}};let ImagePromptValue=class ImagePromptValue extends BasePromptValue{static lc_name(){return"ImagePromptValue"}constructor(e){"imageUrl"in e||(e={imageUrl:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","prompt_values"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"imageUrl",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"value",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.imageUrl=e.imageUrl}toString(){return this.imageUrl.url}toChatMessages(){return[new n.xk({content:[{type:"image_url",image_url:{detail:this.imageUrl.detail,url:this.imageUrl.url}}]})]}}},8477:function(e,t,r){"use strict";r.d(t,{eq:function(){return Runnable},Vh:function(){return RunnableAssign},dT:function(){return RunnableMap},lW:function(){return RunnableSequence}});var a=r(6418),n=r(1018),i=r(7018),s=r(6918),o=r(1448),l=r(2272),u=r(3478);let RunLogPatch=class RunLogPatch{constructor(e){Object.defineProperty(this,"ops",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.ops=e.ops??[]}concat(e){let t=this.ops.concat(e.ops),r=(0,s.af)({},t);return new RunLog({ops:t,state:r[r.length-1].newDocument})}};let RunLog=class RunLog extends RunLogPatch{constructor(e){super(e),Object.defineProperty(this,"state",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.state=e.state}concat(e){let t=this.ops.concat(e.ops),r=(0,s.af)(this.state,e.ops);return new RunLog({ops:t,state:r[r.length-1].newDocument})}static fromRunLogPatch(e){let t=(0,s.af)({},e.ops);return new RunLog({ops:e.ops,state:t[t.length-1].newDocument})}};async function _getStandardizedInputs(e,t){if("original"===t)throw Error("Do not assign inputs with original schema drop the key for now. When inputs are added to streamLog they should be added with standardized schema for streaming events.");let{inputs:r}=e;return["retriever","llm","prompt"].includes(e.run_type)?r:1!==Object.keys(r).length||r?.input!==""?r.input:void 0}async function _getStandardizedOutputs(e,t){let{outputs:r}=e;return"original"===t||["retriever","llm","prompt"].includes(e.run_type)?r:void 0!==r&&1===Object.keys(r).length&&r?.output!==void 0?r.output:r}function isChatGenerationChunk(e){return void 0!==e&&void 0!==e.message}let LogStreamCallbackHandler=class LogStreamCallbackHandler extends o.Z{constructor(e){super({_awaitHandler:!0,...e}),Object.defineProperty(this,"autoClose",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_schemaFormat",{enumerable:!0,configurable:!0,writable:!0,value:"original"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"keyMapByRunId",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"counterMapByRunName",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"transformStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"writer",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"receiveStream",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"log_stream_tracer"}),this.autoClose=e?.autoClose??!0,this.includeNames=e?.includeNames,this.includeTypes=e?.includeTypes,this.includeTags=e?.includeTags,this.excludeNames=e?.excludeNames,this.excludeTypes=e?.excludeTypes,this.excludeTags=e?.excludeTags,this._schemaFormat=e?._schemaFormat??this._schemaFormat,this.transformStream=new TransformStream,this.writer=this.transformStream.writable.getWriter(),this.receiveStream=l.QJ.fromReadableStream(this.transformStream.readable)}[Symbol.asyncIterator](){return this.receiveStream}async persistRun(e){}_includeRun(e){if(e.id===this.rootId)return!1;let t=e.tags??[],r=void 0===this.includeNames&&void 0===this.includeTags&&void 0===this.includeTypes;return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(e.run_type)),void 0!==this.includeTags&&(r=r||void 0!==t.find(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(e.run_type)),void 0!==this.excludeTags&&(r=r&&t.every(e=>!this.excludeTags?.includes(e))),r}async *tapOutputIterable(e,t){for await(let r of t){if(e!==this.rootId){let t=this.keyMapByRunId[e];t&&await this.writer.write(new RunLogPatch({ops:[{op:"add",path:`/logs/${t}/streamed_output/-`,value:r}]}))}yield r}}async onRunCreate(e){if(void 0===this.rootId&&(this.rootId=e.id,await this.writer.write(new RunLogPatch({ops:[{op:"replace",path:"",value:{id:e.id,name:e.name,type:e.run_type,streamed_output:[],final_output:void 0,logs:{}}}]}))),!this._includeRun(e))return;void 0===this.counterMapByRunName[e.name]&&(this.counterMapByRunName[e.name]=0),this.counterMapByRunName[e.name]+=1;let t=this.counterMapByRunName[e.name];this.keyMapByRunId[e.id]=1===t?e.name:`${e.name}:${t}`;let r={id:e.id,name:e.name,type:e.run_type,tags:e.tags??[],metadata:e.extra?.metadata??{},start_time:new Date(e.start_time).toISOString(),streamed_output:[],streamed_output_str:[],final_output:void 0,end_time:void 0};"streaming_events"===this._schemaFormat&&(r.inputs=await _getStandardizedInputs(e,this._schemaFormat)),await this.writer.write(new RunLogPatch({ops:[{op:"add",path:`/logs/${this.keyMapByRunId[e.id]}`,value:r}]}))}async onRunUpdate(e){try{let t=this.keyMapByRunId[e.id];if(void 0===t)return;let r=[];"streaming_events"===this._schemaFormat&&r.push({op:"replace",path:`/logs/${t}/inputs`,value:await _getStandardizedInputs(e,this._schemaFormat)}),r.push({op:"add",path:`/logs/${t}/final_output`,value:await _getStandardizedOutputs(e,this._schemaFormat)}),void 0!==e.end_time&&r.push({op:"add",path:`/logs/${t}/end_time`,value:new Date(e.end_time).toISOString()});let a=new RunLogPatch({ops:r});await this.writer.write(a)}finally{if(e.id===this.rootId){let t=new RunLogPatch({ops:[{op:"replace",path:"/final_output",value:await _getStandardizedOutputs(e,this._schemaFormat)}]});await this.writer.write(t),this.autoClose&&await this.writer.close()}}}async onLLMNewToken(e,t,r){let a;let n=this.keyMapByRunId[e.id];if(void 0===n)return;let i=void 0!==e.inputs.messages;a=i?isChatGenerationChunk(r?.chunk)?r?.chunk:new u.GC(t):t;let s=new RunLogPatch({ops:[{op:"add",path:`/logs/${n}/streamed_output_str/-`,value:t},{op:"add",path:`/logs/${n}/streamed_output/-`,value:a}]});await this.writer.write(s)}};var d=r(8498),c=r(9189),h=r(3830);let RootListenersTracer=class RootListenersTracer extends o.Z{constructor({config:e,onStart:t,onEnd:r,onError:a}){super({_awaitHandler:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:"RootListenersTracer"}),Object.defineProperty(this,"rootId",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnStart",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnEnd",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"argOnError",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.config=e,this.argOnStart=t,this.argOnEnd=r,this.argOnError=a}persistRun(e){return Promise.resolve()}async onRunCreate(e){!this.rootId&&(this.rootId=e.id,this.argOnStart&&(1===this.argOnStart.length?await this.argOnStart(e):2===this.argOnStart.length&&await this.argOnStart(e,this.config)))}async onRunUpdate(e){e.id===this.rootId&&(e.error?this.argOnError&&(1===this.argOnError.length?await this.argOnError(e):2===this.argOnError.length&&await this.argOnError(e,this.config)):this.argOnEnd&&(1===this.argOnEnd.length?await this.argOnEnd(e):2===this.argOnEnd.length&&await this.argOnEnd(e,this.config)))}};function utils_isRunnableInterface(e){return!!e&&e.lc_runnable}let _RootEventFilter=class _RootEventFilter{constructor(e){Object.defineProperty(this,"includeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"includeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeNames",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTypes",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"excludeTags",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.includeNames=e.includeNames,this.includeTypes=e.includeTypes,this.includeTags=e.includeTags,this.excludeNames=e.excludeNames,this.excludeTypes=e.excludeTypes,this.excludeTags=e.excludeTags}includeEvent(e,t){let r=void 0===this.includeNames&&void 0===this.includeTypes&&void 0===this.includeTags,a=e.tags??[];return void 0!==this.includeNames&&(r=r||this.includeNames.includes(e.name)),void 0!==this.includeTypes&&(r=r||this.includeTypes.includes(t)),void 0!==this.includeTags&&(r=r||a.some(e=>this.includeTags?.includes(e))),void 0!==this.excludeNames&&(r=r&&!this.excludeNames.includes(e.name)),void 0!==this.excludeTypes&&(r=r&&!this.excludeTypes.includes(t)),void 0!==this.excludeTags&&(r=r&&a.every(e=>!this.excludeTags?.includes(e))),r}};var p=r(5051),f=r(9711),m=r(325),g=r(9634);function nodeDataJson(e){return utils_isRunnableInterface(e.data)?{type:"runnable",data:{id:e.data.lc_id,name:e.data.getName()}}:{type:"schema",data:{...(0,f.Y_)(e.data.schema),title:e.data.name}}}let Graph=class Graph{constructor(){Object.defineProperty(this,"nodes",{enumerable:!0,configurable:!0,writable:!0,value:{}}),Object.defineProperty(this,"edges",{enumerable:!0,configurable:!0,writable:!0,value:[]})}toJSON(){let e={};return Object.values(this.nodes).forEach((t,r)=>{e[t.id]=(0,m.Z)(t.id)?r:t.id}),{nodes:Object.values(this.nodes).map(t=>({id:e[t.id],...nodeDataJson(t)})),edges:this.edges.map(t=>t.data?{source:e[t.source],target:e[t.target],data:t.data}:{source:e[t.source],target:e[t.target]})}}addNode(e,t){if(void 0!==t&&void 0!==this.nodes[t])throw Error(`Node with id ${t} already exists`);let r=t||(0,g.Z)(),a={id:r,data:e};return this.nodes[r]=a,a}removeNode(e){delete this.nodes[e.id],this.edges=this.edges.filter(t=>t.source!==e.id&&t.target!==e.id)}addEdge(e,t,r){if(void 0===this.nodes[e.id])throw Error(`Source node ${e.id} not in graph`);if(void 0===this.nodes[t.id])throw Error(`Target node ${t.id} not in graph`);let a={source:e.id,target:t.id,data:r};return this.edges.push(a),a}firstNode(){let e=new Set(this.edges.map(e=>e.target)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}lastNode(){let e=new Set(this.edges.map(e=>e.source)),t=[];return Object.values(this.nodes).forEach(r=>{e.has(r.id)||t.push(r)}),t[0]}extend(e){Object.entries(e.nodes).forEach(([e,t])=>{this.nodes[e]=t}),this.edges=[...this.edges,...e.edges]}trimFirstNode(){let e=this.firstNode();if(e){let t=this.edges.filter(t=>t.source===e.id);(1===Object.keys(this.nodes).length||1===t.length)&&this.removeNode(e)}}trimLastNode(){let e=this.lastNode();if(e){let t=this.edges.filter(t=>t.target===e.id);(1===Object.keys(this.nodes).length||1===t.length)&&this.removeNode(e)}}};function _coerceToDict(e,t){return!e||Array.isArray(e)||e instanceof Date||"object"!=typeof e?{[t]:e}:e}let Runnable=class Runnable extends d.i{constructor(){super(...arguments),Object.defineProperty(this,"lc_runnable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}getName(e){let t=this.name??this.constructor.lc_name()??this.constructor.name;return e?`${t}${e}`:t}bind(e){return new RunnableBinding({bound:this,kwargs:e,config:{}})}map(){return new RunnableEach({bound:this})}withRetry(e){return new RunnableRetry({bound:this,kwargs:{},config:{},maxAttemptNumber:e?.stopAfterAttempt,...e})}withConfig(e){return new RunnableBinding({bound:this,config:e,kwargs:{}})}withFallbacks(e){return new RunnableWithFallbacks({runnable:this,fallbacks:e.fallbacks})}_getOptionsList(e,t=0){if(Array.isArray(e)&&e.length!==t)throw Error(`Passed "options" must be an array with the same length as the inputs, but got ${e.length} options for ${t} inputs`);if(Array.isArray(e))return e.map(c.LE);if(t>1&&!Array.isArray(e)&&e.runId){console.warn("Provided runId will be used only for the first element of the batch.");let r=Object.fromEntries(Object.entries(e).filter(([e])=>"runId"!==e));return Array.from({length:t},(t,a)=>(0,c.LE)(0===a?e:r))}return Array.from({length:t},()=>(0,c.LE)(e))}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),n=a[0]?.maxConcurrency??r?.maxConcurrency,i=new h.L({maxConcurrency:n,onFailedAttempt:e=>{throw e}}),s=e.map((e,t)=>i.call(async()=>{try{let r=await this.invoke(e,a[t]);return r}catch(e){if(r?.returnExceptions)return e;throw e}}));return Promise.all(s)}async *_streamIterator(e,t){yield this.invoke(e,t)}async stream(e,t){let r=new l.qq(this._streamIterator(e,(0,c.LE)(t)));return await r.setup,l.QJ.fromAsyncGenerator(r)}_separateRunnableConfigFromCallOptions(e){let t;t=void 0===e?(0,c.LE)(e):(0,c.LE)({callbacks:e.callbacks,tags:e.tags,metadata:e.metadata,runName:e.runName,configurable:e.configurable,recursionLimit:e.recursionLimit,maxConcurrency:e.maxConcurrency,runId:e.runId});let r={...e};return delete r.callbacks,delete r.tags,delete r.metadata,delete r.runName,delete r.configurable,delete r.recursionLimit,delete r.maxConcurrency,delete r.runId,[t,r]}async _callWithConfig(e,t,r){let a;let n=(0,c.LE)(r),i=await (0,c.Le)(n),s=await i?.handleChainStart(this.toJSON(),_coerceToDict(t,"input"),n.runId,n?.runType,void 0,void 0,n?.runName??this.getName());delete n.runId;try{a=await e.call(this,t,n,s)}catch(e){throw await s?.handleChainError(e),e}return await s?.handleChainEnd(_coerceToDict(a,"output")),a}async _batchWithConfig(e,t,r,a){let n;let i=this._getOptionsList(r??{},t.length),s=await Promise.all(i.map(c.Le)),o=await Promise.all(s.map(async(e,r)=>{let a=await e?.handleChainStart(this.toJSON(),_coerceToDict(t[r],"input"),i[r].runId,i[r].runType,void 0,void 0,i[r].runName??this.getName());return delete i[r].runId,a}));try{n=await e.call(this,t,i,o,a)}catch(e){throw await Promise.all(o.map(t=>t?.handleChainError(e))),e}return await Promise.all(o.map(e=>e?.handleChainEnd(_coerceToDict(n,"output")))),n}async *_transformStreamWithConfig(e,t,r){let a,n,i;let s=!0,o=!0,u=(0,c.LE)(r),d=await (0,c.Le)(u);async function*wrapInputForTracing(){for await(let t of e){if(s){if(void 0===a)a=t;else try{a=(0,l.zo)(a,t)}catch{a=void 0,s=!1}}yield t}}try{let e=await (0,l.E7)(t.bind(this),wrapInputForTracing(),async()=>d?.handleChainStart(this.toJSON(),{input:""},u.runId,u.runType,void 0,void 0,u.runName??this.getName()),u);delete u.runId,i=e.setup;let r=i?.handlers.find(e=>"log_stream_tracer"===e.name),a=e.output;for await(let t of(void 0!==r&&void 0!==i&&(a=await r.tapOutputIterable(i.runId,e.output)),a))if(yield t,o){if(void 0===n)n=t;else try{n=(0,l.zo)(n,t)}catch{n=void 0,o=!1}}}catch(e){throw await i?.handleChainError(e,void 0,void 0,void 0,{inputs:_coerceToDict(a,"input")}),e}await i?.handleChainEnd(n??{},void 0,void 0,void 0,{inputs:_coerceToDict(a,"input")})}getGraph(e){let t=new Graph,r=t.addNode({name:`${this.getName()}Input`,schema:a.z.any()}),n=t.addNode(this),i=t.addNode({name:`${this.getName()}Output`,schema:a.z.any()});return t.addEdge(r,n),t.addEdge(n,i),t}pipe(e){return new RunnableSequence({first:this,last:_coerceToRunnable(e)})}pick(e){return this.pipe(new RunnablePick(e))}assign(e){return this.pipe(new RunnableAssign(new RunnableMap({steps:e})))}async *transform(e,t){let r;for await(let t of e)r=void 0===r?t:(0,l.zo)(r,t);yield*this._streamIterator(r,(0,c.LE)(t))}async *streamLog(e,t,r){let a=new LogStreamCallbackHandler({...r,autoClose:!1,_schemaFormat:"original"}),n=(0,c.LE)(t);yield*this._streamLog(e,a,n)}async *_streamLog(e,t,r){let{callbacks:a}=r;if(void 0===a)r.callbacks=[t];else if(Array.isArray(a))r.callbacks=a.concat([t]);else{let e=a.copy();e.inheritableHandlers.push(t),r.callbacks=e}let n=this.stream(e,r);async function consumeRunnableStream(){try{let e=await n;for await(let r of e){let e=new RunLogPatch({ops:[{op:"add",path:"/streamed_output/-",value:r}]});await t.writer.write(e)}}finally{await t.writer.close()}}let i=consumeRunnableStream();try{for await(let e of t)yield e}finally{await i}}async *streamEvents(e,t,r){let a;if("v1"!==t.version)throw Error('Only version "v1" of the events schema is currently supported.');let n=!1,i=(0,c.LE)(t),s=i.tags??[],o=i.metadata??{},l=i.runName??this.getName(),u=new LogStreamCallbackHandler({...r,autoClose:!1,_schemaFormat:"streaming_events"}),d=new _RootEventFilter({...r}),h=this._streamLog(e,u,i);for await(let t of h){if(void 0===(a=a?a.concat(t):RunLog.fromRunLogPatch(t)).state)throw Error('Internal error: "streamEvents" state is missing. Please open a bug report.');if(!n){n=!0;let t={...a.state},r={run_id:t.id,event:`on_${t.type}_start`,name:l,tags:s,metadata:o,data:{input:e}};d.includeEvent(r,t.type)&&(yield r)}let r=t.ops.filter(e=>e.path.startsWith("/logs/")).map(e=>e.path.split("/")[2]),i=[...new Set(r)];for(let e of i){let t;let r={},n=a.state.logs[e];if("start"==(t=void 0===n.end_time?n.streamed_output.length>0?"stream":"start":"end"))void 0!==n.inputs&&(r.input=n.inputs);else if("end"===t)void 0!==n.inputs&&(r.input=n.inputs),r.output=n.final_output;else if("stream"===t){let e=n.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${n.name}"`);r={chunk:n.streamed_output[0]},n.streamed_output=[]}yield{event:`on_${n.type}_${t}`,name:n.name,run_id:n.id,tags:n.tags,metadata:n.metadata,data:r}}let{state:u}=a;if(u.streamed_output.length>0){let e=u.streamed_output.length;if(1!==e)throw Error(`Expected exactly one chunk of streamed output, got ${e} instead. Encountered in: "${u.name}"`);let t={chunk:u.streamed_output[0]};u.streamed_output=[];let r={event:`on_${u.type}_stream`,run_id:u.id,tags:s,metadata:o,name:l,data:t};d.includeEvent(r,u.type)&&(yield r)}}let p=a?.state;if(void 0!==p){let e={event:`on_${p.type}_end`,name:l,run_id:p.id,tags:s,metadata:o,data:{output:p.final_output}};d.includeEvent(e,p.type)&&(yield e)}}static isRunnable(e){return utils_isRunnableInterface(e)}withListeners({onStart:e,onEnd:t,onError:r}){return new RunnableBinding({bound:this,config:{},configFactories:[a=>({callbacks:[new RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}};let RunnableBinding=class RunnableBinding extends Runnable{static lc_name(){return"RunnableBinding"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"config",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"kwargs",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"configFactories",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound,this.kwargs=e.kwargs,this.config=e.config,this.configFactories=e.configFactories}getName(e){return this.bound.getName(e)}async _mergeConfig(...e){let t=(0,c.t8)(this.config,...e);return(0,c.t8)(t,...this.configFactories?await Promise.all(this.configFactories.map(async e=>await e(t))):[])}bind(e){return new this.constructor({bound:this.bound,kwargs:{...this.kwargs,...e},config:this.config})}withConfig(e){return new this.constructor({bound:this.bound,kwargs:this.kwargs,config:{...this.config,...e}})}withRetry(e){return new this.constructor({bound:this.bound.withRetry(e),kwargs:this.kwargs,config:this.config})}async invoke(e,t){return this.bound.invoke(e,await this._mergeConfig((0,c.LE)(t),this.kwargs))}async batch(e,t,r){let a=Array.isArray(t)?await Promise.all(t.map(async e=>this._mergeConfig((0,c.LE)(e),this.kwargs))):await this._mergeConfig((0,c.LE)(t),this.kwargs);return this.bound.batch(e,a,r)}async *_streamIterator(e,t){yield*this.bound._streamIterator(e,await this._mergeConfig((0,c.LE)(t),this.kwargs))}async stream(e,t){return this.bound.stream(e,await this._mergeConfig((0,c.LE)(t),this.kwargs))}async *transform(e,t){yield*this.bound.transform(e,await this._mergeConfig((0,c.LE)(t),this.kwargs))}async *streamEvents(e,t,r){yield*this.bound.streamEvents(e,{...await this._mergeConfig((0,c.LE)(t),this.kwargs),version:t.version},r)}static isRunnableBinding(e){return e.bound&&Runnable.isRunnable(e.bound)}withListeners({onStart:e,onEnd:t,onError:r}){return new RunnableBinding({bound:this.bound,kwargs:this.kwargs,config:this.config,configFactories:[a=>({callbacks:[new RootListenersTracer({config:a,onStart:e,onEnd:t,onError:r})]})]})}};let RunnableEach=class RunnableEach extends Runnable{static lc_name(){return"RunnableEach"}constructor(e){super(e),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"bound",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.bound=e.bound}bind(e){return new RunnableEach({bound:this.bound.bind(e)})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _invoke(e,t,r){return this.bound.batch(e,(0,c.q)(t,{callbacks:r?.getChild()}))}withListeners({onStart:e,onEnd:t,onError:r}){return new RunnableEach({bound:this.bound.withListeners({onStart:e,onEnd:t,onError:r})})}};let RunnableRetry=class RunnableRetry extends RunnableBinding{static lc_name(){return"RunnableRetry"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"maxAttemptNumber",{enumerable:!0,configurable:!0,writable:!0,value:3}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:()=>{}}),this.maxAttemptNumber=e.maxAttemptNumber??this.maxAttemptNumber,this.onFailedAttempt=e.onFailedAttempt??this.onFailedAttempt}_patchConfigForRetry(e,t,r){let a=e>1?`retry:attempt:${e}`:void 0;return(0,c.q)(t,{callbacks:r?.getChild(a)})}async _invoke(e,t,r){return n(a=>super.invoke(e,this._patchConfigForRetry(a,t,r)),{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async _batch(e,t,r,a){let i={};try{await n(async n=>{let s;let o=e.map((e,t)=>t).filter(e=>void 0===i[e.toString()]||i[e.toString()]instanceof Error),l=o.map(t=>e[t]),u=o.map(e=>this._patchConfigForRetry(n,t?.[e],r?.[e])),d=await super.batch(l,u,{...a,returnExceptions:!0});for(let e=0;e<d.length;e+=1){let t=d[e],r=o[e];t instanceof Error&&void 0===s&&(s=t),i[r.toString()]=t}if(s)throw s;return d},{onFailedAttempt:this.onFailedAttempt,retries:Math.max(this.maxAttemptNumber-1,0),randomize:!0})}catch(e){if(a?.returnExceptions!==!0)throw e}return Object.keys(i).sort((e,t)=>parseInt(e,10)-parseInt(t,10)).map(e=>i[parseInt(e,10)])}async batch(e,t,r){return this._batchWithConfig(this._batch.bind(this),e,t,r)}};let RunnableSequence=class RunnableSequence extends Runnable{static lc_name(){return"RunnableSequence"}constructor(e){super(e),Object.defineProperty(this,"first",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"middle",{enumerable:!0,configurable:!0,writable:!0,value:[]}),Object.defineProperty(this,"last",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),this.first=e.first,this.middle=e.middle??this.middle,this.last=e.last,this.name=e.name}get steps(){return[this.first,...this.middle,this.last]}async invoke(e,t){let r;let a=(0,c.LE)(t),n=await (0,c.Le)(a),i=await n?.handleChainStart(this.toJSON(),_coerceToDict(e,"input"),a.runId,void 0,void 0,void 0,a?.runName);delete a.runId;let s=e;try{let e=[this.first,...this.middle];for(let t=0;t<e.length;t+=1){let r=e[t];s=await r.invoke(s,(0,c.q)(a,{callbacks:i?.getChild(`seq:step:${t+1}`)}))}r=await this.last.invoke(s,(0,c.q)(a,{callbacks:i?.getChild(`seq:step:${this.steps.length}`)}))}catch(e){throw await i?.handleChainError(e),e}return await i?.handleChainEnd(_coerceToDict(r,"output")),r}async batch(e,t,r){let a=this._getOptionsList(t??{},e.length),n=await Promise.all(a.map(c.Le)),i=await Promise.all(n.map(async(t,r)=>{let n=await t?.handleChainStart(this.toJSON(),_coerceToDict(e[r],"input"),a[r].runId,void 0,void 0,void 0,a[r].runName);return delete a[r].runId,n})),s=e;try{for(let e=0;e<this.steps.length;e+=1){let t=this.steps[e];s=await t.batch(s,i.map((t,r)=>{let n=t?.getChild(`seq:step:${e+1}`);return(0,c.q)(a[r],{callbacks:n})}),r)}}catch(e){throw await Promise.all(i.map(t=>t?.handleChainError(e))),e}return await Promise.all(i.map(e=>e?.handleChainEnd(_coerceToDict(s,"output")))),s}async *_streamIterator(e,t){let r;let a=await (0,c.Le)(t),{runId:n,...i}=t??{},s=await a?.handleChainStart(this.toJSON(),_coerceToDict(e,"input"),n,void 0,void 0,void 0,i?.runName),o=[this.first,...this.middle,this.last],u=!0;async function*inputGenerator(){yield e}try{let e=o[0].transform(inputGenerator(),(0,c.q)(i,{callbacks:s?.getChild("seq:step:1")}));for(let t=1;t<o.length;t+=1){let r=o[t];e=await r.transform(e,(0,c.q)(i,{callbacks:s?.getChild(`seq:step:${t+1}`)}))}for await(let t of e)if(yield t,u){if(void 0===r)r=t;else try{r=(0,l.zo)(r,t)}catch(e){r=void 0,u=!1}}}catch(e){throw await s?.handleChainError(e),e}await s?.handleChainEnd(_coerceToDict(r,"output"))}getGraph(e){let t=new Graph,r=null;return this.steps.forEach((a,n)=>{let i=a.getGraph(e);0!==n&&i.trimFirstNode(),n!==this.steps.length-1&&i.trimLastNode(),t.extend(i);let s=i.firstNode();if(!s)throw Error(`Runnable ${a} has no first node`);r&&t.addEdge(r,s),r=i.lastNode()}),t}pipe(e){return new RunnableSequence(RunnableSequence.isRunnableSequence(e)?{first:this.first,middle:this.middle.concat([this.last,e.first,...e.middle]),last:e.last,name:this.name??e.name}:{first:this.first,middle:[...this.middle,this.last],last:_coerceToRunnable(e),name:this.name})}static isRunnableSequence(e){return Array.isArray(e.middle)&&Runnable.isRunnable(e)}static from([e,...t],r){return new RunnableSequence({first:_coerceToRunnable(e),middle:t.slice(0,-1).map(_coerceToRunnable),last:_coerceToRunnable(t[t.length-1]),name:r})}};let RunnableMap=class RunnableMap extends Runnable{static lc_name(){return"RunnableMap"}getStepsKeys(){return Object.keys(this.steps)}constructor(e){for(let[t,r]of(super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"steps",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.steps={},Object.entries(e.steps)))this.steps[t]=_coerceToRunnable(r)}static from(e){return new RunnableMap({steps:e})}async invoke(e,t){let r=(0,c.LE)(t),a=await (0,c.Le)(r),n=await a?.handleChainStart(this.toJSON(),{input:e},r.runId,void 0,void 0,void 0,r?.runName);delete r.runId;let i={};try{await Promise.all(Object.entries(this.steps).map(async([t,a])=>{i[t]=await a.invoke(e,(0,c.q)(r,{callbacks:n?.getChild(`map:key:${t}`)}))}))}catch(e){throw await n?.handleChainError(e),e}return await n?.handleChainEnd(i),i}async *_transform(e,t,r){let a={...this.steps},n=(0,l.y2)(e,Object.keys(a).length),i=new Map(Object.entries(a).map(([e,a],i)=>{let s=a.transform(n[i],(0,c.q)(r,{callbacks:t?.getChild(`map:key:${e}`)}));return[e,s.next().then(t=>({key:e,gen:s,result:t}))]}));for(;i.size;){let{key:e,result:t,gen:r}=await Promise.race(i.values());i.delete(e),t.done||(yield{[e]:t.value},i.set(e,r.next().then(t=>({key:e,gen:r,result:t}))))}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*generator(){yield e}let r=new l.qq(this.transform(generator(),t));return await r.setup,l.QJ.fromAsyncGenerator(r)}};let RunnableLambda=class RunnableLambda extends Runnable{static lc_name(){return"RunnableLambda"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.func=e.func}static from(e){return new RunnableLambda({func:e})}async _invoke(e,t,r){return new Promise((a,n)=>{let i=(0,c.q)(t,{callbacks:r?.getChild(),recursionLimit:(t?.recursionLimit??c.ov)-1});p.A.getInstance().run(i,async()=>{try{let r=await this.func(e,{...i,config:i});if(r&&Runnable.isRunnable(r)){if(t?.recursionLimit===0)throw Error("Recursion limit reached.");r=await r.invoke(e,{...i,recursionLimit:(i.recursionLimit??c.ov)-1})}a(r)}catch(e){n(e)}})})}async invoke(e,t){return this._callWithConfig(this._invoke,e,t)}async *_transform(e,t,r){let a;for await(let t of e)if(void 0===a)a=t;else try{a=(0,l.zo)(a,t)}catch(e){a=t}let n=await new Promise((e,t)=>{p.A.getInstance().run(r,async()=>{try{let t=await this.func(a,{...r,config:r});e(t)}catch(e){t(e)}})});if(n&&Runnable.isRunnable(n)){if(r?.recursionLimit===0)throw Error("Recursion limit reached.");let e=await n.stream(a,(0,c.q)(r,{callbacks:t?.getChild(),recursionLimit:(r?.recursionLimit??c.ov)-1}));for await(let t of e)yield t}else yield n}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*generator(){yield e}let r=new l.qq(this.transform(generator(),t));return await r.setup,l.QJ.fromAsyncGenerator(r)}};let RunnableWithFallbacks=class RunnableWithFallbacks extends Runnable{static lc_name(){return"RunnableWithFallbacks"}constructor(e){super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"runnable",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"fallbacks",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.runnable=e.runnable,this.fallbacks=e.fallbacks}*runnables(){for(let e of(yield this.runnable,this.fallbacks))yield e}async invoke(e,t){let r;let a=await i.Ye.configure(t?.callbacks,void 0,t?.tags,void 0,t?.metadata),{runId:n,...s}=t??{},o=await a?.handleChainStart(this.toJSON(),_coerceToDict(e,"input"),n,void 0,void 0,void 0,s?.runName);for(let t of this.runnables())try{let r=await t.invoke(e,(0,c.q)(s,{callbacks:o?.getChild()}));return await o?.handleChainEnd(_coerceToDict(r,"output")),r}catch(e){void 0===r&&(r=e)}if(void 0===r)throw Error("No error stored at end of fallback.");throw await o?.handleChainError(r),r}async batch(e,t,r){let a;if(r?.returnExceptions)throw Error("Not implemented.");let n=this._getOptionsList(t??{},e.length),s=await Promise.all(n.map(e=>i.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata))),o=await Promise.all(s.map(async(t,r)=>{let a=await t?.handleChainStart(this.toJSON(),_coerceToDict(e[r],"input"),n[r].runId,void 0,void 0,void 0,n[r].runName);return delete n[r].runId,a}));for(let t of this.runnables())try{let a=await t.batch(e,o.map((e,t)=>(0,c.q)(n[t],{callbacks:e?.getChild()})),r);return await Promise.all(o.map((e,t)=>e?.handleChainEnd(_coerceToDict(a[t],"output")))),a}catch(e){void 0===a&&(a=e)}if(!a)throw Error("No error stored at end of fallbacks.");throw await Promise.all(o.map(e=>e?.handleChainError(a))),a}};function _coerceToRunnable(e){if("function"==typeof e)return new RunnableLambda({func:e});if(Runnable.isRunnable(e))return e;if(Array.isArray(e)||"object"!=typeof e)throw Error(`Expected a Runnable, function or object.
Instead got an unsupported type.`);{let t={};for(let[r,a]of Object.entries(e))t[r]=_coerceToRunnable(a);return new RunnableMap({steps:t})}}let RunnableAssign=class RunnableAssign extends Runnable{static lc_name(){return"RunnableAssign"}constructor(e){e instanceof RunnableMap&&(e={mapper:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"mapper",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.mapper=e.mapper}async invoke(e,t){let r=await this.mapper.invoke(e,t);return{...e,...r}}async *_transform(e,t,r){let a=this.mapper.getStepsKeys(),[n,i]=(0,l.y2)(e),s=this.mapper.transform(i,(0,c.q)(r,{callbacks:t?.getChild()})),o=s.next();for await(let e of n){if("object"!=typeof e||Array.isArray(e))throw Error(`RunnableAssign can only be used with objects as input, got ${typeof e}`);let t=Object.fromEntries(Object.entries(e).filter(([e])=>!a.includes(e)));Object.keys(t).length>0&&(yield t)}for await(let e of(yield(await o).value,s))yield e}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*generator(){yield e}let r=new l.qq(this.transform(generator(),t));return await r.setup,l.QJ.fromAsyncGenerator(r)}};let RunnablePick=class RunnablePick extends Runnable{static lc_name(){return"RunnablePick"}constructor(e){("string"==typeof e||Array.isArray(e))&&(e={keys:e}),super(e),Object.defineProperty(this,"lc_namespace",{enumerable:!0,configurable:!0,writable:!0,value:["langchain_core","runnables"]}),Object.defineProperty(this,"lc_serializable",{enumerable:!0,configurable:!0,writable:!0,value:!0}),Object.defineProperty(this,"keys",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.keys=e.keys}async _pick(e){if("string"==typeof this.keys)return e[this.keys];{let t=this.keys.map(t=>[t,e[t]]).filter(e=>void 0!==e[1]);return 0===t.length?void 0:Object.fromEntries(t)}}async invoke(e,t){return this._callWithConfig(this._pick.bind(this),e,t)}async *_transform(e){for await(let t of e){let e=await this._pick(t);void 0!==e&&(yield e)}}transform(e,t){return this._transformStreamWithConfig(e,this._transform.bind(this),t)}async stream(e,t){async function*generator(){yield e}let r=new l.qq(this.transform(generator(),t));return await r.setup,l.QJ.fromAsyncGenerator(r)}}},9189:function(e,t,r){"use strict";r.d(t,{LE:function(){return ensureConfig},Le:function(){return getCallbackManagerForConfig},ov:function(){return i},q:function(){return patchConfig},t8:function(){return mergeConfigs}});var a=r(7018),n=r(5051);let i=25;async function getCallbackManagerForConfig(e){return a.Ye.configure(e?.callbacks,void 0,e?.tags,void 0,e?.metadata)}function mergeConfigs(...e){let t={};for(let r of e.filter(e=>!!e))for(let e of Object.keys(r))if("metadata"===e)t[e]={...t[e],...r[e]};else if("tags"===e){let a=t[e]??[];t[e]=[...new Set(a.concat(r[e]??[]))]}else if("configurable"===e)t[e]={...t[e],...r[e]};else if("callbacks"===e){let e=t.callbacks,n=r.callbacks;if(Array.isArray(n)){if(e){if(Array.isArray(e))t.callbacks=e.concat(n);else{let r=e.copy();for(let e of n)r.addHandler((0,a.xz)(e),!0);t.callbacks=r}}else t.callbacks=n}else if(n){if(e){if(Array.isArray(e)){let r=n.copy();for(let t of e)r.addHandler((0,a.xz)(t),!0);t.callbacks=r}else t.callbacks=new a.Ye(n._parentRunId,{handlers:e.handlers.concat(n.handlers),inheritableHandlers:e.inheritableHandlers.concat(n.inheritableHandlers),tags:Array.from(new Set(e.tags.concat(n.tags))),inheritableTags:Array.from(new Set(e.inheritableTags.concat(n.inheritableTags))),metadata:{...e.metadata,...n.metadata}})}else t.callbacks=n}}else t[e]=r[e]??t[e];return t}let s=new Set(["string","number","boolean"]);function ensureConfig(e){let t=e??n.A.getInstance().getStore(),r={tags:[],metadata:{},callbacks:void 0,recursionLimit:25,runId:void 0};if(t&&(r={...r,...t}),t?.configurable)for(let e of Object.keys(t.configurable))s.has(typeof t.configurable[e])&&!r.metadata?.[e]&&(r.metadata||(r.metadata={}),r.metadata[e]=t.configurable[e]);return r}function patchConfig(e={},{callbacks:t,maxConcurrency:r,recursionLimit:a,runName:n,configurable:i,runId:s}={}){let o=ensureConfig(e);return void 0!==t&&(delete o.runName,o.callbacks=t),void 0!==a&&(o.recursionLimit=a),void 0!==r&&(o.maxConcurrency=r),void 0!==n&&(o.runName=n),void 0!==i&&(o.configurable={...o.configurable,...i}),void 0!==s&&delete o.runId,o}},5051:function(e,t,r){"use strict";r.d(t,{A:function(){return a}});let MockAsyncLocalStorage=class MockAsyncLocalStorage{getStore(){}run(e,t){t()}};let AsyncLocalStorageProvider=class AsyncLocalStorageProvider{constructor(){Object.defineProperty(this,"asyncLocalStorage",{enumerable:!0,configurable:!0,writable:!0,value:new MockAsyncLocalStorage}),Object.defineProperty(this,"hasBeenInitialized",{enumerable:!0,configurable:!0,writable:!0,value:!1})}getInstance(){return this.asyncLocalStorage}initializeGlobalInstance(e){this.hasBeenInitialized||(this.hasBeenInitialized=!0,this.asyncLocalStorage=e)}};let a=new AsyncLocalStorageProvider},1448:function(e,t,r){"use strict";r.d(t,{Z:function(){return BaseTracer}});var a=r(2713);function _coerceToDict(e,t){return e&&!Array.isArray(e)&&"object"==typeof e?e:{[t]:e}}function stripNonAlphanumeric(e){return e.replace(/[-:.]/g,"")}function convertToDottedOrderFormat(e,t){return stripNonAlphanumeric(`${new Date(e).toISOString().slice(0,-1)}000Z`)+t}let BaseTracer=class BaseTracer extends a.E{constructor(e){super(...arguments),Object.defineProperty(this,"runMap",{enumerable:!0,configurable:!0,writable:!0,value:new Map})}copy(){return this}stringifyError(e){return e instanceof Error?e.message+(e?.stack?`

${e.stack}`:""):"string"==typeof e?e:`${e}`}_addChildRun(e,t){e.child_runs.push(t)}async _startTrace(e){let t=convertToDottedOrderFormat(e.start_time,e.id),r={...e};if(void 0!==r.parent_run_id){let e=this.runMap.get(r.parent_run_id);e&&(this._addChildRun(e,r),e.child_execution_order=Math.max(e.child_execution_order,r.child_execution_order),r.trace_id=e.trace_id,void 0!==e.dotted_order&&(r.dotted_order=[e.dotted_order,t].join(".")))}else r.trace_id=r.id,r.dotted_order=t;this.runMap.set(r.id,r),await this.onRunCreate?.(r)}async _endTrace(e){let t=void 0!==e.parent_run_id&&this.runMap.get(e.parent_run_id);t?t.child_execution_order=Math.max(t.child_execution_order,e.child_execution_order):await this.persistRun(e),this.runMap.delete(e.id),await this.onRunUpdate?.(e)}_getExecutionOrder(e){let t=void 0!==e&&this.runMap.get(e);return t?t.child_execution_order+1:1}async handleLLMStart(e,t,r,a,n,i,s,o){let l=this._getExecutionOrder(a),u=Date.now(),d=s?{...n,metadata:s}:n,c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{prompts:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return await this._startTrace(c),await this.onLLMStart?.(c),c}async handleChatModelStart(e,t,r,a,n,i,s,o){let l=this._getExecutionOrder(a),u=Date.now(),d=s?{...n,metadata:s}:n,c={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:{messages:t},execution_order:l,child_runs:[],child_execution_order:l,run_type:"llm",extra:d??{},tags:i||[]};return await this._startTrace(c),await this.onLLMStart?.(c),c}async handleLLMEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.outputs=e,r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onLLMEnd?.(r),await this._endTrace(r),r}async handleLLMError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="llm")throw Error("No LLM run to end.");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onLLMError?.(r),await this._endTrace(r),r}async handleChainStart(e,t,r,a,n,i,s,o){let l=this._getExecutionOrder(a),u=Date.now(),d={id:r,name:o??e.id[e.id.length-1],parent_run_id:a,start_time:u,serialized:e,events:[{name:"start",time:new Date(u).toISOString()}],inputs:t,execution_order:l,child_execution_order:l,run_type:s??"chain",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(d),await this.onChainStart?.(d),d}async handleChainEnd(e,t,r,a,n){let i=this.runMap.get(t);if(!i)throw Error("No chain run to end.");return i.end_time=Date.now(),i.outputs=_coerceToDict(e,"output"),i.events.push({name:"end",time:new Date(i.end_time).toISOString()}),n?.inputs!==void 0&&(i.inputs=_coerceToDict(n.inputs,"input")),await this.onChainEnd?.(i),await this._endTrace(i),i}async handleChainError(e,t,r,a,n){let i=this.runMap.get(t);if(!i)throw Error("No chain run to end.");return i.end_time=Date.now(),i.error=this.stringifyError(e),i.events.push({name:"error",time:new Date(i.end_time).toISOString()}),n?.inputs!==void 0&&(i.inputs=_coerceToDict(n.inputs,"input")),await this.onChainError?.(i),await this._endTrace(i),i}async handleToolStart(e,t,r,a,n,i,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{input:t},execution_order:o,child_execution_order:o,run_type:"tool",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(u),await this.onToolStart?.(u),u}async handleToolEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.outputs={output:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onToolEnd?.(r),await this._endTrace(r),r}async handleToolError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="tool")throw Error("No tool run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onToolError?.(r),await this._endTrace(r),r}async handleAgentAction(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.actions=r.actions||[],r.actions.push(e),r.events.push({name:"agent_action",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentAction?.(r))}async handleAgentEnd(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"agent_end",time:new Date().toISOString(),kwargs:{action:e}}),await this.onAgentEnd?.(r))}async handleRetrieverStart(e,t,r,a,n,i,s){let o=this._getExecutionOrder(a),l=Date.now(),u={id:r,name:s??e.id[e.id.length-1],parent_run_id:a,start_time:l,serialized:e,events:[{name:"start",time:new Date(l).toISOString()}],inputs:{query:t},execution_order:o,child_execution_order:o,run_type:"retriever",child_runs:[],extra:i?{metadata:i}:{},tags:n||[]};return await this._startTrace(u),await this.onRetrieverStart?.(u),u}async handleRetrieverEnd(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.outputs={documents:e},r.events.push({name:"end",time:new Date(r.end_time).toISOString()}),await this.onRetrieverEnd?.(r),await this._endTrace(r),r}async handleRetrieverError(e,t){let r=this.runMap.get(t);if(!r||r?.run_type!=="retriever")throw Error("No retriever run to end");return r.end_time=Date.now(),r.error=this.stringifyError(e),r.events.push({name:"error",time:new Date(r.end_time).toISOString()}),await this.onRetrieverError?.(r),await this._endTrace(r),r}async handleText(e,t){let r=this.runMap.get(t);r&&r?.run_type==="chain"&&(r.events.push({name:"text",time:new Date().toISOString(),kwargs:{text:e}}),await this.onText?.(r))}async handleLLMNewToken(e,t,r,a,n,i){let s=this.runMap.get(r);if(!s||s?.run_type!=="llm")throw Error('Invalid "runId" provided to "handleLLMNewToken" callback.');return s.events.push({name:"new_token",time:new Date().toISOString(),kwargs:{token:e,idx:t,chunk:i?.chunk}}),await this.onLLMNewToken?.(s,e,{chunk:i?.chunk}),s}}},3830:function(e,t,r){"use strict";r.d(t,{L:function(){return AsyncCaller}});var a=r(1018),n=r(4825);let i=[400,401,402,403,404,405,406,407,409],defaultFailedAttemptHandler=e=>{if(e.message.startsWith("Cancel")||e.message.startsWith("AbortError")||"AbortError"===e.name||e?.code==="ECONNABORTED")throw e;let t=e?.response?.status??e?.status;if(t&&i.includes(+t))throw e;if(e?.error?.code==="insufficient_quota"){let t=Error(e?.message);throw t.name="InsufficientQuotaError",t}};let AsyncCaller=class AsyncCaller{constructor(e){Object.defineProperty(this,"maxConcurrency",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"maxRetries",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"onFailedAttempt",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"queue",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.maxConcurrency=e.maxConcurrency??1/0,this.maxRetries=e.maxRetries??6,this.onFailedAttempt=e.onFailedAttempt??defaultFailedAttemptHandler;let t=n.default;this.queue=new t({concurrency:this.maxConcurrency})}call(e,...t){return this.queue.add(()=>a(()=>e(...t).catch(e=>{if(e instanceof Error)throw e;throw Error(e)}),{onFailedAttempt:this.onFailedAttempt,retries:this.maxRetries,randomize:!0}),{throwOnTimeout:!0})}callWithOptions(e,t,...r){return e.signal?Promise.race([this.call(t,...r),new Promise((t,r)=>{e.signal?.addEventListener("abort",()=>{r(Error("AbortError"))})})]):this.call(t,...r)}fetch(...e){return this.call(()=>fetch(...e).then(e=>e.ok?e:Promise.reject(e)))}}},298:function(e,t,r){"use strict";let a;r.d(t,{lS:function(){return getEnvironmentVariable},sA:function(){return getRuntimeEnvironment}});var n=r(5656);let isBrowser=()=>"undefined"!=typeof window&&void 0!==window.document,isWebWorker=()=>"object"==typeof globalThis&&globalThis.constructor&&"DedicatedWorkerGlobalScope"===globalThis.constructor.name,isJsDom=()=>"undefined"!=typeof window&&"nodejs"===window.name||"undefined"!=typeof navigator&&(navigator.userAgent.includes("Node.js")||navigator.userAgent.includes("jsdom")),isDeno=()=>"undefined"!=typeof Deno,isNode=()=>void 0!==n&&void 0!==n.versions&&void 0!==n.versions.node&&!isDeno(),getEnv=()=>isBrowser()?"browser":isNode()?"node":isWebWorker()?"webworker":isJsDom()?"jsdom":isDeno()?"deno":"other";async function getRuntimeEnvironment(){if(void 0===a){let e=getEnv();a={library:"langchain-js",runtime:e}}return a}function getEnvironmentVariable(e){try{return void 0!==n?n.env?.[e]:void 0}catch(e){return}}},6918:function(e,t,r){"use strict";r.d(t,{af:function(){return core_applyPatch},qu:function(){return compare}});var a={};r.r(a),r.d(a,{JsonPatchError:function(){return i},_areEquals:function(){return _areEquals},applyOperation:function(){return applyOperation},applyPatch:function(){return core_applyPatch},applyReducer:function(){return applyReducer},deepClone:function(){return s},getValueByPointer:function(){return getValueByPointer},validate:function(){return validate},validator:function(){return validator}});/*!
 * https://github.com/Starcounter-Jack/JSON-Patch
 * (c) 2017-2022 Joachim Wester
 * MIT licensed
 */let n=Object.prototype.hasOwnProperty;function helpers_hasOwnProperty(e,t){return n.call(e,t)}function _objectKeys(e){if(Array.isArray(e)){let t=Array(e.length);for(let e=0;e<t.length;e++)t[e]=""+e;return t}if(Object.keys)return Object.keys(e);let t=[];for(let r in e)helpers_hasOwnProperty(e,r)&&t.push(r);return t}function helpers_deepClone(e){switch(typeof e){case"object":return JSON.parse(JSON.stringify(e));case"undefined":return null;default:return e}}function isInteger(e){let t,r=0,a=e.length;for(;r<a;){if((t=e.charCodeAt(r))>=48&&t<=57){r++;continue}return!1}return!0}function escapePathComponent(e){return -1===e.indexOf("/")&&-1===e.indexOf("~")?e:e.replace(/~/g,"~0").replace(/\//g,"~1")}function unescapePathComponent(e){return e.replace(/~1/g,"/").replace(/~0/g,"~")}function hasUndefined(e){if(void 0===e)return!0;if(e){if(Array.isArray(e)){for(let t=0,r=e.length;t<r;t++)if(hasUndefined(e[t]))return!0}else if("object"==typeof e){let r=_objectKeys(e),a=r.length;for(var t=0;t<a;t++)if(hasUndefined(e[r[t]]))return!0}}return!1}function patchErrorMessageFormatter(e,t){let r=[e];for(let e in t){let a="object"==typeof t[e]?JSON.stringify(t[e],null,2):t[e];void 0!==a&&r.push(`${e}: ${a}`)}return r.join("\n")}let PatchError=class PatchError extends Error{constructor(e,t,r,a,n){super(patchErrorMessageFormatter(e,{name:t,index:r,operation:a,tree:n})),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:t}),Object.defineProperty(this,"index",{enumerable:!0,configurable:!0,writable:!0,value:r}),Object.defineProperty(this,"operation",{enumerable:!0,configurable:!0,writable:!0,value:a}),Object.defineProperty(this,"tree",{enumerable:!0,configurable:!0,writable:!0,value:n}),Object.setPrototypeOf(this,new.target.prototype),this.message=patchErrorMessageFormatter(e,{name:t,index:r,operation:a,tree:n})}};let i=PatchError,s=helpers_deepClone,o={add:function(e,t,r){return e[t]=this.value,{newDocument:r}},remove:function(e,t,r){var a=e[t];return delete e[t],{newDocument:r,removed:a}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:function(e,t,r){let a=getValueByPointer(r,this.path);a&&(a=helpers_deepClone(a));let n=applyOperation(r,{op:"remove",path:this.from}).removed;return applyOperation(r,{op:"add",path:this.path,value:n}),{newDocument:r,removed:a}},copy:function(e,t,r){let a=getValueByPointer(r,this.from);return applyOperation(r,{op:"add",path:this.path,value:helpers_deepClone(a)}),{newDocument:r}},test:function(e,t,r){return{newDocument:r,test:_areEquals(e[t],this.value)}},_get:function(e,t,r){return this.value=e[t],{newDocument:r}}};var l={add:function(e,t,r){return isInteger(t)?e.splice(t,0,this.value):e[t]=this.value,{newDocument:r,index:t}},remove:function(e,t,r){return{newDocument:r,removed:e.splice(t,1)[0]}},replace:function(e,t,r){var a=e[t];return e[t]=this.value,{newDocument:r,removed:a}},move:o.move,copy:o.copy,test:o.test,_get:o._get};function getValueByPointer(e,t){if(""==t)return e;var r={op:"_get",path:t};return applyOperation(e,r),r.value}function applyOperation(e,t,r=!1,a=!0,n=!0,s=0){if(r&&("function"==typeof r?r(t,0,e,t.path):validator(t,0)),""===t.path){let a={newDocument:e};if("add"===t.op)return a.newDocument=t.value,a;if("replace"===t.op)return a.newDocument=t.value,a.removed=e,a;if("move"===t.op||"copy"===t.op)return a.newDocument=getValueByPointer(e,t.from),"move"===t.op&&(a.removed=e),a;if("test"===t.op){if(a.test=_areEquals(e,t.value),!1===a.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a.newDocument=e,a}else{if("remove"===t.op)return a.removed=e,a.newDocument=null,a;if("_get"===t.op)return t.value=e,a;if(!r)return a;throw new i("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",s,t,e)}}{let u,d,c;a||(e=helpers_deepClone(e));let h=t.path||"",p=h.split("/"),f=e,m=1,g=p.length;for(d="function"==typeof r?r:validator;;){if((u=p[m])&&-1!=u.indexOf("~")&&(u=unescapePathComponent(u)),n&&("__proto__"==u||"prototype"==u&&m>0&&"constructor"==p[m-1]))throw TypeError("JSON-Patch: modifying `__proto__` or `constructor/prototype` prop is banned for security reasons, if this was on purpose, please set `banPrototypeModifications` flag false and pass it to this function. More info in fast-json-patch README");if(r&&void 0===c&&(void 0===f[u]?c=p.slice(0,m).join("/"):m==g-1&&(c=t.path),void 0!==c&&d(t,0,e,c)),m++,Array.isArray(f)){if("-"===u)u=f.length;else{if(r&&!isInteger(u))throw new i("Expected an unsigned base-10 integer value, making the new referenced value the array element with the zero-based index","OPERATION_PATH_ILLEGAL_ARRAY_INDEX",s,t,e);isInteger(u)&&(u=~~u)}if(m>=g){if(r&&"add"===t.op&&u>f.length)throw new i("The specified index MUST NOT be greater than the number of elements in the array","OPERATION_VALUE_OUT_OF_BOUNDS",s,t,e);let a=l[t.op].call(t,f,u,e);if(!1===a.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return a}}else if(m>=g){let r=o[t.op].call(t,f,u,e);if(!1===r.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",s,t,e);return r}if(f=f[u],r&&m<g&&(!f||"object"!=typeof f))throw new i("Cannot perform operation at the desired path","OPERATION_PATH_UNRESOLVABLE",s,t,e)}}}function core_applyPatch(e,t,r,a=!0,n=!0){if(r&&!Array.isArray(t))throw new i("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");a||(e=helpers_deepClone(e));let s=Array(t.length);for(let a=0,i=t.length;a<i;a++)s[a]=applyOperation(e,t[a],r,!0,n,a),e=s[a].newDocument;return s.newDocument=e,s}function applyReducer(e,t,r){let a=applyOperation(e,t);if(!1===a.test)throw new i("Test operation failed","TEST_OPERATION_FAILED",r,t,e);return a.newDocument}function validator(e,t,r,a){if("object"!=typeof e||null===e||Array.isArray(e))throw new i("Operation is not an object","OPERATION_NOT_AN_OBJECT",t,e,r);if(o[e.op]){if("string"!=typeof e.path)throw new i("Operation `path` property is not a string","OPERATION_PATH_INVALID",t,e,r);if(0!==e.path.indexOf("/")&&e.path.length>0)throw new i('Operation `path` property must start with "/"',"OPERATION_PATH_INVALID",t,e,r);if(("move"===e.op||"copy"===e.op)&&"string"!=typeof e.from)throw new i("Operation `from` property is not present (applicable in `move` and `copy` operations)","OPERATION_FROM_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&void 0===e.value)throw new i("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_REQUIRED",t,e,r);else if(("add"===e.op||"replace"===e.op||"test"===e.op)&&hasUndefined(e.value))throw new i("Operation `value` property is not present (applicable in `add`, `replace` and `test` operations)","OPERATION_VALUE_CANNOT_CONTAIN_UNDEFINED",t,e,r);else if(r){if("add"==e.op){var n=e.path.split("/").length,s=a.split("/").length;if(n!==s+1&&n!==s)throw new i("Cannot perform an `add` operation at the desired path","OPERATION_PATH_CANNOT_ADD",t,e,r)}else if("replace"===e.op||"remove"===e.op||"_get"===e.op){if(e.path!==a)throw new i("Cannot perform the operation at a path that does not exist","OPERATION_PATH_UNRESOLVABLE",t,e,r)}else if("move"===e.op||"copy"===e.op){var l=validate([{op:"_get",path:e.from,value:void 0}],r);if(l&&"OPERATION_PATH_UNRESOLVABLE"===l.name)throw new i("Cannot perform the operation from a path that does not exist","OPERATION_FROM_UNRESOLVABLE",t,e,r)}}}else throw new i("Operation `op` property is not one of operations defined in RFC-6902","OPERATION_OP_INVALID",t,e,r)}function validate(e,t,r){try{if(!Array.isArray(e))throw new i("Patch sequence must be an array","SEQUENCE_NOT_AN_ARRAY");if(t)core_applyPatch(helpers_deepClone(t),helpers_deepClone(e),r||!0);else{r=r||validator;for(var a=0;a<e.length;a++)r(e[a],a,t,void 0)}}catch(e){if(e instanceof i)return e;throw e}}function _areEquals(e,t){if(e===t)return!0;if(e&&t&&"object"==typeof e&&"object"==typeof t){var r,a,n,i=Array.isArray(e),s=Array.isArray(t);if(i&&s){if((a=e.length)!=t.length)return!1;for(r=a;0!=r--;)if(!_areEquals(e[r],t[r]))return!1;return!0}if(i!=s)return!1;var o=Object.keys(e);if((a=o.length)!==Object.keys(t).length)return!1;for(r=a;0!=r--;)if(!t.hasOwnProperty(o[r]))return!1;for(r=a;0!=r--;)if(!_areEquals(e[n=o[r]],t[n]))return!1;return!0}return e!=e&&t!=t}function _generate(e,t,r,a,n){if(t!==e){"function"==typeof t.toJSON&&(t=t.toJSON());for(var i=_objectKeys(t),s=_objectKeys(e),o=!1,l=s.length-1;l>=0;l--){var u=s[l],d=e[u];if(helpers_hasOwnProperty(t,u)&&!(void 0===t[u]&&void 0!==d&&!1===Array.isArray(t))){var c=t[u];"object"==typeof d&&null!=d&&"object"==typeof c&&null!=c&&Array.isArray(d)===Array.isArray(c)?_generate(d,c,r,a+"/"+escapePathComponent(u),n):d!==c&&(n&&r.push({op:"test",path:a+"/"+escapePathComponent(u),value:helpers_deepClone(d)}),r.push({op:"replace",path:a+"/"+escapePathComponent(u),value:helpers_deepClone(c)}))}else Array.isArray(e)===Array.isArray(t)?(n&&r.push({op:"test",path:a+"/"+escapePathComponent(u),value:helpers_deepClone(d)}),r.push({op:"remove",path:a+"/"+escapePathComponent(u)}),o=!0):(n&&r.push({op:"test",path:a,value:e}),r.push({op:"replace",path:a,value:t}))}if(o||i.length!=s.length)for(var l=0;l<i.length;l++){var u=i[l];helpers_hasOwnProperty(e,u)||void 0===t[u]||r.push({op:"add",path:a+"/"+escapePathComponent(u),value:helpers_deepClone(t[u])})}}}function compare(e,t,r=!1){var a=[];return _generate(e,t,a,"",r),a}new WeakMap},2991:function(e,t,r){"use strict";function parseJsonMarkdown(e,t=parsePartialJson){e=e.trim();let r=/```(json)?(.*)```/s.exec(e);return t(r?r[2]:e)}function parsePartialJson(e){if(void 0===e)return null;try{return JSON.parse(e)}catch(e){}let t="",r=[],a=!1,n=!1;for(let i of e){if(a)'"'!==i||n?"\n"!==i||n?n="\\"===i&&!n:i="\\n":a=!1;else if('"'===i)a=!0,n=!1;else if("{"===i)r.push("}");else if("["===i)r.push("]");else if("}"===i||"]"===i){if(!r||r[r.length-1]!==i)return null;r.pop()}t+=i}a&&(t+='"');for(let e=r.length-1;e>=0;e-=1)t+=r[e];try{return JSON.parse(t)}catch(e){return null}}r.d(t,{M:function(){return parseJsonMarkdown},g:function(){return parsePartialJson}})},2272:function(e,t,r){"use strict";r.d(t,{E7:function(){return pipeGeneratorWithSetup},QJ:function(){return IterableReadableStream},qq:function(){return AsyncGeneratorWithSetup},y2:function(){return atee},zo:function(){return concat}});let IterableReadableStream=class IterableReadableStream extends ReadableStream{constructor(){super(...arguments),Object.defineProperty(this,"reader",{enumerable:!0,configurable:!0,writable:!0,value:void 0})}ensureReader(){this.reader||(this.reader=this.getReader())}async next(){this.ensureReader();try{let e=await this.reader.read();if(e.done)return this.reader.releaseLock(),{done:!0,value:void 0};return{done:!1,value:e.value}}catch(e){throw this.reader.releaseLock(),e}}async return(){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}return{done:!0,value:void 0}}async throw(e){if(this.ensureReader(),this.locked){let e=this.reader.cancel();this.reader.releaseLock(),await e}throw e}[Symbol.asyncIterator](){return this}static fromReadableStream(e){let t=e.getReader();return new IterableReadableStream({start(e){return pump();function pump(){return t.read().then(({done:t,value:r})=>{if(t){e.close();return}return e.enqueue(r),pump()})}},cancel(){t.releaseLock()}})}static fromAsyncGenerator(e){return new IterableReadableStream({async pull(t){let{value:r,done:a}=await e.next();a&&t.close(),t.enqueue(r)},async cancel(t){await e.return(t)}})}};function atee(e,t=2){let r=Array.from({length:t},()=>[]);return r.map(async function*(t){for(;;)if(0===t.length){let t=await e.next();for(let e of r)e.push(t)}else{if(t[0].done)return;yield t.shift().value}})}function concat(e,t){if(Array.isArray(e)&&Array.isArray(t))return e.concat(t);if("string"==typeof e&&"string"==typeof t||"number"==typeof e&&"number"==typeof t)return e+t;if("concat"in e&&"function"==typeof e.concat)return e.concat(t);if("object"==typeof e&&"object"==typeof t){let r={...e};for(let[e,a]of Object.entries(t))e in r&&!Array.isArray(r[e])?r[e]=concat(r[e],a):r[e]=a;return r}throw Error(`Cannot concat ${typeof e} and ${typeof t}`)}let AsyncGeneratorWithSetup=class AsyncGeneratorWithSetup{constructor(e,t){Object.defineProperty(this,"generator",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"setup",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResult",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"firstResultUsed",{enumerable:!0,configurable:!0,writable:!0,value:!1}),this.generator=e,this.setup=new Promise((r,a)=>{this.firstResult=e.next(),t?this.firstResult.then(t).then(r,a):this.firstResult.then(e=>r(void 0),a)})}async next(...e){return this.firstResultUsed?this.generator.next(...e):(this.firstResultUsed=!0,this.firstResult)}async return(e){return this.generator.return(e)}async throw(e){return this.generator.throw(e)}[Symbol.asyncIterator](){return this}};async function pipeGeneratorWithSetup(e,t,r,...a){let n=new AsyncGeneratorWithSetup(t,r),i=await n.setup;return{output:e(n,i,...a),setup:i}}},1907:function(e,t,r){"use strict";r.d(t,{XQ:function(){return DynamicStructuredTool},UA:function(){return Tool},YE:function(){return ToolInputParsingException}});var a=r(6418),n=r(7018),i=r(7610),s=r(9189);let ToolInputParsingException=class ToolInputParsingException extends Error{constructor(e,t){super(e),Object.defineProperty(this,"output",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.output=t}};let StructuredTool=class StructuredTool extends i.BD{get lc_namespace(){return["langchain","tools"]}constructor(e){super(e??{}),Object.defineProperty(this,"returnDirect",{enumerable:!0,configurable:!0,writable:!0,value:!1})}async invoke(e,t){return this.call(e,(0,s.LE)(t))}async call(e,t,r){let a,i;try{a=await this.schema.parseAsync(e)}catch(t){throw new ToolInputParsingException("Received tool input did not match expected schema",JSON.stringify(e))}let s=(0,n.QH)(t),o=await n.Ye.configure(s.callbacks,this.callbacks,s.tags||r,this.tags,s.metadata,this.metadata,{verbose:this.verbose}),l=await o?.handleToolStart(this.toJSON(),"string"==typeof a?a:JSON.stringify(a),s.runId,void 0,void 0,void 0,s.runName);delete s.runId;try{i=await this._call(a,l,s)}catch(e){throw await l?.handleToolError(e),e}return await l?.handleToolEnd(i),i}};let Tool=class Tool extends StructuredTool{constructor(e){super(e),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:a.z.object({input:a.z.string().optional()}).transform(e=>e.input)})}call(e,t){return super.call("string"!=typeof e&&e?e:{input:e},t)}};let DynamicStructuredTool=class DynamicStructuredTool extends StructuredTool{static lc_name(){return"DynamicStructuredTool"}constructor(e){super(e),Object.defineProperty(this,"name",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"description",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"func",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"schema",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),this.name=e.name,this.description=e.description,this.func=e.func,this.returnDirect=e.returnDirect??this.returnDirect,this.schema=e.schema}async call(e,t,r){let a=(0,n.QH)(t);return void 0===a.runName&&(a.runName=this.name),super.call(e,a,r)}_call(e,t,r){return this.func(e,t,r)}}},9711:function(e,t,r){"use strict";r.d(t,{Y_:function(){return zodToJsonSchema_zodToJsonSchema}});let a=Symbol("Let zodToJsonSchema decide on which parser to use"),n={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",definitionPath:"definitions",target:"jsonSchema7",strictUnions:!1,definitions:{},errorMessages:!1,markdownDescription:!1,patternStrategy:"escape",emailStrategy:"format:email",base64Strategy:"contentEncoding:base64"},getDefaultOptions=e=>"string"==typeof e?{...n,name:e}:{...n,...e},getRefs=e=>{let t=getDefaultOptions(e),r=void 0!==t.name?[...t.basePath,t.definitionPath,t.name]:t.basePath;return{...t,currentPath:r,propertyPath:void 0,seen:new Map(Object.entries(t.definitions).map(([e,r])=>[r._def,{def:r._def,path:[...t.basePath,t.definitionPath,e],jsonSchema:void 0}]))}};var i=r(6418);function parseAnyDef(){return{}}function addErrorMessage(e,t,r,a){a?.errorMessages&&r&&(e.errorMessage={...e.errorMessage,[t]:r})}function setResponseValueAndErrors(e,t,r,a,n){e[t]=r,addErrorMessage(e,t,a,n)}function parseArrayDef(e,t){let r={type:"array"};return e.type?._def?.typeName!==i.pA.ZodAny&&(r.items=parseDef_parseDef(e.type._def,{...t,currentPath:[...t.currentPath,"items"]})),e.minLength&&setResponseValueAndErrors(r,"minItems",e.minLength.value,e.minLength.message,t),e.maxLength&&setResponseValueAndErrors(r,"maxItems",e.maxLength.value,e.maxLength.message,t),e.exactLength&&(setResponseValueAndErrors(r,"minItems",e.exactLength.value,e.exactLength.message,t),setResponseValueAndErrors(r,"maxItems",e.exactLength.value,e.exactLength.message,t)),r}function parseBigintDef(e,t){let r={type:"integer",format:"int64"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"min":"jsonSchema7"===t.target?a.inclusive?setResponseValueAndErrors(r,"minimum",a.value,a.message,t):setResponseValueAndErrors(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),setResponseValueAndErrors(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?setResponseValueAndErrors(r,"maximum",a.value,a.message,t):setResponseValueAndErrors(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),setResponseValueAndErrors(r,"maximum",a.value,a.message,t));break;case"multipleOf":setResponseValueAndErrors(r,"multipleOf",a.value,a.message,t)}return r}function parseBooleanDef(){return{type:"boolean"}}function parseBrandedDef(e,t){return parseDef_parseDef(e.type._def,t)}let parseCatchDef=(e,t)=>parseDef_parseDef(e.innerType._def,t);function parseDateDef(e,t,r){let a=r??t.dateStrategy;if(Array.isArray(a))return{anyOf:a.map((r,a)=>parseDateDef(e,t,r))};switch(a){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return integerDateParser(e,t)}}let integerDateParser=(e,t)=>{let r={type:"integer",format:"unix-time"};if("openApi3"===t.target)return r;for(let a of e.checks)switch(a.kind){case"min":setResponseValueAndErrors(r,"minimum",a.value,a.message,t);break;case"max":setResponseValueAndErrors(r,"maximum",a.value,a.message,t)}return r};function parseDefaultDef(e,t){return{...parseDef_parseDef(e.innerType._def,t),default:e.defaultValue()}}function parseEffectsDef(e,t){return"input"===t.effectStrategy?parseDef_parseDef(e.schema._def,t):{}}function parseEnumDef(e){return{type:"string",enum:e.values}}let isJsonSchema7AllOfType=e=>(!("type"in e)||"string"!==e.type)&&"allOf"in e;function parseIntersectionDef(e,t){let r=[parseDef_parseDef(e.left._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),parseDef_parseDef(e.right._def,{...t,currentPath:[...t.currentPath,"allOf","1"]})].filter(e=>!!e),a="jsonSchema2019-09"===t.target?{unevaluatedProperties:!1}:void 0,n=[];return r.forEach(e=>{if(isJsonSchema7AllOfType(e))n.push(...e.allOf),void 0===e.unevaluatedProperties&&(a=void 0);else{let t=e;if("additionalProperties"in e&&!1===e.additionalProperties){let{additionalProperties:r,...a}=e;t=a}else a=void 0;n.push(t)}}),n.length?{allOf:n,...a}:void 0}function parseLiteralDef(e,t){let r=typeof e.value;return"bigint"!==r&&"number"!==r&&"boolean"!==r&&"string"!==r?{type:Array.isArray(e.value)?"array":"object"}:"openApi3"===t.target?{type:"bigint"===r?"integer":r,enum:[e.value]}:{type:"bigint"===r?"integer":r,const:e.value}}let s={cuid:"^[cC][^\\s-]{8,}$",cuid2:"^[a-z][a-z0-9]*$",ulid:"^[0-9A-HJKMNP-TV-Z]{26}$",email:"^(?!\\.)(?!.*\\.\\.)([a-zA-Z0-9_+-\\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\\-]*\\.)+[a-zA-Z]{2,}$",emoji:"^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",base64:"^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$",nanoid:"^[a-zA-Z0-9_-]{21}$"};function parseStringDef(e,t){let r={type:"string"};function processPattern(e){return"escape"===t.patternStrategy?escapeNonAlphaNumeric(e):e}if(e.checks)for(let a of e.checks)switch(a.kind){case"min":setResponseValueAndErrors(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t);break;case"max":setResponseValueAndErrors(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"email":switch(t.emailStrategy){case"format:email":addFormat(r,"email",a.message,t);break;case"format:idn-email":addFormat(r,"idn-email",a.message,t);break;case"pattern:zod":addPattern(r,s.email,a.message,t)}break;case"url":addFormat(r,"uri",a.message,t);break;case"uuid":addFormat(r,"uuid",a.message,t);break;case"regex":addPattern(r,a.regex.source,a.message,t);break;case"cuid":addPattern(r,s.cuid,a.message,t);break;case"cuid2":addPattern(r,s.cuid2,a.message,t);break;case"startsWith":addPattern(r,"^"+processPattern(a.value),a.message,t);break;case"endsWith":addPattern(r,processPattern(a.value)+"$",a.message,t);break;case"datetime":addFormat(r,"date-time",a.message,t);break;case"date":addFormat(r,"date",a.message,t);break;case"time":addFormat(r,"time",a.message,t);break;case"duration":addFormat(r,"duration",a.message,t);break;case"length":setResponseValueAndErrors(r,"minLength","number"==typeof r.minLength?Math.max(r.minLength,a.value):a.value,a.message,t),setResponseValueAndErrors(r,"maxLength","number"==typeof r.maxLength?Math.min(r.maxLength,a.value):a.value,a.message,t);break;case"includes":addPattern(r,processPattern(a.value),a.message,t);break;case"ip":"v6"!==a.version&&addFormat(r,"ipv4",a.message,t),"v4"!==a.version&&addFormat(r,"ipv6",a.message,t);break;case"emoji":addPattern(r,s.emoji,a.message,t);break;case"ulid":addPattern(r,s.ulid,a.message,t);break;case"base64":switch(t.base64Strategy){case"format:binary":addFormat(r,"binary",a.message,t);break;case"contentEncoding:base64":setResponseValueAndErrors(r,"contentEncoding","base64",a.message,t);break;case"pattern:zod":addPattern(r,s.base64,a.message,t)}break;case"nanoid":addPattern(r,s.nanoid,a.message,t)}return r}let escapeNonAlphaNumeric=e=>Array.from(e).map(e=>/[a-zA-Z0-9]/.test(e)?e:`\\${e}`).join(""),addFormat=(e,t,r,a)=>{e.format||e.anyOf?.some(e=>e.format)?(e.anyOf||(e.anyOf=[]),e.format&&(e.anyOf.push({format:e.format,...e.errorMessage&&a.errorMessages&&{errorMessage:{format:e.errorMessage.format}}}),delete e.format,e.errorMessage&&(delete e.errorMessage.format,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.anyOf.push({format:t,...r&&a.errorMessages&&{errorMessage:{format:r}}})):setResponseValueAndErrors(e,"format",t,r,a)},addPattern=(e,t,r,a)=>{e.pattern||e.allOf?.some(e=>e.pattern)?(e.allOf||(e.allOf=[]),e.pattern&&(e.allOf.push({pattern:e.pattern,...e.errorMessage&&a.errorMessages&&{errorMessage:{pattern:e.errorMessage.pattern}}}),delete e.pattern,e.errorMessage&&(delete e.errorMessage.pattern,0===Object.keys(e.errorMessage).length&&delete e.errorMessage)),e.allOf.push({pattern:t,...r&&a.errorMessages&&{errorMessage:{pattern:r}}})):setResponseValueAndErrors(e,"pattern",t,r,a)};function parseRecordDef(e,t){if("openApi3"===t.target&&e.keyType?._def.typeName===i.pA.ZodEnum)return{type:"object",required:e.keyType._def.values,properties:e.keyType._def.values.reduce((r,a)=>({...r,[a]:parseDef_parseDef(e.valueType._def,{...t,currentPath:[...t.currentPath,"properties",a]})??{}}),{}),additionalProperties:!1};let r={type:"object",additionalProperties:parseDef_parseDef(e.valueType._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??{}};if("openApi3"===t.target)return r;if(e.keyType?._def.typeName===i.pA.ZodString&&e.keyType._def.checks?.length){let a=Object.entries(parseStringDef(e.keyType._def,t)).reduce((e,[t,r])=>"type"===t?e:{...e,[t]:r},{});return{...r,propertyNames:a}}return e.keyType?._def.typeName===i.pA.ZodEnum?{...r,propertyNames:{enum:e.keyType._def.values}}:r}function parseMapDef(e,t){if("record"===t.mapStrategy)return parseRecordDef(e,t);let r=parseDef_parseDef(e.keyType._def,{...t,currentPath:[...t.currentPath,"items","items","0"]})||{},a=parseDef_parseDef(e.valueType._def,{...t,currentPath:[...t.currentPath,"items","items","1"]})||{};return{type:"array",maxItems:125,items:{type:"array",items:[r,a],minItems:2,maxItems:2}}}function parseNativeEnumDef(e){let t=e.values,r=Object.keys(e.values).filter(e=>"number"!=typeof t[t[e]]),a=r.map(e=>t[e]),n=Array.from(new Set(a.map(e=>typeof e)));return{type:1===n.length?"string"===n[0]?"string":"number":["string","number"],enum:a}}function parseNeverDef(){return{not:{}}}function parseNullDef(e){return"openApi3"===e.target?{enum:["null"],nullable:!0}:{type:"null"}}let o={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function parseUnionDef(e,t){if("openApi3"===t.target)return asAnyOf(e,t);let r=e.options instanceof Map?Array.from(e.options.values()):e.options;if(r.every(e=>e._def.typeName in o&&(!e._def.checks||!e._def.checks.length))){let e=r.reduce((e,t)=>{let r=o[t._def.typeName];return r&&!e.includes(r)?[...e,r]:e},[]);return{type:e.length>1?e:e[0]}}if(r.every(e=>"ZodLiteral"===e._def.typeName&&!e.description)){let e=r.reduce((e,t)=>{let r=typeof t._def.value;switch(r){case"string":case"number":case"boolean":return[...e,r];case"bigint":return[...e,"integer"];case"object":if(null===t._def.value)return[...e,"null"];default:return e}},[]);if(e.length===r.length){let t=e.filter((e,t,r)=>r.indexOf(e)===t);return{type:t.length>1?t:t[0],enum:r.reduce((e,t)=>e.includes(t._def.value)?e:[...e,t._def.value],[])}}}else if(r.every(e=>"ZodEnum"===e._def.typeName))return{type:"string",enum:r.reduce((e,t)=>[...e,...t._def.values.filter(t=>!e.includes(t))],[])};return asAnyOf(e,t)}let asAnyOf=(e,t)=>{let r=(e.options instanceof Map?Array.from(e.options.values()):e.options).map((e,r)=>parseDef_parseDef(e._def,{...t,currentPath:[...t.currentPath,"anyOf",`${r}`]})).filter(e=>!!e&&(!t.strictUnions||"object"==typeof e&&Object.keys(e).length>0));return r.length?{anyOf:r}:void 0};function parseNullableDef(e,t){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(e.innerType._def.typeName)&&(!e.innerType._def.checks||!e.innerType._def.checks.length))return"openApi3"===t.target?{type:o[e.innerType._def.typeName],nullable:!0}:{type:[o[e.innerType._def.typeName],"null"]};if("openApi3"===t.target){let r=parseDef_parseDef(e.innerType._def,{...t,currentPath:[...t.currentPath]});return r&&"$ref"in r?{allOf:[r],nullable:!0}:r&&{...r,nullable:!0}}let r=parseDef_parseDef(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","0"]});return r&&{anyOf:[r,{type:"null"}]}}function parseNumberDef(e,t){let r={type:"number"};if(!e.checks)return r;for(let a of e.checks)switch(a.kind){case"int":r.type="integer",addErrorMessage(r,"type",a.message,t);break;case"min":"jsonSchema7"===t.target?a.inclusive?setResponseValueAndErrors(r,"minimum",a.value,a.message,t):setResponseValueAndErrors(r,"exclusiveMinimum",a.value,a.message,t):(a.inclusive||(r.exclusiveMinimum=!0),setResponseValueAndErrors(r,"minimum",a.value,a.message,t));break;case"max":"jsonSchema7"===t.target?a.inclusive?setResponseValueAndErrors(r,"maximum",a.value,a.message,t):setResponseValueAndErrors(r,"exclusiveMaximum",a.value,a.message,t):(a.inclusive||(r.exclusiveMaximum=!0),setResponseValueAndErrors(r,"maximum",a.value,a.message,t));break;case"multipleOf":setResponseValueAndErrors(r,"multipleOf",a.value,a.message,t)}return r}function decideAdditionalProperties(e,t){return"strict"===t.removeAdditionalStrategy?"ZodNever"===e.catchall._def.typeName?"strict"!==e.unknownKeys:parseDef_parseDef(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0:"ZodNever"===e.catchall._def.typeName?"passthrough"===e.unknownKeys:parseDef_parseDef(e.catchall._def,{...t,currentPath:[...t.currentPath,"additionalProperties"]})??!0}function parseObjectDef(e,t){let r={type:"object",...Object.entries(e.shape()).reduce((e,[r,a])=>{if(void 0===a||void 0===a._def)return e;let n=parseDef_parseDef(a._def,{...t,currentPath:[...t.currentPath,"properties",r],propertyPath:[...t.currentPath,"properties",r]});return void 0===n?e:{properties:{...e.properties,[r]:n},required:a.isOptional()?e.required:[...e.required,r]}},{properties:{},required:[]}),additionalProperties:decideAdditionalProperties(e,t)};return r.required.length||delete r.required,r}let parseOptionalDef=(e,t)=>{if(t.currentPath.toString()===t.propertyPath?.toString())return parseDef_parseDef(e.innerType._def,t);let r=parseDef_parseDef(e.innerType._def,{...t,currentPath:[...t.currentPath,"anyOf","1"]});return r?{anyOf:[{not:{}},r]}:{}},parsePipelineDef=(e,t)=>{if("input"===t.pipeStrategy)return parseDef_parseDef(e.in._def,t);if("output"===t.pipeStrategy)return parseDef_parseDef(e.out._def,t);let r=parseDef_parseDef(e.in._def,{...t,currentPath:[...t.currentPath,"allOf","0"]}),a=parseDef_parseDef(e.out._def,{...t,currentPath:[...t.currentPath,"allOf",r?"1":"0"]});return{allOf:[r,a].filter(e=>void 0!==e)}};function parsePromiseDef(e,t){return parseDef_parseDef(e.type._def,t)}function parseSetDef(e,t){let r=parseDef_parseDef(e.valueType._def,{...t,currentPath:[...t.currentPath,"items"]}),a={type:"array",uniqueItems:!0,items:r};return e.minSize&&setResponseValueAndErrors(a,"minItems",e.minSize.value,e.minSize.message,t),e.maxSize&&setResponseValueAndErrors(a,"maxItems",e.maxSize.value,e.maxSize.message,t),a}function parseTupleDef(e,t){return e.rest?{type:"array",minItems:e.items.length,items:e.items.map((e,r)=>parseDef_parseDef(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[]),additionalItems:parseDef_parseDef(e.rest._def,{...t,currentPath:[...t.currentPath,"additionalItems"]})}:{type:"array",minItems:e.items.length,maxItems:e.items.length,items:e.items.map((e,r)=>parseDef_parseDef(e._def,{...t,currentPath:[...t.currentPath,"items",`${r}`]})).reduce((e,t)=>void 0===t?e:[...e,t],[])}}function parseUndefinedDef(){return{not:{}}}function parseUnknownDef(){return{}}let parseReadonlyDef=(e,t)=>parseDef_parseDef(e.innerType._def,t);function parseDef_parseDef(e,t,r=!1){let n=t.seen.get(e);if(t.override){let i=t.override?.(e,t,n,r);if(i!==a)return i}if(n&&!r){let e=get$ref(n,t);if(void 0!==e)return e}let i={def:e,path:t.currentPath,jsonSchema:void 0};t.seen.set(e,i);let s=selectParser(e,e.typeName,t);return s&&addMeta(e,t,s),i.jsonSchema=s,s}let get$ref=(e,t)=>{switch(t.$refStrategy){case"root":return{$ref:e.path.join("/")};case"relative":return{$ref:getRelativePath(t.currentPath,e.path)};case"none":case"seen":if(e.path.length<t.currentPath.length&&e.path.every((e,r)=>t.currentPath[r]===e))return console.warn(`Recursive reference detected at ${t.currentPath.join("/")}! Defaulting to any`),{};return"seen"===t.$refStrategy?{}:void 0}},getRelativePath=(e,t)=>{let r=0;for(;r<e.length&&r<t.length&&e[r]===t[r];r++);return[(e.length-r).toString(),...t.slice(r)].join("/")},selectParser=(e,t,r)=>{switch(t){case i.pA.ZodString:return parseStringDef(e,r);case i.pA.ZodNumber:return parseNumberDef(e,r);case i.pA.ZodObject:return parseObjectDef(e,r);case i.pA.ZodBigInt:return parseBigintDef(e,r);case i.pA.ZodBoolean:return parseBooleanDef();case i.pA.ZodDate:return parseDateDef(e,r);case i.pA.ZodUndefined:return parseUndefinedDef();case i.pA.ZodNull:return parseNullDef(r);case i.pA.ZodArray:return parseArrayDef(e,r);case i.pA.ZodUnion:case i.pA.ZodDiscriminatedUnion:return parseUnionDef(e,r);case i.pA.ZodIntersection:return parseIntersectionDef(e,r);case i.pA.ZodTuple:return parseTupleDef(e,r);case i.pA.ZodRecord:return parseRecordDef(e,r);case i.pA.ZodLiteral:return parseLiteralDef(e,r);case i.pA.ZodEnum:return parseEnumDef(e);case i.pA.ZodNativeEnum:return parseNativeEnumDef(e);case i.pA.ZodNullable:return parseNullableDef(e,r);case i.pA.ZodOptional:return parseOptionalDef(e,r);case i.pA.ZodMap:return parseMapDef(e,r);case i.pA.ZodSet:return parseSetDef(e,r);case i.pA.ZodLazy:return parseDef_parseDef(e.getter()._def,r);case i.pA.ZodPromise:return parsePromiseDef(e,r);case i.pA.ZodNaN:case i.pA.ZodNever:return parseNeverDef();case i.pA.ZodEffects:return parseEffectsDef(e,r);case i.pA.ZodAny:return parseAnyDef();case i.pA.ZodUnknown:return parseUnknownDef();case i.pA.ZodDefault:return parseDefaultDef(e,r);case i.pA.ZodBranded:return parseBrandedDef(e,r);case i.pA.ZodReadonly:return parseReadonlyDef(e,r);case i.pA.ZodCatch:return parseCatchDef(e,r);case i.pA.ZodPipeline:return parsePipelineDef(e,r);case i.pA.ZodFunction:case i.pA.ZodVoid:case i.pA.ZodSymbol:default:return}},addMeta=(e,t,r)=>(e.description&&(r.description=e.description,t.markdownDescription&&(r.markdownDescription=e.description)),r),zodToJsonSchema_zodToJsonSchema=(e,t)=>{let r=getRefs(t),a="object"==typeof t&&t.definitions?Object.entries(t.definitions).reduce((e,[t,a])=>({...e,[t]:parseDef_parseDef(a._def,{...r,currentPath:[...r.basePath,r.definitionPath,t]},!0)??{}}),{}):void 0,n="string"==typeof t?t:t?.name,i=parseDef_parseDef(e._def,void 0===n?r:{...r,currentPath:[...r.basePath,r.definitionPath,n]},!1)??{},s=void 0===n?a?{...i,[r.definitionPath]:a}:i:{$ref:[..."relative"===r.$refStrategy?[]:r.basePath,r.definitionPath,n].join("/"),[r.definitionPath]:{...a,[n]:i}};return"jsonSchema7"===r.target?s.$schema="http://json-schema.org/draft-07/schema#":"jsonSchema2019-09"===r.target&&(s.$schema="https://json-schema.org/draft/2019-09/schema#"),s}},6418:function(e,t,r){"use strict";let a;r.d(t,{pA:function(){return eu},z:function(){return ed}}),function(e){function assertIs(e){}function assertNever(e){throw Error()}function joinValues(e,t=" | "){return e.map(e=>"string"==typeof e?`'${e}'`:e).join(t)}e.assertEqual=e=>e,e.assertIs=assertIs,e.assertNever=assertNever,e.arrayToEnum=e=>{let t={};for(let r of e)t[r]=r;return t},e.getValidEnumValues=t=>{let r=e.objectKeys(t).filter(e=>"number"!=typeof t[t[e]]),a={};for(let e of r)a[e]=t[e];return e.objectValues(a)},e.objectValues=t=>e.objectKeys(t).map(function(e){return t[e]}),e.objectKeys="function"==typeof Object.keys?e=>Object.keys(e):e=>{let t=[];for(let r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.push(r);return t},e.find=(e,t)=>{for(let r of e)if(t(r))return r},e.isInteger="function"==typeof Number.isInteger?e=>Number.isInteger(e):e=>"number"==typeof e&&isFinite(e)&&Math.floor(e)===e,e.joinValues=joinValues,e.jsonStringifyReplacer=(e,t)=>"bigint"==typeof t?t.toString():t}(en||(en={})),(ei||(ei={})).mergeShapes=(e,t)=>({...e,...t});let n=en.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),getParsedType=e=>{let t=typeof e;switch(t){case"undefined":return n.undefined;case"string":return n.string;case"number":return isNaN(e)?n.nan:n.number;case"boolean":return n.boolean;case"function":return n.function;case"bigint":return n.bigint;case"symbol":return n.symbol;case"object":if(Array.isArray(e))return n.array;if(null===e)return n.null;if(e.then&&"function"==typeof e.then&&e.catch&&"function"==typeof e.catch)return n.promise;if("undefined"!=typeof Map&&e instanceof Map)return n.map;if("undefined"!=typeof Set&&e instanceof Set)return n.set;if("undefined"!=typeof Date&&e instanceof Date)return n.date;return n.object;default:return n.unknown}},i=en.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);let ZodError=class ZodError extends Error{constructor(e){super(),this.issues=[],this.addIssue=e=>{this.issues=[...this.issues,e]},this.addIssues=(e=[])=>{this.issues=[...this.issues,...e]};let t=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,t):this.__proto__=t,this.name="ZodError",this.issues=e}get errors(){return this.issues}format(e){let t=e||function(e){return e.message},r={_errors:[]},processError=e=>{for(let a of e.issues)if("invalid_union"===a.code)a.unionErrors.map(processError);else if("invalid_return_type"===a.code)processError(a.returnTypeError);else if("invalid_arguments"===a.code)processError(a.argumentsError);else if(0===a.path.length)r._errors.push(t(a));else{let e=r,n=0;for(;n<a.path.length;){let r=a.path[n],i=n===a.path.length-1;i?(e[r]=e[r]||{_errors:[]},e[r]._errors.push(t(a))):e[r]=e[r]||{_errors:[]},e=e[r],n++}}};return processError(this),r}static assert(e){if(!(e instanceof ZodError))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,en.jsonStringifyReplacer,2)}get isEmpty(){return 0===this.issues.length}flatten(e=e=>e.message){let t={},r=[];for(let a of this.issues)a.path.length>0?(t[a.path[0]]=t[a.path[0]]||[],t[a.path[0]].push(e(a))):r.push(e(a));return{formErrors:r,fieldErrors:t}}get formErrors(){return this.flatten()}};ZodError.create=e=>{let t=new ZodError(e);return t};let errorMap=(e,t)=>{let r;switch(e.code){case i.invalid_type:r=e.received===n.undefined?"Required":`Expected ${e.expected}, received ${e.received}`;break;case i.invalid_literal:r=`Invalid literal value, expected ${JSON.stringify(e.expected,en.jsonStringifyReplacer)}`;break;case i.unrecognized_keys:r=`Unrecognized key(s) in object: ${en.joinValues(e.keys,", ")}`;break;case i.invalid_union:r="Invalid input";break;case i.invalid_union_discriminator:r=`Invalid discriminator value. Expected ${en.joinValues(e.options)}`;break;case i.invalid_enum_value:r=`Invalid enum value. Expected ${en.joinValues(e.options)}, received '${e.received}'`;break;case i.invalid_arguments:r="Invalid function arguments";break;case i.invalid_return_type:r="Invalid function return type";break;case i.invalid_date:r="Invalid date";break;case i.invalid_string:"object"==typeof e.validation?"includes"in e.validation?(r=`Invalid input: must include "${e.validation.includes}"`,"number"==typeof e.validation.position&&(r=`${r} at one or more positions greater than or equal to ${e.validation.position}`)):"startsWith"in e.validation?r=`Invalid input: must start with "${e.validation.startsWith}"`:"endsWith"in e.validation?r=`Invalid input: must end with "${e.validation.endsWith}"`:en.assertNever(e.validation):r="regex"!==e.validation?`Invalid ${e.validation}`:"Invalid";break;case i.too_small:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at least":"more than"} ${e.minimum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at least":"over"} ${e.minimum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${e.minimum}`:"date"===e.type?`Date must be ${e.exact?"exactly equal to ":e.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(e.minimum))}`:"Invalid input";break;case i.too_big:r="array"===e.type?`Array must contain ${e.exact?"exactly":e.inclusive?"at most":"less than"} ${e.maximum} element(s)`:"string"===e.type?`String must contain ${e.exact?"exactly":e.inclusive?"at most":"under"} ${e.maximum} character(s)`:"number"===e.type?`Number must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"bigint"===e.type?`BigInt must be ${e.exact?"exactly":e.inclusive?"less than or equal to":"less than"} ${e.maximum}`:"date"===e.type?`Date must be ${e.exact?"exactly":e.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(e.maximum))}`:"Invalid input";break;case i.custom:r="Invalid input";break;case i.invalid_intersection_types:r="Intersection results could not be merged";break;case i.not_multiple_of:r=`Number must be a multiple of ${e.multipleOf}`;break;case i.not_finite:r="Number must be finite";break;default:r=t.defaultError,en.assertNever(e)}return{message:r}},s=errorMap;function setErrorMap(e){s=e}function getErrorMap(){return s}let makeIssue=e=>{let{data:t,path:r,errorMaps:a,issueData:n}=e,i=[...r,...n.path||[]],s={...n,path:i};if(void 0!==n.message)return{...n,path:i,message:n.message};let o="",l=a.filter(e=>!!e).slice().reverse();for(let e of l)o=e(s,{data:t,defaultError:o}).message;return{...n,path:i,message:o}};function addIssueToContext(e,t){let r=getErrorMap(),a=makeIssue({issueData:t,data:e.data,path:e.path,errorMaps:[e.common.contextualErrorMap,e.schemaErrorMap,r,r===errorMap?void 0:errorMap].filter(e=>!!e)});e.common.issues.push(a)}let ParseStatus=class ParseStatus{constructor(){this.value="valid"}dirty(){"valid"===this.value&&(this.value="dirty")}abort(){"aborted"!==this.value&&(this.value="aborted")}static mergeArray(e,t){let r=[];for(let a of t){if("aborted"===a.status)return o;"dirty"===a.status&&e.dirty(),r.push(a.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,t){let r=[];for(let e of t){let t=await e.key,a=await e.value;r.push({key:t,value:a})}return ParseStatus.mergeObjectSync(e,r)}static mergeObjectSync(e,t){let r={};for(let a of t){let{key:t,value:n}=a;if("aborted"===t.status||"aborted"===n.status)return o;"dirty"===t.status&&e.dirty(),"dirty"===n.status&&e.dirty(),"__proto__"!==t.value&&(void 0!==n.value||a.alwaysSet)&&(r[t.value]=n.value)}return{status:e.value,value:r}}};let o=Object.freeze({status:"aborted"}),DIRTY=e=>({status:"dirty",value:e}),OK=e=>({status:"valid",value:e}),isAborted=e=>"aborted"===e.status,isDirty=e=>"dirty"===e.status,isValid=e=>"valid"===e.status,isAsync=e=>"undefined"!=typeof Promise&&e instanceof Promise;function __classPrivateFieldGet(e,t,r,a){if("a"===r&&!a)throw TypeError("Private accessor was defined without a getter");if("function"==typeof t?e!==t||!a:!t.has(e))throw TypeError("Cannot read private member from an object whose class did not declare it");return"m"===r?a:"a"===r?a.call(e):a?a.value:t.get(e)}function __classPrivateFieldSet(e,t,r,a,n){if("m"===a)throw TypeError("Private method is not writable");if("a"===a&&!n)throw TypeError("Private accessor was defined without a setter");if("function"==typeof t?e!==t||!n:!t.has(e))throw TypeError("Cannot write private member to an object whose class did not declare it");return"a"===a?n.call(e,r):n?n.value=r:t.set(e,r),r}"function"==typeof SuppressedError&&SuppressedError,(er=es||(es={})).errToObj=e=>"string"==typeof e?{message:e}:e||{},er.toString=e=>"string"==typeof e?e:null==e?void 0:e.message;let ParseInputLazyPath=class ParseInputLazyPath{constructor(e,t,r,a){this._cachedPath=[],this.parent=e,this.data=t,this._path=r,this._key=a}get path(){return this._cachedPath.length||(this._key instanceof Array?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}};let handleResult=(e,t)=>{if(isValid(t))return{success:!0,data:t.value};if(!e.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){if(this._error)return this._error;let t=new ZodError(e.common.issues);return this._error=t,this._error}}};function processCreateParams(e){if(!e)return{};let{errorMap:t,invalid_type_error:r,required_error:a,description:n}=e;if(t&&(r||a))throw Error('Can\'t use "invalid_type_error" or "required_error" in conjunction with custom error map.');return t?{errorMap:t,description:n}:{errorMap:(t,n)=>{var i,s;let{message:o}=e;return"invalid_enum_value"===t.code?{message:null!=o?o:n.defaultError}:void 0===n.data?{message:null!==(i=null!=o?o:a)&&void 0!==i?i:n.defaultError}:"invalid_type"!==t.code?{message:n.defaultError}:{message:null!==(s=null!=o?o:r)&&void 0!==s?s:n.defaultError}},description:n}}let ZodType=class ZodType{constructor(e){this.spa=this.safeParseAsync,this._def=e,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this)}get description(){return this._def.description}_getType(e){return getParsedType(e.data)}_getOrReturnCtx(e,t){return t||{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}_processInputParams(e){return{status:new ParseStatus,ctx:{common:e.parent.common,data:e.data,parsedType:getParsedType(e.data),schemaErrorMap:this._def.errorMap,path:e.path,parent:e.parent}}}_parseSync(e){let t=this._parse(e);if(isAsync(t))throw Error("Synchronous parse encountered promise.");return t}_parseAsync(e){let t=this._parse(e);return Promise.resolve(t)}parse(e,t){let r=this.safeParse(e,t);if(r.success)return r.data;throw r.error}safeParse(e,t){var r;let a={common:{issues:[],async:null!==(r=null==t?void 0:t.async)&&void 0!==r&&r,contextualErrorMap:null==t?void 0:t.errorMap},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},n=this._parseSync({data:e,path:a.path,parent:a});return handleResult(a,n)}async parseAsync(e,t){let r=await this.safeParseAsync(e,t);if(r.success)return r.data;throw r.error}async safeParseAsync(e,t){let r={common:{issues:[],contextualErrorMap:null==t?void 0:t.errorMap,async:!0},path:(null==t?void 0:t.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:e,parsedType:getParsedType(e)},a=this._parse({data:e,path:r.path,parent:r}),n=await (isAsync(a)?a:Promise.resolve(a));return handleResult(r,n)}refine(e,t){let getIssueProperties=e=>"string"==typeof t||void 0===t?{message:t}:"function"==typeof t?t(e):t;return this._refinement((t,r)=>{let a=e(t),setError=()=>r.addIssue({code:i.custom,...getIssueProperties(t)});return"undefined"!=typeof Promise&&a instanceof Promise?a.then(e=>!!e||(setError(),!1)):!!a||(setError(),!1)})}refinement(e,t){return this._refinement((r,a)=>!!e(r)||(a.addIssue("function"==typeof t?t(r,a):t),!1))}_refinement(e){return new ZodEffects({schema:this,typeName:eu.ZodEffects,effect:{type:"refinement",refinement:e}})}superRefine(e){return this._refinement(e)}optional(){return ZodOptional.create(this,this._def)}nullable(){return ZodNullable.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return ZodArray.create(this,this._def)}promise(){return ZodPromise.create(this,this._def)}or(e){return ZodUnion.create([this,e],this._def)}and(e){return ZodIntersection.create(this,e,this._def)}transform(e){return new ZodEffects({...processCreateParams(this._def),schema:this,typeName:eu.ZodEffects,effect:{type:"transform",transform:e}})}default(e){return new ZodDefault({...processCreateParams(this._def),innerType:this,defaultValue:"function"==typeof e?e:()=>e,typeName:eu.ZodDefault})}brand(){return new ZodBranded({typeName:eu.ZodBranded,type:this,...processCreateParams(this._def)})}catch(e){return new ZodCatch({...processCreateParams(this._def),innerType:this,catchValue:"function"==typeof e?e:()=>e,typeName:eu.ZodCatch})}describe(e){let t=this.constructor;return new t({...this._def,description:e})}pipe(e){return ZodPipeline.create(this,e)}readonly(){return ZodReadonly.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}};let l=/^c[^\s-]{8,}$/i,u=/^[0-9a-z]+$/,d=/^[0-9A-HJKMNP-TV-Z]{26}$/,c=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,h=/^[a-z0-9_-]{21}$/i,p=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,f=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,m=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,g=/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,y=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,b="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",_=RegExp(`^${b}$`);function timeRegexSource(e){let t="([01]\\d|2[0-3]):[0-5]\\d:[0-5]\\d";return e.precision?t=`${t}\\.\\d{${e.precision}}`:null==e.precision&&(t=`${t}(\\.\\d+)?`),t}function timeRegex(e){return RegExp(`^${timeRegexSource(e)}$`)}function datetimeRegex(e){let t=`${b}T${timeRegexSource(e)}`,r=[];return r.push(e.local?"Z?":"Z"),e.offset&&r.push("([+-]\\d{2}:?\\d{2})"),t=`${t}(${r.join("|")})`,RegExp(`^${t}$`)}function isValidIP(e,t){return!!(("v4"===t||!t)&&m.test(e)||("v6"===t||!t)&&g.test(e))}let ZodString=class ZodString extends ZodType{_parse(e){let t;this._def.coerce&&(e.data=String(e.data));let r=this._getType(e);if(r!==n.string){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.string,received:t.parsedType}),o}let s=new ParseStatus;for(let r of this._def.checks)if("min"===r.kind)e.data.length<r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if("max"===r.kind)e.data.length>r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!1,message:r.message}),s.dirty());else if("length"===r.kind){let a=e.data.length>r.value,n=e.data.length<r.value;(a||n)&&(t=this._getOrReturnCtx(e,t),a?addIssueToContext(t,{code:i.too_big,maximum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}):n&&addIssueToContext(t,{code:i.too_small,minimum:r.value,type:"string",inclusive:!0,exact:!0,message:r.message}),s.dirty())}else if("email"===r.kind)f.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"email",code:i.invalid_string,message:r.message}),s.dirty());else if("emoji"===r.kind)a||(a=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),a.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"emoji",code:i.invalid_string,message:r.message}),s.dirty());else if("uuid"===r.kind)c.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"uuid",code:i.invalid_string,message:r.message}),s.dirty());else if("nanoid"===r.kind)h.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"nanoid",code:i.invalid_string,message:r.message}),s.dirty());else if("cuid"===r.kind)l.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"cuid",code:i.invalid_string,message:r.message}),s.dirty());else if("cuid2"===r.kind)u.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"cuid2",code:i.invalid_string,message:r.message}),s.dirty());else if("ulid"===r.kind)d.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"ulid",code:i.invalid_string,message:r.message}),s.dirty());else if("url"===r.kind)try{new URL(e.data)}catch(a){addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"url",code:i.invalid_string,message:r.message}),s.dirty()}else if("regex"===r.kind){r.regex.lastIndex=0;let a=r.regex.test(e.data);a||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"regex",code:i.invalid_string,message:r.message}),s.dirty())}else if("trim"===r.kind)e.data=e.data.trim();else if("includes"===r.kind)e.data.includes(r.value,r.position)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_string,validation:{includes:r.value,position:r.position},message:r.message}),s.dirty());else if("toLowerCase"===r.kind)e.data=e.data.toLowerCase();else if("toUpperCase"===r.kind)e.data=e.data.toUpperCase();else if("startsWith"===r.kind)e.data.startsWith(r.value)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_string,validation:{startsWith:r.value},message:r.message}),s.dirty());else if("endsWith"===r.kind)e.data.endsWith(r.value)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_string,validation:{endsWith:r.value},message:r.message}),s.dirty());else if("datetime"===r.kind){let a=datetimeRegex(r);a.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_string,validation:"datetime",message:r.message}),s.dirty())}else if("date"===r.kind)_.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_string,validation:"date",message:r.message}),s.dirty());else if("time"===r.kind){let a=timeRegex(r);a.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_string,validation:"time",message:r.message}),s.dirty())}else"duration"===r.kind?p.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"duration",code:i.invalid_string,message:r.message}),s.dirty()):"ip"===r.kind?isValidIP(e.data,r.version)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"ip",code:i.invalid_string,message:r.message}),s.dirty()):"base64"===r.kind?y.test(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{validation:"base64",code:i.invalid_string,message:r.message}),s.dirty()):en.assertNever(r);return{status:s.value,value:e.data}}_regex(e,t,r){return this.refinement(t=>e.test(t),{validation:t,code:i.invalid_string,...es.errToObj(r)})}_addCheck(e){return new ZodString({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...es.errToObj(e)})}url(e){return this._addCheck({kind:"url",...es.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...es.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...es.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...es.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...es.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...es.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...es.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...es.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...es.errToObj(e)})}datetime(e){var t,r;return"string"==typeof e?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,offset:null!==(t=null==e?void 0:e.offset)&&void 0!==t&&t,local:null!==(r=null==e?void 0:e.local)&&void 0!==r&&r,...es.errToObj(null==e?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return"string"==typeof e?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:void 0===(null==e?void 0:e.precision)?null:null==e?void 0:e.precision,...es.errToObj(null==e?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...es.errToObj(e)})}regex(e,t){return this._addCheck({kind:"regex",regex:e,...es.errToObj(t)})}includes(e,t){return this._addCheck({kind:"includes",value:e,position:null==t?void 0:t.position,...es.errToObj(null==t?void 0:t.message)})}startsWith(e,t){return this._addCheck({kind:"startsWith",value:e,...es.errToObj(t)})}endsWith(e,t){return this._addCheck({kind:"endsWith",value:e,...es.errToObj(t)})}min(e,t){return this._addCheck({kind:"min",value:e,...es.errToObj(t)})}max(e,t){return this._addCheck({kind:"max",value:e,...es.errToObj(t)})}length(e,t){return this._addCheck({kind:"length",value:e,...es.errToObj(t)})}nonempty(e){return this.min(1,es.errToObj(e))}trim(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new ZodString({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>"datetime"===e.kind)}get isDate(){return!!this._def.checks.find(e=>"date"===e.kind)}get isTime(){return!!this._def.checks.find(e=>"time"===e.kind)}get isDuration(){return!!this._def.checks.find(e=>"duration"===e.kind)}get isEmail(){return!!this._def.checks.find(e=>"email"===e.kind)}get isURL(){return!!this._def.checks.find(e=>"url"===e.kind)}get isEmoji(){return!!this._def.checks.find(e=>"emoji"===e.kind)}get isUUID(){return!!this._def.checks.find(e=>"uuid"===e.kind)}get isNANOID(){return!!this._def.checks.find(e=>"nanoid"===e.kind)}get isCUID(){return!!this._def.checks.find(e=>"cuid"===e.kind)}get isCUID2(){return!!this._def.checks.find(e=>"cuid2"===e.kind)}get isULID(){return!!this._def.checks.find(e=>"ulid"===e.kind)}get isIP(){return!!this._def.checks.find(e=>"ip"===e.kind)}get isBase64(){return!!this._def.checks.find(e=>"base64"===e.kind)}get minLength(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxLength(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};function floatSafeRemainder(e,t){let r=(e.toString().split(".")[1]||"").length,a=(t.toString().split(".")[1]||"").length,n=r>a?r:a,i=parseInt(e.toFixed(n).replace(".","")),s=parseInt(t.toFixed(n).replace(".",""));return i%s/Math.pow(10,n)}ZodString.create=e=>{var t;return new ZodString({checks:[],typeName:eu.ZodString,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};let ZodNumber=class ZodNumber extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){let t;this._def.coerce&&(e.data=Number(e.data));let r=this._getType(e);if(r!==n.number){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.number,received:t.parsedType}),o}let a=new ParseStatus;for(let r of this._def.checks)if("int"===r.kind)en.isInteger(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.invalid_type,expected:"integer",received:"float",message:r.message}),a.dirty());else if("min"===r.kind){let n=r.inclusive?e.data<r.value:e.data<=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_small,minimum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else if("max"===r.kind){let n=r.inclusive?e.data>r.value:e.data>=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_big,maximum:r.value,type:"number",inclusive:r.inclusive,exact:!1,message:r.message}),a.dirty())}else"multipleOf"===r.kind?0!==floatSafeRemainder(e.data,r.value)&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):"finite"===r.kind?Number.isFinite(e.data)||(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.not_finite,message:r.message}),a.dirty()):en.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,es.toString(t))}gt(e,t){return this.setLimit("min",e,!1,es.toString(t))}lte(e,t){return this.setLimit("max",e,!0,es.toString(t))}lt(e,t){return this.setLimit("max",e,!1,es.toString(t))}setLimit(e,t,r,a){return new ZodNumber({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:es.toString(a)}]})}_addCheck(e){return new ZodNumber({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:es.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:es.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:es.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:es.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:es.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:es.toString(t)})}finite(e){return this._addCheck({kind:"finite",message:es.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:Number.MIN_SAFE_INTEGER,message:es.toString(e)})._addCheck({kind:"max",inclusive:!0,value:Number.MAX_SAFE_INTEGER,message:es.toString(e)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}get isInt(){return!!this._def.checks.find(e=>"int"===e.kind||"multipleOf"===e.kind&&en.isInteger(e.value))}get isFinite(){let e=null,t=null;for(let r of this._def.checks){if("finite"===r.kind||"int"===r.kind||"multipleOf"===r.kind)return!0;"min"===r.kind?(null===t||r.value>t)&&(t=r.value):"max"===r.kind&&(null===e||r.value<e)&&(e=r.value)}return Number.isFinite(t)&&Number.isFinite(e)}};ZodNumber.create=e=>new ZodNumber({checks:[],typeName:eu.ZodNumber,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});let ZodBigInt=class ZodBigInt extends ZodType{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){let t;this._def.coerce&&(e.data=BigInt(e.data));let r=this._getType(e);if(r!==n.bigint){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.bigint,received:t.parsedType}),o}let a=new ParseStatus;for(let r of this._def.checks)if("min"===r.kind){let n=r.inclusive?e.data<r.value:e.data<=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_small,type:"bigint",minimum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else if("max"===r.kind){let n=r.inclusive?e.data>r.value:e.data>=r.value;n&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_big,type:"bigint",maximum:r.value,inclusive:r.inclusive,message:r.message}),a.dirty())}else"multipleOf"===r.kind?e.data%r.value!==BigInt(0)&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.not_multiple_of,multipleOf:r.value,message:r.message}),a.dirty()):en.assertNever(r);return{status:a.value,value:e.data}}gte(e,t){return this.setLimit("min",e,!0,es.toString(t))}gt(e,t){return this.setLimit("min",e,!1,es.toString(t))}lte(e,t){return this.setLimit("max",e,!0,es.toString(t))}lt(e,t){return this.setLimit("max",e,!1,es.toString(t))}setLimit(e,t,r,a){return new ZodBigInt({...this._def,checks:[...this._def.checks,{kind:e,value:t,inclusive:r,message:es.toString(a)}]})}_addCheck(e){return new ZodBigInt({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:es.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:es.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:es.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:es.toString(e)})}multipleOf(e,t){return this._addCheck({kind:"multipleOf",value:e,message:es.toString(t)})}get minValue(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return e}get maxValue(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return e}};ZodBigInt.create=e=>{var t;return new ZodBigInt({checks:[],typeName:eu.ZodBigInt,coerce:null!==(t=null==e?void 0:e.coerce)&&void 0!==t&&t,...processCreateParams(e)})};let ZodBoolean=class ZodBoolean extends ZodType{_parse(e){this._def.coerce&&(e.data=!!e.data);let t=this._getType(e);if(t!==n.boolean){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.boolean,received:t.parsedType}),o}return OK(e.data)}};ZodBoolean.create=e=>new ZodBoolean({typeName:eu.ZodBoolean,coerce:(null==e?void 0:e.coerce)||!1,...processCreateParams(e)});let ZodDate=class ZodDate extends ZodType{_parse(e){let t;this._def.coerce&&(e.data=new Date(e.data));let r=this._getType(e);if(r!==n.date){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.date,received:t.parsedType}),o}if(isNaN(e.data.getTime())){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_date}),o}let a=new ParseStatus;for(let r of this._def.checks)"min"===r.kind?e.data.getTime()<r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_small,message:r.message,inclusive:!0,exact:!1,minimum:r.value,type:"date"}),a.dirty()):"max"===r.kind?e.data.getTime()>r.value&&(addIssueToContext(t=this._getOrReturnCtx(e,t),{code:i.too_big,message:r.message,inclusive:!0,exact:!1,maximum:r.value,type:"date"}),a.dirty()):en.assertNever(r);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new ZodDate({...this._def,checks:[...this._def.checks,e]})}min(e,t){return this._addCheck({kind:"min",value:e.getTime(),message:es.toString(t)})}max(e,t){return this._addCheck({kind:"max",value:e.getTime(),message:es.toString(t)})}get minDate(){let e=null;for(let t of this._def.checks)"min"===t.kind&&(null===e||t.value>e)&&(e=t.value);return null!=e?new Date(e):null}get maxDate(){let e=null;for(let t of this._def.checks)"max"===t.kind&&(null===e||t.value<e)&&(e=t.value);return null!=e?new Date(e):null}};ZodDate.create=e=>new ZodDate({checks:[],coerce:(null==e?void 0:e.coerce)||!1,typeName:eu.ZodDate,...processCreateParams(e)});let ZodSymbol=class ZodSymbol extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.symbol){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.symbol,received:t.parsedType}),o}return OK(e.data)}};ZodSymbol.create=e=>new ZodSymbol({typeName:eu.ZodSymbol,...processCreateParams(e)});let ZodUndefined=class ZodUndefined extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.undefined){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.undefined,received:t.parsedType}),o}return OK(e.data)}};ZodUndefined.create=e=>new ZodUndefined({typeName:eu.ZodUndefined,...processCreateParams(e)});let ZodNull=class ZodNull extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.null){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.null,received:t.parsedType}),o}return OK(e.data)}};ZodNull.create=e=>new ZodNull({typeName:eu.ZodNull,...processCreateParams(e)});let ZodAny=class ZodAny extends ZodType{constructor(){super(...arguments),this._any=!0}_parse(e){return OK(e.data)}};ZodAny.create=e=>new ZodAny({typeName:eu.ZodAny,...processCreateParams(e)});let ZodUnknown=class ZodUnknown extends ZodType{constructor(){super(...arguments),this._unknown=!0}_parse(e){return OK(e.data)}};ZodUnknown.create=e=>new ZodUnknown({typeName:eu.ZodUnknown,...processCreateParams(e)});let ZodNever=class ZodNever extends ZodType{_parse(e){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.never,received:t.parsedType}),o}};ZodNever.create=e=>new ZodNever({typeName:eu.ZodNever,...processCreateParams(e)});let ZodVoid=class ZodVoid extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.undefined){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.void,received:t.parsedType}),o}return OK(e.data)}};ZodVoid.create=e=>new ZodVoid({typeName:eu.ZodVoid,...processCreateParams(e)});let ZodArray=class ZodArray extends ZodType{_parse(e){let{ctx:t,status:r}=this._processInputParams(e),a=this._def;if(t.parsedType!==n.array)return addIssueToContext(t,{code:i.invalid_type,expected:n.array,received:t.parsedType}),o;if(null!==a.exactLength){let e=t.data.length>a.exactLength.value,n=t.data.length<a.exactLength.value;(e||n)&&(addIssueToContext(t,{code:e?i.too_big:i.too_small,minimum:n?a.exactLength.value:void 0,maximum:e?a.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:a.exactLength.message}),r.dirty())}if(null!==a.minLength&&t.data.length<a.minLength.value&&(addIssueToContext(t,{code:i.too_small,minimum:a.minLength.value,type:"array",inclusive:!0,exact:!1,message:a.minLength.message}),r.dirty()),null!==a.maxLength&&t.data.length>a.maxLength.value&&(addIssueToContext(t,{code:i.too_big,maximum:a.maxLength.value,type:"array",inclusive:!0,exact:!1,message:a.maxLength.message}),r.dirty()),t.common.async)return Promise.all([...t.data].map((e,r)=>a.type._parseAsync(new ParseInputLazyPath(t,e,t.path,r)))).then(e=>ParseStatus.mergeArray(r,e));let s=[...t.data].map((e,r)=>a.type._parseSync(new ParseInputLazyPath(t,e,t.path,r)));return ParseStatus.mergeArray(r,s)}get element(){return this._def.type}min(e,t){return new ZodArray({...this._def,minLength:{value:e,message:es.toString(t)}})}max(e,t){return new ZodArray({...this._def,maxLength:{value:e,message:es.toString(t)}})}length(e,t){return new ZodArray({...this._def,exactLength:{value:e,message:es.toString(t)}})}nonempty(e){return this.min(1,e)}};function deepPartialify(e){if(e instanceof ZodObject){let t={};for(let r in e.shape){let a=e.shape[r];t[r]=ZodOptional.create(deepPartialify(a))}return new ZodObject({...e._def,shape:()=>t})}return e instanceof ZodArray?new ZodArray({...e._def,type:deepPartialify(e.element)}):e instanceof ZodOptional?ZodOptional.create(deepPartialify(e.unwrap())):e instanceof ZodNullable?ZodNullable.create(deepPartialify(e.unwrap())):e instanceof ZodTuple?ZodTuple.create(e.items.map(e=>deepPartialify(e))):e}ZodArray.create=(e,t)=>new ZodArray({type:e,minLength:null,maxLength:null,exactLength:null,typeName:eu.ZodArray,...processCreateParams(t)});let ZodObject=class ZodObject extends ZodType{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(null!==this._cached)return this._cached;let e=this._def.shape(),t=en.objectKeys(e);return this._cached={shape:e,keys:t}}_parse(e){let t=this._getType(e);if(t!==n.object){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.object,received:t.parsedType}),o}let{status:r,ctx:a}=this._processInputParams(e),{shape:s,keys:l}=this._getCached(),u=[];if(!(this._def.catchall instanceof ZodNever&&"strip"===this._def.unknownKeys))for(let e in a.data)l.includes(e)||u.push(e);let d=[];for(let e of l){let t=s[e],r=a.data[e];d.push({key:{status:"valid",value:e},value:t._parse(new ParseInputLazyPath(a,r,a.path,e)),alwaysSet:e in a.data})}if(this._def.catchall instanceof ZodNever){let e=this._def.unknownKeys;if("passthrough"===e)for(let e of u)d.push({key:{status:"valid",value:e},value:{status:"valid",value:a.data[e]}});else if("strict"===e)u.length>0&&(addIssueToContext(a,{code:i.unrecognized_keys,keys:u}),r.dirty());else if("strip"===e);else throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let e=this._def.catchall;for(let t of u){let r=a.data[t];d.push({key:{status:"valid",value:t},value:e._parse(new ParseInputLazyPath(a,r,a.path,t)),alwaysSet:t in a.data})}}return a.common.async?Promise.resolve().then(async()=>{let e=[];for(let t of d){let r=await t.key,a=await t.value;e.push({key:r,value:a,alwaysSet:t.alwaysSet})}return e}).then(e=>ParseStatus.mergeObjectSync(r,e)):ParseStatus.mergeObjectSync(r,d)}get shape(){return this._def.shape()}strict(e){return es.errToObj,new ZodObject({...this._def,unknownKeys:"strict",...void 0!==e?{errorMap:(t,r)=>{var a,n,i,s;let o=null!==(i=null===(n=(a=this._def).errorMap)||void 0===n?void 0:n.call(a,t,r).message)&&void 0!==i?i:r.defaultError;return"unrecognized_keys"===t.code?{message:null!==(s=es.errToObj(e).message)&&void 0!==s?s:o}:{message:o}}}:{}})}strip(){return new ZodObject({...this._def,unknownKeys:"strip"})}passthrough(){return new ZodObject({...this._def,unknownKeys:"passthrough"})}extend(e){return new ZodObject({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){let t=new ZodObject({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:eu.ZodObject});return t}setKey(e,t){return this.augment({[e]:t})}catchall(e){return new ZodObject({...this._def,catchall:e})}pick(e){let t={};return en.objectKeys(e).forEach(r=>{e[r]&&this.shape[r]&&(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}omit(e){let t={};return en.objectKeys(this.shape).forEach(r=>{e[r]||(t[r]=this.shape[r])}),new ZodObject({...this._def,shape:()=>t})}deepPartial(){return deepPartialify(this)}partial(e){let t={};return en.objectKeys(this.shape).forEach(r=>{let a=this.shape[r];e&&!e[r]?t[r]=a:t[r]=a.optional()}),new ZodObject({...this._def,shape:()=>t})}required(e){let t={};return en.objectKeys(this.shape).forEach(r=>{if(e&&!e[r])t[r]=this.shape[r];else{let e=this.shape[r],a=e;for(;a instanceof ZodOptional;)a=a._def.innerType;t[r]=a}}),new ZodObject({...this._def,shape:()=>t})}keyof(){return createZodEnum(en.objectKeys(this.shape))}};ZodObject.create=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:eu.ZodObject,...processCreateParams(t)}),ZodObject.strictCreate=(e,t)=>new ZodObject({shape:()=>e,unknownKeys:"strict",catchall:ZodNever.create(),typeName:eu.ZodObject,...processCreateParams(t)}),ZodObject.lazycreate=(e,t)=>new ZodObject({shape:e,unknownKeys:"strip",catchall:ZodNever.create(),typeName:eu.ZodObject,...processCreateParams(t)});let ZodUnion=class ZodUnion extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.options;function handleResults(e){for(let t of e)if("valid"===t.result.status)return t.result;for(let r of e)if("dirty"===r.result.status)return t.common.issues.push(...r.ctx.common.issues),r.result;let r=e.map(e=>new ZodError(e.ctx.common.issues));return addIssueToContext(t,{code:i.invalid_union,unionErrors:r}),o}if(t.common.async)return Promise.all(r.map(async e=>{let r={...t,common:{...t.common,issues:[]},parent:null};return{result:await e._parseAsync({data:t.data,path:t.path,parent:r}),ctx:r}})).then(handleResults);{let e;let a=[];for(let n of r){let r={...t,common:{...t.common,issues:[]},parent:null},i=n._parseSync({data:t.data,path:t.path,parent:r});if("valid"===i.status)return i;"dirty"!==i.status||e||(e={result:i,ctx:r}),r.common.issues.length&&a.push(r.common.issues)}if(e)return t.common.issues.push(...e.ctx.common.issues),e.result;let n=a.map(e=>new ZodError(e));return addIssueToContext(t,{code:i.invalid_union,unionErrors:n}),o}}get options(){return this._def.options}};ZodUnion.create=(e,t)=>new ZodUnion({options:e,typeName:eu.ZodUnion,...processCreateParams(t)});let getDiscriminator=e=>{if(e instanceof ZodLazy)return getDiscriminator(e.schema);if(e instanceof ZodEffects)return getDiscriminator(e.innerType());if(e instanceof ZodLiteral)return[e.value];if(e instanceof ZodEnum)return e.options;if(e instanceof ZodNativeEnum)return en.objectValues(e.enum);if(e instanceof ZodDefault)return getDiscriminator(e._def.innerType);if(e instanceof ZodUndefined)return[void 0];else if(e instanceof ZodNull)return[null];else if(e instanceof ZodOptional)return[void 0,...getDiscriminator(e.unwrap())];else if(e instanceof ZodNullable)return[null,...getDiscriminator(e.unwrap())];else if(e instanceof ZodBranded)return getDiscriminator(e.unwrap());else if(e instanceof ZodReadonly)return getDiscriminator(e.unwrap());else if(e instanceof ZodCatch)return getDiscriminator(e._def.innerType);else return[]};let ZodDiscriminatedUnion=class ZodDiscriminatedUnion extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==n.object)return addIssueToContext(t,{code:i.invalid_type,expected:n.object,received:t.parsedType}),o;let r=this.discriminator,a=t.data[r],s=this.optionsMap.get(a);return s?t.common.async?s._parseAsync({data:t.data,path:t.path,parent:t}):s._parseSync({data:t.data,path:t.path,parent:t}):(addIssueToContext(t,{code:i.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),o)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,t,r){let a=new Map;for(let r of t){let t=getDiscriminator(r.shape[e]);if(!t.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let n of t){if(a.has(n))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(n)}`);a.set(n,r)}}return new ZodDiscriminatedUnion({typeName:eu.ZodDiscriminatedUnion,discriminator:e,options:t,optionsMap:a,...processCreateParams(r)})}};function mergeValues(e,t){let r=getParsedType(e),a=getParsedType(t);if(e===t)return{valid:!0,data:e};if(r===n.object&&a===n.object){let r=en.objectKeys(t),a=en.objectKeys(e).filter(e=>-1!==r.indexOf(e)),n={...e,...t};for(let r of a){let a=mergeValues(e[r],t[r]);if(!a.valid)return{valid:!1};n[r]=a.data}return{valid:!0,data:n}}if(r===n.array&&a===n.array){if(e.length!==t.length)return{valid:!1};let r=[];for(let a=0;a<e.length;a++){let n=e[a],i=t[a],s=mergeValues(n,i);if(!s.valid)return{valid:!1};r.push(s.data)}return{valid:!0,data:r}}return r===n.date&&a===n.date&&+e==+t?{valid:!0,data:e}:{valid:!1}}let ZodIntersection=class ZodIntersection extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e),handleParsed=(e,a)=>{if(isAborted(e)||isAborted(a))return o;let n=mergeValues(e.value,a.value);return n.valid?((isDirty(e)||isDirty(a))&&t.dirty(),{status:t.value,value:n.data}):(addIssueToContext(r,{code:i.invalid_intersection_types}),o)};return r.common.async?Promise.all([this._def.left._parseAsync({data:r.data,path:r.path,parent:r}),this._def.right._parseAsync({data:r.data,path:r.path,parent:r})]).then(([e,t])=>handleParsed(e,t)):handleParsed(this._def.left._parseSync({data:r.data,path:r.path,parent:r}),this._def.right._parseSync({data:r.data,path:r.path,parent:r}))}};ZodIntersection.create=(e,t,r)=>new ZodIntersection({left:e,right:t,typeName:eu.ZodIntersection,...processCreateParams(r)});let ZodTuple=class ZodTuple extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.array)return addIssueToContext(r,{code:i.invalid_type,expected:n.array,received:r.parsedType}),o;if(r.data.length<this._def.items.length)return addIssueToContext(r,{code:i.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),o;let a=this._def.rest;!a&&r.data.length>this._def.items.length&&(addIssueToContext(r,{code:i.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),t.dirty());let s=[...r.data].map((e,t)=>{let a=this._def.items[t]||this._def.rest;return a?a._parse(new ParseInputLazyPath(r,e,r.path,t)):null}).filter(e=>!!e);return r.common.async?Promise.all(s).then(e=>ParseStatus.mergeArray(t,e)):ParseStatus.mergeArray(t,s)}get items(){return this._def.items}rest(e){return new ZodTuple({...this._def,rest:e})}};ZodTuple.create=(e,t)=>{if(!Array.isArray(e))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new ZodTuple({items:e,typeName:eu.ZodTuple,rest:null,...processCreateParams(t)})};let ZodRecord=class ZodRecord extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.object)return addIssueToContext(r,{code:i.invalid_type,expected:n.object,received:r.parsedType}),o;let a=[],s=this._def.keyType,l=this._def.valueType;for(let e in r.data)a.push({key:s._parse(new ParseInputLazyPath(r,e,r.path,e)),value:l._parse(new ParseInputLazyPath(r,r.data[e],r.path,e)),alwaysSet:e in r.data});return r.common.async?ParseStatus.mergeObjectAsync(t,a):ParseStatus.mergeObjectSync(t,a)}get element(){return this._def.valueType}static create(e,t,r){return new ZodRecord(t instanceof ZodType?{keyType:e,valueType:t,typeName:eu.ZodRecord,...processCreateParams(r)}:{keyType:ZodString.create(),valueType:e,typeName:eu.ZodRecord,...processCreateParams(t)})}};let ZodMap=class ZodMap extends ZodType{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.map)return addIssueToContext(r,{code:i.invalid_type,expected:n.map,received:r.parsedType}),o;let a=this._def.keyType,s=this._def.valueType,l=[...r.data.entries()].map(([e,t],n)=>({key:a._parse(new ParseInputLazyPath(r,e,r.path,[n,"key"])),value:s._parse(new ParseInputLazyPath(r,t,r.path,[n,"value"]))}));if(r.common.async){let e=new Map;return Promise.resolve().then(async()=>{for(let r of l){let a=await r.key,n=await r.value;if("aborted"===a.status||"aborted"===n.status)return o;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}})}{let e=new Map;for(let r of l){let a=r.key,n=r.value;if("aborted"===a.status||"aborted"===n.status)return o;("dirty"===a.status||"dirty"===n.status)&&t.dirty(),e.set(a.value,n.value)}return{status:t.value,value:e}}}};ZodMap.create=(e,t,r)=>new ZodMap({valueType:t,keyType:e,typeName:eu.ZodMap,...processCreateParams(r)});let ZodSet=class ZodSet extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.parsedType!==n.set)return addIssueToContext(r,{code:i.invalid_type,expected:n.set,received:r.parsedType}),o;let a=this._def;null!==a.minSize&&r.data.size<a.minSize.value&&(addIssueToContext(r,{code:i.too_small,minimum:a.minSize.value,type:"set",inclusive:!0,exact:!1,message:a.minSize.message}),t.dirty()),null!==a.maxSize&&r.data.size>a.maxSize.value&&(addIssueToContext(r,{code:i.too_big,maximum:a.maxSize.value,type:"set",inclusive:!0,exact:!1,message:a.maxSize.message}),t.dirty());let s=this._def.valueType;function finalizeSet(e){let r=new Set;for(let a of e){if("aborted"===a.status)return o;"dirty"===a.status&&t.dirty(),r.add(a.value)}return{status:t.value,value:r}}let l=[...r.data.values()].map((e,t)=>s._parse(new ParseInputLazyPath(r,e,r.path,t)));return r.common.async?Promise.all(l).then(e=>finalizeSet(e)):finalizeSet(l)}min(e,t){return new ZodSet({...this._def,minSize:{value:e,message:es.toString(t)}})}max(e,t){return new ZodSet({...this._def,maxSize:{value:e,message:es.toString(t)}})}size(e,t){return this.min(e,t).max(e,t)}nonempty(e){return this.min(1,e)}};ZodSet.create=(e,t)=>new ZodSet({valueType:e,minSize:null,maxSize:null,typeName:eu.ZodSet,...processCreateParams(t)});let ZodFunction=class ZodFunction extends ZodType{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==n.function)return addIssueToContext(t,{code:i.invalid_type,expected:n.function,received:t.parsedType}),o;function makeArgsIssue(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e),issueData:{code:i.invalid_arguments,argumentsError:r}})}function makeReturnsIssue(e,r){return makeIssue({data:e,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,getErrorMap(),errorMap].filter(e=>!!e),issueData:{code:i.invalid_return_type,returnTypeError:r}})}let r={errorMap:t.common.contextualErrorMap},a=t.data;if(this._def.returns instanceof ZodPromise){let e=this;return OK(async function(...t){let n=new ZodError([]),i=await e._def.args.parseAsync(t,r).catch(e=>{throw n.addIssue(makeArgsIssue(t,e)),n}),s=await Reflect.apply(a,this,i),o=await e._def.returns._def.type.parseAsync(s,r).catch(e=>{throw n.addIssue(makeReturnsIssue(s,e)),n});return o})}{let e=this;return OK(function(...t){let n=e._def.args.safeParse(t,r);if(!n.success)throw new ZodError([makeArgsIssue(t,n.error)]);let i=Reflect.apply(a,this,n.data),s=e._def.returns.safeParse(i,r);if(!s.success)throw new ZodError([makeReturnsIssue(i,s.error)]);return s.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new ZodFunction({...this._def,args:ZodTuple.create(e).rest(ZodUnknown.create())})}returns(e){return new ZodFunction({...this._def,returns:e})}implement(e){let t=this.parse(e);return t}strictImplement(e){let t=this.parse(e);return t}static create(e,t,r){return new ZodFunction({args:e||ZodTuple.create([]).rest(ZodUnknown.create()),returns:t||ZodUnknown.create(),typeName:eu.ZodFunction,...processCreateParams(r)})}};let ZodLazy=class ZodLazy extends ZodType{get schema(){return this._def.getter()}_parse(e){let{ctx:t}=this._processInputParams(e),r=this._def.getter();return r._parse({data:t.data,path:t.path,parent:t})}};ZodLazy.create=(e,t)=>new ZodLazy({getter:e,typeName:eu.ZodLazy,...processCreateParams(t)});let ZodLiteral=class ZodLiteral extends ZodType{_parse(e){if(e.data!==this._def.value){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{received:t.data,code:i.invalid_literal,expected:this._def.value}),o}return{status:"valid",value:e.data}}get value(){return this._def.value}};function createZodEnum(e,t){return new ZodEnum({values:e,typeName:eu.ZodEnum,...processCreateParams(t)})}ZodLiteral.create=(e,t)=>new ZodLiteral({value:e,typeName:eu.ZodLiteral,...processCreateParams(t)});let ZodEnum=class ZodEnum extends ZodType{constructor(){super(...arguments),eo.set(this,void 0)}_parse(e){if("string"!=typeof e.data){let t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{expected:en.joinValues(r),received:t.parsedType,code:i.invalid_type}),o}if(__classPrivateFieldGet(this,eo,"f")||__classPrivateFieldSet(this,eo,new Set(this._def.values),"f"),!__classPrivateFieldGet(this,eo,"f").has(e.data)){let t=this._getOrReturnCtx(e),r=this._def.values;return addIssueToContext(t,{received:t.data,code:i.invalid_enum_value,options:r}),o}return OK(e.data)}get options(){return this._def.values}get enum(){let e={};for(let t of this._def.values)e[t]=t;return e}get Values(){let e={};for(let t of this._def.values)e[t]=t;return e}get Enum(){let e={};for(let t of this._def.values)e[t]=t;return e}extract(e,t=this._def){return ZodEnum.create(e,{...this._def,...t})}exclude(e,t=this._def){return ZodEnum.create(this.options.filter(t=>!e.includes(t)),{...this._def,...t})}};eo=new WeakMap,ZodEnum.create=createZodEnum;let ZodNativeEnum=class ZodNativeEnum extends ZodType{constructor(){super(...arguments),el.set(this,void 0)}_parse(e){let t=en.getValidEnumValues(this._def.values),r=this._getOrReturnCtx(e);if(r.parsedType!==n.string&&r.parsedType!==n.number){let e=en.objectValues(t);return addIssueToContext(r,{expected:en.joinValues(e),received:r.parsedType,code:i.invalid_type}),o}if(__classPrivateFieldGet(this,el,"f")||__classPrivateFieldSet(this,el,new Set(en.getValidEnumValues(this._def.values)),"f"),!__classPrivateFieldGet(this,el,"f").has(e.data)){let e=en.objectValues(t);return addIssueToContext(r,{received:r.data,code:i.invalid_enum_value,options:e}),o}return OK(e.data)}get enum(){return this._def.values}};el=new WeakMap,ZodNativeEnum.create=(e,t)=>new ZodNativeEnum({values:e,typeName:eu.ZodNativeEnum,...processCreateParams(t)});let ZodPromise=class ZodPromise extends ZodType{unwrap(){return this._def.type}_parse(e){let{ctx:t}=this._processInputParams(e);if(t.parsedType!==n.promise&&!1===t.common.async)return addIssueToContext(t,{code:i.invalid_type,expected:n.promise,received:t.parsedType}),o;let r=t.parsedType===n.promise?t.data:Promise.resolve(t.data);return OK(r.then(e=>this._def.type.parseAsync(e,{path:t.path,errorMap:t.common.contextualErrorMap})))}};ZodPromise.create=(e,t)=>new ZodPromise({type:e,typeName:eu.ZodPromise,...processCreateParams(t)});let ZodEffects=class ZodEffects extends ZodType{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===eu.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(e){let{status:t,ctx:r}=this._processInputParams(e),a=this._def.effect||null,n={addIssue:e=>{addIssueToContext(r,e),e.fatal?t.abort():t.dirty()},get path(){return r.path}};if(n.addIssue=n.addIssue.bind(n),"preprocess"===a.type){let e=a.transform(r.data,n);if(r.common.async)return Promise.resolve(e).then(async e=>{if("aborted"===t.value)return o;let a=await this._def.schema._parseAsync({data:e,path:r.path,parent:r});return"aborted"===a.status?o:"dirty"===a.status||"dirty"===t.value?DIRTY(a.value):a});{if("aborted"===t.value)return o;let a=this._def.schema._parseSync({data:e,path:r.path,parent:r});return"aborted"===a.status?o:"dirty"===a.status||"dirty"===t.value?DIRTY(a.value):a}}if("refinement"===a.type){let executeRefinement=e=>{let t=a.refinement(e,n);if(r.common.async)return Promise.resolve(t);if(t instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return e};if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>"aborted"===e.status?o:("dirty"===e.status&&t.dirty(),executeRefinement(e.value).then(()=>({status:t.value,value:e.value}))));{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o:("dirty"===e.status&&t.dirty(),executeRefinement(e.value),{status:t.value,value:e.value})}}if("transform"===a.type){if(!1!==r.common.async)return this._def.schema._parseAsync({data:r.data,path:r.path,parent:r}).then(e=>isValid(e)?Promise.resolve(a.transform(e.value,n)).then(e=>({status:t.value,value:e})):e);{let e=this._def.schema._parseSync({data:r.data,path:r.path,parent:r});if(!isValid(e))return e;let i=a.transform(e.value,n);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:t.value,value:i}}}en.assertNever(a)}};ZodEffects.create=(e,t,r)=>new ZodEffects({schema:e,typeName:eu.ZodEffects,effect:t,...processCreateParams(r)}),ZodEffects.createWithPreprocess=(e,t,r)=>new ZodEffects({schema:t,effect:{type:"preprocess",transform:e},typeName:eu.ZodEffects,...processCreateParams(r)});let ZodOptional=class ZodOptional extends ZodType{_parse(e){let t=this._getType(e);return t===n.undefined?OK(void 0):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ZodOptional.create=(e,t)=>new ZodOptional({innerType:e,typeName:eu.ZodOptional,...processCreateParams(t)});let ZodNullable=class ZodNullable extends ZodType{_parse(e){let t=this._getType(e);return t===n.null?OK(null):this._def.innerType._parse(e)}unwrap(){return this._def.innerType}};ZodNullable.create=(e,t)=>new ZodNullable({innerType:e,typeName:eu.ZodNullable,...processCreateParams(t)});let ZodDefault=class ZodDefault extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return t.parsedType===n.undefined&&(r=this._def.defaultValue()),this._def.innerType._parse({data:r,path:t.path,parent:t})}removeDefault(){return this._def.innerType}};ZodDefault.create=(e,t)=>new ZodDefault({innerType:e,typeName:eu.ZodDefault,defaultValue:"function"==typeof t.default?t.default:()=>t.default,...processCreateParams(t)});let ZodCatch=class ZodCatch extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r={...t,common:{...t.common,issues:[]}},a=this._def.innerType._parse({data:r.data,path:r.path,parent:{...r}});return isAsync(a)?a.then(e=>({status:"valid",value:"valid"===e.status?e.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})})):{status:"valid",value:"valid"===a.status?a.value:this._def.catchValue({get error(){return new ZodError(r.common.issues)},input:r.data})}}removeCatch(){return this._def.innerType}};ZodCatch.create=(e,t)=>new ZodCatch({innerType:e,typeName:eu.ZodCatch,catchValue:"function"==typeof t.catch?t.catch:()=>t.catch,...processCreateParams(t)});let ZodNaN=class ZodNaN extends ZodType{_parse(e){let t=this._getType(e);if(t!==n.nan){let t=this._getOrReturnCtx(e);return addIssueToContext(t,{code:i.invalid_type,expected:n.nan,received:t.parsedType}),o}return{status:"valid",value:e.data}}};ZodNaN.create=e=>new ZodNaN({typeName:eu.ZodNaN,...processCreateParams(e)});let v=Symbol("zod_brand");let ZodBranded=class ZodBranded extends ZodType{_parse(e){let{ctx:t}=this._processInputParams(e),r=t.data;return this._def.type._parse({data:r,path:t.path,parent:t})}unwrap(){return this._def.type}};let ZodPipeline=class ZodPipeline extends ZodType{_parse(e){let{status:t,ctx:r}=this._processInputParams(e);if(r.common.async){let handleAsync=async()=>{let e=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o:"dirty"===e.status?(t.dirty(),DIRTY(e.value)):this._def.out._parseAsync({data:e.value,path:r.path,parent:r})};return handleAsync()}{let e=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return"aborted"===e.status?o:"dirty"===e.status?(t.dirty(),{status:"dirty",value:e.value}):this._def.out._parseSync({data:e.value,path:r.path,parent:r})}}static create(e,t){return new ZodPipeline({in:e,out:t,typeName:eu.ZodPipeline})}};let ZodReadonly=class ZodReadonly extends ZodType{_parse(e){let t=this._def.innerType._parse(e);return isValid(t)&&(t.value=Object.freeze(t.value)),t}unwrap(){return this._def.innerType}};function custom(e,t={},r){return e?ZodAny.create().superRefine((a,n)=>{var i,s;if(!e(a)){let e="function"==typeof t?t(a):"string"==typeof t?{message:t}:t,o=null===(s=null!==(i=e.fatal)&&void 0!==i?i:r)||void 0===s||s,l="string"==typeof e?{message:e}:e;n.addIssue({code:"custom",...l,fatal:o})}}):ZodAny.create()}ZodReadonly.create=(e,t)=>new ZodReadonly({innerType:e,typeName:eu.ZodReadonly,...processCreateParams(t)});let w={object:ZodObject.lazycreate};(ea=eu||(eu={})).ZodString="ZodString",ea.ZodNumber="ZodNumber",ea.ZodNaN="ZodNaN",ea.ZodBigInt="ZodBigInt",ea.ZodBoolean="ZodBoolean",ea.ZodDate="ZodDate",ea.ZodSymbol="ZodSymbol",ea.ZodUndefined="ZodUndefined",ea.ZodNull="ZodNull",ea.ZodAny="ZodAny",ea.ZodUnknown="ZodUnknown",ea.ZodNever="ZodNever",ea.ZodVoid="ZodVoid",ea.ZodArray="ZodArray",ea.ZodObject="ZodObject",ea.ZodUnion="ZodUnion",ea.ZodDiscriminatedUnion="ZodDiscriminatedUnion",ea.ZodIntersection="ZodIntersection",ea.ZodTuple="ZodTuple",ea.ZodRecord="ZodRecord",ea.ZodMap="ZodMap",ea.ZodSet="ZodSet",ea.ZodFunction="ZodFunction",ea.ZodLazy="ZodLazy",ea.ZodLiteral="ZodLiteral",ea.ZodEnum="ZodEnum",ea.ZodEffects="ZodEffects",ea.ZodNativeEnum="ZodNativeEnum",ea.ZodOptional="ZodOptional",ea.ZodNullable="ZodNullable",ea.ZodDefault="ZodDefault",ea.ZodCatch="ZodCatch",ea.ZodPromise="ZodPromise",ea.ZodBranded="ZodBranded",ea.ZodPipeline="ZodPipeline",ea.ZodReadonly="ZodReadonly";let k=ZodString.create,T=ZodNumber.create,E=ZodNaN.create,O=ZodBigInt.create,C=ZodBoolean.create,x=ZodDate.create,P=ZodSymbol.create,A=ZodUndefined.create,S=ZodNull.create,I=ZodAny.create,R=ZodUnknown.create,Z=ZodNever.create,j=ZodVoid.create,N=ZodArray.create,M=ZodObject.create,L=ZodObject.strictCreate,D=ZodUnion.create,$=ZodDiscriminatedUnion.create,U=ZodIntersection.create,B=ZodTuple.create,F=ZodRecord.create,z=ZodMap.create,H=ZodSet.create,V=ZodFunction.create,q=ZodLazy.create,J=ZodLiteral.create,G=ZodEnum.create,W=ZodNativeEnum.create,K=ZodPromise.create,Q=ZodEffects.create,Y=ZodOptional.create,X=ZodNullable.create,ee=ZodEffects.createWithPreprocess,et=ZodPipeline.create;var er,ea,en,ei,es,eo,el,eu,ed=Object.freeze({__proto__:null,defaultErrorMap:errorMap,setErrorMap:setErrorMap,getErrorMap:getErrorMap,makeIssue:makeIssue,EMPTY_PATH:[],addIssueToContext:addIssueToContext,ParseStatus:ParseStatus,INVALID:o,DIRTY:DIRTY,OK:OK,isAborted:isAborted,isDirty:isDirty,isValid:isValid,isAsync:isAsync,get util(){return en},get objectUtil(){return ei},ZodParsedType:n,getParsedType:getParsedType,ZodType:ZodType,datetimeRegex:datetimeRegex,ZodString:ZodString,ZodNumber:ZodNumber,ZodBigInt:ZodBigInt,ZodBoolean:ZodBoolean,ZodDate:ZodDate,ZodSymbol:ZodSymbol,ZodUndefined:ZodUndefined,ZodNull:ZodNull,ZodAny:ZodAny,ZodUnknown:ZodUnknown,ZodNever:ZodNever,ZodVoid:ZodVoid,ZodArray:ZodArray,ZodObject:ZodObject,ZodUnion:ZodUnion,ZodDiscriminatedUnion:ZodDiscriminatedUnion,ZodIntersection:ZodIntersection,ZodTuple:ZodTuple,ZodRecord:ZodRecord,ZodMap:ZodMap,ZodSet:ZodSet,ZodFunction:ZodFunction,ZodLazy:ZodLazy,ZodLiteral:ZodLiteral,ZodEnum:ZodEnum,ZodNativeEnum:ZodNativeEnum,ZodPromise:ZodPromise,ZodEffects:ZodEffects,ZodTransformer:ZodEffects,ZodOptional:ZodOptional,ZodNullable:ZodNullable,ZodDefault:ZodDefault,ZodCatch:ZodCatch,ZodNaN:ZodNaN,BRAND:v,ZodBranded:ZodBranded,ZodPipeline:ZodPipeline,ZodReadonly:ZodReadonly,custom:custom,Schema:ZodType,ZodSchema:ZodType,late:w,get ZodFirstPartyTypeKind(){return eu},coerce:{string:e=>ZodString.create({...e,coerce:!0}),number:e=>ZodNumber.create({...e,coerce:!0}),boolean:e=>ZodBoolean.create({...e,coerce:!0}),bigint:e=>ZodBigInt.create({...e,coerce:!0}),date:e=>ZodDate.create({...e,coerce:!0})},any:I,array:N,bigint:O,boolean:C,date:x,discriminatedUnion:$,effect:Q,enum:G,function:V,instanceof:(e,t={message:`Input not instance of ${e.name}`})=>custom(t=>t instanceof e,t),intersection:U,lazy:q,literal:J,map:z,nan:E,nativeEnum:W,never:Z,null:S,nullable:X,number:T,object:M,oboolean:()=>C().optional(),onumber:()=>T().optional(),optional:Y,ostring:()=>k().optional(),pipeline:et,preprocess:ee,promise:K,record:F,set:H,strictObject:L,string:k,symbol:P,transformer:Q,tuple:B,undefined:A,union:D,unknown:R,void:j,NEVER:o,ZodIssueCode:i,quotelessJson:e=>{let t=JSON.stringify(e,null,2);return t.replace(/"([^"]+)":/g,"$1:")},ZodError:ZodError})}}]);